(function(a){function e(a,c){c=c||b;var e=a.split("."),f,g=e.length;for(f=0;f<g;f++){a=e[f];if(c==b&&(a=="travelline"||a=="TL"))continue;var i=c[a];if(!i||!(i instanceof d))c[a]=new d,i&&h(c[a],i);c=c[a]}return c}function f(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a.__super__.constructor=b,a}function g(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c&&typeof c=="object")for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a}function h(a,b){if(b)for(var c in b)!a.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var b=a.TL||a.travelline;if(b&&b._NS&&b instanceof b._NS)return;var c=Array.prototype.slice,d=function(){};d.prototype={extend:function(){var a=[this].concat(c.call(arguments,0));return g.apply(this,a)},define:function(a){return e(a,this)}},b=h(new d,b),b.ns=b.define,b._extends=f,b._NS=d,a.travelline=a.TL=b})(window),function(a){function e(a){return typeof a=="function"}function f(a,g){if(c[a]==null){if(!b[a]){if(e(g)){d[a]=d[a]||[],d[a].push(g);return}throw new Error("TL module with name '"+a+"' not defined")}if(e(b[a])){var h={},i={exports:h},j=b[a](f,h,i);j==null&&(j=i.exports),c[a]=j}else c[a]=b[a]}return e(g)&&g(c[a]),c[a]}function g(a,c){if(b[a])throw new Error("TL module with name '"+a+"' already defined");b[a]=c;if(d[a]){for(var e=d[a],f=0;f<e.length;f++)e[f](c);delete d[a]}}if(a.modules)return;var b={},c={},d={};a.modules={define:g,run:function(a,b){return a.apply(null,[f].concat(b))}}}(TL);;

TL.ns("integration.xfc"),function(a){function b(b,c,d){function q(){return j++}function r(a,b){var c=h[a];delete h[a],c&&setTimeout(function(){c(b)},1)}function s(a,b,c){b&&typeof b=="function"&&(h[a]=b,c>0&&setTimeout(function(){r(a,"timeout")},c))}function t(a,b,c){a instanceof p||(a=new p(q(),a)),s(a.id,b,c||0);try{f.postMessage(a.pack(),e)}catch(d){r(a.id,"error")}}function u(a){if(!p.canUnpack(a))return;var b=p.unpack(a);if(b.data===m){r(b.id,"success");return}t(new p(b.id,m));for(var c=0;c<g.length;c++){var d=g[c];setTimeout(function(){d(b.data)},1)}}function w(){a.removeEventListener("message",v),a.addEventListener("message",v,!1),clearInterval(l),l=setInterval(function(){k||w(),k=!1;try{a.postMessage(n,"*")}catch(b){}},3e3)}function x(a){a&&typeof a=="function"&&g.push(a),g.length==1&&w()}var e=c||"*",f=b||null,g=[],h={},i=d||String(Math.random()).substr(2),j=1,k=!1,l,m="--OK--",n="--TEST--",o="!TL!"+i+"!",p=function(a,b){this.id=a,this.data=b,this.pack=function(){return o+JSON.stringify(this)}};p.unpack=function(a){return JSON.parse(a.substr(o.length))},p.canUnpack=function(a){return typeof a=="string"&&a.indexOf(o)===0&&JSON&&JSON.parse};var v=function(a){k=!0,u(a.data)};this.postMessage=t,this.onMessage=x,this.connectionId=i}TL.integration.xfc.XFrameConnectLite=b}(window);;

TL.modules.run(function(a,b,c){function k(a,b,c,d){b=f({},b,{_method:a}),j.postMessage(b,c,d)}function l(a,b,c){c=f({},c,{_event:b}),k(a,c)}var d=function(){var a={},b=location.search.substr(1).split("&");for(var c in b){var d=b[c].split("=");a[d[0]]=decodeURIComponent(d[1])}return a},e=function(a){return typeof a=="function"},f=function(){var a={};for(var b=0;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},g=d(),h=g.origin,i=g.conId,j=new c.integration.xfc.XFrameConnectLite(b.parent,h,i),m=function(a,b,c,d,f,g,h,i){this._params=f,this._env=a,this._source=b,this._referrer=c,this._referrerUrl=i,this._integrationKey=d,this._position=g,this._timings=h,this._frameEventCallbacks={},this._integrationEventCallbacks={},this._handleEvent=function(a,b){var c=b._event;if(a[c])for(var d in a[c]){var f=a[c][d];e(f)&&f(b)}},this._handleFrameEvent=function(a){this._handleEvent(this._frameEventCallbacks,a)},this._handleIntegrationEvent=function(a){this._handleEvent(this._integrationEventCallbacks,a)},this.hideLoader=function(){k("connect")},this.fireEvent=function(a,b){l("handleEvent",a,b)},this.isAvailable=function(){return!0},this.getProperties=function(){return this._params},this.getEnv=function(){return this._env},this.getSource=function(){return this._source},this.getReferrerCode=function(){return this._referrer},this.getReferrerUrl=function(){return this._referrerUrl},this.getIntegrationKey=function(){return this._integrationKey},this.getTimings=function(){return this._timings},this.scrollTo=function(a,b){var c=function(){k("scroll"),document.body.removeEventListener("touchmove",c),document.body.removeEventListener("wheel",c)};k("scrollTo",{offsetY:a,ignoreStickyHeader:b}),document.body.addEventListener("touchmove",c),document.body.addEventListener("wheel",c)},this.getPosition=function(){return this._position},this.showImages=function(a,b){b.urls=a,k("showImages",b)},this.subscribeEvent=function(a,b){this._integrationEventCallbacks[a]||(this._integrationEventCallbacks[a]=[]),this._integrationEventCallbacks[a].push(b)},this.redirect=function(a){k("redirect",{url:a})},this.frameCreate=function(a,b,c){k("frameCreate",{url:a,config:b,role:c})},this.frameSubscribeEvent=function(a,b){this._frameEventCallbacks[a]||(this._frameEventCallbacks[a]=[]),this._frameEventCallbacks[a].push(b)},this.frameFireEvent=function(a,b){l("frameFireEvent",a,b)}};c.AppContainer={_appIntegration:null,_readyCallbacks:[],_autoresize:function(){var a=this._appIntegration.getProperties();if(!a)return;var b=function(){return{height:Math.max(document.body.offsetHeight,1),width:a.width?a.width:document.body.offsetWidth}},c,d,e,f=this;setInterval(function(){var a=b();if(c!=a.width||d!=a.height)f._resize(a),c=a.width,d=a.height},50)},_resize:function(a){k("resize",a)},_updatePosition:function(a){this._appIntegration&&(this._appIntegration._position=a)},_handleFrameEvent:function(a){this._appIntegration&&this._appIntegration._handleFrameEvent(a)},_handleIntegrationEvent:function(a){this._appIntegration&&this._appIntegration._handleIntegrationEvent(a)},_init:function(a){if(!this._appIntegration){this._appIntegration=new m(a.env,a.source,a.referrer,a.integrationKey,a.params,a.position,a.timings,a.referrerUrl);while(this._readyCallbacks.length>0){var b=this._readyCallbacks.shift();e(b)&&b(this._appIntegration)}this._autoresize()}},ready:function(a){if(this._appIntegration)e(a)&&a(this._appIntegration);else{this._readyCallbacks.push(a);if(this._readyCallbacks.length==1){var b=function(a){k("init",null,function(c){c!=="success"&&a<5&&b(++a)},3e3)};b(0)}}}};var n={init:function(a){c.AppContainer._init(a)},updatePosition:function(a){c.AppContainer._updatePosition(a)},handleFrameEvent:function(a){c.AppContainer._handleFrameEvent(a)},handleIntegrationEvent:function(a){c.AppContainer._handleIntegrationEvent(a)}};j.onMessage(function(a){var b=n[a._method];delete a._method,e(b)&&b.call(this,a)})},[window,TL]);;
