var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<i;t++)for(var r=arguments[t],a=0,s=r.length;a<s;a++,o++)n[o]=r[a];return n},tl,tl,appParams,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,_a,_b,l10nHyponline48=(!function(e){function t(){}function i(){}function n(){}function o(){}function r(){}function a(){}function s(){}function l(){}function c(){}function u(){}t.BookingSuccess="bookingSuccess",t.BookingFailure="bookingFailure",t.BookingEdit="bookingEdit",t.NoAvailableRooms="noAvailableRooms",t.SearchRooms="searchRooms",t.ClearSearchParams="clearSearchParams",t.BookingStepChanged="bookingStepChanged",t.LanguageChanged="languageChanged",t.CurrencyChanged="currencyChanged",t.TrackUserAction="trackUserAction",t.VisitorsOnlineWidget="visitorsOnlineWidget",t.Snackbar="snackbar",t.PushArtifact="pushArtifact",t.UpdateGuestToken="updateGuestToken",t.MetaSearchTrackBooking="metaSearchTrackBooking",e.AppIntegrationEvent=t,i.Search="search",i.Preview="preview",i.Payment="payment",i.Complete="complete",i.Room="room",e.AppIntegrationEvent__BookingStep=i,n.Cancel="cancel",e.AppIntegrationEvent__BookingEdit__EditKind=n,o.PayButton="payment-pay-button",o.RoomsChangeSearchButton="rooms-change-search-button",o.RoomsBookButton="rooms-book-button",o.RoomsCartBookButton="rooms-cart-book-button",o.ServicesCartBookButton="services-cart-book-button",o.ServicesBookLink="services-book-link",e.AppIntegrationEvent__TrackUserAction__ClickTarget=o,r.Email="email",r.Phone="phone",r.Name="name",e.AppIntegrationEvent__TrackUserAction__FieldKind=r,a.ChangeOrderPrice="change-order-price",a.SelectRoom="select-room",a.UpgradeRoom="upgrade-room",a.UpdateOptions="update-options",a.ChangeDates="change-dates",a.SearchRooms="search-rooms",a.Click="click",a.Type="type",a.Interact="interact",a.CopyToClipboard="copy-to-clipboard",a.MirRegister="mir-register",e.AppIntegration__TrackUserAction__UserAction=a,s.None="none",s.Always="always",s.Transition="transition",e.AppIntegrationAutoScroll=s,l.Auto="auto",l.Booking="booking",l.EditBooking="edit-booking",l.Rooms="rooms",l.Cancellation="cancellation",l.PriceList="price-list",l.RestoreBooking="restore-booking",l.ApproveBooking="approve-booking",l.ChangeCard="change-card",l.DeferredPayment="deferred-payment",l.Components="components",l.Survey="survey",e.AppIntegrationState=l,c.Search="search",e.AppIntegrationStep=c,u.convert=function(e){return{text:u.Text,image:u.Image}[e]},u.Text="text",u.Image="image",e.LanguageControlType=u}(tl=tl||{}),Date.prototype.WeekDaysNames={su:0,mo:1,tu:2,we:3,th:4,fr:5,sa:6},Date.prototype.addMinutes=function(e){return this.moment().add(e,"minute").toDate()},Date.prototype.addDays=function(e){return this.moment().add(e,"day").toDate()},Date.prototype.subtractDays=function(e){return this.moment().subtract(e,"day").toDate()},Date.prototype.addMonths=function(e){return this.moment().add(e,"months").toDate()},Date.prototype.addYears=function(e){return this.moment().add(e,"years").toDate()},Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.resetTime=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())},Date.prototype.resetDate=function(){return new Date(this.getFullYear(),this.getMonth())},Date.prototype.moment=function(){return moment(this)},Date.prototype.diffInMonths=function(e){return this.resetTime().moment().diff(e.resetDate().moment(),"months")},Date.prototype.diffInDays=function(e){return this.resetTime().moment().diff(e.resetTime().moment(),"days")},Date.prototype.diffInSeconds=function(e){return this.moment().diff(e.moment(),"seconds")},Date.prototype.diffInMs=function(e){return this.moment().valueOf()-e.moment().valueOf()},Date.prototype.isEqualTime=function(e){return e.getHours()==this.getHours()&&e.getMinutes()==this.getMinutes()},Date.prototype.isEqualDate=function(e){return e.getFullYear()==this.getFullYear()&&e.getMonth()==this.getMonth()&&e.getDate()==this.getDate()},Date.prototype.isSame=function(e){return this.isEqualTime(e)&&this.isEqualDate(e)},Date.prototype.formatTimezoneOffset=function(){return this.moment().format("Z")},Date.prototype.format=function(e){return this.moment().format(e)},Date.prototype.setNextDayOfWeek=function(e){var e=this.WeekDaysNames[e],t=this.getDay();void 0===e&&e===t||this.setDate(this.getDate()+(e+(7-t))%7)},Object.defineProperty(Date,"millisecondsInMinute",{value:6e4}),Object.defineProperty(Date,"millisecondsInDay",{value:864e5}),!function(e){var t;function i(){}function n(){}function o(){}function r(){}function a(){}function s(){}function l(){}function c(){}function u(){}function d(){}function p(){}function m(){}function g(){}function h(){}function F(){}function f(){}function v(){}function y(){}function L(){}function U(){}function $(){}function N(){}function H(){}function _(){}function b(){}function S(){}function q(){}function k(){}function G(){}function P(){}function C(){}function T(){}function x(){}function A(){}function w(){}function I(){}function R(){}function K(){}function D(){}function B(){}function E(){}function V(){}function W(){}function z(){}function j(){}function Y(){}function Q(){}function X(){}function Z(){}function M(){}function J(){}function ee(){}function te(){}function ie(){}function ne(){}function oe(){}function re(){}function O(){}function ae(){}function se(){}function le(){}function ce(){}function ue(){}i.convert=function(e){return{unconfirmed:i.Unconfirmed,confirmed:i.Confirmed,cancelled:i.Cancelled,released:i.Released,pending:i.Pending,edited:i.Edited}[e]},i.Unconfirmed="unconfirmed",i.Confirmed="confirmed",i.Cancelled="cancelled",i.Released="released",i.Pending="pending",i.Edited="edited",e.HotelBookingStatus=i,n.convert=function(e){return{customer:n.Customer,payment:n.Payment,unknown:n.Unknown}[e]},n.Customer="customer",n.Payment="payment",n.Unknown="unknown",e.CancellationSubject=n,o.convert=function(e){return{"shared-accommodation-rate-plan":o.SharedAccommodationRatePlan,"shared-room-view":o.SharedRoomView,"rooms-filter-view":o.RoomsFilterView,"calculate-adults-separately-from-children":o.CalculateAdultsSeparatelyFromChildren,"rooms-grid-view":o.RoomsGridView,"rooms-search-criteria-view":o.RoomsSearchCriteriaView,"guest-rooms":o.GuestRoomBookingForm,"certificate-sale-view":o.CertificateBookingForm,"services-view":o.ServicesBookingForm,"services-with-period":o.ServicesWithPeriod,"camp-view":o.CampBookingForm}[e]},o.SharedAccommodationRatePlan="shared-accommodation-rate-plan",o.SharedRoomView="shared-room-view",o.CalculateAdultsSeparatelyFromChildren="calculate-adults-separately-from-children",o.RoomsFilterView="rooms-filter-view",o.RoomsGridView="rooms-grid-view",o.RoomsSearchCriteriaView="rooms-search-criteria-view",o.GuestRoomBookingForm="guest-rooms",o.CertificateBookingForm="certificate-sale-view",o.ServicesBookingForm="services-view",o.ServicesWithPeriod="services-with-period",o.CampBookingForm="camp-view",e.BookingFormMode=o,r.convert=function(e){return{manual:r.Manual,auto:r.Auto}[e]},r.Manual="manual",r.Auto="auto",e.AccommodationMode=r,a.convert=function(e){return{adult:a.Adult,child:a.Child}[e]},a.Adult="adult",a.Child="child",e.AgeQualifyingCode=a,s.convert=function(e){return{default:s.Default,"sberbank-promo-input":s.SberbankPromoInput,"continue-without-services":s.ContinueWithoutServices,"wish-list":s.WishList,"booking-modification":s.BookingModification,"show-guest-account-link":s.ShowGuestAccountLink,"force-new-experiment-segment":s.ForceNewExperimentSegment,"show-unavailable-payment-system-error":s.ShowUnavailablePaymentSystemError,"services-view-mode":s.ServicesViewMode,"multi-price-services":s.MultiPriceServices,"new-socials-survey":s.NewSocialsSurvey}[e]},s.Default="default",s.SberbankPromoInput="sberbank-promo-input",s.ContinueWithoutServices="continue-without-services",s.WishList="wish-list",s.BookingModification="booking-modification",s.ShowGuestAccountLink="show-guest-account-link",s.ForceNewExperimentSegment="force-new-experiment-segment",s.ShowUnavailablePaymentSystemError="show-unavailable-payment-system-error",s.ServicesViewMode="services-view-mode",s.MultiPriceServices="multi-price-services",s.NewSocialsSurvey="new-socials-survey",e.Experiment=s,l.convert=function(e){return{default:l.Default,"mir-cashback-demo":l.MirCashbackDemo,"mir-cashback":l.MirCashback,mir:l.MirCashback}[e]},l.Default="default",l.MirCashback="mir-cashback",l.MirCashbackDemo="mir-cashback-demo",e.PromoOffer=l,c.convert=function(e){return{early_arrival:c.EarlyArrival,late_departure:c.LateDeparture}[e]},c.EarlyArrival="early_arrival",c.LateDeparture="late_departure",e.ExtraStayType=c,u.convert=function(e){return{fax:u.Fax,mobile:u.Mobile}[e]||u.Default},u.Default="",u.Fax="fax",u.Mobile="mobile",e.PhoneType=u,d.convert=function(e){return{per_reservation:d.PerBooking,per_person:d.PerPerson,per_stay:d.PerStay,per_room_per_night:d.PerNight,per_person_per_night:d.PerPersonPerNight,per_occupancy_per_night:d.PerOccupancyPerNight,per_unit:d.PerUse}[e]},d.PerBooking="per_reservation",d.PerPerson="per_person",d.PerStay="per_stay",d.PerNight="per_room_per_night",d.PerPersonPerNight="per_person_per_night",d.PerOccupancyPerNight="per_occupancy_per_night",d.PerUse="per_unit",e.ChargeType=d,p.convert=function(e){return{all_guests:p.AllGuests,depends_on_age:p.DependsOnAge,depends_on_accommodation:p.DependsOnAccommodation}[e]},p.AllGuests="all_guests",p.DependsOnAge="depends_on_age",p.DependsOnAccommodation="depends_on_accommodation",e.OptionApplicabilityType=p,m.convert=function(e){return{adult:m.Adult,extra_adult:m.ExtraAdult,child:m.Child,extra_child:m.ExtraChild,child_band_without_bed:m.ChildBandWithoutBed,room_type:m.RoomType}[e]},m.Adult="adult",m.ExtraAdult="extra_adult",m.Child="child",m.ExtraChild="extra_child",m.ChildBandWithoutBed="child_band_without_bed",m.RoomType="room_type",e.GuestPlacementKind=m,g.convert=function(e){return{english_breakfast:g.EnglishBreakfast,continental_breakfast:g.ContinentalBreakfast,buffet_breakfast:g.BuffetBreakfast,breakfast:g.Breakfast,half_board:g.HalfBoard,full_board:g.FullBoard,lunch:g.Lunch,dinner:g.Dinner,all_inclusive:g.AllInclusive,ultra_all_inclusive:g.UltraAllInclusive}[e]},g.EnglishBreakfast="english_breakfast",g.ContinentalBreakfast="continental_breakfast",g.BuffetBreakfast="buffet_breakfast",g.Breakfast="breakfast",g.HalfBoard="half_board",g.FullBoard="full_board",g.Lunch="lunch",g.Dinner="dinner",g.AllInclusive="all_inclusive",g.UltraAllInclusive="ultra_all_inclusive",e.MealPlanType=g,h.PayPal="PAYPAL",h.YandexMoneyBankCard="YANDEXMONEY_BANKCARD",h.YandexMoneyWallet="YANDEXMONEY_WALLET",h.YandexKasssaInstallments="YANDEXKASSA_INSTALLMENTS",h.PayMasterElectronic="PAYMASTER_ELECTRONIC",h.IndividualCashless="INDIVIDUAL_CASHLESS",h.ManualIndividualCashless="MANUAL_INDIVIDUAL_CASHLESS",h.AtArrival="AT_ARRIVAL",h.LiqpayWallet="LIQPAY_WALLET",h.LiqpayOffline="LIQPAY_OFFLINE",h.Chronopay="CHRONOPAY",h.PayU="PAYU",h.WebPay="WEBPAY",h.RSB="RSB",h.UcsOnline="UCS_ONLINE",h.PayOnlineBankCard="PAYONLINE_BANK_CARD",h.SberbankOnline="SBERBANK_ONLINE",h.TLPayments="TLPAYMENTS",h.TLPaymentsPrepay="TLPAYMENTS_PREPAY",h.TLPaymentsNoPrepay="TLPAYMENTS_NOPREPAY",h.AtOffice="AT_OFFICE",h.TravelAgencyTLPayments="TA_TLPAYMENTS",h.BelAssist="BELASSIST",h.ReservMaster="RESERVMASTER",h.QIWI="QIWI",h.RussiaBank="RUSSIABANK",h.StripeBankcard="STRIPE_BANKCARD",h.ProcessingKz="PROCESSINGKZ",h.Webteh="WEBTEH",h.Vellaris="VELLARIS",h.BePaid="BEPAID",h.UnitellerBankCard="UNITELLER_BANKCARD",h.Payler="PAYLER",h.PayMasterBankCard="PAYMASTER_BANKCARD",h.AlphaBankRbs="ALPHA_BANK_RBS",h.FUIB="FUIB",h.ApplePay="APPLE_PAY",h.GooglePay="GOOGLE_PAY",h.SamsungPay="SAMSUNG_PAY",h.Moneywall="MONEYWALL",h.MonetaSbp="MONETA_SBP",e.PaymentSystemCode=h,F.Euroset="euroset",F.Contact="contact",F.Svyaznoy="svyaznoy",e.PaymentSystemInternalCode=F,f.convert=function(e){return{cash:f.Cash,guarantee:f.Guarantee,pre_pay:f.Prepay,guarantee_noprepay:f.GuaranteeNoprepay,credit_card:f.CreditCard,payment_service:f.PaymentService,money_order:f.MoneyOrder,direct_bill:f.DirectBill,credit_payment:f.Credit,sbp:f.SBP,unknown:f.Unknown}[e]},f.Cash="cash",f.Guarantee="guarantee",f.Prepay="pre_pay",f.GuaranteeNoprepay="guarantee_noprepay",f.CreditCard="credit_card",f.PaymentService="payment_service",f.MoneyOrder="money_order",f.DirectBill="direct_bill",f.Credit="credit_payment",f.SBP="sbp",f.Unknown="unknown",e.PaymentSystemType=f,v.convert=function(e){return{booking:v.Booking,"change-card":v.ChangeCard,"deferred-payment":v.DeferredPayment}[e]},v.Booking="booking",v.ChangeCard="change-card",v.DeferredPayment="deferred-payment",e.PaymentType=v,y.convert=function(e){return{accepted:y.Accepted,failed:y.Failed,pending:y.Pending}[e]},y.Accepted="accepted",y.Failed="failed",y.Pending="pending",e.PaymentGuaranteeStatus=y,L.Service="service",L.MealPlan="meal-plan",e.OptionType=L,U.PrivacyPolicy="policy",U.UserAgreement="terms",e.PolicyPageType=U,$.Desktop="desktop",$.Phone="phone",e.Layout=$,N.WindowSizeChanged="size-changed",e.BroadcastEvent=N,H.XS="xs",H.SM="sm",H.MD="md",H.LG="lg",e.LayoutSizeCode=H,_.convert=function(e){return{bus_station:_.Bus,airport:_.Airport,railway_station:_.Railway,custom:_.Custom}[e]},_.Bus="bus_station",_.Airport="airport",_.Railway="railway_station",_.Custom="custom",e.TransferType=_,b.convert=function(e){return{tax:b.Tax,fee:b.Fee}[e]},b.Tax="tax",b.Fee="fee",e.TaxType=b,S.convert=function(e){return{from_hotel:S.FromHotel,to_hotel:S.ToHotel}[e]},S.FromHotel="from_hotel",S.ToHotel="to_hotel",e.TransferDirection=S,q.convert=function(e){return{promo:q.PromotionalCode}[e]},q.PromotionalCode="promo",e.RoomStayRestrictionKind=q,k.TransportError="0",k.BookingTemporarilyUnavailable="92",k.BookingStatusInvalid="118",k.EndDateIsInvalid="135",k.StartDateIsInvalid="136",k.CreditCardHasExpired="240",k.CreditCardNumberIsInvalidOrMissing="242",k.DepartureDateIsNotAvailable="293",k.ArrivalDateIsNotAvailable="294",k.NoAvailability="322",k.Retry="366",k.RateNotExists="394",k.InvalidRoomType="402",k.NoMatchFound="425",k.RateUnavailable="437",k.RatePromoCodeRestricted="438",k.Reenter="439",k.UnableToProcess="450",k.InvalidPromoCode="536",k.RoomNotExists="730",k.RateDeactivated="733",k.NonExistentServiceType="850",k.NonExistentServiceId="851",k.InternalServerError="1000",k.CaptchaChallenge="30001",e.ServiceErrorCode=k,G.InvalidPromoCode="536",e.ServiceWarningCode=G,P.convert=function(e){return{male:P.Male,female:P.Female}[e]},P.convertFromGuestProfile=function(e){return 0==e?null:{1:P.Female,2:P.Male}[e]},P.Male="male",P.Female="female",e.GuestInfoSex=P,C.convert=function(e){return{trivago:C.Trivago,google_hotel_ads:C.GoogleHotelAds}[e]},C.Trivago="trivago",C.GoogleHotelAds="google_hotel_ads",e.MetaSearchKind=C,T.convert=function(e){return{square_metre:T.SquareMetre,square_foot:T.SquareFoot}[e]},T.SquareMetre="square_metre",T.SquareFoot="square_foot",e.LengthUnitKind=T,x.convert=function(e){return{day:x.Day,night:x.Night}[e]},x.Day="day",x.Night="night",e.StayUnitKind=x,A.convert=function(e){return{room:A.Room,place_in_room:A.PlaceInRoom,cottage:A.Cottage,apartment:A.Apartment,service:A.Service,guest_room:A.GuestRoom,camp:A.Camp,studio:A.Studio,flat:A.Flat,house:A.House,villa:A.Villa}[e]},A.Room="room",A.PlaceInRoom="place_in_room",A.Cottage="cottage",A.Apartment="apartment",A.Service="service",A.GuestRoom="guest_room",A.Camp="camp",A.Studio="studio",A.Flat="flat",A.House="house",A.Villa="villa",e.RoomTypeUnitKind=A,w.convert=function(e){return{tax:w.Tax,fee:w.Fee,tax_fee:w.TaxAndFee}[e]},w.Tax="tax",w.Fee="fee",w.TaxAndFee="tax_fee",e.TaxUnitKind=w,I.convert=function(e){return{hotel:I.Hotel,hotel_alt:I.HotelAlt,hostel:I.Hostel,apartment:I.Apartment,sanatorium:I.Sanatorium,camp:I.Camp,glamping:I.Glamping}[e]},I.Hotel="hotel",I.HotelAlt="hotel_alt",I.Hostel="hostel",I.Apartment="apartment",I.Sanatorium="sanatorium",I.Camp="camp",I.Glamping="glamping",e.ProviderTypeUnitKind=I,R.convert=function(e){return{stay_dates:R.StayDates,promotion_code:R.PromotionCode,tourist:R.Tourist,registration:R.Registration,loyalty:R.Loyalty}[e]},R.StayDates="stay_dates",R.PromotionCode="promotion_code",R.Tourist="tourist",R.Registration="registration",R.Loyalty="loyalty",e.DiscountType=R,K.convert=function(e){return{partial:K.Partial,full:K.Full}[e]},K.Partial="partial",K.Full="full",e.DiscountApplicabilityType=K,D.convert=function(e){return{"change-full-prepayment-option-name-to-mir-cashback":D.ChangeFullPrepaymentOptionNameToMirCashback,"require-certificate-of-covid-vaccination":D.RequireCertificateOfCovidVaccination,"hide-room-capacity":D.HideRoomCapacity,"hide-banner-mir":D.HideBannerMir,"prevent-override-mir-payment-system-sort-order":D.PreventOverrideMirPaymentSystemSortOrder,"hide-guest-info-filling":D.HideGuestInfoFilling,"require-middle-name":D.RequireMiddleName}[e]},D.ChangeFullPrepaymentOptionNameToMirCashback="change-full-prepayment-option-name-to-mir-cashback",D.RequireCertificateOfCovidVaccination="require-certificate-of-covid-vaccination",D.HideRoomCapacity="hide-room-capacity",D.HideBannerMir="hide-banner-mir",D.PreventOverrideMirPaymentSystemSortOrder="prevent-override-mir-payment-system-sort-order",D.HideGuestInfoFilling="hide-guest-info-filling",D.RequireMiddleName="require-middle-name",e.Feature=D,B.convert=function(e){return{stock:B.Stock,sales_leader:B.SalesLeader,hurry_up_booking:B.HurryUpBooking,family:B.Family,friends:B.Friends}[e]},B.Stock="stock",B.SalesLeader="sales_leader",B.HurryUpBooking="hurry_up_booking",B.Family="family",B.Friends="friends",e.OptionMotivator=B,E.Custom="custom",E.CancellationTravel="cancellation_travel",E.ChangeHotel="change_hotel",E.AmmendmentArrivalDate="ammendment_arrival_date",E.ChangeRoomType="change_room_type",E.ChangePaymentMethod="change_payment_method",e.CancellationReasonCode=E,V.Cancellation="cancellation",V.EditBooking="edit",V.PayBooking="pay",e.AuthRole=V,W.Common="common",W.Meal="meal",e.ServiceKind=W,z.Am="am",z.Pm="pm",e.TimePeriodKind=z,j.TimePeriod12="12",j.TimePeriod24="24",e.TimePeriodFormat=j,Y.Common="common",Y.Reverse="reverse",e.AddressFormatKind=Y,Q.LFM="lfm",Q.FML="fml",e.PersonalNameFormatKind=Q,X.Enabled="enabled",X.Disabled="disabled",X.Muted="muted",X.Forbidden="forbidden",e.CalendarDateDisabledKind=X,Z.Rooms="rooms",Z.Filter="filter",e.RoomsViewMode=Z,M.Page="page",M.Click="click",M.View="view",M.SessionStart="session_start",M.SessionEnd="session_end",M.SearchCriteriaStartDate="search_criteria_start_date",M.SearchCriteriaEndDate="search_criteria_end_date",M.BookingNumber="booking_number",M.BookingStatus="booking_status",e.ArtifactKind=M,J.Default="default",J.RoomsGrid="rooms-grid",e.PreloaderViewMode=J,ee.Integration="guest-profile-integration",ee.DiscountBanner="guest-profile-discount-banner",e.GuestProfileEventSource=ee,te.getSegments=function(){return[te.Enabled,te.Disabled]},te.Enabled="enabled",te.Disabled="disabled",e.ContinueWithoutServicesExperiment=te,ie.getSegments=function(){return[ie.Old,ie.New]},ie.Old="old",ie.New="new",e.ServicesViewModeExperiment=ie,ne.OverQuota="over_quota",ne.Currency="currency",ne.AvailabilityBlock="availability_block",ne.PaymentSystem="payment_system",ne.WithChildrenOnly="with_children_only",e.uiRestriction=ne,oe.ServicesBookingForm="service",oe.GuestRoomBookingForm="guest-room",oe.CertificateBookingForm="certificate",oe.CampBookingForm="camp",oe.Default="default",e.TranslationMode=oe,re.Vk="vk",re.Facebook="facebook",re.Google="google",re.Tl="tl",e.AuthServiceKind=re,O.TokenPrefix="gp-token-",O.CrmCampaignKeyPrefix="gp-crm-campaign-key-",O.AuthCode="gp-auth-code",O.AuthService="gp-auth-service",O.ExpiresAt="gp-expires-at",O.AuthFlowKind="gp-auth-flow-kind",e.GuestProfileParam=O,ae.NotStarted="not-started",ae.Running="running",ae.Over="over",e.MirShowPeriod=ae,se.WebPms="BS-WEB_PMS",se.Extranet="BS-EXTRANET_BF",e.BookingSourceCode=se,le.MealPlan="meal_plan",le.FreeCancellation="free_cancellation",le.Payment="payment",le.RoomOptions="room_options",e.FilterId=le,ce.PaymentLink="payment-link",e.CopyToClipboardTarget=ce,ue.SnackBar={activeColor:"--snackbar-color-active",backgroundColor:"--snackbar-background-color",shadow:"--snackbar-shadow",iconBorderColor:"--snackbar-icon-border-color"},e.ComponentTheme=ue,(t=e.EventType||(e.EventType={})).Click="click",t.Hover="hover",t.Focus="focus",t.Blur="blur",t.Resize="resize",t.KeyUp="keyup",t.MouseEnter="mouseenter",t.MouseLeave="mouseleave",t.MouseDown="mousedown",t.MouseMove="mousemove",t.MouseUp="mouseup",t.MouseOver="mouseover",t.MouseOut="mouseout",t.PointerUp="pointerup",t.TouchStart="touchstart",t.TouchEnd="touchend",t.TouchMove="touchmove",t.BeforeUnload="beforeunload",(t=e.KeyCode||(e.KeyCode={}))[t.Enter=13]="Enter",t[t.Space=32]="Space",(t=e.ServiceActionType||(e.ServiceActionType={})).Button="button",t.Stepper="stepper",t.ButtonAfterStepper="button_after_stepper",(t=e.SurveyErrorType||(e.SurveyErrorType={})).SurveyNotFound="survey_not_found",t.SurveyAlreadyPassed="survey_already_passed",t.InvalidCredentials="invalid_credentials",t.Unknown="unknown"}(tl=tl||{}),INTEGRATED||(appParams={providerId:_.parseInt(location.search.substr(1)),bookingSource:"",sourceUrl:"",arrivalDayOfWeek:"",date:ENV?(new Date).addDays(13).moment().format("YYYY-MM-DD"):"",nights:ENV?1:0,adults:ENV?"1":"",children:"",childrenAge:"",roomTypes:"",ratePlans:"",promoCodePlain:"",language:"ru",languageRegion:"",currency:"",citizenship:"",attachCart:!0,autoScroll:tl.AppIntegrationAutoScroll.Always,bookingNumber:"",paymentCode:"",cancellationCode:"",confirmationCode:"",accommodationMode:tl.AccommodationMode.Manual,state:tl.AppIntegrationState.Auto,experiment:[],unfinishedBookingNumber:"",unfinishedBookingSign:"",bookingFormMode:[],tlTrackerUser:"",tlTrackerSession:"",autoApplyPromoCodeRatePlans:"",autoApplyPromoCodeDiscount:"",autoApplyPromoCode:"",customerEmail:"",customerPhone:"",guestFirstName:"",guestLastName:"",guestMiddleName:"",wishListTicketId:"",opener:"",utm_source:"",utm_medium:"",utm_campaign:"",utm_content:"",promoOffer:""},_.forEach(location.search.substr(1).split("&"),function(e){var e=e.split("="),t=_.includes(e[0],"[]"),i=e[0].replace("[]",""),e=decodeURIComponent(e[1]),e=_.isBoolean(appParams[i])?"true"==e:e;t?appParams[i].push(e):appParams[i]=e}),0<=location.search.indexOf("disableCache")&&_.filter(_.keys(sessionStorage),function(e){0===e.indexOf("TL;")&&sessionStorage.removeItem(e)}),AppIntegration={hideLoader:function(){},isAvailable:function(){return!1},fireEvent:function(e,t){},subscribeEvent:function(e,t){},getProperties:function(){return appParams},getEnv:function(){return ENV},getSource:function(){return null},getReferrerCode:function(){return""},getReferrerUrl:function(){return""},getIntegrationKey:function(){return""},getTimings:function(){return{}},showImages:function(e,t){},scrollTo:function(e,t){window.scrollBy(0,e)},getPosition:function(){return{scrollLeft:window.pageXOffset,scrollTop:window.pageYOffset,screenWidth:window.innerWidth,screenHeight:window.innerHeight,fixedHeaderHeight:0}},redirect:function(e){location.href=e},frameCreate:function(e,t,i){},frameSubscribeEvent:function(e,t){},frameFireEvent:function(e,t){}}),!function(n){Object.defineProperty(t.prototype,"bootstrapService",{get:function(){return this._bootstrapService||(this._bootstrapService=new n.BootstrapService(this.$injector)),this._bootstrapService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bookingService",{get:function(){return this._bookingService||(this._bookingService=new n.BookingService(this.$injector,this,this.serviceTransport,this.serviceStorage)),this._bookingService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bookingRuleService",{get:function(){return this._bookingRuleService||(this._bookingRuleService=new n.BookingRuleService(this.$injector,this,this.serviceTransport)),this._bookingRuleService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cancellationService",{get:function(){return this._cancellationService||(this._cancellationService=new n.CancellationService(this.$injector,this,this.serviceTransport,this.serviceStorage)),this._cancellationService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editBookingService",{get:function(){return this._editBookingService||(this._editBookingService=new n.EditBookingService(this.$injector,this,this.serviceTransport,this.serviceStorage)),this._editBookingService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"surveyService",{get:function(){return this._surveyService||(this._surveyService=new n.SurveyService(this.$injector,this,this.serviceTransport,this.serviceStorage)),this._surveyService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"personalDataService",{get:function(){return this._personalDataService||(this._personalDataService=new n.PersonalDataService(this,this.serviceTransport,this.serviceStorage)),this._personalDataService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orderService",{get:function(){return this._orderService||(this._orderService=new n.OrderService(this.serviceStorage)),this._orderService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"affiliateService",{get:function(){return this._affiliateService||(this._affiliateService=new n.AffiliateService(this.serviceTransport,this.serviceStorage,this.$q)),this._affiliateService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"promoCodeService",{get:function(){return this._promoCodeService||(this._promoCodeService=new n.PromoCodeService(this.serviceTransport)),this._promoCodeService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availabilityCalendarService",{get:function(){return this._availabilityCalendarService||(this._availabilityCalendarService=new n.AvailabilityCalendarService(this.serviceTransport,this.serviceStorage)),this._availabilityCalendarService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wishListService",{get:function(){return this._wishListService||(this._wishListService=new n.WishListService(this.serviceTransport,this.$q)),this._wishListService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guestProfileTokenService",{get:function(){return this._guestProfileTokenService||(this._guestProfileTokenService=new n.GuestProfileTokenService(this.serviceTransport,this.$q)),this._guestProfileTokenService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guestProfileService",{get:function(){return this._guestProfileService||(this._guestProfileService=new n.GuestProfileService(this.serviceTransport,this.$q,this.guestProfileTokenService)),this._guestProfileService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paymentPopupService",{get:function(){return this._paymentPopupService||(this._paymentPopupService=new n.PaymentPopupService(this.hotelReservationsRequestService)),this._paymentPopupService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hotelReservationsRequestService",{get:function(){return this._hotelReservationsRequestService||(this._hotelReservationsRequestService=new n.HotelReservationsRequestService(this.$injector)),this._hotelReservationsRequestService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bestPriceGuaranteeService",{get:function(){return this._bestPriceGuaranteeService||(this._bestPriceGuaranteeService=new n.BestPriceGuaranteeService(this.serviceTransport)),this._bestPriceGuaranteeService},enumerable:!0,configurable:!0}),t.$inject=["$injector","$http","$q"];var e=t;function t(e,t,i){this.$injector=e,this.$http=t,this.$q=i,this.serviceTransport=new n.ServiceTransport(SERVICE_BASE_URL,t,i),this.serviceStorage=new n.ServiceStorage}n.ServiceFactory=e}(tl=tl||{}),!function(n){function e(){if(this.availableCurrencies=[],this.availableLanguages=[],this.guestDetailing=new d,this.showLanguageControl=!0,this.showCurrencyControl=!0,this.showAutofillGuestInfoControl=!0,this.enableSmsConfirmation=!0,this.isTaxesEnabled=!1,this.forceMailDistributionSubscribe=!1,this.forceSendSmsConfirmation=!1,this.fullScreenOnMobile=!1,this.registrationDiscounts=!1,this.touristDiscounts=!1,this.loyaltyDiscounts=!1,this.promotions=[],this.promoOffers=[],this.accommodationMode=n.AccommodationMode.Manual,this.experiments=[],this.languageControlType=n.LanguageControlType.Image,this._childrenAgeGroups=[],this.selectedRoomTypes=[],this.selectedRatePlans=[],this.defaultAdults=1,this.promoCodeAccessEmails={},this.modes=[],this.metaSearches=[],this.completeGuestListRequired=!1,this.motivators=new f,this.features=[],this.roomUpgradeSuggestions=[],this.customScripts=[],this.adultAge=18,e._instance)throw new Error("Error: Instantiation failed: Use BookingFormSettings.getInstance() instead of new.");e._instance=this}e.getInstance=function(){return e._instance=null===e._instance?new e:e._instance},e.prototype.init=function(e){var i=this,t=(this.providerId=e.providerId?String(e.providerId):"",this.bookingNumber=e.bookingNumber,this.paymentCode=e.paymentCode||null,this.cancellationCode=e.cancellationCode||null,this.confirmationCode=e.confirmationCode||null,this.bookingStatus=a.Enabled,e.citizenship?(this.phoneCode=e.citizenship.toUpperCase(),this.citizenship=e.citizenship.toUpperCase()):(t=n.Locale.getInstance().id(),this.phoneCode=this.citizenship=t),_.isUndefined(e.bookingSource)||(this.bookingSource=e.bookingSource),AppIntegration&&AppIntegration.getSource()?this.sourceUrl=AppIntegration.getSource():_.isUndefined(e.sourceUrl)||(this.sourceUrl=e.sourceUrl),AppIntegration&&AppIntegration.getIntegrationKey()&&(this.integrationKey=AppIntegration.getIntegrationKey()),AppIntegration&&AppIntegration.getReferrerCode()&&(this.referrerCode=AppIntegration.getReferrerCode()),_.isUndefined(e.utmParameters)||(this.utmParameters=e.utmParameters),_.isUndefined(e.roistatParameters)||(this.roistatParameters=e.roistatParameters),_.isUndefined(e.enableSmsConfirmation)||(this.enableSmsConfirmation=e.enableSmsConfirmation),_.isUndefined(e.fullScreenOnMobile)||(this.fullScreenOnMobile=e.fullScreenOnMobile),_.isUndefined(e.showLanguageControl)||(this.showLanguageControl=e.showLanguageControl),_.isUndefined(e.showCurrencyControl)||(this.showCurrencyControl=e.showCurrencyControl),_.isUndefined(e.showAutofillGuestInfoControl)||(this.showAutofillGuestInfoControl=e.showAutofillGuestInfoControl),_.isUndefined(e.bestPaymentSystemType)||(t=n.PaymentSystemType.convert(e.bestPaymentSystemType),_.isUndefined(t)||(this.motivators.bestPaymentSystemType=t)),_.isUndefined(e.accommodationMode)||(t=n.AccommodationMode.convert(e.accommodationMode),_.isUndefined(t)||(this.accommodationMode=t)),_.isUndefined(e.languageControlType)||(t=n.LanguageControlType.convert(e.languageControlType.toString()),_.isUndefined(t)||(this.languageControlType=t)),_.isUndefined(e.bookingFormMode)||_.each(e.bookingFormMode,function(e){_.isUndefined(n.BookingFormMode.convert(e))||i.modes.push(e)}),_.isUndefined(e.experiment)||_.each(e.experiment,function(e){_.isUndefined(n.Experiment.convert(e))||i.experiments.push(e)}),_.isUndefined(e.bestRoomTypes)||(this.motivators.bestRoomTypes=e.bestRoomTypes),e.roomTypes&&(this.selectedRoomTypes=String(e.roomTypes).split(",")),e.ratePlans&&(this.selectedRatePlans=String(e.ratePlans).split(",")),_.isEmpty(e.promoOffer)||_.forEach(e.promoOffer.split(","),function(e){_.isUndefined(n.PromoOffer.convert(e))||i.promoOffers.push(n.PromoOffer.convert(e))}),_.isUndefined(e.promoCodeAccessEmails)||_.forEach(e.promoCodeAccessEmails,function(e,t){i.promoCodeAccessEmails[t.toLocaleLowerCase()]=e}),_.isUndefined(e.trivagoReference)||(this.trivagoReference=e.trivagoReference),_.isUndefined(e.adults)||(this.defaultAdults=Math.max(1,_.parseInt(e.adults))),this.cdnHost=CDN_HOST,location.protocol+"//"+location.host+location.pathname);this.originalBaseUrl=t.slice(0,t.lastIndexOf("/")+1),this.originalAccommodationMode=this.accommodationMode,(e.guestFirstName||e.guestLastName||e.guestMiddleName)&&(this.defaultGuestInfo=new n.Person,this.defaultGuestInfo.firstName=e.guestFirstName,this.defaultGuestInfo.lastName=e.guestLastName,this.defaultGuestInfo.middleName=e.guestMiddleName),this.customerEmail=e.customerEmail,this.customerPhone=e.customerPhone,_.isUndefined(e.autoApplyPromoCodeRatePlans)||_.isUndefined(e.autoApplyPromoCode)||(this.motivators.autoApplyPromoCodeRatePlans=e.autoApplyPromoCodeRatePlans.split(","),this.motivators.autoApplyPromoCodeDiscount=e.autoApplyPromoCodeDiscount||"10%",this.motivators.autoApplyPromoCode=e.autoApplyPromoCode)},e.prototype.isAutoApplyPromoCodeRatePlan=function(e){return!!this.findAutoApplyPromoCode(e)},e.prototype.findAutoApplyPromoCode=function(t){var i=this;return _.includes(this.motivators.autoApplyPromoCodeRatePlans,t)?this.motivators.autoApplyPromoCode:this.motivators.promoRatePlans?_.find(Object.keys(this.motivators.promoRatePlans),function(e){return _.includes(i.motivators.promoRatePlans[e],t)}):null},e.prototype.findAutoApplyPromoCodeDiscount=function(e){return _.includes(this.motivators.autoApplyPromoCodeRatePlans,e)?this.motivators.autoApplyPromoCodeDiscount:""},e.prototype.getOptionMotivators=function(t){var e;return null!=(e=null==(e=_.find(this.motivators.options,function(e){return e.code===t}))?void 0:e.motivators)?e:[]},e.prototype.hasExperiment=function(e){return _.includes(this.experiments,e)},e.prototype.hasFeature=function(e){return _.includes(this.features,e)},e.prototype.hasPromoOffer=function(e){return _.includes(this.promoOffers,e)},e.prototype.isMirCashbackPromoPageAvailable=function(){return!_.isUndefined(this.promoMirSettings)&&(this.hasPromoOffer(n.PromoOffer.MirCashback)||this.hasPromoOffer(n.PromoOffer.MirCashbackDemo))},e.prototype.isMirCashbackAvailable=function(){return!_.isUndefined(this.promoMirSettings)&&(!!this.hasPromoOffer(n.PromoOffer.MirCashbackDemo)||n.MirCashbackUtil.isShowPeriodValid())},e.prototype.isModeTurnedOn=function(e){return _.includes(this.modes,e)},e.prototype.getTranslationMode=function(){return this.isModeTurnedOn(n.BookingFormMode.CertificateBookingForm)?n.TranslationMode.CertificateBookingForm:this.isServicesBookingForm()?n.TranslationMode.ServicesBookingForm:this.isModeTurnedOn(n.BookingFormMode.GuestRoomBookingForm)?n.TranslationMode.GuestRoomBookingForm:this.isModeTurnedOn(n.BookingFormMode.CampBookingForm)?n.TranslationMode.CampBookingForm:n.TranslationMode.Default},e.prototype.isMetaSearchEnabled=function(e){return _.includes(this.metaSearches,e)},Object.defineProperty(e.prototype,"childrenAgeGroups",{get:function(){return this._childrenAgeGroups},set:function(e){this._childrenAgeGroups=e},enumerable:!0,configurable:!0}),e.prototype.hasPersonalDiscounts=function(){return this.registrationDiscounts||this.touristDiscounts||this.hasLoyaltyProgram()},e.prototype.hasLoyaltyProgram=function(){var e;return this.loyaltyDiscounts&&(null==(e=this.loyaltySettings)?void 0:e.enabled)},e.prototype.getRoomUpgradeSuggestions=function(t){return _.filter(this.roomUpgradeSuggestions,function(e){return e.sourceRoomTypeId===t})},e.prototype.childrenAgeGroupByCode=function(t){return _.find(this._childrenAgeGroups,function(e){return e.ageGroupCode==t})},e.prototype.childrenAgeGroupByAge=function(t){return _.find(this._childrenAgeGroups,function(e){return e.inGroup(t)})},e.prototype.maxChildrenAge=function(){return _.chain(this._childrenAgeGroups).map(function(e){return e.maxAge}).max().value()},e.prototype.citizenshipCode=function(){return this.citizenship},e.prototype.isServicesBookingForm=function(){return this.isModeTurnedOn(n.BookingFormMode.ServicesBookingForm)},e.prototype.isServicesWithPeriod=function(){return this.isModeTurnedOn(n.BookingFormMode.ServicesWithPeriod)},e.prototype.isCampBookingForm=function(){return this.isModeTurnedOn(n.BookingFormMode.CampBookingForm)},e.prototype.isCertificatesBookingForm=function(){return this.isModeTurnedOn(n.BookingFormMode.CertificateBookingForm)},e.prototype.isManualAccommodationMode=function(){return this.accommodationMode==n.AccommodationMode.Manual},e.prototype.isSharedMode=function(){return this.isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)},e.prototype.isHotelMode=function(){return!(this.isSharedMode()||this.isModeTurnedOn(n.BookingFormMode.CertificateBookingForm)||this.isModeTurnedOn(n.BookingFormMode.ServicesBookingForm)||this.isModeTurnedOn(n.BookingFormMode.ServicesWithPeriod)||this.isModeTurnedOn(n.BookingFormMode.CampBookingForm))},e.prototype.isSanatoriumMode=function(){return this.isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)&&!this.isModeTurnedOn(n.BookingFormMode.SharedRoomView)},e.prototype.isResortMode=function(){return this.isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)&&this.isModeTurnedOn(n.BookingFormMode.SharedRoomView)},e.prototype.isServicesViewModeExperimentAvailable=function(){return!this.isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)&&this.hasExperiment(n.Experiment.ServicesViewMode)},e.prototype.isServicesNewViewMode=function(){return!(this.isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)||this.hasExperiment(n.Experiment.ServicesViewMode)&&n.TrackerService.getExperimentSegment(n.Experiment.ServicesViewMode,n.ServicesViewModeExperiment.getSegments())==n.ServicesViewModeExperiment.Old)},e._instance=null,n.BookingFormSettings=e;function t(e,t,i,n){this.isAvailable=e||!1,this.startDate=t||new Date(0),this.endDate=i||new Date(0),this.maxNights=n||3}n.AvailabilityCalendarSettings=t,__extends(r,i=t);var i,o=r;function r(){return null!==i&&i.apply(this,arguments)||this}n.StayStoreAvailabilityCalendarSettings=o;s.Enabled="enabled",s.Disabled="disabled";var a=s;function s(){}n.BookingStatus=a;c.day="day",c.month="month",c.year="year";var l=c;function c(){}function u(e,t,i){this.originDate=e,this.delta=t,this.unit=i}n.BookingAvailabilityUnit=l,u.prototype.getDate=function(){switch(this.unit){case l.day:return this.originDate.addDays(this.delta);case l.month:return this.originDate.addMonths(this.delta);case l.year:return this.originDate.addYears(this.delta)}return this.originDate},n.BookingAvailabilityDate=u;n.BookingFormSettingsBookingRule=function(e,t){this.minAvailDate=e,this.maxAvailDate=t};var d=function(){},o=(n.BookingGuestDetailing=d,p.prototype.inGroup=function(e){return e>=this.minAge&&e<this.maxAge},p);function p(e,t,i){this.ageGroupCode=e,this.minAge=t,this.maxAge=i,this.id=_.uniqueId("ag")}n.BookingFormSettingsChildrenAgeGroup=o;function m(){}n.BookingFormSettingsLoyalty=function(){};function g(){}function h(){}n.RoomUpgradeSuggestion=m;var f=function(){this.autoApplyPromoCodeRatePlans=[],this.autoApplyPromoCodeDiscount="",this.bestRoomTypes=[],this.bestPaymentSystemType=n.PaymentSystemType.Cash,this.promoRatePlans={},this.options=[]};n.BookingFormSettingsMotivators=f,n.PromoMirSettings=g;n.PromoMirShowPeriod=h}(tl=tl||{}),!function(I){e.prototype.language=function(){return this._language},e.prototype.region=function(){return this._region},e.prototype.name=function(){return this._name},e.prototype.firstDayOfWeek=function(){return this._firstDayOfWeek},e.prototype.timeFormat=function(){return this._timeFormat},e.prototype.dateFormat=function(){return this._dateFormat},e.prototype.addressFormat=function(){return this._addressFormat},e.prototype.personalNameFormat=function(){return this._personalNameFormat},e.prototype.locale=function(){return this.region()?this.language()+"-"+this.region():this.language()};var R=e;function e(e,t,i,n,o,r,a,s){this._language=e,this._region=t,this._firstDayOfWeek=i,this._name=n,this._timeFormat=o,this._dateFormat=r,this._addressFormat=a,this._personalNameFormat=s}I.Language=R;var D=function(e,t){this.language=t,this.id=e},t=(I.LanguageContext=D,function(e){this.id=e}),i=(I.Currency=t,n.getInstance=function(){return n._instance=null===n._instance?new n:n._instance},n.prototype.id=function(){return this._languageContext.id},n.prototype.locale=function(){return this._languageContext.language.locale()},n.prototype.language=function(){return this._languageContext.language},n.prototype.languageId=function(){return this._languageContext.language.language()},n.prototype.region=function(){return this._languageContext.language.region()},n.prototype.firstDayOfWeek=function(){return this._languageContext.language.firstDayOfWeek()},n.prototype.getTimeFormat=function(){return this._languageContext.language.timeFormat()},n.prototype.addressFormatKind=function(){return this._languageContext.language.addressFormat()},n.prototype.personalNameFormatKind=function(){return this._languageContext.language.personalNameFormat()},n.prototype.currency=function(){return this._currency},n.prototype.currencyId=function(){return this._currency.id},n.prototype.languages=function(){var e,t,i,n,o,r,a,s,l,c,u,d,p,m,g,h,f,v,y,_,b,S,k,P,C,T,x,A,w;return this._languages.length||(e=new R("ru","ru",1,"Русский",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),t=new R("en","us",0,"English",I.TimePeriodFormat.TimePeriod12,"MM/DD/YYYY",I.AddressFormatKind.Reverse,I.PersonalNameFormatKind.FML),i=new R("en","gb",1,"English",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Reverse,I.PersonalNameFormatKind.FML),n=new R("fr","fr",1,"Français",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.FML),o=new R("de","de",1,"Deutsch",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),r=new R("it","it",1,"Italiano",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),a=new R("es","es",1,"Español",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),s=new R("pl","pl",1,"Polskie",I.TimePeriodFormat.TimePeriod24,"YYYY-MM-DD",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),l=new R("uk","ua",1,"Українська",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),c=new R("kk","",1,"Қазақша",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),u=new R("cs","cz",1,"Český",I.TimePeriodFormat.TimePeriod24,"YYYY-MM-DD",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),d=new R("fi","fi",1,"Suomi",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),p=new R("sv","se",1,"Svenska",I.TimePeriodFormat.TimePeriod24,"YYYY-MM-DD",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),m=new R("zh","cn",1,"简体中文",I.TimePeriodFormat.TimePeriod24,"YYYY年MM月DD日",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),g=new R("ja","jp",1,"日本語",I.TimePeriodFormat.TimePeriod24,"YYYY年MM月DD日",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),h=new R("ko","kr",1,"한국어",I.TimePeriodFormat.TimePeriod24,"YYYY년MM월DD일",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),f=new R("lv","lv",1,"Latviešu",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),v=new R("bg","bg",1,"Български",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),y=new R("ka","ge",1,"ქართული",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),_=new R("id","id",1,"Bahasa Indonesia",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),b=new R("et","ee",1,"Eesti keel",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),S=new R("ro","ro",1,"Română",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),k=new R("sr","latn",1,"Srpski",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),P=new R("hy","am",1,"հայերեն",I.TimePeriodFormat.TimePeriod24,"YYYY-MM-DD",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),C=new R("az","latn",1,"Azərbaycan dili",I.TimePeriodFormat.TimePeriod24,"YYYY-MM-DD",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),T=new R("el","gr",1,"Ελληνικά",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),x=new R("pt","pt",0,"Português",I.TimePeriodFormat.TimePeriod24,"DD-MM-YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.LFM),A=new R("tr","tr",1,"Türk",I.TimePeriodFormat.TimePeriod24,"DD.MM.YYYY",I.AddressFormatKind.Common,I.PersonalNameFormatKind.FML),w=new R("th","th",0,"ภาษาไทย",I.TimePeriodFormat.TimePeriod24,"DD/MM/YYYY",I.AddressFormatKind.Reverse,I.PersonalNameFormatKind.FML),this._languages=[new D("USA",t),new D("GBR",i),new D("RUS",e),new D("FRA",n),new D("DEU",o),new D("CHN",m),new D("ITA",r),new D("ESP",a),new D("POL",s),new D("UKR",l),new D("KAZ",c),new D("CZE",u),new D("FIN",d),new D("SWE",p),new D("LVA",f),new D("BGR",v),new D("JPN",g),new D("KOR",h),new D("GEO",y),new D("IDN",_),new D("EST",b),new D("ROU",S),new D("SRB",k),new D("ARM",P),new D("AZE",C),new D("GRC",T),new D("PRT",x),new D("TUR",A),new D("THA",w)]),this._languages},n.prototype.currencies=function(){return this._currencies.length||(this._currencies=[new t("USD"),new t("EUR"),new t("GBP"),new t("RUB"),new t("AMD"),new t("AZN"),new t("BGN"),new t("BYN"),new t("CAD"),new t("CHF"),new t("CNY"),new t("DOP"),new t("GEL"),new t("HRK"),new t("IDR"),new t("INR"),new t("ILS"),new t("KGS"),new t("KRW"),new t("KZT"),new t("MDL"),new t("NOK"),new t("PHP"),new t("PLN"),new t("SAR"),new t("THB"),new t("TJS"),new t("TND"),new t("UAH"),new t("UZS"),new t("VND"),new t("AUD"),new t("CZK"),new t("HUF"),new t("TRY"),new t("MAD"),new t("AED"),new t("KES"),new t("JOD"),new t("DKK")]),this._currencies},n.prototype.findCurrency=function(t){return _.find(this.currencies(),function(e){return e.id==t})},n.prototype.setLocale=function(e){if(!e)throw new Error("Language is not supported!");this._languageContext=e},n.prototype.setCurrency=function(e){if(!e)throw new Error("Currency is not supported!");this._currency=e},n._instance=null,n);function n(){if(this._languages=[],this._currencies=[],n._instance)throw new Error("Error: Instantiation failed: Use Locale.getInstance() instead of new.");n._instance=this}I.Locale=i}(tl=tl||{}),!function(c){function e(){}e.All="all",e.Phone="phone",e.Desktop="desktop",c.ChunkMediaType=e;t.Common="common",t.Theme="theme";function t(){}function i(e,t){this._chunks={},this.$q=e,this._chunks={},this._errorHandler=t}i.prototype.define=function(e,t,i){var n=this,o=this.generateChunkKey(e,t,i);if(!this._chunks[o])throw new Error("define unregistered chunk "+o);this._chunks[o].resolve(),_.forEach(this.resolveChunkInfo(e,t),function(e){e.type==i&&n.removeScript(n.generateScriptId(e.url))})},i.prototype.ensure=function(i,e){var n=this;return this.$q.all(_.map(this.resolveChunkInfo(i,e),function(e){var t=n.generateChunkKey(i,e.media,e.type);return n._chunks[t]||(n._chunks[t]=n.$q.defer(),n.loadScript(t,i,e.url)),n._chunks[t].promise}))},i.prototype.resolveChunkInfo=function(e,t){return _.map(document.querySelectorAll(['link[rel="chunk"][chunk-id="'+e+'"][media="'+t+'"]','link[rel="chunk"][chunk-id="'+e+'"][media="all"]'].join(", ")),function(e){return{url:e.getAttribute("href"),media:e.getAttribute("media"),type:e.getAttribute("chunk-type")}})},i.prototype.generateChunkKey=function(e,t,i){return[e,t,i].join("__")},i.prototype.generateScriptId=function(e){return e},i.prototype.removeScript=function(e){for(var t=document.querySelectorAll('script[chunk-id="'+e+'"]'),i=0;i<t.length;i++){var n=t[i];n.parentNode.removeChild(n)}},i.prototype.getCdnScriptUrl=function(e){return c.BookingFormSettings.getInstance().cdnHost?c.BookingFormSettings.getInstance().cdnHost+e:e},i.prototype.isCdnScriptUrl=function(e){return!!c.BookingFormSettings.getInstance().cdnHost&&0==e.indexOf(c.BookingFormSettings.getInstance().cdnHost)},i.prototype.loadScript=function(e,t,i,n,o){var r=this,a=(void 0===n&&(n=5),void 0===o&&(o=!0),this.generateScriptId(i)),s=document.createElement("script"),l=document.querySelector("body");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.src=o?this.getCdnScriptUrl(i):c.BookingFormSettings.getInstance().originalBaseUrl+i,s.setAttribute("chunk-id",a),s.onerror=function(){setTimeout(function(){r.removeScript(a),1<=n?r.loadScript(e,t,i,--n,!1):(r._chunks[e]&&(r._chunks[e].reject(),delete r._chunks[e]),c.ServiceErrorInformer.getInstance().notify(c.ServiceErrorInformerMessageType.Error,{error_code:c.ServiceErrorCode.TransportError,lang:"en",message:"cant load chunk script "+i}))},3e3)},l.appendChild(s)},i.$inject=["$q","errorHandler"],c.ChunkRequireService=i}(tl=tl||{}),!function(tl){function url(e){return e}app=angular.module("tlBookingForm",["ui.router","tmh.dynamicLocale","ngTouch"]),app.factory("$exceptionHandler",["$log",function(i){return function(e,t){window.hasOwnProperty("Raven")&&Raven.captureException(e,{extra:{info:JSON.stringify({artifacts:tl.SessionLogger.getInstance().artifactLogger.artifacts},null,2)}}),i.error.apply(i,arguments)}}]),app.service("serviceFactory",tl.ServiceFactory),app.service("bookingFormSettings",tl.BookingFormSettings),app.service("locale",tl.Locale),app.service("chunkRequire",tl.ChunkRequireService),app.run(["$injector","$rootScope","$templateCache","layout","$state","stateStack","auth","$location","$http","paymentPopup","errorHandler","serviceFactory",function($injector,$rootScope,$templateCache,layout,$state,stateStack,authService,$location,$http,_paymentPopup,errorHandler,serviceFactory){tl.SessionLogger.getInstance().performanceLogger.push("bookingFormRun"),tl.SessionLogger.getInstance().artifactLogger.push({kind:tl.ArtifactKind.SessionStart,value:tl.DateUtil.getUserDate()});var appParams=AppIntegration.getProperties(),staticPrefix=(serviceFactory.bootstrapService.prepare(appParams),$rootScope.layout=layout,$rootScope.appParams=appParams,url("/s/")),staticRoute=$location.path().substr(0,staticPrefix.length)===staticPrefix;if(staticRoute)errorHandler.disableHandler();else{var nextState=tl.AppState.Start;switch(appParams.state){case tl.AppIntegrationState.Cancellation:nextState=tl.AppState.StartCancellation;break;case tl.AppIntegrationState.Rooms:nextState=tl.AppState.StartRooms;break;case tl.AppIntegrationState.Booking:nextState=tl.AppState.Start;break;case tl.AppIntegrationState.EditBooking:nextState=tl.AppState.StartEditBooking;break;case tl.AppIntegrationState.RestoreBooking:nextState=tl.AppState.StartRestoreBooking;break;case tl.AppIntegrationState.ApproveBooking:nextState=tl.AppState.StartApproveBooking;break;case tl.AppIntegrationState.ChangeCard:nextState=tl.AppState.StartChangeCard;break;case tl.AppIntegrationState.DeferredPayment:nextState=tl.AppState.StartDeferredPayment;break;case tl.AppIntegrationState.PriceList:nextState=tl.AppState.StartPriceList;break;case tl.AppIntegrationState.Components:nextState=tl.AppState.StartComponents;break;case tl.AppIntegrationState.Survey:nextState=tl.AppState.StartSurvey;break;default:nextState=appParams.bookingNumber||!appParams.providerId?tl.AppState.StartEditBooking:appParams.unfinishedBookingNumber&&appParams.unfinishedBookingSign?tl.AppState.StartContinueBooking:tl.AppState.Start}$state.go(nextState,{},{location:"replace",reload:!0})}$rootScope.staticRoute=staticRoute;var svgContainer=document.getElementById("tl-svg"),autoScroll=(svgContainer&&$http.get(document.querySelector('link[rel="svg"]').getAttribute("href")).then(function(e){svgContainer.innerHTML=e.data}),paymentPopup=_paymentPopup,{}),provider,watchSlowLoadingInterval,slowLoadingSent,loadingTimingSent,slowLoadingCount,sendLoadingTiming,bookingFormSettings_1;document.addEventListener(tl.EventType.Click,function(e){var t,i;layout.phone&&(t=(t=e.target.closest("[data-autoscroll-save]"))?t.dataset.autoscrollSave:null,i=(i=e.target.closest("[data-autoscroll-start]"))?i.dataset.autoscrollStart:null,e=(e=e.target.closest("[data-autoscroll-remove]"))?e.dataset.autoscrollRemove:null,i&&autoScroll[i]?(tl.util.IntegrationUtil.scrollTo(autoScroll[i]),delete autoScroll[i]):t?autoScroll[t]?delete autoScroll[t]:autoScroll[t]=AppIntegration.getPosition().scrollTop:e&&autoScroll[e]&&delete autoScroll[e])}),staticRoute||(provider=String(appParams.providerId||""),tl.TrackerService.store({_provider:provider}),tl.TrackerService.track("session-start",{provider:provider,agent:navigator.userAgent,screen:[window.screen.availWidth,window.screen.availHeight].join("x"),width:window.innerWidth,source:AppIntegration.getSource(),referrer:AppIntegration.getReferrerCode(),referrerUrl:AppIntegration.getReferrerUrl(),profile:AppIntegration.getIntegrationKey(),theme:THEME,bookingSource:appParams.bookingSource,opener:appParams.opener||"",platform:tl.DeviceUtil.getPlatform(),os:tl.DeviceUtil.getOS(),browser:tl.DeviceUtil.getBrowser()}),tl.TrackerService.track("language",{id:tl.Locale.getInstance().language().locale()}),tl.TrackerService.track("currency",{id:tl.Locale.getInstance().currency().id}),$rootScope.$on(tl.BroadcastEvent.WindowSizeChanged,function(e,t){var i=layout.desktop?tl.Layout.Desktop:tl.Layout.Phone;tl.TrackerService.store({_layout:i}),tl.TrackerService.track("layout",{layout:i})}),watchSlowLoadingInterval=null,slowLoadingSent=!1,loadingTimingSent=!1,slowLoadingCount=0,sendLoadingTiming=function(e){!loadingTimingSent&&PERFORMANCE_TIMINGS&&(loadingTimingSent=!0,tl.TrackerService.track("tech",{action:e?"init-complete":"init-incomplete",timeMs:(new Date).getTime()-PERFORMANCE_TIMINGS.initStart}))},bookingFormSettings_1=tl.BookingFormSettings.getInstance(),$rootScope.$watch(function(){var e;return null==(e=bookingFormSettings_1.customScripts)?void 0:e.length},function(newLength,oldLength){0!==newLength&&_.forEach(bookingFormSettings_1.customScripts,function(script,index){var injector=$injector,$scope=$rootScope.$new(!0);try{eval(script)}catch(e){tl.TrackerService.track("tech",{action:"custom-script-failed",scriptIndex:index,message:e.message})}})}),$rootScope.$watch(function(){return layout.isVisible},function(){clearInterval(watchSlowLoadingInterval),layout.isVisible&&sendLoadingTiming(!0),layout.isVisible?slowLoadingSent&&tl.TrackerService.track("tech",{action:"slow-init-resolved"}):watchSlowLoadingInterval=setInterval(function(){layout.isVisible||(slowLoadingCount<100&&tl.TrackerService.track("tech",{action:"slow-init-warning",timeoutMs:1e4}),slowLoadingCount++,slowLoadingSent=!0)},1e4),slowLoadingSent=!1}),tl.TrackerService.trackGaPageview(),angular.element(window).on(tl.EventType.BeforeUnload,function(){sendLoadingTiming(!1),tl.TrackerService.track("session-end"),tl.TrackerService.flushTrackEvents(),tl.SessionLogger.getInstance().artifactLogger.push({kind:tl.ArtifactKind.SessionEnd,value:tl.DateUtil.getUserDate()}),tl.TrackerService.trackPerformance()}))}]),app.filter("tlResolveLocaleLocation",[function(){return function(e){return document.querySelector('link[rel="locale"][locale-id="'+e+'"]').getAttribute("href")}}]),app.config(["$stateProvider","$locationProvider","$compileProvider","$controllerProvider","$qProvider","tmhDynamicLocaleProvider","$sceDelegateProvider",function(e,t,i,n,o,r,a){i.debugInfoEnabled(!1),o.errorOnUnhandledRejections(!1),app.controller=n.register,app.directive=i.directive,t.hashPrefix(""),t.html5Mode(!1),r.localeLocationPattern("{{locale | tlResolveLocaleLocation}}");function s(n,o){return{chunk:["chunkRequire","layout",function(t,e){var i=e.phone?tl.ChunkMediaType.Phone:tl.ChunkMediaType.Desktop;return t.ensure(n,i).then(function(){_.forEach(o,function(e){t.ensure(e,i)})})}]}}CDN_HOST&&a.resourceUrlWhitelist(["self",CDN_HOST+"**"]),e.state(tl.AppState.Start,{template:'<div ng-controller="StartBookingPageCtrl"></div>',resolve:s("start",["rooms","search-filter"])}).state(tl.AppState.StartRooms,{template:'<div ng-controller="StartRoomsPageCtrl"></div>',resolve:s("start",["rooms-list"])}).state(tl.AppState.StartCancellation,{template:'<div ng-controller="StartCancellationPageCtrl"></div>',resolve:s("start",["auth","cancellation"])}).state(tl.AppState.StartContinueBooking,{template:'<div ng-controller="StartContinueBookingPageCtrl"></div>',resolve:s("start",["payment"])}).state(tl.AppState.StartEditBooking,{template:'<div ng-controller="StartEditBookingPageCtrl"></div>',resolve:s("start",["auth","edit-booking"])}).state(tl.AppState.StartRestoreBooking,{template:'<div ng-controller="StartRestoreBookingPageCtrl"></div>',resolve:s("start",["auth","edit-booking"])}).state(tl.AppState.StartApproveBooking,{template:'<div ng-controller="StartApproveBookingPageCtrl"></div>',resolve:s("start",["auth","edit-booking"])}).state(tl.AppState.StartChangeCard,{template:'<div ng-controller="StartChangeCardPageCtrl"></div>',resolve:s("start",["auth","edit-booking"])}).state(tl.AppState.StartDeferredPayment,{template:'<div ng-controller="StartDeferredPaymentPageCtrl"></div>',resolve:s("start",["auth","edit-booking"])}).state(tl.AppState.StartPriceList,{template:'<div ng-controller="StartPriceListCtrl"></div>',resolve:s("start",["price-list"])}).state(tl.AppState.StartComponents,{template:'<div ng-controller="StartComponentsCtrl"></div>',resolve:s("start",["components"])}).state(tl.AppState.StartSurvey,{template:'<div ng-controller="StartSurveyCtrl"></div>',resolve:s("start",["survey"])}).state(tl.AppState.Rooms,{url:url("/search"),template:tl.pageTemplate({name:"rooms",template:"rooms-view",ctrl:"RoomsPageCtrl"}),resolve:s("rooms",["preview","payment","search-filter"])}).state(tl.AppState.Rooms_List,{template:tl.pageTemplate({name:"rooms",template:"rooms"}),resolve:s("rooms",["preview","payment","search-filter"])}).state(tl.AppState.Rooms_FilteredList,{template:tl.pageTemplate({name:"rooms",template:"rooms-with-filter"}),resolve:s("rooms",["preview","payment","search-filter"])}).state(tl.AppState.Rooms_Grid,{template:tl.pageTemplate({name:"rooms",template:"rooms-grid",single:!0}),resolve:s("rooms",["preview","payment","search-filter"])}).state(tl.AppState.RoomsSearchCriteria,{url:url("/rooms-search-criteria"),template:tl.pageTemplate({name:"rooms-search-criteria",ctrl:"RoomsSearchCriteriaPageCtrl"}),resolve:s("rooms-search-criteria",["preview","payment"])}).state(tl.AppState.RoomsSearchCriteria_All,{template:tl.pageTemplate({name:"rooms-search-criteria",template:"rooms-search-criteria-all"}),resolve:s("rooms-search-criteria",["preview","payment"])}).state(tl.AppState.RoomsSearchCriteria_Filtered,{template:tl.pageTemplate({name:"rooms-search-criteria",template:"rooms-search-criteria-filter"}),resolve:s("rooms-search-criteria",["preview","payment"])}).state(tl.AppState.RoomsSearchCriteria_NoRooms,{template:tl.pageTemplate({name:"rooms-search-criteria",template:"rooms-search-criteria-no-rooms",single:!0}),resolve:s("rooms-search-criteria",["preview","payment"])}).state(tl.AppState.CertificateList,{url:url("/certificates-list"),template:tl.pageTemplate({name:"certificates-list",template:"certificates-list",ctrl:"CertificatesListPageCtrl",single:!0}),resolve:s("certificates-list",["payment"])}).state(tl.AppState.NoRooms,{url:url("/no-rooms"),template:tl.pageTemplate({name:"no-rooms",ctrl:"NoRoomsPageCtrl",single:!0,template:"no-rooms"}),resolve:s("no-rooms",["rooms","search-filter"])}).state(tl.AppState.SharedRatePlans,{url:url("/shared-rate-plans"),template:tl.pageTemplate({name:"shared-rate-plans",ctrl:"SharedRatePlansPageCtrl",single:!0,template:"shared-rate-plans-view"}),resolve:s("shared-rate-plans",["shared-rooms"])}).state(tl.AppState.SharedRatePlans_List,{template:tl.pageTemplate({name:"shared-rate-plans",single:!0,template:"shared-rate-plans"}),resolve:s("shared-rate-plans",["shared-rooms"])}).state(tl.AppState.SharedRatePlans_FilteredList,{template:tl.pageTemplate({name:"shared-rate-plans",single:!0,template:"shared-rate-plans-with-filter"}),resolve:s("shared-rate-plans",["shared-rooms"])}).state(tl.AppState.SharedRooms,{url:url("/shared-rooms"),template:tl.pageTemplate({name:"shared-rooms",ctrl:"SharedRoomsPageCtrl",single:!0,template:"shared-rooms-view"}),resolve:s("shared-rooms",["preview","payment"])}).state(tl.AppState.SharedRooms_List,{template:tl.pageTemplate({name:"shared-rooms",single:!0,template:"shared-rooms"}),resolve:s("shared-rooms",["preview","payment"])}).state(tl.AppState.SharedRooms_FilteredList,{template:tl.pageTemplate({name:"shared-rooms",single:!0,template:"shared-rooms-with-filter"}),resolve:s("shared-rooms",["preview","payment"])}).state(tl.AppState.RoomsGuestAccommodation,{url:url("/rooms-guest-accommodation/:placementRef"),template:tl.pageTemplate({name:"rooms-guest-accommodation",ctrl:"RoomsGuestAccommodationPageCtrl",single:!0}),resolve:s("rooms-guest-accommodation",["rate-plans-guest-accommodation"])}).state(tl.AppState.RatePlansGuestAccommodation,{url:url("/rate-plans-guest-accommodation"),template:tl.pageTemplate({name:"rate-plans-guest-accommodation",ctrl:"RatePlansGuestAccommodationPageCtrl",single:!0}),resolve:s("rate-plans-guest-accommodation",["preview","payment"])}).state(tl.AppState.SearchFilter,{url:url("/filter"),template:tl.pageTemplate({name:"search-filter",ctrl:"SearchFilterPageCtrl",single:!0}),resolve:s("search-filter",["rooms","no-rooms"])}).state(tl.AppState.Cart,{url:url("/s/cart"),template:"<div><div tl-cart-detached></div><div tl-cart-new-detached></div></div>",data:{preventNavigation:!0}}).state(tl.AppState.Components,{url:url("/s/components"),template:tl.pageTemplate({name:"components",ctrl:"ComponentsPageCtrl",single:!0}),resolve:s("components")}).state(tl.AppState.RoomList,{url:url("/rooms"),template:tl.pageTemplate({name:"rooms-list",ctrl:"RoomsListPageCtrl",single:!0}),resolve:s("rooms-list",["rooms","search-filter"])}).state(tl.AppState.PriceList,{url:url("/price-list"),template:tl.pageTemplate({name:"price-list",ctrl:"PriceListPageCtrl",single:!0}),resolve:s("price-list",["rooms","search-filter"])}).state(tl.AppState.RoomInfo,{url:url("/room-info/:roomId"),template:tl.pageTemplate({name:"room-info",ctrl:"RoomInfoPageCtrl",single:!0}),resolve:s("room-info",["preview","payment","rooms"])}).state(tl.AppState.Preview,{url:url("/preview/:placementRef"),template:tl.pageTemplate({name:"preview",ctrl:"PreviewPageCtrl",single:!0}),resolve:s("preview",["payment","rooms"])}).state(tl.AppState.Payment,{url:url("/payment/:scrollTo"),template:tl.pageTemplate({name:"payment",ctrl:"PaymentPageCtrl",single:!0}),resolve:s("payment",["payment-await","payment-internal","preview","rooms","complete"])}).state(tl.AppState.Payment_Certificate,{template:tl.pageTemplate({name:"payment",ctrl:"PaymentPageCtrl",template:"payment-certificate",single:!0}),resolve:s("payment",["payment-await","payment-internal","certificates-list","complete"])}).state(tl.AppState.PaymentAwait,{url:url("/payment-await"),template:tl.pageTemplate({name:"payment-await",ctrl:"PaymentAwaitPageCtrl",single:!0}),resolve:s("payment-await",["complete","payment-failed"])}).state(tl.AppState.PaymentInternal,{url:url("/payment-internal"),template:tl.pageTemplate({name:"payment-internal",ctrl:"PaymentInternalPageCtrl",single:!0}),resolve:s("payment-internal",["complete","payment-failed"])}).state(tl.AppState.PaymentFailed,{url:url("/payment-failed"),template:tl.pageTemplate({name:"payment-failed",ctrl:"PaymentFailedPageCtrl",single:!0}),resolve:s("payment-failed",["payment"])}).state(tl.AppState.PaymentPopup,{url:url("/s/payment-popup/:bookingNumber"),template:tl.pageTemplate({name:"payment-popup",ctrl:"PaymentPopupPageCtrl",single:!0}),resolve:s("payment-popup")}).state(tl.AppState.PaymentResult,{url:url("/s/payment/:result"),template:'<div ng-controller="PaymentResultPageCtrl"></div>',resolve:s("payment-result")}).state(tl.AppState.Complete,{url:url("/complete"),template:tl.pageTemplate({name:"complete",ctrl:"CompletePageCtrl",single:!0}),resolve:s("complete"),data:{preventNavigation:!0}}).state(tl.AppState.Auth,{url:url("/auth/:back"),template:tl.pageTemplate({name:"auth",ctrl:"AuthPageCtrl",single:!0}),resolve:s("auth")}).state(tl.AppState.Cancellation,{url:url("/cancellation"),template:tl.pageTemplate({name:"cancellation",ctrl:"CancellationPageCtrl",single:!0}),resolve:s("cancellation",["cancellation-complete","cancellation-failed","auth"]),data:{restrictedRoles:[tl.AuthRole.Cancellation]}}).state(tl.AppState.CancellationComplete,{template:tl.pageTemplate({name:"cancellation-complete",ctrl:"CancellationCompletePageCtrl",single:!0}),resolve:s("cancellation-complete"),data:{restrictedRoles:[tl.AuthRole.Cancellation],preventNavigation:!0}}).state(tl.AppState.CancellationFailed,{template:tl.pageTemplate({name:"cancellation-failed",ctrl:"CancellationFailedPageCtrl",single:!0}),resolve:s("cancellation-failed"),data:{restrictedRoles:[tl.AuthRole.Cancellation]}}).state(tl.AppState.EditBooking,{url:url("/edit-booking"),template:tl.pageTemplate({name:"edit-booking",ctrl:"EditBookingPageCtrl",single:!0}),resolve:s("edit-booking"),data:{restrictedRoles:[tl.AuthRole.EditBooking,tl.AuthRole.PayBooking]}}).state(tl.AppState.EditBooking_RestoreBooking,{template:tl.pageTemplate({name:"edit-booking",single:!0})}).state(tl.AppState.EditBooking_ApproveBooking,{template:tl.pageTemplate({name:"edit-booking",single:!0})}).state(tl.AppState.EditBooking_RestoreBookingSuccess,{template:tl.pageTemplate({name:"edit-booking",single:!0})}).state(tl.AppState.EditBooking_ApproveBookingSuccess,{template:tl.pageTemplate({name:"edit-booking",single:!0})}).state(tl.AppState.EditBooking_ChangeCard,{template:tl.pageTemplate({name:"edit-booking",single:!0})}).state(tl.AppState.EditBooking_DeferredPayment,{template:tl.pageTemplate({name:"edit-booking",single:!0})}).state(tl.AppState.EditBookingPaymentAwait,{url:url("/edit-booking-payment-await?paymentType"),template:tl.pageTemplate({name:"payment-await",ctrl:"PaymentAwaitPageCtrl",single:!0}),resolve:s("payment-await",["edit-booking-payment-succeed","payment-failed"])}).state(tl.AppState.EditBookingPaymentInternal,{url:url("/edit-booking-payment-internal?paymentType"),template:tl.pageTemplate({name:"payment-internal",ctrl:"PaymentInternalPageCtrl",single:!0}),resolve:s("payment-internal",["edit-booking-payment-succeed","payment-failed"])}).state(tl.AppState.EditBookingPaymentFailed,{url:url("/edit-booking-payment-failed?paymentType"),template:tl.pageTemplate({name:"payment-failed",ctrl:"PaymentFailedPageCtrl",single:!0}),resolve:s("payment-failed",["edit-booking"])}).state(tl.AppState.EditBookingPaymentPopup,{url:url("/s/edit-booking-payment-popup/:bookingNumber?paymentType"),template:tl.pageTemplate({name:"payment-popup",ctrl:"PaymentPopupPageCtrl",single:!0}),resolve:s("payment-popup")}).state(tl.AppState.EditBookingPaymentResult,{url:url("/s/edit-booking-payment/:result?paymentType"),template:'<div ng-controller="PaymentResultPageCtrl"></div>',resolve:s("payment-result")}).state(tl.AppState.EditBookingPaymentSucceed,{url:url("/edit-booking-payment-succeed?paymentType"),template:tl.pageTemplate({name:"edit-booking-payment-succeed",ctrl:"EditBookingPaymentSucceedPageCtrl",single:!0}),resolve:s("edit-booking-payment-succeed",["edit-booking","cancellation"])}).state(tl.AppState.EditBookingDates,{url:url("/edit-booking-dates/:roomStayIndex"),template:tl.pageTemplate({name:"edit-booking-dates",ctrl:"EditBookingDatesPageCtrl",single:!0}),resolve:s("edit-booking-dates",["edit-booking","cancellation"]),data:{restrictedRoles:[tl.AuthRole.EditBooking]}}).state(tl.AppState.EditBookingDates_Calendar,{template:tl.pageTemplate({name:"edit-booking-dates",template:"edit-booking-dates__calendar",single:!0})}).state(tl.AppState.EditBookingDates_Result,{template:tl.pageTemplate({name:"edit-booking-dates",template:"edit-booking-dates__result",single:!0})}).state(tl.AppState.EditBookingDates_Confirm,{template:tl.pageTemplate({name:"edit-booking-dates",template:"edit-booking-dates__confirm",single:!0})}).state(tl.AppState.EditBookingRoomType,{url:url("/edit-booking-room-type/:roomStayIndex"),template:tl.pageTemplate({name:"edit-booking-room-type",ctrl:"EditBookingRoomTypePageCtrl",single:!0}),resolve:s("edit-booking-room-type",["edit-booking","cancellation"]),data:{restrictedRoles:[tl.AuthRole.EditBooking]}}).state(tl.AppState.EditBookingRoomType_RoomsCommon,{template:tl.pageTemplate({name:"edit-booking-room-type",template:"edit-booking-room-type__rooms-common",single:!0})}).state(tl.AppState.EditBookingRoomType_RoomsSharedRoom,{template:tl.pageTemplate({name:"edit-booking-room-type",template:"edit-booking-room-type__rooms-shared-room",single:!0})}).state(tl.AppState.EditBookingRoomType_NoRooms,{template:tl.pageTemplate({name:"edit-booking-room-type",template:"edit-booking-room-type__no-rooms",single:!0})}).state(tl.AppState.EditBookingRoomType_Result,{template:tl.pageTemplate({name:"edit-booking-room-type",template:"edit-booking-room-type__result",single:!0})}).state(tl.AppState.EditBookingRoomType_Confirm,{template:tl.pageTemplate({name:"edit-booking-room-type",template:"edit-booking-room-type__confirm",single:!0})}).state(tl.AppState.EditBookingRatePlan,{url:url("/edit-booking-rate-plan/:roomStayIndex"),template:tl.pageTemplate({name:"edit-booking-rate-plan",ctrl:"EditBookingRatePlanPageCtrl",single:!0}),resolve:s("edit-booking-rate-plan",["edit-booking","cancellation"]),data:{restrictedRoles:[tl.AuthRole.EditBooking]}}).state(tl.AppState.EditBookingRatePlan_RatesCommon,{template:tl.pageTemplate({name:"edit-booking-rate-plan",template:"edit-booking-rate-plan__rates-common",single:!0})}).state(tl.AppState.EditBookingRatePlan_RatesSharedRoom,{template:tl.pageTemplate({name:"edit-booking-rate-plan",template:"edit-booking-rate-plan__rates-shared-room",single:!0})}).state(tl.AppState.EditBookingRatePlan_NoRates,{template:tl.pageTemplate({name:"edit-booking-rate-plan",template:"edit-booking-rate-plan__no-rates",single:!0})}).state(tl.AppState.EditBookingRatePlan_Result,{template:tl.pageTemplate({name:"edit-booking-rate-plan",template:"edit-booking-rate-plan__result",single:!0})}).state(tl.AppState.EditBookingRatePlan_Confirm,{template:tl.pageTemplate({name:"edit-booking-rate-plan",template:"edit-booking-rate-plan__confirm",single:!0})}).state(tl.AppState.EditBookingOptions,{url:url("/edit-booking-options"),template:tl.pageTemplate({name:"edit-booking-options",ctrl:"EditBookingOptionsPageCtrl",single:!0}),resolve:s("edit-booking-options",["edit-booking","cancellation"]),data:{restrictedRoles:[tl.AuthRole.EditBooking]}}).state(tl.AppState.EditBookingOptions_Options,{template:tl.pageTemplate({name:"edit-booking-options",template:"edit-booking-options__options",single:!0})}).state(tl.AppState.EditBookingOptions_NoOptions,{template:tl.pageTemplate({name:"edit-booking-options",template:"edit-booking-options__no-options",single:!0})}).state(tl.AppState.EditBookingOptions_Result,{template:tl.pageTemplate({name:"edit-booking-options",template:"edit-booking-options__result",single:!0})}).state(tl.AppState.EditBookingOptions_Confirm,{template:tl.pageTemplate({name:"edit-booking-options",template:"edit-booking-options__confirm",single:!0})}).state(tl.AppState.EditBookingDeleteRoom,{url:url("/edit-booking-delete-room/:roomStayIndex"),template:tl.pageTemplate({name:"edit-booking-delete-room",ctrl:"EditBookingDeleteRoomPageCtrl",single:!0}),resolve:s("edit-booking-delete-room",["edit-booking","cancellation"]),data:{restrictedRoles:[tl.AuthRole.EditBooking]}}).state(tl.AppState.EditBookingDeleteRoom_Result,{template:tl.pageTemplate({name:"edit-booking-delete-room",template:"edit-booking-delete-room__result",single:!0})}).state(tl.AppState.EditBookingDeleteRoom_Confirm,{template:tl.pageTemplate({name:"edit-booking-delete-room",template:"edit-booking-delete-room__confirm",single:!0})}).state(tl.AppState.Prefetch,{url:url("/s/prefetch"),template:'<div ng-controller="PrefetchPageCtrl"></div>',resolve:s("prefetch",["rooms","search-filter"])}).state(tl.AppState.Error,{url:url("/error/:errorCode"),template:tl.pageTemplate({name:"error",ctrl:"ErrorPageCtrl",single:!0}),resolve:s("error")}).state(tl.AppState.MirRegister,{url:url("/mir-register"),template:tl.pageTemplate({name:"mir-register",ctrl:"MirRegisterPageCtrl",single:!0}),resolve:s("mir-register",[])}).state(tl.AppState.Survey,{url:url("/s/survey"),template:tl.pageTemplate({name:"survey",ctrl:"SurveyPageCtrl",single:!0}),resolve:s("survey")})}])}(tl=tl||{}),!function(a){var b={state:null,scope:{}},e=(t.prototype.init=function(){var e,r=this,t=(this.initHeader(),this.initCartPanel(),this.initCopyright(),this.$scope.$on("$stateChangeStart",function(e,t,i,n,o){e.defaultPrevented||(r.isPageLoaded=!1,r.preloaderViewMode=a.PreloaderViewMode.Default),b.state=n.name,b.scope={},r.tearDown(b.scope)}),null),i=!1,n=0,o=this.$state.current.name;o!=a.AppState.Prefetch&&o!=a.AppState.Cart&&(e=function(){a.TrackerService.track("tech",{action:"slow-page-resolved",page:r.$state.current.name})},this.$scope.$watch(function(){return r.layout.isVisible&&r.isPageLoaded},function(){clearInterval(t),r.isPageLoaded?i&&e():t=setInterval(function(){!r.isPageLoaded&&r.layout.isVisible&&(i=!0,n<100&&a.TrackerService.track("tech",{action:"slow-page-warning",page:r.$state.current.name,timeoutMs:4e3}),n++)},4e3),i=!1}),this.$scope.$on("$destroy",function(){clearInterval(t),i&&e()}))},t.prototype.overlayOn=function(){this.overlay.on()},t.prototype.overlayOff=function(){this.overlay.off()},t.prototype.initHeader=function(){},t.prototype.initCartPanel=function(){},t.prototype.initCopyright=function(){a.CopyrightManager.getInstance().hide()},t.prototype.tearUp=function(e){},t.prototype.tearDown=function(e){},t);function t(){this.isPageLoaded=!1,this.preloaderViewMode=a.PreloaderViewMode.Default}a.IController=e;__extends(o,i=e),Object.defineProperty(o.prototype,"bootstrapService",{get:function(){return this.serviceFactory.bootstrapService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bookingRuleService",{get:function(){return this.serviceFactory.bookingRuleService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"orderService",{get:function(){return this.serviceFactory.orderService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bookingService",{get:function(){return this.serviceFactory.bookingService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bookingStrategy",{get:function(){return this.bookingService.getBookingStrategy()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"affiliateService",{get:function(){return this.serviceFactory.affiliateService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"availabilityCalendarService",{get:function(){return this.serviceFactory.availabilityCalendarService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"wishListService",{get:function(){return this.serviceFactory.wishListService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"guestProfileService",{get:function(){return this.serviceFactory.guestProfileService},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"paymentPopupService",{get:function(){return this.serviceFactory.paymentPopupService},enumerable:!0,configurable:!0});var i,n=o;function o(){return null!==i&&i.apply(this,arguments)||this}a.BookingController=n;__extends(s,r=e),Object.defineProperty(s.prototype,"bootstrapService",{get:function(){return this.serviceFactory.bootstrapService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"editBookingService",{get:function(){return this.serviceFactory.editBookingService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"orderService",{get:function(){return this.serviceFactory.orderService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"paymentPopupService",{get:function(){return this.serviceFactory.paymentPopupService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"personalDataService",{get:function(){return this.serviceFactory.personalDataService},enumerable:!0,configurable:!0});var r,n=s;function s(){return null!==r&&r.apply(this,arguments)||this}a.EditBookingController=n;__extends(u,l=n),Object.defineProperty(u.prototype,"editBookingStrategy",{get:function(){return this.editBookingService.getEditBookingStrategy()},enumerable:!0,configurable:!0});var l,c=u;function u(){return null!==l&&l.apply(this,arguments)||this}a.CommonEditBookingController=c;__extends(p,d=n),Object.defineProperty(p.prototype,"editBookingStrategy",{get:function(){return this.editBookingService.getEditBookingStrategy()},enumerable:!0,configurable:!0});var d,c=p;function p(){return null!==d&&d.apply(this,arguments)||this}a.SharedRoomEditBookingController=c;__extends(g,m=e),Object.defineProperty(g.prototype,"orderService",{get:function(){return this.serviceFactory.orderService},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"bootstrapService",{get:function(){return this.serviceFactory.bootstrapService},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"cancellationService",{get:function(){return this.serviceFactory.cancellationService},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"personalDataService",{get:function(){return this.serviceFactory.personalDataService},enumerable:!0,configurable:!0});var m,n=g;function g(){return null!==m&&m.apply(this,arguments)||this}a.CancellationController=n;__extends(f,h=e),Object.defineProperty(f.prototype,"bootstrapService",{get:function(){return this.serviceFactory.bootstrapService},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"bookingService",{get:function(){return this.serviceFactory.bookingService},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"editBookingService",{get:function(){return this.serviceFactory.editBookingService},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"orderService",{get:function(){return this.serviceFactory.orderService},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"guestProfileService",{get:function(){return this.serviceFactory.guestProfileService},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"paymentPopupService",{get:function(){return this.serviceFactory.paymentPopupService},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"hotelReservationsRequestService",{get:function(){return this.serviceFactory.hotelReservationsRequestService},enumerable:!0,configurable:!0});var h,c=f;function f(){return null!==h&&h.apply(this,arguments)||this}a.CommonPaymentController=c;__extends(y,v=e),Object.defineProperty(y.prototype,"surveyService",{get:function(){return this.serviceFactory.surveyService},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"bootstrapService",{get:function(){return this.serviceFactory.bootstrapService},enumerable:!0,configurable:!0});var v,n=y;function y(){return null!==v&&v.apply(this,arguments)||this}a.SurveyController=n,a.registerStyles=function(e,t){var i,e="styles-"+e;document.getElementById(e)||((i=document.createElement("style")).setAttribute("id",e),i.textContent=t,document.body.appendChild(i))};var _=null;app.run(["$templateCache",function(e){_=e}]),a.registerTemplate=function(t){_?t(_):app.run(["$templateCache",function(e){t(e)}])};var S=[];function k(e,t){var i="";return t==a.Layout.Desktop&&e&&e.desktop?i=e.desktop+"/":t==a.Layout.Phone&&e&&e.phone?i=e.phone+"/":!t&&e&&e.single&&(i=e.single+"/"),i}function P(e){return["<div",e.ctrl?' ng-controller="%CTRL"':"",' ng-include="::',e.single?"'%PATH/%COMPONENT/%EXPERIMENT_SINGLE%TEMPLATE.html'":"$root.layout.phone ? '%PATH/%COMPONENT/%PHONE%EXPERIMENT_PHONE%TEMPLATE__phone.html' : '%PATH/%COMPONENT/%DESKTOP%EXPERIMENT_DESKTOP%TEMPLATE__desktop.html'",'"></div>'].join("").replace(/%PATH/g,e.basePath).replace(/%PHONE/g,"phone/").replace(/%DESKTOP/g,"desktop/").replace(/%CTRL/g,e.ctrl).replace(/%EXPERIMENT_SINGLE/g,k(e.experiment,"")).replace(/%EXPERIMENT_DESKTOP/g,k(e.experiment,a.Layout.Desktop)).replace(/%EXPERIMENT_PHONE/g,k(e.experiment,a.Layout.Phone)).replace(/%TEMPLATE/g,e.template||e.component).replace(/%COMPONENT/g,e.component)}function C(e){var t=(t=e.layout?":PATH/:COMPONENT/:LAYOUT/:EXPERIMENT:TEMPLATE__:LAYOUT.html":":PATH/:COMPONENT/:EXPERIMENT:TEMPLATE.html").replace(/:PATH/g,e.basePath).replace(/:LAYOUT/g,e.layout).replace(/:TEMPLATE/g,e.template||e.component).replace(/:COMPONENT/g,e.component).replace(/:EXPERIMENT/g,e.experiment?e.experiment+"/":"");return e.quote?"'"+t+"'":t}a.registerDirective=function(e,t){-1==S.indexOf(e)&&(S.push(e),app.directive(e,t))},a.registerController=function(e,y,_){void 0===_&&(_=!1),app.controller(e,["$scope","$injector","$location","$element","$state","$stateParams","$q","$compile","$templateCache","$timeout","tl.messages","serviceFactory","overlay","locale","layout","auth","errorHandler","$filter",function(e,t,i,n,o,r,a,s,l,c,u,d,p,m,g,h,f,v){t=t.instantiate(_?y():y),t.$element=n,t.$location=i,t.messages=u,t.serviceFactory=d,t.$state=o,t.$stateParams=r,t.$q=a,t.$compile=s,t.$templateCache=l,t.$timeout=c,t.overlay=p,t.locale=m,t.layout=g,t.authService=h,t.errorHandler=f,t.$filter=v,n=function(e,t){for(var i in t.$scope=e,t){var n;e.hasOwnProperty(i)||(n=t[i],angular.isFunction(n)&&n.bind&&"$q"!=i?e[i]=n.bind(e):e[i]=n)}return e}(e,t);b.state==o.current.name&&n.tearUp(b.scope),n.init()}])},a.pageTemplate=function(e){return P({basePath:"pages",component:e.name,template:e.template,ctrl:e.ctrl,single:e.single,experiment:e.experiment})},a.directiveTemplate=function(e){return P({basePath:"directives",component:e.name,template:e.template,single:e.single,experiment:e.experiment})},a.directiveTemplateUrl=function(e,t,i,n){return C({basePath:"directives",component:e,template:t,layout:i,experiment:n})},a.pageTemplateUrl=function(e,t,i){return C({basePath:"pages",component:e,template:t,layout:i})}}(tl=tl||{}),!function(o){function i(e,t,i,n,o,r,a){this.promoCode="",this.guestRatePlans=[],this._placements=[],this._roomTypeIds=[],this._ratePlansIds=[],this._isValidPromoCode=!1,this.providerId=e,this.placements=t,this.checkInDate=i,this.checkOutDate=n,this.language=o,this.currency=r,this.source=a}Object.defineProperty(i.prototype,"roomTypeIds",{get:function(){return this._roomTypeIds},set:function(e){this._roomTypeIds=_.uniq(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ratePlansIds",{get:function(){return this._ratePlansIds},set:function(e){this._ratePlansIds=_.uniq(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"placements",{get:function(){return this._placements},set:function(e){this._placements=e,_.each(this._placements,function(e,t){e.ref=t})},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isValidPromoCode",{get:function(){return this._isValidPromoCode},set:function(e){this._isValidPromoCode=e},enumerable:!0,configurable:!0}),i.prototype.stayDuration=function(e){return new o.StayDuration(e,this.nights()+(e==o.StayUnitKind.Night?0:1))},i.prototype.stayPeriod=function(){return new o.DatePeriod(this.checkInDate,this.checkOutDate)},i.prototype.nights=function(){return this.checkOutDate.diffInDays(this.checkInDate)},i.prototype.guests=function(){return this.adults()+this.children()},i.prototype.adults=function(){var e=_.reduce(this.placements,function(e,t){return e+t.adults},0);return e=o.BookingFormSettings.getInstance().isModeTurnedOn(o.BookingFormMode.SharedAccommodationRatePlan)&&!o.BookingFormSettings.getInstance().isModeTurnedOn(o.BookingFormMode.SharedRoomView)?_.reduce(this.guestRatePlans,function(e,t){return e+t.adults},0):e},i.prototype.children=function(){var e=_.reduce(this.placements,function(e,t){return e+t.children.length},0);return e=o.BookingFormSettings.getInstance().isModeTurnedOn(o.BookingFormMode.SharedAccommodationRatePlan)&&!o.BookingFormSettings.getInstance().isModeTurnedOn(o.BookingFormMode.SharedRoomView)?_.reduce(this.guestRatePlans,function(e,t){return e+t.children.length},0):e},i.prototype.clone=function(){var e=_.map(this.placements,function(e){return e.clone()}),t=_.map(this.guestRatePlans,function(e){return e.clone()}),e=new i(this.providerId,e,this.checkInDate.clone(),this.checkOutDate.clone(),this.language,this.currency,this.source);return e.promoCode=this.promoCode,e.roomTypeIds=this.roomTypeIds,e.ratePlansIds=this.ratePlansIds,e.guestRatePlans=t,e.isValidPromoCode=this.isValidPromoCode,e},o.SearchCriteria=i;function e(){}function t(e,t,i,n,o,r,a,s,l,c,u){this.date=e,this.roomTypes=t||null,this.forbidden=i||!1,this.minLos=n||1,this.minLosArrival=o||1,this.minAdvBooking=r||0,this.maxLos=a||Number.MAX_VALUE,this.maxLosArrival=s||Number.MAX_VALUE,this.maxAdvBooking=l||Number.MAX_VALUE,this.closeArrival=c||!1,this.closeDeparture=u||!1,this.hasRestriction=this.forbidden||1<this.minLos||this.maxLos<Number.MAX_VALUE||this.closeArrival||this.closeDeparture}o.Country=function(e,t,i,n){this.name=e,this.phoneCode=t,this.countryCode2=i,this.countryCode3=n,this.code=this.countryCode2},o.HotelAvailabilityInfo=e;o.DailyBookingRule=t,__extends(a,n=t);var n,r=a;function a(){return null!==n&&n.apply(this,arguments)||this}o.HotelBookingRule=r;__extends(s,p=t);var p,r=s;function s(e,t,i,n,o,r,a,s,l,c,u,d){t=p.call(this,t,i,n,o,r,a,s,l,c,u,d)||this;return t.ratePlanCode=e,t}function l(e,t,i,n){this.ratePlanCode=e,this.minLos=new o.StayDuration(t,i||1),this.maxLos=new o.StayDuration(t,n||Number.MAX_VALUE)}o.RatePlanBookingRule=r,l.prototype.hasMinLos=function(){return 1<this.minLos.value},l.prototype.hasMaxLos=function(){return this.maxLos.value&&this.maxLos.value!=Number.MAX_VALUE},o.RatePlanRestriction=l}(tl=tl||{}),!function(e){function t(){}t.CommonInfo="commonInfo",t.HotelInfo="hotelInfo",t.BookingFormSettings="bookingFormSettings",t.HotelAvailability="hotelAvailability",t.HotelOfferAvailability="hotelOfferAvailability",t.ResolvePromoCode="resolvePromoCode",t.IvisaAffiliate="ivisa",t.HotelReservation="hotelReservation",t.RoomTypeAvailability="roomTypeAvailability",t.BookingFormInfo="bookingFormInfo",t.HotelBookingRules="hotelBookingRules",t.RatePlanBookingRules="ratePlanBookingRules",t.NearestAvailableDates="nearestAvailableDates",t.PayOrderRequest="payOrderRequest",t.PayOrder="payOrder",t.CustomMessages="customMessages",t.WishListSettings="wishListSettings",t.WishListLegalDocuments="wishListLegalDocuments",t.YandexCreditSchedule="yandexCreditSchedule",t.BestPriceGuarantee="bestPriceGuarantee",e.ServiceCacheStorageKey=t}(tl=tl||{}),!function(e){e.State=function(e,t){this.params={},this.name=e,this.params=t},i.SearchFilter="search-filter",i.NoRooms="no-rooms",i.Rooms="search",i.Rooms_List="search.rooms",i.Rooms_FilteredList="search.rooms-with-filter",i.Rooms_Grid="search.rooms-grid",i.RoomsSearchCriteria="rooms-search-criteria",i.RoomsSearchCriteria_All="rooms-search-criteria.all",i.RoomsSearchCriteria_Filtered="rooms-search-criteria.filtered",i.RoomsSearchCriteria_NoRooms="rooms-search-criteria.no-rooms",i.SharedRooms="shared-rooms",i.SharedRooms_List="shared-rooms.rooms",i.SharedRooms_FilteredList="shared-rooms.rooms-with-filter",i.RoomsGuestAccommodation="rooms-guest-accommodation",i.RatePlansGuestAccommodation="rate-plans-guest-accommodation",i.SharedRatePlans="shared-rate-plans",i.SharedRatePlans_List="shared-rate-plans.list",i.SharedRatePlans_FilteredList="shared-rate-plans.list-with-filter",i.Cart="cart",i.RoomInfo="room-info",i.RoomList="rooms-list",i.CertificateList="certificates-list",i.Preview="preview",i.Payment="payment",i.Payment_Certificate="payment-certificate",i.PaymentResult="payment-result",i.PaymentPopup="payment-popup",i.PaymentFailed="payment-failed",i.PaymentAwait="payment-await",i.PaymentInternal="payment-internal",i.Complete="complete",i.Auth="auth",i.Cancellation="cancellation",i.CancellationComplete="cancellation-complete",i.CancellationFailed="cancellation-failed",i.EditBooking="edit-booking",i.EditBooking_RestoreBooking="edit-booking.restore-booking",i.EditBooking_ApproveBooking="edit-booking.approve-booking",i.EditBooking_RestoreBookingSuccess="edit-booking.restore-booking-success",i.EditBooking_ApproveBookingSuccess="edit-booking.approve-booking-success",i.EditBooking_ChangeCard="edit-booking.change-card",i.EditBooking_DeferredPayment="edit-booking.deferred-payment",i.EditBookingPaymentAwait="edit-booking-payment-await",i.EditBookingPaymentFailed="edit-booking-payment-failed",i.EditBookingPaymentInternal="edit-booking-payment-internal",i.EditBookingPaymentPopup="edit-booking-payment-popup",i.EditBookingPaymentResult="edit-booking-payment-result",i.EditBookingPaymentSucceed="edit-booking-payment-succeed",i.EditBookingDates="edit-booking-dates",i.EditBookingDates_Confirm="edit-booking-dates.confirm",i.EditBookingDates_Calendar="edit-booking-dates.calendar",i.EditBookingDates_Result="edit-booking-dates.result",i.EditBookingRoomType="edit-booking-room-type",i.EditBookingRoomType_Confirm="edit-booking-room-type.confirm",i.EditBookingRoomType_RoomsCommon="edit-booking-room-type.rooms-common",i.EditBookingRoomType_RoomsSharedRoom="edit-booking-room-type.rooms-shared-room",i.EditBookingRoomType_NoRooms="edit-booking-room-type.no-rooms",i.EditBookingRoomType_Result="edit-booking-room-type.result",i.EditBookingRatePlan="edit-booking-rate-plan",i.EditBookingRatePlan_Confirm="edit-booking-rate-plan.confirm",i.EditBookingRatePlan_RatesCommon="edit-booking-rate-plan.rates-common",i.EditBookingRatePlan_RatesSharedRoom="edit-booking-rate-plan.rates-shared-room",i.EditBookingRatePlan_NoRates="edit-booking-rate-plan.no-rates",i.EditBookingRatePlan_Result="edit-booking-rate-plan.result",i.EditBookingOptions="edit-booking-options",i.EditBookingOptions_Options="edit-booking-options.options",i.EditBookingOptions_NoOptions="edit-booking-options.no-options",i.EditBookingOptions_Confirm="edit-booking-options.confirm",i.EditBookingOptions_Result="edit-booking-options.result",i.EditBookingDeleteRoom="edit-booking-delete-room",i.EditBookingDeleteRoom_Confirm="edit-booking-delete-room.confirm",i.EditBookingDeleteRoom_Result="edit-booking-delete-room.result",i.Start="start",i.StartCancellation="start-cancellation",i.StartRooms="start-rooms",i.StartEditBooking="start-edit-booking",i.StartContinueBooking="start-continue-booking",i.StartPriceList="start-price-list",i.StartRestoreBooking="start-restore-booking",i.StartApproveBooking="start-approve-booking",i.StartChangeCard="start-change-card",i.StartDeferredPayment="start-deferred-payment",i.StartComponents="start-components",i.StartSurvey="start-survey",i.Prefetch="prefetch",i.PriceList="price-list",i.Error="error",i.MirRegister="mir-register",i.Components="components",i.Survey="survey";var t=i;function i(){}e.AppState=t}(tl=tl||{}),!function(e){function t(){this.subscribers=[]}t.prototype.subscribe=function(e,t){this.subscribers.hasOwnProperty(t)||(this.subscribers[t]=[]);var i=_.some(this.subscribers[t],e);return i||this.subscribers[t].push(e),!i},t.prototype.unsubscribe=function(t,e){this.subscribers.hasOwnProperty(e)&&_.remove(this.subscribers[e],function(e){return e===t})},t.prototype.notify=function(e,t){this.subscribers.hasOwnProperty(e)&&_.each(this.subscribers[e],function(e){e.callback(t)})},e.Informer=t}(tl=tl||{}),!function(c){t.prototype.getThumbnailUrl=function(e,t){return this.images.length?this.images[0].getThumbnailUrl(e,t):null};var e=t;function t(e,t,i,n,o,r,a,s){this.images=[],this.includedInPrepayment=!1,this.requireGuaranteedPayment=!1,this.quantity=0,this.sortingKey=0,this.id=e,this.name=t,this.description=i,this.type=n,this.includedInPrepayment=o,this.requireGuaranteedPayment=r,this.pricing=a,this.applicabilityType=s}c.AbstractProviderService=e;c.OptionCategory=function(e,t,i){this.sortingKey=Number.MAX_VALUE,this.id=e,this.name=t,this.description=i},__extends(n,l=e);var l,i=n;function n(e,t,i,n,o,r,a,s){void 0===s&&(s=0);e=l.call(this,e,t,i,c.OptionType.Service,!1,!1,n,o)||this;return e.quantity=s,e.includedInPrepayment=r,e.requireGuaranteedPayment=a,e}function o(e,t,i,n,o,r,a){this.isInclusive=!1,this.isQuotaUsed=!1,this._id=e,this.option=t,this.placementIndex=n,this.pricePerUnit=i,this.isInclusive=o,this.isQuotaUsed=r,this._quantity=a,this.price=c.PriceCalculator.clone(i)}c.Option=i,o.prototype.id=function(){return this._id},o.prototype.code=function(){return this.option.id},o.prototype.getPlacementIndex=function(){return this.placementIndex},o.prototype.hasPlacementIndex=function(){return null!=this.placementIndex},o.prototype.getPrice=function(){return this.isInclusive?c.Price.empty(this.price.currency):this.price},o.prototype.name=function(){return this.option.name},o.prototype.description=function(){return this.option.description},o.prototype.type=function(){return this.option.type},o.prototype.inclusive=function(){return this.isInclusive},o.prototype.chargeType=function(){return this.option.pricing},o.prototype.applicabilityType=function(){return this.option.applicabilityType},o.prototype.images=function(){return this.option.images},o.prototype.quantity=function(){return this.isQuotaUsed?this._quantity:this.option.quantity},o.prototype.quotaUsed=function(){return this.isQuotaUsed},o.prototype.includedInPrepayment=function(){return this.option.includedInPrepayment},o.prototype.requireGuaranteedPayment=function(){return this.option.requireGuaranteedPayment},o.prototype.getCategory=function(){return this.option.category},o.prototype.getOption=function(){return this.option},c.RoomOption=o;__extends(r,u=e);var u,i=r;function r(e,t,i,n,o,r,a,s,l){void 0===l&&(l=0);e=u.call(this,e,t,i,c.OptionType.MealPlan,!1,!1,o,r)||this;return e.mealPlanType=n,e.quantity=l,e.includedInPrepayment=a,e.requireGuaranteedPayment=s,e}function a(e,t,i,n,o){this.isInclusive=!1,this._id=e,this.meal=t,this.placementIndex=n,this.pricePerUnit=i,this.isInclusive=o,this.price=c.PriceCalculator.clone(i)}c.Meal=i,a.prototype.id=function(){return this._id},a.prototype.code=function(){return this.meal.id},a.prototype.getPlacementIndex=function(){return this.placementIndex},a.prototype.hasPlacementIndex=function(){return null!=this.placementIndex},a.prototype.getPrice=function(){return this.isInclusive?c.Price.empty(this.price.currency):this.price},a.prototype.name=function(){return this.meal.name},a.prototype.description=function(){return this.meal.description},a.prototype.type=function(){return this.meal.type},a.prototype.inclusive=function(){return this.isInclusive},a.prototype.chargeType=function(){return this.meal.pricing},a.prototype.applicabilityType=function(){return this.meal.applicabilityType},a.prototype.images=function(){return this.meal.images},a.prototype.quantity=function(){return this.meal.quantity},a.prototype.quotaUsed=function(){return!1},a.prototype.includedInPrepayment=function(){return this.meal.includedInPrepayment},a.prototype.requireGuaranteedPayment=function(){return this.meal.requireGuaranteedPayment},a.prototype.getCategory=function(){return this.meal.category},a.prototype.getOption=function(){return this.meal},c.MealPlan=a;Object.defineProperty(s.prototype,"option",{get:function(){return null},set:function(e){this._optionId=e?e.id():null},enumerable:!0,configurable:!0}),s.prototype.getQuantity=function(){return this.quantity},s.prototype.setQuantity=function(e){this.quantity=e,this._totalPrice||(this._totalPrice=c.Price.empty(this.option.getPrice().currency)),c.PriceCalculator.mulTo(this._totalPrice,this.option.getPrice(),e)},s.prototype.getTotalPrice=function(){var e=this.option.getPrice().currency;return this._totalPrice&&this._totalPrice.currency===e||(this._totalPrice?c.PriceCalculator.clean(this._totalPrice,e):this._totalPrice=c.Price.empty(e),this.setQuantity(this.getQuantity())),this._totalPrice},s.prototype.id=function(){return this.option.id()},s.prototype.code=function(){return this.option.code()},s.prototype.isInclusive=function(){return this.option.inclusive()},s.prototype.invalidateTotalPrice=function(){this._totalPrice=null};e=s;function s(e,t,i,n){void 0===n&&(n=0),this._optionId=null,this._optionPlacementIndex=null,this._optionId=t.id(),this._optionPlacementIndex=t.getPlacementIndex(),this._roomStayId=e.id,this._serviceStorage=i,this._totalPrice=c.Price.empty(this.option.getPrice().currency),this.setQuantity(n)}c.AbstractEnumerableRoomOption=e;__extends(p,d=e),Object.defineProperty(p.prototype,"option",{get:function(){var t=this,e=_.filter(this._serviceStorage.getStayOptions(!0),{id:this._roomStayId}),i=null;return _.each(e,function(e){if(i=_.find(e.roomStay.getMealPlans(),function(e){return e.id()==t._optionId}))return!1}),i},enumerable:!0,configurable:!0});var d,i=p;function p(){return null!==d&&d.apply(this,arguments)||this}c.EnumerableMealPlan=i;__extends(g,m=e),Object.defineProperty(g.prototype,"option",{get:function(){var t=this,e=_.filter(this._serviceStorage.getStayOptions(!0),{id:this._roomStayId}),i=null;return _.each(e,function(e){if(i=_.find(e.roomStay.getOptions(),function(e){return e.id()==t._optionId}))return!1}),i},enumerable:!0,configurable:!0});var m,i=g;function g(){return null!==m&&m.apply(this,arguments)||this}c.EnumerableRoomOption=i;__extends(f,h=e),Object.defineProperty(f.prototype,"option",{get:function(){var t=this,e=_.filter(this._serviceStorage.getStayOptions(!0),{id:this._roomStayId}),i=null;return _.each(e,function(e){if(i=_.find(e.bookingOptions,function(e){return e.id()==t._optionId}))return!1}),i},enumerable:!0,configurable:!0});var h,i=f;function f(){return null!==h&&h.apply(this,arguments)||this}c.EnumerableBookingOption=i}(tl=tl||{}),!function(e){function t(){this.maxShownRatePlans=1,this.suggestedRatePlans=[],this.suggestedRatePlansUnavailable=!1}function i(e,t,i){void 0===i&&(i=!1),this.id=e,this.name=t,this.promo=i}function n(e){this.name=e}e.RatePlan=function(e,t,i,n,o,r,a,s,l,c,u,d,p,m){this.id=e,this.name=t,this.sharedAccommodation=i,this.shortDescription=n,this.description=o,this.category=r,this.currency=a,this.fullPrepayment=s,this.treatment=l,this.withChildrenOnly=c,this.promo=u,this.icon=d,this.images=p,this.features=m},e.RatePlansDisplaySettings=t,e.RatePlanCategory=i;e.RatePlanFeature=n}(tl=tl||{}),!function(e){function t(e,t){void 0===e&&(e=1),void 0===t&&(t=[]),this.children=[],this.adultPlacements=[],this.id=_.uniqueId("scp"),this.adults=e,this.children=t}t.prototype.total=function(){return this.adults+this.children.length},Object.defineProperty(t.prototype,"adults",{get:function(){return this.adultPlacements.length},set:function(e){if(this.adultPlacements.length<e)for(;this.adultPlacements.length!=e;)this.adultPlacements.push(new i);else if(this.adultPlacements.length>e)for(;this.adultPlacements.length!=e;)this.adultPlacements.pop()},enumerable:!0,configurable:!0}),t.prototype.clone=function(){_.map(this.adultPlacements,function(e){return e.clone()});var e=new t(this.adults,_.map(this.children,function(e){return e.clone()}));return e.adultPlacements=this.adultPlacements,e.roomTypeId=this.roomTypeId,e},e.SearchCriteriaPlacement=t;n.prototype.clone=function(){return new n(this.ratePlanId)};var i=n;function n(e){void 0===e&&(e=null),this.id=_.uniqueId("scap"),this.ratePlanId=e}function o(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.id=_.uniqueId("sccp"),this.age=e,this.ratePlanId=t,this.withoutBed=i}function r(e,t,i){void 0===t&&(t=0),void 0===i&&(i=[]),this.children=[],this.id=_.uniqueId("scgrp"),this.ratePlan=e,this.adults=t,this.children=i}function a(e){this.id=_.uniqueId("sccp"),this.age=e}e.SearchCriteriaAdultPlacement=i,o.prototype.clone=function(){return new o(this.age,this.ratePlanId,this.withoutBed)},e.SearchCriteriaChildPlacement=o,r.prototype.clone=function(){var e=new r(this.ratePlan,this.adults);return e.children=_.map(this.children,function(e){return e.clone()}),e},r.prototype.guests=function(){return this.adults+this.children.length},e.SearchCriteriaGuestsRatePlan=r,a.prototype.clone=function(){return new a(this.age)},e.SearchCriteriaChildRatePlan=a}(tl=tl||{}),!function(e){i=e.Informer,__extends(n,i),n.getInstance=function(){return n._instance=null===n._instance?new n:n._instance},n.prototype.subscribe=function(e,t){return i.prototype.subscribe.call(this,e,t.toString())},n.prototype.notify=function(e,t){return i.prototype.notify.call(this,e.toString(),t)},n.prototype.unsubscribe=function(e,t){i.prototype.unsubscribe.call(this,e,t.toString())},n._instance=null;var i,t=n;function n(){var e;if(n._instance)throw new Error("Error: Instantiation failed: Use SearchCriteriaInformer.getInstance() instead of new.");return e=i.call(this)||this,n._instance=e}function o(){}e.SearchCriteriaInformer=t,o.CreateSearchCriteria="CreateSearchCriteria",o.ApplyPromoCode="ApplyPromoCode",o.PromoCodeApplied="PromoCodeApplied",o.InvalidPromoCode="InvalidPromoCode",o.SynchronizePromoCode="SynchronizePromoCode",o.AuthorizationChanged="AuthorizationChanged",o.GuestLogIn="GuestLogIn",o.GuestLogOut="GuestLogLogOut",e.SearchCriteriaInformerMessageType=o}(tl=tl||{}),!function(e){function t(e,t){this.minAge=e,this.maxAge=t,this.id=[this.minAge,this.maxAge].join("-")}t.prototype.inGroup=function(e){return e>=this.minAge&&e<this.maxAge},e.AgeGroup=t;function i(e,t){this.date=e,this.price=t}function n(e){this.date=e,this.rates={}}e.ChildPlacement=function(e,t){this.age=e,this.ageGroup=t},e.PlacementRate=i;e.GuestPlacementRates=n,r.prototype.total=function(){return this.adults+this.children};var o=r;function r(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.adults=0,this.children=0,this.adults=e,this.children=t}function a(e,t,i,n,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===o&&(o=[]),this.adults=0,this.adultsExtraBed=0,this.children=[],this.childrenExtraBed=[],this.childrenWithoutBed=[],this.adults=e,this.adultsExtraBed=t,this.children=i,this.childrenExtraBed=n,this.childrenWithoutBed=o}function s(){this.adults=0,this.extraAdults=0,this.children=0,this.extraChildren=0,this.childrenWithoutBed=0}function l(e,t,i,n,o,r,a,s,l,c,u){this.capacity=0,this.adults=0,this.childrenPlacements=[],this._rates=null,this.index=e,this.kind=t,this.code=i,this.ratePlan=n,this.ageGroup=o,this.capacity=r,this.price=a,this.isPriceDetailsAvailable=l,this.adults=c,this.childrenPlacements=u,this._ratesBuilder=s}e.RoomPlacement=o,Object.defineProperty(a.prototype,"totalChildren",{get:function(){return this.children.length+this.childrenWithoutBed.length+this.childrenExtraBed.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"totalAdults",{get:function(){return this.adults+this.adultsExtraBed},enumerable:!0,configurable:!0}),a.prototype.total=function(){return this.totalAdults+this.totalChildren},Object.defineProperty(a.prototype,"totalMainBeds",{get:function(){return this.adults+this.children.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"totalExtraBeds",{get:function(){return this.adultsExtraBed+this.childrenExtraBed.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"totalWithoutBeds",{get:function(){return this.childrenWithoutBed.length},enumerable:!0,configurable:!0}),a.prototype.equals=function(e){function t(e,t){return _.isEqual(_.map(e,function(e){return e.ageGroup.id}).sort(),_.map(t,function(e){return e.ageGroup.id}).sort())}return this.adults==e.adults&&this.adultsExtraBed==e.adultsExtraBed&&t(this.children,e.children)&&t(this.childrenExtraBed,e.childrenExtraBed)&&t(this.childrenWithoutBed,e.childrenWithoutBed)},e.RoomStayPlacement=a,s.prototype.totalAdults=function(){return this.adults+ +this.extraAdults},s.prototype.totalChildren=function(){return+this.children+ +this.extraChildren+ +this.childrenWithoutBed},s.prototype.total=function(){return this.totalAdults()+this.totalChildren()},e.Placement=s,Object.defineProperty(l.prototype,"rates",{get:function(){return this._rates||(this._rates=this._ratesBuilder()),this._rates},enumerable:!0,configurable:!0}),l.prototype.hash=function(){return[this.code,this.kind,this.ratePlan?this.ratePlan.id:""].join("-")},Object.defineProperty(l.prototype,"children",{get:function(){return this.childrenPlacements?this.childrenPlacements.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"guests",{get:function(){return this.adults+this.children},enumerable:!0,configurable:!0}),l.prototype.clone=function(){return new l(this.index,this.kind,this.code,this.ratePlan,this.ageGroup,this.capacity,this.price,this._ratesBuilder,this.isPriceDetailsAvailable,this.adults,this.childrenPlacements)},e.GuestPlacement=l}(tl=tl||{}),!function(r){function e(e,t,i,n,o,r,a,s,l,c){void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),this.isRoomStayOffer=!1,this.ratePlanRestriction=null,this._guestPlacementOptions=null,this._paymentOptions=null,this._options=null,this._mealPlans=null,this.id=e,this.placementsCode=t,this.roomType=i,this.ratePlan=_.head(n),this.ratePlans=n,this.price=o,this.limitedInventoryCount=c,this._guestPlacementOptionsBuilder=r||function(){return[]},this._paymentOptionsBuilder=a||function(){return[]},this._optionsBuilder=s||function(){return[]},this._mealPlansBuilder=l||function(){return[]}}function t(e,t,i,n,o){this.guests=[],this.guestPlacements=[],this.roomPreferences=[],this.mealPlans=[],this.roomOptions=[],this.form=null,this._roomStayId=null,this._validatedRoomStay=null,this._serviceStorage=n,this.id=_.uniqueId("gs-"),this._roomStayId=e.id,this.initGuestPlacements(),this.initRoomPreferences(),this.arrivalExtraStay=new r.OrderExtraStay(t),this.departureExtraStay=new r.OrderExtraStay(i),this.initInclusiveOptions(),_.isUndefined(o)||(this.placementRef=o)}Object.defineProperty(e.prototype,"isPriceDetailsAvailable",{get:function(){return void 0===this._isPriceDetailsAvailable&&(this._isPriceDetailsAvailable=_.some(this.guestPlacementOptions,function(e){return e.isPriceDetailsAvailable})),this._isPriceDetailsAvailable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"guestPlacementOptions",{get:function(){return this._guestPlacementOptions||(this._guestPlacementOptions=this._guestPlacementOptionsBuilder()),this._guestPlacementOptions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paymentOptions",{get:function(){return this._paymentOptions||(this._paymentOptions=this._paymentOptionsBuilder()),this._paymentOptions},set:function(e){this._paymentOptions=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mealPlans",{get:function(){return this._mealPlans||(this._mealPlans=this._mealPlansBuilder()),this._mealPlans},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options||(this._options=this._optionsBuilder()),this._options},enumerable:!0,configurable:!0}),e.prototype.hasRestriction=function(e){return!!this.restrictions&&_.includes(this.restrictions,e)},e.prototype.hasOptions=function(){return 0<this.options.length||0<this.mealPlans.length},e.prototype.inclusiveMealPlan=function(){return _.find(this.mealPlans,{isInclusive:!0})||null},e.prototype.getMealPlans=function(){return this.mealPlans},e.prototype.getOptions=function(){return this.options},r.RoomStay=e,Object.defineProperty(t.prototype,"roomStay",{get:function(){var e=_.find(this._serviceStorage.getStayOptions(!0),{id:this._roomStayId});return e?e.roomStay:null},enumerable:!0,configurable:!0}),t.prototype.getRoomStays=function(){return _.chain(this._serviceStorage.getStayOptions(!0)).filter({id:this._roomStayId}).map(function(e){return e.roomStay}).without(void 0).value()},Object.defineProperty(t.prototype,"validatedRoomStayId",{get:function(){return this._validatedRoomStay?this._validatedRoomStay.id:null},enumerable:!0,configurable:!0}),t.prototype.updateServicesQuantity=function(){var o=this;_.each([this.roomOptions,this.mealPlans],function(e){_.each(e,function(e){var t=e.getQuantity(),i=r.OptionCalculator.getMaxQuantity(e.option.chargeType(),o.placement.total(),e.option.quantity(),Number.MAX_VALUE),n=r.OptionCalculator.getMinQuantity(e.option.chargeType(),o.placement.total(),e.option.quantity());i<t&&0<t&&0<i?e.setQuantity(i):t<n&&0<t&&0<n&&e.setQuantity(n)})})},t.prototype.updatePlacement=function(){this.placement=r.PlacementManager.guestPlacementsToPlacement(this.guestPlacements)},t.prototype.initGuestPlacements=function(){var t=this;this.roomStay.isRoomStayOffer?this.guestPlacements=[_.head(_.map(_.filter(this.roomStay.guestPlacementOptions,function(e){return e.kind==r.GuestPlacementKind.Adult}),function(e){return new c(t.roomStay,e)}))]:this.guestPlacements=_.map(this.roomStay.guestPlacementOptions,function(e){return new a(t,e)}),this.updatePlacement()},t.prototype.initRoomPreferences=function(){var t=this;this.roomPreferences=_.map(this.roomStay.roomType.preferences,function(e){return new d(e,!1,t._serviceStorage)})},t.prototype.initInclusiveOptions=function(){var t=this;_.each(this.roomStay.getOptions(),function(e){e.isInclusive&&t.addOption(e,1)}),_.each(this.roomStay.getMealPlans(),function(e){e.isInclusive&&t.addMealPlan(e,1)})},t.prototype.departure=function(e){return(e=void 0===e?null:e)&&(this.departureExtraStay.priceTime=e),this.departureExtraStay.priceTime},t.prototype.arrival=function(e){return(e=void 0===e?null:e)&&(this.arrivalExtraStay.priceTime=e),this.arrivalExtraStay.priceTime},t.prototype.getGuestPlacementsPrice=function(){var t=this,e=_.head(this.guestPlacements).guestPlacement.price.currency;if(!this._guestPlacementsPrice||this._guestPlacementsPrice.currency!==e){if(this._guestPlacementsPrice=r.PriceWithDiscount.empty(e),!this.roomStay)return null;this.roomStay.price&&this.roomStay.price.priceAfterDiscount.priceAfterTax.amount&&e.id==this.roomStay.price.currency.id?r.PriceWithDiscountCalculator.sumTo(this._guestPlacementsPrice,this.roomStay.price):this._validatedRoomStay?r.PriceWithDiscountCalculator.sumTo(this._guestPlacementsPrice,this._validatedRoomStay.price):_.each(this.guestPlacements,function(e){r.PriceWithDiscountCalculator.sumTo(t._guestPlacementsPrice,e.guestPlacement.price)})}return this._guestPlacementsPrice},t.prototype.getTotalPrice=function(){var t=this,e=(this._totalPrice=r.PriceWithDiscountCalculator.clone(this.getGuestPlacementsPrice()),_.each(this.mealPlans,function(e){e=e.getTotalPrice(),e=new r.PriceWithDiscount(e,e);r.PriceWithDiscountCalculator.isAllowOperation(t._totalPrice,e)&&r.PriceWithDiscountCalculator.sumTo(t._totalPrice,e)}),_.each(this.roomOptions,function(e){e=e.getTotalPrice(),e=new r.PriceWithDiscount(e,e);r.PriceWithDiscountCalculator.isAllowOperation(t._totalPrice,e)&&r.PriceWithDiscountCalculator.sumTo(t._totalPrice,e)}),this.arrival().price()),e=new r.PriceWithDiscount(e,e),e=(r.PriceWithDiscountCalculator.isAllowOperation(this._totalPrice,e)&&r.PriceWithDiscountCalculator.sumTo(this._totalPrice,e),this.departure().price()),e=new r.PriceWithDiscount(e,e);return r.PriceWithDiscountCalculator.isAllowOperation(this._totalPrice,e)&&r.PriceWithDiscountCalculator.sumTo(this._totalPrice,e),this._totalPrice},t.prototype.findEnumerableRoomOption=function(t){return _.find(this.roomOptions,function(e){return t.id()==e.id()})},t.prototype.findEnumerableMealPlan=function(t){return _.find(this.mealPlans,function(e){return t.id()==e.id()})},t.prototype.findOptions=function(t){return _.filter(__spreadArrays(this.roomOptions,this.mealPlans),function(e){return t.code()===e.code()})},t.prototype.addGuestPlacements=function(t){this.roomStay.isRoomStayOffer&&(this._validatedRoomStay=t,this.guestPlacements=_.map(t.guestPlacementOptions,function(e){return new c(t,e)}),this._guestPlacementsPrice=null,this.updatePlacement(),this.updateServicesQuantity())},t.prototype.addOption=function(e,t){var i=this.findEnumerableRoomOption(e);i?i.setQuantity(t):(i=new r.EnumerableRoomOption(this.roomStay,e,this._serviceStorage,t),this.roomOptions.push(i))},t.prototype.removeOption=function(t){_.remove(this.roomOptions,function(e){return t.id()==e.id()})},t.prototype.addMealPlan=function(e,t){var i=this.findEnumerableMealPlan(e);i?i.setQuantity(t):(i=new r.EnumerableMealPlan(this.roomStay,e,this._serviceStorage,t),this.mealPlans.push(i))},t.prototype.removeMealPlan=function(t){_.remove(this.mealPlans,function(e){return t.id()==e.id()})},t.prototype.addRoomPreference=function(t,i){this.removeRoomPreference(t);var e=_.find(this.roomPreferences,function(e){return e.roomPreference.code==i&&e.roomPreference.categoryCode==t});_.isUndefined(e)||(e.selected=!0)},t.prototype.removeRoomPreference=function(t,i){_.forEach(_.filter(this.roomPreferences,function(e){return e.roomPreference.categoryCode==t&&e.roomPreference.placementRef==i}),function(e){e.selected=!1})},t.prototype.invalidatePrice=function(){this._guestPlacementsPrice=null,_.forEach(this.mealPlans,function(e){e.invalidateTotalPrice()}),_.forEach(this.roomOptions,function(e){e.invalidateTotalPrice()})},t.prototype.findOptionEnumerableGuestPlacement=function(t){return _.find(this.guestPlacements,function(e){return e.index===t.getPlacementIndex()})},t.prototype.findOptionGuestPlacement=function(e){return null==(e=this.findOptionEnumerableGuestPlacement(e))?void 0:e.guestPlacement},Object.defineProperty(t.prototype,"guestsCount",{get:function(){return _.reduce(this.guestPlacements,function(e,t){return e+t.guests},0)},enumerable:!0,configurable:!0}),r.GuestStay=t;Object.defineProperty(n.prototype,"index",{get:function(){return this.guestPlacement.index},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"code",{get:function(){return this.guestPlacement.code},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"kind",{get:function(){return this.guestPlacement.kind},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ratePlan",{get:function(){return this.guestPlacement.ratePlan},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ageGroup",{get:function(){return this.guestPlacement.ageGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"price",{get:function(){return this.guestPlacement.price},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPriceDetailsAvailable",{get:function(){return this.guestPlacement.isPriceDetailsAvailable},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rates",{get:function(){return this.guestPlacement.rates},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guests",{get:function(){return this.guestPlacement.guests},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"adults",{get:function(){return this.guestPlacement.adults},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"children",{get:function(){return this.guestPlacement.children},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"childrenPlacements",{get:function(){return this.guestPlacement.childrenPlacements},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guestPlacement",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0});var i=n;function n(){}r.EnumerableGuestPlacement=i;__extends(s,o=i),Object.defineProperty(s.prototype,"guestPlacement",{get:function(){return this._guestStay.roomStay.guestPlacementOptions[this._guestPlacementIndex]},set:function(e){this._guestPlacementIndex=_.findIndex(this._guestStay.roomStay.guestPlacementOptions,e)},enumerable:!0,configurable:!0});var o,a=s;function s(e,t){var i=o.call(this)||this;return i._guestStay=e,i.guestPlacement=t,i}r.EnumerableRoomStayGuestPlacement=a;__extends(u,l=i),Object.defineProperty(u.prototype,"guestPlacement",{get:function(){return this._roomStay.guestPlacementOptions[this._guestPlacementIndex]},set:function(e){this._guestPlacementIndex=_.findIndex(this._roomStay.guestPlacementOptions,e)},enumerable:!0,configurable:!0});var l,c=u;function u(e,t){var i=l.call(this)||this;return i._roomStay=e,i.guestPlacement=t,i}r.EnumerableRoomStayOfferGuestPlacement=c;Object.defineProperty(p.prototype,"roomPreference",{get:function(){var t=this,i=null;return _.forEach(this._serviceStorage.rooms,function(e){if(i=_.find(e.preferences,function(e){return e.categoryCode==t._preferenceCategoryCode&&e.code==t._preferenceCode}),!_.isUndefined(i))return!1}),i},enumerable:!0,configurable:!0});var d=p;function p(e,t,i){this._serviceStorage=i,this._preferenceCode=e.code,this._preferenceCategoryCode=e.categoryCode,this.selected=t}function m(e,t,i){this._startDate=e,this._endDate=t,this._stayUnitKind=i}function g(e,t,i){this._transfers=null,this._bookingOptions=null,this.roomStay=e,this._transfersBuilder=t,this._bookingOptionsBuilder=i}r.EnumerableRoomPreference=d,Object.defineProperty(m.prototype,"startDate",{get:function(){return this._startDate},set:function(e){this._startDate=e,this._duration=null},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"endDate",{get:function(){return this._endDate},set:function(e){this._endDate=e,this._duration=null},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"stayUnitKind",{get:function(){return this._stayUnitKind},enumerable:!0,configurable:!0}),m.prototype.duration=function(){var e;return this._duration||(e=this.endDate.diffInDays(this.startDate),this._stayUnitKind==r.StayUnitKind.Day&&e++,this._duration=new f(this._stayUnitKind,e)),this._duration},m.prototype.nights=function(){return this.duration().value},r.RoomStayStayDate=m,Object.defineProperty(g.prototype,"id",{get:function(){return this._id||(this._id=this.roomStay.id),this._id},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"transfers",{get:function(){return this._transfers||_.isUndefined(this._transfersBuilder)||(this._transfers=this._transfersBuilder()),this._transfers},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"bookingOptions",{get:function(){return this._bookingOptions||_.isUndefined(this._bookingOptionsBuilder)||(this._bookingOptions=this._bookingOptionsBuilder()),this._bookingOptions},enumerable:!0,configurable:!0}),r.StayOption=g;function h(e,t,i){this.placementRef=e,this.roomType=t,this.step=i}var f=function(e,t){this.prefix="stay_duration",this.kind=e,this.value=t};r.StayDuration=f;r.EnumerableRoom=h}(tl=tl||{}),!function(o){o.RoomStayFilterCriteria=function(){this.ratePlanIds=[]},e.getPreferableRoomStay=function(e,t){if(!t)return e;var i=!e||!!t.price&&(!e.price||!!e.ratePlanRestriction||!!e.restrictions||t.price.priceAfterDiscount.priceAfterTax.amount<e.price.priceAfterDiscount.priceAfterTax.amount),n=!1;return i||(n=!t.price&&!e.price&&!!t.ratePlanRestriction&&!!e.ratePlanRestriction&&(t.ratePlanRestriction.hasMinLos()&&e.ratePlanRestriction.hasMinLos()&&t.ratePlanRestriction.minLos.value<e.ratePlanRestriction.minLos.value||t.ratePlanRestriction.hasMaxLos()&&e.ratePlanRestriction.hasMaxLos()&&t.ratePlanRestriction.maxLos.value>e.ratePlanRestriction.maxLos.value)),i||n?t:e};var r=e;function e(){}function t(){}function i(){}o.RoomStayFinder=r,t.buildGroups=function(e){var n=[],o={};return _.forEach(e,function(e){var t=e.roomType,i=o[t.id];i||(i=o[t.id]=new l(t),n.push(i)),i.addRoomStay(e)}),n},o.RoomStayGroupBuilder=t,i.buildGroups=function(e){var n=[],o={};return _.forEach(e,function(e){var t=_.head(e.ratePlans),i=o[t.id];i||(i=o[t.id]=new d(t),n.push(i)),i.addRoomStay(e)}),n},o.RatePlanGroupBuilder=i;Object.defineProperty(a.prototype,"promo",{get:function(){return _.some(this.roomStayRatePlans,function(e){return e.hasPromoRoomStays()})},enumerable:!0,configurable:!0}),a.prototype.addRoomStay=function(t){var e=_.find(this.roomStayRatePlans,function(e){return e.ratePlan.id==t.ratePlans[0].id&&e.roomType.id==t.roomType.id});e?_.some(e.roomStays,function(e){return t.id==e.id})||e.addRoomStay(t):this.roomStayRatePlans.push(new m(t))},a.prototype.applyRoomStayFilter=function(t){var i=this;this.isVisible=!t.isEnabled||0==t.ratePlanIds.length,_.forEach(this.roomStayRatePlans,function(e){e.applyRoomStayFilter(t),i.isVisible=i.isVisible||e.isVisible})},a.prototype.adultMinPrice=function(t){void 0===t&&(t=1);var i=null,n=-999;return _.forEach(this.roomStayRatePlans,function(e){_.forEach(e.roomStays,function(e){_.forEach(e.guestPlacementOptions,function(e){e.kind==o.GuestPlacementKind.Adult&&e.price&&(e.adults==t&&(!i||i.priceAfterDiscount.priceAfterTax.amount>e.price.priceAfterDiscount.priceAfterTax.amount||n!=t)&&(i=e.price,n=e.adults),n!=t&&(!i||i.priceAfterDiscount.priceAfterTax.amount>e.price.priceAfterDiscount.priceAfterTax.amount)&&e.adults-t<=e.adults-n&&(i=e.price,n=e.adults))})})}),i},a.prototype.minPrice=function(n){return _.reduce(this.roomStayRatePlans,function(t,e){var i=t;return _.forEach(e.roomStays,function(e){_.forEach(e.guestPlacementOptions,function(e){e.kind==n&&(!t||e.price&&t.priceAfterDiscount.priceAfterTax.amount>e.price.priceAfterDiscount.priceAfterTax.amount)&&(i=e.price)})}),i},null)};var n=a;function a(e){this.roomStayRatePlans=[],this.id=e,this.isVisible=!0}o.uiAbstractRoomStayRatePlanGroup=n;__extends(c,s=n),c.prototype.getStayWithMinPrice=function(e){return this.getRoomStayWithMinPrice(e=void 0===e?[]:e)},c.prototype.getMinPrice=function(e){e=this.getRoomStayWithMinPrice(e=void 0===e?[]:e);return e?e.price:null},c.prototype.getRoomStayWithMinPrice=function(n){var o=!1;return(n=void 0===n?[]:n).length&&_.forEach(this.roomStayRatePlans,function(e){var t=e.getRoomStayWithMinPrice();if(-1!=n.indexOf(e.ratePlan.id)&&t.price&&t.price.priceAfterDiscount.priceAfterTax.amount)return!(o=!0)}),_.reduce(this.roomStayRatePlans,function(e,t){var i=t.getRoomStayWithMinPrice();return o&&-1!=n.indexOf(t.ratePlan.id)||!o?r.getPreferableRoomStay(e,i):e},null)},c.prototype.limitedInventoryCount=function(){var t=void 0;return _.each(this.roomStayRatePlans,function(e){e=e.limitedInventoryCount();if(void 0!==e){if(!e)return t=null,!1;(!t||t.value<e.value)&&(t=e)}}),t};var s,l=c;function c(e){var t=s.call(this,e.id)||this;return t.roomType=e,t}o.uiRoomStayGroup=l;__extends(p,u=n),p.prototype.ageGroups=function(){var t={};return _.forEach(this.roomStayRatePlans,function(e){_.forEach(e.ageGroups(),function(e){t[e.id]=e})}),_.sortBy(_.values(t),function(e){return e.minAge})},p.prototype.adultsQuota=function(){return 10},p.prototype.childrenQuota=function(){return 10};var u,d=p;function p(e){var t=u.call(this,e.id)||this;return t.ratePlan=e,t}o.uiRatePlanGroup=d;g.prototype.addRoomStay=function(e){this.roomStays.push(e)},g.prototype.hasPaymentType=function(t){return _.some(this.roomStays,function(e){return _.some(e.paymentOptions,function(e){return t==e.paymentSystem.type})})},g.prototype.hasRestrictedRoomStays=function(){return _.some(this.roomStays,function(e){return e.restrictions&&e.restrictions.length})},g.prototype.hasPromoRoomStays=function(){return _.some(this.roomStays,function(e){return e.promo})},g.prototype.getRoomStayWithMinPrice=function(){return _.reduce(this.roomStays,r.getPreferableRoomStay,null)},g.prototype.limitedInventoryCount=function(){var t=void 0;return _.each(this.roomStays,function(e){if(e.price){if(!e.limitedInventoryCount)return t=null,!1;(!t||t.value<e.limitedInventoryCount.value)&&(t=e.limitedInventoryCount)}}),t},g.prototype.ageGroups=function(){var t={};return _.forEach(this.roomStays,function(e){_.forEach(e.guestPlacementOptions,function(e){e.ageGroup&&(t[e.ageGroup.id]=e.ageGroup)})}),_.sortBy(_.values(t),function(e){return e.minAge})},g.prototype.applyRoomStayFilter=function(e){e.ratePlanIds.length?(this.isVisible=_.includes(e.ratePlanIds,this.ratePlan.id),this.isFilterApplied=!0):(this.isVisible=!0,this.isFilterApplied=!1)};var m=g;function g(e){this.roomStays=[],this.id=_.uniqueId("rsrp-"),this.roomType=e.roomType,this.ratePlan=e.ratePlans[0],this.isVisible=!0,this.isFilterApplied=!1,this.addRoomStay(e)}o.uiRoomStayRatePlan=m}(tl=tl||{}),!function(r){function t(){}t.buildGroups=function(e){var n=[],o={};return _.forEach(e,function(e){var t=e.priceableOption.getCategory()?e.priceableOption.getCategory():new r.OptionCategory,i=o[t.id];i||(i=o[t.id]=new a(t),n.push(i)),i.addOption(e)}),t.sortGroups(n)},t.sortGroups=function(e){return _.forEach(e,function(e){e.optionGroups=_.sortBy(_.sortBy(e.optionGroups,function(e){return e.option.priceableOption.getOption().sortingKey}),function(e){return e.option.priceableOption.inclusive()})}),_.sortBy(e,function(e){return e.category.sortingKey})},r.RoomStayOptionGroupBuilder=t;e.prototype.addOption=function(t){this.isMealPlan=(!this.optionGroups.length||this.isMealPlan)&&t.priceableOption.type()==r.OptionType.MealPlan;var e=_.find(this.optionGroups,function(e){return e.id==t.priceableOption.code()});e||(e=new i(t),this.optionGroups.push(e)),e.addOption(t),this.isExpanded=this.optionGroups.length<this.visibleGroupLength};var a=e;function e(e){this.optionGroups=[],this.isMealPlan=!1,this.isExpanded=!1,this.visibleGroupLength=4,this.id=_.uniqueId("category-"),this.category=e}r.uiRoomStayOptionCategoryGroup=a;n.prototype.addOption=function(t){_.some(this.options,function(e){return e.priceableOption.id()===t.priceableOption.id()&&e.priceableOption.getPlacementIndex()===t.priceableOption.getPlacementIndex()})||(this.options.push(t),t.priceableOption.inclusive()||this._minPrice&&!(this._minPrice.priceAfterTax.amount>t.priceableOption.getPrice().priceAfterTax.amount)||(this._minPrice=t.priceableOption.getPrice()))},Object.defineProperty(n.prototype,"minPrice",{get:function(){return this._minPrice},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isHidden",{get:function(){return 1<this.options.length&&_.every(this.options,function(e){return!e.isSelected})},enumerable:!0,configurable:!0}),n.prototype.isPerBooking=function(){return this.option.priceableOption.chargeType()==r.ChargeType.PerBooking},Object.defineProperty(n.prototype,"isSubmitted",{get:function(){return _.every(this.options,function(e){return e.isSubmitted})},enumerable:!0,configurable:!0});var i=n;function n(e){this.options=[],this.id=e.priceableOption.code(),this.option=e}function o(e,t,i){this.isSubmitted=!1,this._quantity=0,this.priceableOption=e,this.guestStay=t,this.quantity=null!=i?i:0}r.uiRoomStayOptionGroup=i,Object.defineProperty(o.prototype,"quantity",{get:function(){return this._quantity},set:function(e){this._quantity=e,this.isSubmitted=!1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isSelected",{get:function(){return 0<this.quantity},enumerable:!0,configurable:!0}),o.prototype.submit=function(e,t){this.isSelected||r.OptionUtil.removeOption(this.priceableOption,t),r.OptionUtil.updateOptionQuantity(e,this.priceableOption,this.quantity,t),this.isSubmitted=!0},r.uiRoomStayOption=o}(tl=tl||{}),!function(o){function e(e,t,i){this.restrictions=[],this.ratePlanRestriction=null,this.isRestrictedByPromotionCode=!1,this.limitedInventoryCount=null,this.paymentSystems=[],this.cancellationInfo=null,this.inclusiveMealPlan=null,this.options=[],this.promo=!1,this.ratePlan=e,this.price=t,this.roomTypeQuotaId=i,this.id=_.uniqueId("uigrp")}function t(e,t){void 0===t&&(t=null),this.guestRatePlans=[],this.restrictions=[],this.blink=!1,this.expanded=!1,this.kind=e,this.age=t,this.id=_.uniqueId("uigp")}e.prototype.hasRestriction=function(e){return!!this.restrictions&&_.includes(this.restrictions,e)},Object.defineProperty(e.prototype,"restrictionMessage",{get:function(){if(0!=this.restrictions.length)return _.head(this.restrictions).message()},enumerable:!0,configurable:!0}),o.uiGuestRatePlan=e,Object.defineProperty(t.prototype,"price",{get:function(){return this.guestRatePlan?this.guestRatePlan.price:this.priceFrom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priceFrom",{get:function(){return _.reduce(this.guestRatePlans,function(e,t){return e=!e||t.price&&t.price.priceAfterDiscount.priceAfterTax.amount<e.priceAfterDiscount.priceAfterTax.amount?t.price:e},null)},enumerable:!0,configurable:!0}),t.prototype.limitedInventoryCount=function(){var t=void 0;return _.each(this.guestRatePlans,function(e){if(e.price)return e=e.limitedInventoryCount,e?void((!t||t.value<e.value)&&(t=e)):(t=null,!1)}),t},o.uiGuestPlacement=t;Object.defineProperty(n.prototype,"price",{get:function(){return this.roomStay&&this.roomStay.price?this.roomStay.price:this.guests.length?(this._price&&this._price.currency.id==_.head(this.guests).price.currency.id||(this._price=o.PriceWithDiscountCalculator.clone(_.head(this.guests).price)),this._price?(o.PriceWithDiscountCalculator.clean(this._price),_.reduce(this.guests,function(e,t){return o.PriceWithDiscountCalculator.sumTo(e,t.price),e},this._price),this._price):null):null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"priceFrom",{get:function(){return this.guests.length?(this._priceFrom&&this._priceFrom.currency.id==_.head(this.guests).priceFrom.currency.id||(this._priceFrom=o.PriceWithDiscountCalculator.clone(_.head(this.guests).priceFrom)),this._priceFrom?(o.PriceWithDiscountCalculator.clean(this._priceFrom),_.reduce(this.guests,function(e,t){return o.PriceWithDiscountCalculator.sumTo(e,t.priceFrom),e},this._priceFrom),this._priceFrom):null):null},enumerable:!0,configurable:!0}),n.prototype.isRatePlansSelected=function(){return this.guests.length&&!_.find(this.guests,function(e){return!e.guestRatePlan})},n.prototype.limitedInventoryCount=function(){var t=void 0;return _.each(this.guests,function(e){e=e.limitedInventoryCount();if(!e)return t=null,!1;(!t||t.value<e.value)&&(t=e)}),t};var i=n;function n(){this.guests=[],this.restrictions=[],this.roomStay=null,this.validating=!1,this.invalid=!1,this.id=_.uniqueId("uisrs")}function r(e){this.restrictions=[],this.id=e}function a(){this.roomStays=[],this.restrictions=[]}o.uiSharedRoomStay=i,Object.defineProperty(r.prototype,"ratePlans",{get:function(){return this.roomStay?_.chain(this.roomStay.guests).map(function(e){return e.guestRatePlans}).flatten().map(function(e){return e}).uniqBy(function(e){return e.ratePlan.id}).value():null},enumerable:!0,configurable:!0}),r.prototype.getStayWithMinPrice=function(e){return this.getGuestRatePlanWithMinPrice(e=void 0===e?[]:e)},r.prototype.getGuestRatePlanWithMinPrice=function(o){void 0===o&&(o=[]);var r=null,a=null;return this.roomStay?(_.each(this.roomStay.guests,function(e){_.each(e.guestRatePlans,function(e){var t=e.price&&e.price.priceAfterDiscount.priceAfterTax.amount,i=r&&r.price&&r.price.priceAfterDiscount.priceAfterTax.amount,n=o.length&&_.includes(o,e.ratePlan.id);(t&&i&&t<i||!i)&&(r=e,n&&!a&&(a=e))})}),r=r&&r.price||!a?r:a):null},r.prototype.getMinPrice=function(n){if(void 0===n&&(n=[]),!this.roomStay)return null;var e=this.roomStay.guests,t=_.head(e);return this._price&&t&&this._price.currency.id==t.priceFrom.currency.id?this._price:(this._price=t&&o.PriceWithDiscountCalculator.clone(t.priceFrom),this._price?(o.PriceWithDiscountCalculator.clean(this._price),_.reduce(e,function(e,t){var i=null;return(i=(i=n.length&&(i=_.find(t.guestRatePlans,function(e){return _.includes(n,e.ratePlan.id)}))&&!i.price?null:i)||_.chain(t.guestRatePlans).filter(function(e){return!!e.price}).minBy(function(e){return e.price.priceAfterDiscount.priceAfterTax.amount}).value())&&o.PriceWithDiscountCalculator.sumTo(e,i.price),e},this._price),this._price):null)},r.prototype.limitedInventoryCount=function(){var e=void 0,t=this.roomStay&&this.roomStay.limitedInventoryCount();return e=!(e=t?e:null)||e.value<t.value?t:e},o.uiSharedRoomStayGroup=r,a.prototype.limitedInventoryCount=function(){var t=void 0;return _.each(this.roomStays,function(e){e=e.limitedInventoryCount();if(!e)return t=null,!1;(!t||t.value<e.value)&&(t=e)}),t},o.uiSharedGuestAccommodation=a}(tl=tl||{}),!function(i){function e(e){this.roomStays=[],this.roomStays=e,this.roomType=_.head(e).roomType,this.roomTypeUnit=new i.RoomTypeUnit(this.roomType.kind,this.roomStays.length)}e.prototype.getStayDates=function(){return _.head(this.roomStays).stayDates},e.prototype.getCancellationInfo=function(){return _.head(this.roomStays).cancellationInfo},e.prototype.getPaymentSystems=function(){return _.map(_.head(this.roomStays).paymentOptions,function(e){return e.paymentSystem})},e.prototype.getTotalPrice=function(){var e=_.head(this.roomStays).price.currency;return _.reduce(this.roomStays,function(e,t){return i.PriceWithDiscountCalculator.sumTo(e,t.price),e},i.PriceWithDiscount.empty(e))},e.prototype.getPaymentOptions=function(){return _.head(this.roomStays).paymentOptions},e.prototype.getLimitedInventoryCount=function(){var t=void 0;return _.each(this.roomStays,function(e){e=e.limitedInventoryCount;if(!e)return t=null,!1;(!t||t.value<e.value)&&(t=e)}),t},i.uiSharedRoom=e}(tl=tl||{}),!function(e){function t(e,t){this.code=e,this.text=t}e.CancellationPenaltyDescriptiveInfo=function(e,t,i,n,o){void 0===o&&(o=""),this.id=e,this.cancellationText=t,this.isFreeCancellation=i,this.showDescription=n,this.mirCashbackDescription=o};e.CancellationReason=t}(tl=tl||{}),!function(e){e.Phone=function(){},i.prototype.fullName=function(){var e=[];return this.firstName&&e.push(this.firstName),this.middleName&&e.push(this.middleName),this.lastName&&e.push(this.lastName),e.join(" ")};var t=i;function i(){this.firstName="",this.middleName="",this.lastName=""}function n(){}function o(e){this.setUrl(e),this.id=_.uniqueId()}e.Person=t,n.prototype.addressParts=function(){var e=this.region!=this.city?this.region:"",t=!this.city||-1!=this.city.indexOf(e)&&e?"":this.city,i=[this.postalCode,e,this.county,t];return this.addressLines&&this.addressLines.length&&_.forEach(this.addressLines,function(e){i.push(e)}),i=_.filter(i,function(e){return e&&""!=e})},e.Address=n,o.prototype.setUrl=function(e){this.url=e,this._thumbnailUrl=this.url.replace("/resource/images/","/resource/thumb/"+o.SIZE_PLACEHOLDER+"/")},o.prototype.getThumbnailUrl=function(e,t){return this._thumbnailUrl?this._thumbnailUrl.replace(o.SIZE_PLACEHOLDER,(e?""+e:"")+"x"+(t?""+t:"")):null},o.SIZE_PLACEHOLDER="{SIZE}",e.Image=o;function r(e,t){this.startDate=e,this.endDate=t}function a(e,t){this.checkIn=e,this.checkOut=t}function s(e,t){this.terms=e,this.policy=t}function l(e,t,i,n,o){void 0===n&&(n=[]),void 0===o&&(o=[]),this.discountType=e,this.discountValue=t,this.stayPeriods=i,this.ratePlans=n,this.roomTypes=o}function c(e,t){this.title=e,this.stayPeriod=t}e.TimeZone=function(e,t){this.name=e,this.offset=t},e.DatePeriod=r,e.CalendarAvailablePeriod=a,e.BookingFormInfo=s,e.Promotion=l;e.CampScheduleStayPeriod=c}(tl=tl||{}),!function(e){function t(e,t,i,n){void 0===n&&(n=!1),this._forbidden=!1,this._price=e,this._time=t,this._providerTime=i,this._forbidden=n,this.updateId()}t.prototype.id=function(){return this._id},t.prototype.isForbidden=function(){return this._forbidden},t.prototype.time=function(){return this._time},t.prototype.providerTime=function(){return this._providerTime},t.prototype.price=function(e){return e&&(this._price=e,this.updateId()),this._price},t.prototype.updateId=function(){this._id=null!=this._providerTime?this._providerTime.moment().format("HH_mm"):_.uniqueId("espt_")},e.ExtraStayPriceTime=t,e.OrderExtraStay=function(e){this.options=[],this.priceTime=e}}(tl=tl||{}),(tl||(tl={})).CustomerFeedback=function(){},!function(o){function e(e,t,i,n){this.id=e,this.name=t,this.description=i,this.capacity=n}o.Transfer=function(e,t,i,n,o,r,a,s){this.id=e,this.name=t,this.description=i,this.transferType=n,this.includedInPrepayment=o,this.requireGuaranteedPayment=r,this.endPoint=a,this.isToHotelDirection=s};o.Vehicle=e,Object.defineProperty(i.prototype,"transfer",{get:function(){return _.find(this._serviceStorage.transfers,{id:this._transferId})},set:function(e){this._transferId=e?e.id:null},enumerable:!0,configurable:!0});var t=i;function i(e,t,i){this.id=e.id,this.vehicles=t,this._serviceStorage=i,this._transferId=e.id}function n(e,t){this.transportCompany="",this.departurePlace="",this.additionalInfo="",this.isDraft=!1,this.wasCompleted=!1,this.previousTransportCompany="",this.previousDeparturePlace="",this.previousAdditionalInfo="",this.id=e.id,this.transferOffer=e,this.vehicles=t,this._totalPrice=o.Price.empty(o.Locale.getInstance().currency())}function r(e,t,i,n){this._enumerableVehicleOptionId=_.uniqueId("evo"),this._serviceStorage=n,this._roomStayId=e.id,this._transferId=t.id,this._vehicleOptionId=i.id,this._totalPrice=o.Price.empty(i.price.currency)}o.TransferOffer=t,n.prototype.getTotalPrice=function(){var t=this;return this._totalPrice?_.some(this.vehicles,function(e){return e.option.price.currency!==t._totalPrice.currency})&&this.calculateTotalPrice():(this._totalPrice=o.Price.empty(o.Locale.getInstance().currency()),this.calculateTotalPrice()),this._totalPrice},n.prototype.calculateTotalPrice=function(){var t=this,e=o.Locale.getInstance().currency();this._totalPrice?o.PriceCalculator.clean(this._totalPrice,e):this._totalPrice=o.Price.empty(e),_.forEach(this.vehicles,function(e){0<e.quantity&&(o.PriceCalculator.isAllowOperation(t._totalPrice,e.getTotalPrice())||o.PriceCalculator.clean(t._totalPrice,e.option.price.currency),o.PriceCalculator.sumTo(t._totalPrice,e.getTotalPrice()))})},n.prototype.vehicleOff=function(e){e?this.vehicle(e).quantity=0:_.forEach(this.vehicles,function(e){e.quantity=0}),this.calculateTotalPrice()},n.prototype.vehicleOn=function(e,t){void 0===t&&(t=1),this.vehicle(e).quantity=t,this.calculateTotalPrice()},n.prototype.getSelectedVehicles=function(){return _.filter(this.vehicles,function(e){return 0<e.quantity})},n.prototype.vehicle=function(t){return _.find(this.vehicles,function(e){return e.id==t})},n.prototype.isSelected=function(e){return((e=void 0===e?!1:e)||!this.isDraft)&&_.some(this.vehicles,function(e){return 0<e.quantity})},n.prototype.getQuantity=function(){return _.reduce(this.vehicles,function(e,t){return e+(t.quantity||0)},0)},n.prototype.invalidateTotalPrice=function(){this._totalPrice=null,_.forEach(this.vehicles,function(e){e.invalidateTotalPrice()})},o.TransferOption=n,Object.defineProperty(r.prototype,"option",{get:function(){var e=_.find(this._serviceStorage.getStayOptions(!0),{id:this._roomStayId}),e=_.find(e.transfers,{id:this._transferId});return _.find(e.transferOffer.vehicles,{id:this._vehicleOptionId})},set:function(e){this._vehicleOptionId=e?e.id:null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"quantity",{get:function(){return this._quantity},set:function(e){this._quantity=e,this.updateTotalPrice()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this.option.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"enumerableVehicleOptionId",{get:function(){return this._enumerableVehicleOptionId},enumerable:!0,configurable:!0}),r.prototype.getTotalPrice=function(){var e=this.option.price.currency;return this._totalPrice&&this._totalPrice.currency===e||(this._totalPrice||(this._totalPrice=o.Price.empty(e)),this.updateTotalPrice()),this._totalPrice},r.prototype.invalidateTotalPrice=function(){this._totalPrice=null},r.prototype.updateTotalPrice=function(){var e=this.option.price.currency;this._totalPrice||(this._totalPrice=o.Price.empty(e)),o.PriceCalculator.clean(this._totalPrice,e),o.PriceCalculator.mulTo(this._totalPrice,this.option.price,this.quantity)},o.EnumerableVehicleOption=r,o.VehicleOption=function(e,t){this.id=e.id,this.vehicle=e,this.price=t}}(tl=tl||{}),!function(e){function t(e){this.value=1,this.prefix="tax",this.kind=e}e.Tax=function(e,t,i,n){this.id=e,this.type=t,this.name=i,this.description=n};e.TaxUnit=t}(tl=tl||{}),!function(o){function n(e,t,i,n){this.guestStays=[],this.transfers=[],this.options=[],this.customer=new r,this.paymentOptions=[],this.ratePlans=[],this.captchaChallengeFailed=!1,this.provider=e,this.language=t,this._currency=i,this._serviceStorage=n,this._totalPrice=o.Price.empty(i),this._optionsPrice=o.Price.empty(i),this._bookingOptionsPrice=o.Price.empty(i),this._transfersPrice=o.Price.empty(i);e=o.BookingFormSettings.getInstance();this.pointOfSale={source:e.bookingSource,sourceUrl:e.sourceUrl,utmParameters:e.utmParameters,roistatParameters:e.roistatParameters,integrationKey:e.integrationKey,referrerCode:e.referrerCode},this.customer.subscribeEmail=e.forceMailDistributionSubscribe,this.customer.confirmSms=e.forceSendSmsConfirmation,this.customer.customerIsSamePersonAsGuest=!e.isCampBookingForm(),e.defaultGuestInfo&&(this.customer.firstName=e.defaultGuestInfo.firstName,this.customer.middleName=e.defaultGuestInfo.middleName,this.customer.lastName=e.defaultGuestInfo.lastName),e.customerEmail&&o.EmailUtil.REG_EXP.test(e.customerEmail)&&(this.customer.email=e.customerEmail),e.customerPhone&&(this.customer.phone=l.fromString(e.customerPhone)),e.trivagoReference&&this.pushArtifact("TrivagoReference",e.trivagoReference)}n.extraStayPriceTime=function(e){return new o.ExtraStayPriceTime(null,e=void 0===e?null:e,null)},n.prototype.stay=function(e){return e?_.find(this.guestStays,{id:e}):_.head(this.guestStays)},n.prototype.currency=function(e){return e&&(this._currency=e),this._currency},n.prototype.bookingOptionsPrice=function(){var t=this;return o.PriceCalculator.clean(this._bookingOptionsPrice,this._currency),_.forEach(this.options,function(e){o.PriceCalculator.isAllowOperation(t._bookingOptionsPrice,e.getTotalPrice())&&o.PriceCalculator.sumTo(t._bookingOptionsPrice,e.getTotalPrice())}),this._bookingOptionsPrice},n.prototype.transfersPrice=function(){var t=this;return o.PriceCalculator.clean(this._transfersPrice,this._currency),_.forEach(this.transfers,function(e){o.PriceCalculator.isAllowOperation(t._transfersPrice,e.getTotalPrice())&&e.isSelected()&&o.PriceCalculator.sumTo(t._transfersPrice,e.getTotalPrice())}),this._transfersPrice},n.prototype.optionsPrice=function(){o.PriceCalculator.clean(this._optionsPrice,this._currency),_.reduce(this.guestStays,function(t,e){return _.forEach(e.mealPlans,function(e){o.PriceCalculator.isAllowOperation(e.getTotalPrice(),t)?o.PriceCalculator.sumTo(t,e.getTotalPrice()):t=null}),_.forEach(e.roomOptions,function(e){o.PriceCalculator.isAllowOperation(e.getTotalPrice(),t)?o.PriceCalculator.sumTo(t,e.getTotalPrice()):t=null}),t},this._optionsPrice);var e=this.bookingOptionsPrice(),e=(o.PriceCalculator.isAllowOperation(this._optionsPrice,e)&&o.PriceCalculator.sumTo(this._optionsPrice,e),this.transfersPrice());return o.PriceCalculator.isAllowOperation(this._optionsPrice,e)&&o.PriceCalculator.sumTo(this._optionsPrice,e),this._optionsPrice},n.prototype.guestStaysPrice=function(){var e=new o.PriceWithDiscount(o.Price.empty(this._currency),o.Price.empty(this._currency));return _.reduce(this.guestStays,function(e,t){t=t.getGuestPlacementsPrice();return o.PriceWithDiscountCalculator.isAllowOperation(t,e)?o.PriceWithDiscountCalculator.sumTo(e,t):e=null,e},e),e},n.prototype.totalPrice=function(){var t=this,e=(o.PriceCalculator.clean(this._totalPrice,this._currency),_.each(this.guestStays,function(e){e=e.getTotalPrice();o.PriceCalculator.isAllowOperation(t._totalPrice,e.priceAfterDiscount)&&o.PriceCalculator.sumTo(t._totalPrice,e.priceAfterDiscount)}),this.bookingOptionsPrice()),e=(o.PriceCalculator.isAllowOperation(this._totalPrice,e)&&o.PriceCalculator.sumTo(this._totalPrice,e),this.transfersPrice());return o.PriceCalculator.isAllowOperation(this._totalPrice,e)&&o.PriceCalculator.sumTo(this._totalPrice,e),this._totalPrice},n.prototype.cancellationText=function(e){return e&&(this._cancellationText=e),0==this.guestStays.length||_.head(this.guestStays).roomStay.cancellationInfo.showDescription?this._cancellationText||0==this.guestStays.length?this._cancellationText:_.head(this.guestStays).roomStay.cancellationInfo.cancellationText:""},n.prototype.totalGuests=function(){return this.countAdults()+this.countChildren()},n.prototype.countAdults=function(){return _.reduce(this.guestStays,function(e,t){return e+t.placement.totalAdults},0)},n.prototype.countChildren=function(){return _.reduce(this.guestStays,function(e,t){return e+t.placement.totalChildren},0)},n.prototype.updateOrderCommonInfo=function(){var e;this.stayDates=null==(e=null==(e=_.head(this.guestStays))?void 0:e.roomStay)?void 0:e.stayDates,this.ratePlans=_.chain(this.guestStays).map(function(e){return e.roomStay.ratePlans}).flatten().uniqBy(function(e){return e.id}).value()},n.prototype.removeGuestStay=function(e){this.guestStays.splice(this.guestStays.indexOf(e),1),this.updateOrderCommonInfo()},n.prototype.addRoomStay=function(e,t,i){e=new o.GuestStay(e,n.extraStayPriceTime(e.stayDates.startDate),n.extraStayPriceTime(e.stayDates.endDate),this._serviceStorage,t);return void 0===i?this.guestStays.push(e):this.guestStays.splice(i,0,e),this.updateOrderCommonInfo(),e},n.prototype.pushArtifact=function(e,t){this.artifacts||(this.artifacts={}),this.artifacts[String(e)]=String(t)},n.prototype.removeArtifact=function(e){this.artifacts&&this.artifacts[String(e)]&&delete this.artifacts[String(e)]},o.OrderImpl=n;t=o.Person,__extends(i,t),i.prototype.clone=function(){var e=new i;return e.phone=this.phone.clone(),e.email=this.email,e.comment=this.comment,e.confirmSms=this.confirmSms,e.subscribeEmail=this.subscribeEmail,e.termsAgree=this.termsAgree,e.sanatoriumCardFormAgree=this.sanatoriumCardFormAgree,e.certificateOfCovidVaccinationAgree=this.certificateOfCovidVaccinationAgree,e.travelPurposeIsBusiness=this.travelPurposeIsBusiness,e.customerIsSamePersonAsGuest=this.customerIsSamePersonAsGuest,e.firstName=this.firstName,e.middleName=this.middleName,e.lastName=this.lastName,e};var t,r=i;function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.email="",e.phone=new l,e.comment="",e.confirmSms=!1,e.subscribeEmail=!1,e.termsAgree=!1,e.sanatoriumCardFormAgree=!1,e.certificateOfCovidVaccinationAgree=!1,e.travelPurposeIsBusiness=!1,e.customerIsSamePersonAsGuest=!1,e}o.CustomerInfo=r;a=o.Person,__extends(s,a),s.prototype.getAddress=function(){var e=new o.Address;return this.postalCode&&(e.postalCode=this.postalCode),this.region&&(e.region=this.region),this.city&&(e.city=this.city),e},s.prototype.clone=function(){var e=new s;return e.id=this.id,e.defaultCitizenship=this.defaultCitizenship,e.citizenship=this.citizenship,e.postalCode=this.postalCode,e.region=this.region,e.city=this.city,e.sex=this.sex,e.birthday=this.birthday,e.placementIndex=this.placementIndex,e.firstName=this.firstName,e.middleName=this.middleName,e.lastName=this.lastName,e};var a,e=s;function s(){var e=a.call(this)||this;return e.id="",e.defaultCitizenship="",e.citizenship="",e.postalCode="",e.region="",e.city="",e.id=_.uniqueId("guest"),e}o.GuestInfo=e;c.format=function(e){return _.isUndefined(e)?e:String(e).replace(/(?!^)\+/g,"").replace(/[^0-9\+]/g,"")},c.prototype.number=function(){return c.format(this.phone)},c.prototype.clone=function(){return new c(this.phone)},c.fromString=function(e){return new c(c.format(e))};var l=c;function c(e){this.phone="",this.phone=e||""}o.CustomerPhoneNumber=l,o.RoomPreferenceWithRoomType=function(e,t,i,n){this.roomTypeId=e,this.preferenceCategoryCode=t,this.preferenceCode=i,this.placementRef=n}}(tl=tl||{}),!function(e){i=e.Informer,__extends(n,i),n.getInstance=function(){return n._instance=null===n._instance?new n:n._instance},n.prototype.subscribe=function(e,t){return i.prototype.subscribe.call(this,e,t.toString())},n.prototype.notify=function(e,t){return i.prototype.notify.call(this,e.toString(),t)},n.prototype.unsubscribe=function(e,t){i.prototype.unsubscribe.call(this,e,t.toString())},n._instance=null;var i,t=n;function n(){var e;if(n._instance)throw new Error("Error: Instantiation failed: Use OrderInformer.getInstance() instead of new.");return e=i.call(this)||this,n._instance=e}function o(){}e.OrderInformer=t,o.CreateOrder="CreateOrder",o.RemoveOrder="RemoveOrder",o.AddGuestStays="AddGuestStays",o.RemoveGuestStays="RemoveGuestStays",e.OrderInformerMessageType=o}(tl=tl||{}),!function(e){function t(e,t,i){this._providerId=t,this._startDate=e,this._nights=1,this._endDate=e.addDays(this._nights),this.currency=i}Object.defineProperty(t.prototype,"providerId",{get:function(){return this._providerId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startDate",{get:function(){return this._startDate},set:function(e){this._startDate=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endDate",{get:function(){return this._endDate},set:function(e){this._endDate=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.startDate,this.providerId,this.currency)},e.RoomTypeAvailabilityCriterion=t;function i(e,t,i,n,o,r,a,s){void 0===r&&(r=!1),void 0===a&&(a=null),void 0===s&&(s=[]),this.isAvailable=!1,this.startDate=e,this.endDate=t,this.date=i,this.guests=n,this.roomTypeId=o,this.isAvailable=r,this.price=a,this.pricing=s}function n(e,t){this.date=e,this.price=t}function o(e,t,i,n,o,r,a,s){this.rendererDatesCount=17,this.isAvailable=e,this.checkInDate=t,this.checkOutDate=i,this.minDate=n,this.maxDate=o,this.maxNights=r,this.startDate=a||t,this.sliderWidth=s}e.RoomTypeAvailabilityGroup=function(e,t){this.roomTypeId=e,this.availabilities=t},e.RoomTypeAvailability=i,e.RoomTypeAvailabilityPricing=n;e.RoomTypeAvailabilityCalendarSettings=o}(tl=tl||{}),!function(e){function t(e,t){this.code=e,this.title=t}function i(e,t){this.width=e,this.height=t}function n(e,t,i){this.name=e,this.paymentSystemCode=t,this.prepayment=i}e.PaymentSystemOffice=function(){},e.PaymentSystemLogo=t,e.PaymentSystemLayout=i;e.ExtraGuarantee=n,r.PREPAYMENT_PLACEHOLDER="[prepayment_value]",r.MONTHLY_PAYMENT_PLACEHOLDER="[monthly_payment_value]";var o=r;function r(e,t,i,n){this.offices=[],this.extraGuarantees=[],this.id=e,this.code=e,this.type=t,this.paymentSystemCode=i,this.hasMirCashback=n}function a(e,t){this.paymentSystem=e,this.id=_.uniqueId(e.id),this._loanPaymentScheduleBuilder=t}e.PaymentSystem=o,a.prototype.hasLoanPaymentSchedule=function(){return!!this._loanPaymentScheduleBuilder},a.prototype.loanPaymentSchedule=function(){return this.hasLoanPaymentSchedule()?this._loanPaymentScheduleBuilder():null},e.PaymentOption=a}(tl=tl||{}),!function(e){function t(e,t,i,n,o,r,a,s,l,c,u){this.features=[],this.preferences=[],this.images=[],this.id=e,this.kind=t,this.name=i,this.description=n,this.contactInfo=o,this.features=null!=r?r:[],this.preferences=null!=a?a:[],this.images=null!=s?s:[],this.size=l,this.roomsQuantity=c,this.occupancy=u}t.prototype.getImageUrl=function(e){return e.url},t.prototype.getThumbnailUrl=function(e,t){return this.images.length?this.images[0].getThumbnailUrl(e,t):null},t.prototype.hasImage=function(){return!!this.images.length},e.RoomType=t;e.RoomFeatureCategory=function(e,t){this.id=e,this.name=t},Object.defineProperty(n.prototype,"category",{get:function(){return _.find(this._serviceStorage.roomFeatureCategories,{id:this._categoryId})},set:function(e){this._categoryId=e?e.id:null},enumerable:!0,configurable:!0});var i=n;function n(e,t,i,n,o){this._serviceStorage=o,this._categoryId=i,this.name=e,this.kind=t,this.iconPosition=n}e.RoomFeature=i;function o(e,t){void 0===t&&(t=1),this.prefix="room_type",this.value=t,this.kind=e}function r(e,t){this.prefix="room_type_size",this.value=t,this.kind=e}e.RoomPreference=function(e,t,i,n,o){this.categoryCode=e,this.categoryName=t,this.code=i,this.name=n,this.placementRef=o},e.RoomTypeUnit=o;e.RoomTypeSize=r,Object.defineProperty(a.prototype,"maxAdult",{get:function(){return this.adult+(this.accommodateAdultsOnExtraBed?this.extraBeds:0)},enumerable:!0,configurable:!0});i=a;function a(e,t,i,n,o,r,a){this.total=e,this.adult=t,this.extraBeds=i,this.withoutBeds=n,this.accommodateAdultsOnExtraBed=o,this.extraBedsAgeGroups=r,this.withoutBedsAgeGroups=a}e.RoomTypeOccupancy=i}(tl=tl||{}),!function(a){function e(){this.bookings=[]}function t(){this._surcharge=new a.PriceAmount(0,null)}function i(){this.guestPlacements=[],this.isPriceDetailsAvailable=!1,this.mealPlans=[],this.roomOptions=[],this.roomPreferences=[]}e.prototype.booking=function(){return _.head(this.bookings)},a.Reservation=e,t.prototype.surcharge=function(){return this._surcharge.currency=this.prepayment.currency,this._surcharge.amount=this.total.priceAfterDiscount.priceAfterTax.amount-this.prepayment.amount,this._surcharge},t.prototype.roomStay=function(){return _.head(this.roomStays)},t.prototype.servicesPrice=function(){var t=this;return this._serviceTotalPrice?a.PriceCalculator.clean(this._serviceTotalPrice):this._serviceTotalPrice=a.Price.empty(this.total.currency),_.each(this.roomStays,function(e){_.each(e.roomOptions,function(e){e.isInclusive||a.PriceCalculator.sumTo(t._serviceTotalPrice,e.getPrice())}),_.each(e.mealPlans,function(e){e.isInclusive||a.PriceCalculator.sumTo(t._serviceTotalPrice,e.getPrice())})}),_.each(this.options,function(e){e.isInclusive||a.PriceCalculator.sumTo(t._serviceTotalPrice,e.getPrice())}),_.each(this.transfers,function(e){_.each(e.vehicles,function(e){a.PriceCalculator.sumTo(t._serviceTotalPrice,e.price)})}),this._serviceTotalPrice},a.HotelBooking=t,i.prototype.inclusiveMealPlan=function(){return _.find(this.mealPlans,{isInclusive:!0})||null},i.prototype.getHashCode=function(){return this.index+"="+this.roomType.id+"="+_.map(this.ratePlans,function(e){return"rp"+e.id}).join(",")+"="+this.stayDates.startDate.toISOString()+this.stayDates.endDate.toISOString()+_.map(this.guestPlacements,function(e){return e.code+"*"+e.kind+"*"+(e.ratePlan?e.ratePlan.id:null)}).join("!")+"="+_.sortBy(_.map(this.roomOptions,function(e){return e.code()})).join("!")+"="+_.sortBy(_.map(this.mealPlans,function(e){return e.code()})).join("!")},a.BookingRoomStay=i;function n(e,t,i){this.ageQualifyingCode=e,this.childPlacement=t,this.guestPlacementIndex=i}function o(e,t,i,n){this.categoryCode=e,this.categoryName=t,this.code=i,this.name=n}function r(){this.paymentCode=null,this.cancellationCode=null,this.confirmationCode=null,this.unfinishedBookingSign=null}a.BookingGuestCountInfo=function(){this.adults=0,this.children=0,this.guestCounts=[]},a.BookingGuestCount=n,a.BookingRoomTypePreference=o;a.BookingReference=r,s=a.Person,__extends(c,s);var s,l=c;function c(){return null!==s&&s.apply(this,arguments)||this}function u(e,t){this.transfer=e,this.vehicles=t,this.totalPrice=a.Price.empty(a.Locale.getInstance().currency())}a.BookingGuestInfo=l,u.prototype.getQuantity=function(){return _.reduce(this.vehicles,function(e,t){return e+(t.quantity||0)},0)},u.prototype.getTotalPrice=function(){var t=this;return a.PriceCalculator.clean(this.totalPrice,a.Locale.getInstance().currency()),_.forEach(this.vehicles,function(e){0<e.quantity&&(a.PriceCalculator.isAllowOperation(t.totalPrice,e.price)||a.PriceCalculator.clean(t.totalPrice,e.price.currency),a.PriceCalculator.sumTo(t.totalPrice,e.price))}),this.totalPrice},a.BookingTransfer=u;a.BookingTransferVehicle=function(e,t,i){this.vehicle=e,this.price=t,this.quantity=i},d.prototype.id=function(){return this._id},d.prototype.code=function(){return this.option.id},d.prototype.getPlacementIndex=function(){return this.placementIndex},d.prototype.hasPlacementIndex=function(){return null!=this.placementIndex},d.prototype.getPricePerUnit=function(){return this.isInclusive?a.Price.empty(this.price.currency):this.price},d.prototype.getPrice=function(){return this._totalPrice},d.prototype.name=function(){return this.option.name},d.prototype.description=function(){return this.option.description},d.prototype.type=function(){return this.option.type},d.prototype.inclusive=function(){return this.isInclusive},d.prototype.chargeType=function(){return this.option.pricing},d.prototype.applicabilityType=function(){return this.option.applicabilityType},d.prototype.quantity=function(){return this._bookedQuantity},d.prototype.quotaUsed=function(){return!1},d.prototype.getOption=function(){return this.option},d.prototype.images=function(){return[]},d.prototype.includedInPrepayment=function(){return this.getOption().includedInPrepayment},d.prototype.requireGuaranteedPayment=function(){return this.getOption().requireGuaranteedPayment},d.prototype.getCategory=function(){return this.category};l=d;function d(e,t,i,n,o,r){this._id=e,this.option=t,this.price=i,this.placementIndex=n,this._bookedQuantity=o,this.isInclusive=r,this._totalPrice=a.PriceCalculator.mul(this.price,this.quantity())}function p(e,t,i,n,o,r){this._id=e,this.meal=t,this.price=i,this.placementIndex=n,this.isInclusive=r,this._bookedQuantity=o,this._totalPrice=a.PriceCalculator.mul(this.price,this.quantity())}a.BookingOption=l,p.prototype.id=function(){return this._id},p.prototype.code=function(){return this.meal.id},p.prototype.getPlacementIndex=function(){return this.placementIndex},p.prototype.hasPlacementIndex=function(){return null!=this.placementIndex},p.prototype.getPricePerUnit=function(){return this.isInclusive?a.Price.empty(this.price.currency):this.price},p.prototype.getPrice=function(){return this._totalPrice},p.prototype.name=function(){return this.meal.name},p.prototype.description=function(){return this.meal.description},p.prototype.type=function(){return this.meal.type},p.prototype.inclusive=function(){return this.isInclusive},p.prototype.chargeType=function(){return this.meal.pricing},p.prototype.applicabilityType=function(){return this.meal.applicabilityType},p.prototype.quantity=function(){return this._bookedQuantity},p.prototype.quotaUsed=function(){return!1},p.prototype.getOption=function(){return this.meal},p.prototype.images=function(){return[]},p.prototype.includedInPrepayment=function(){return this.getOption().includedInPrepayment},p.prototype.requireGuaranteedPayment=function(){return this.getOption().requireGuaranteedPayment},p.prototype.getCategory=function(){return this.category},a.BookingMealPlan=p;function m(){this.modifiable={stayDates:!1,customerInfo:!1,guestsInfo:!1,deleteRoomStay:!1,ratePlan:!1,roomType:!1,service:!1}}a.BookingCancellationInfo=function(e,t,i){this.date=e,this.message=t,this.subject=i};a.BookingSettings=m}(tl=tl||{}),!function(e){e.Provider=function(e,t,i,n){this.checkInTime=(new Date).resetTime(),this.checkOutTime=(new Date).resetTime(),this.id=e,this.name=t,this.type=i,this.currency=n},i.prototype.address=function(){return this.addressList[0]},i.prototype.phone=function(){return this.phones.length?this.phones[0].number:""},i.prototype.email=function(){return this.emails.length?this.emails[0]:""},i.prototype.getYandexMapsUrl=function(){return this.address().latitude&&this.address().longitude?["https://maps.yandex.ru/?",["text",[this.address().latitude,this.address().longitude].join(",")].join("=")].join(""):null},i.prototype.getGoogleMapsUrl=function(){return this.address().latitude&&this.address().longitude?["https://maps.google.com/maps?",["q",[this.address().latitude,this.address().longitude].join(",")].join("=")].join(""):null},i.prototype.getMapUrl=function(){return this.address().country&&-1!=["RU","BY","KZ"].indexOf(this.address().country.code)?this.getYandexMapsUrl():this.getGoogleMapsUrl()};var t=i;function i(e,t,i){this.addressList=[],this.emails=[],this.phones=[],this.addressList[0]=e,this.emails=t,this.phones=i}e.ContactInfo=t,e.ProviderTypeUnit=function(e){this.value=1,this.prefix="provider_type",this.kind=e}}(tl=tl||{}),!function(e){function t(){this.phone=new e.CustomerPhoneNumber}e.WishListSettings=function(){};e.WishListTicket=t,n.LinkOpened="LinkOpened",n.BookingComplete="BookingComplete";var i=n;function n(){}e.WishListTicketStatus=i}(tl=tl||{}),!function(i){function e(){}function t(e,t,i){this.id=e,this.bonusPoints=t,this.statusLevel=i}e.prototype.refreshProfile=function(e){var t=i.GuestProfileUtil.getGpToken(e);t&&this.parseUserInfoFromToken(t,e)},e.prototype.addExtendedInfo=function(e){this.middleName=e.middleName,this.sex=e.sex,this.email=e.email,this.phoneNumber=e.phoneNumber,this.photoUrl=e.photoUrl,this.firstName=e.firstName,this.lastName=e.lastName,this.countryName=e.countryName,this.countryCode=e.countryCode,this.cityName=e.cityName,this.birthDay=e.birthDay,this.birthMonth=e.birthMonth,this.birthYear=e.birthYear},e.prototype.clear=function(){this.publicId=null,this.authService=null,this.firstName=null,this.lastName=null,this.middleName=null,this.sex=null,this.email=null,this.phoneNumber=null,this.photoUrl=null,this.countryName=null,this.countryCode=null,this.cityName=null,this.birthDay=null,this.birthMonth=null,this.birthYear=null,this.loyaltyCard=null},e.prototype.isProfileLoaded=function(){return null!=this.publicId&&null!=this.firstName},Object.defineProperty(e.prototype,"fullName",{get:function(){return(this.firstName+" "+this.lastName).trim()},enumerable:!0,configurable:!0}),e.prototype.getBirthDateInfo=function(){var e=null;return e=this.birthDay&&this.birthMonth&&this.birthYear?new Date(this.birthYear,this.birthMonth-1,this.birthDay):e},e.prototype.parseUserInfoFromToken=function(e,t){e&&3==e.split(".").length&&(e=jwt_decode(e),i.GuestProfileUtil.hasExpirationDateArrived(new Date(1e3*parseInt(e.exp)))?i.GuestProfileUtil.clearStorage(t):(this.publicId=e.publicId,this.authService=e.authService))},e.prototype.isLoggedInThroughSocial=function(){return this.authService!=i.AuthServiceKind.Tl},i.GuestProfile=e,Object.defineProperty(t.prototype,"bonusPoints",{get:function(){return this._bonusPoints},set:function(e){this._bonusPoints=null!=e?e:null},enumerable:!0,configurable:!0}),i.LoyaltyCard=t}(tl=tl||{}),(tl||(tl={})).GuestAccountIntegration=function(e,t,i){this.id=e,this.providerId=t,this.url=i},(tl||(tl={})).BestPriceGuaranteeAdvantage=function(e,t){void 0===t&&(t=null),this.text=e,this.action="function"==typeof t?t:null},!function(e){function t(){}function i(){}function n(){}t.Medal="medal",t.Lock="lock",t.Ticket="ticket",t.People="people",t.PercentSign="percent",e.SnackbarIcon=t,i.Default=3e3,i.Long=6e3,e.SnackbarCloseTimeout=i,n.Default=-1,n.Low=-2,e.SnackbarPriority=n}(tl=tl||{}),!function(e){(e=(e=e.tracker||(e.tracker={})).BookingFormMode||(e.BookingFormMode={})).Hotel="hotel",e.Services="services",e.Camp="camp",e.Resort="resort",e.Sanatorium="sanatorium",e.EditBooking="edit-booking",e.RoomsList="rooms-list",e.CancelBooking="cancel-booking",e.PriceList="price-list",e.Certificates="certificates"}(tl=tl||{}),(tl||(tl={})).Step=function(e,t,i,n,o,r,a,s){this.completed=!1,this.label=e,this.getContent=t,this.getSummary=i,this.getFooter=n,this.getNextStep=o,this.onLeaveAction=r,this.onChooseAction=a,this.releaseAction=s},!function(e){function t(e,t){this.primary=e,this.specific=t,this.useBonus=!1,this.id=e.id,this.paymentSystem=e.paymentSystem,this.prepayment=e.prepayment,this.transactionAmount=e.transactionAmount,this.paymentDueDateDescription=e.paymentDueDateDescription,this.loanPaymentSchedule=function(){return e.loanPaymentSchedule()},this.hasLoanPaymentSchedule=function(){return e.hasLoanPaymentSchedule()},t&&(this.specificPrepayment=t.specificPrepayment,this.specificDiscount=null==(t=_.head(t.paymentSystem.extraGuarantees))?void 0:t.prepayment)}Object.defineProperty(t.prototype,"primaryOption",{get:function(){return this.primary},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specificOption",{get:function(){return this.specific},enumerable:!0,configurable:!0}),e.uiPaymentOption=t}(tl=tl||{}),!function(e){function t(e,t,i){this.id=e,this.name=t,this.questions=i}function i(){}e.Question=function(e,t){this.id=e,this.text=t,this.mark=0},e.CategoryQuestion=t;e.SurveyConfig=i}(tl=tl||{}),app.filter("tlAddress",["locale",function(i){function e(e,t){return e=e.addressParts(),i.addressFormatKind()==tl.AddressFormatKind.Reverse&&e.reverse(),e.join(t||", ")}return e.$stateful=!0,e}]),app.filter("tlCurrency",["$sce","$locale","$filter",function(s,l,c){return function(e,t,i){if(void 0===i&&(i=!0),!e)return i?s.trustAsHtml(""):"";var n=c("number"),o=c("message"),r=l.NUMBER_FORMATS,a=r.PATTERNS[1],e=tl.PriceFormat.format(e,r,a,n,o,t);return i?s.trustAsHtml(e):e}}]),app.filter("format",["tl.format",function(i){return function(e,t){return i.format(e,t)}}]),app.filter("message",["tl.messages",function(i){function e(e,t){return i.formatMessage(e,t)}return e.$stateful=!0,e}]),app.filter("tlPersonalName",["locale",function(n){function e(e,t){var i=[];return e.firstName&&i.push(e.firstName),e.middleName&&i.push(e.middleName),e.lastName&&(n.personalNameFormatKind()==tl.PersonalNameFormatKind.FML?i.push(e.lastName):i.unshift(e.lastName)),i.join(t||" ")}return e.$stateful=!0,e}]),app.filter("tlSafeLinks",function(){return function(e){for(var t=document.createElement("div"),i=(t.innerHTML=e,t.querySelectorAll("a")),n=0;n<i.length;n++)i[n].setAttribute("target","_blank");return t.innerHTML}}),app.filter("tlUnit",["$filter",function(a){return function(e,t){var i=a("message");if(null==e)return"";_.isString(e)&&(e={value:1,kind:e,prefix:""});var t=(t=t||"%ds").split(":"),n=-1!=t[0].indexOf("d"),o=-1!=t[0].indexOf("s"),r=[];return n&&r.push(e.value),o&&(n=1<t.length?":"+t[1]:"",o=e.prefix?e.prefix+".":"",r.push(i("T:unit."+o+e.kind+n,{value:e.value}))),r.join(" ")}}]),app.filter("tlUnsafe",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]),app.filter("tlTax",[function(){return function(e){return e?tl.BookingFormSettings.getInstance().showNetPrices?e.priceBeforeTax:e.priceAfterTax:null}}]),app.filter("tlToquote",["$filter",function(i){function n(e){var t=i("message");return _.isArray(e)?_.map(e,n).join(", "):t("T:common.quotes_format",{value:e})}return n}]),!function(e){function t(){if(this._isShown=!1,t._instance)throw new Error("Error: Instantiation failed: Use HeaderManager.getInstance() instead of new.");var e=angular.element(AppContainer).injector().get("$q");(t._instance=this)._scope=e.defer()}t.getInstance=function(){return t._instance=null===t._instance?new t:t._instance},t.prototype.show=function(t){this._isShown=!0,this._scope.promise.then(function(e){e.show(t)})},t.prototype.hide=function(){this._isShown=!1,this._scope.promise.then(function(e){e.hide()})},t.prototype.initScope=function(e){this._scope.resolve(e)},t._instance=null,e.HeaderManager=t}(tl=tl||{}),!function(t){function e(){if(this.isFrameCreated=!1,this._isShown=!1,this._scopes=[],e._instance)throw new Error("Error: Instantiation failed: Use CartPanelManager.getInstance() instead of new.");e._instance=this}e.getInstance=function(){return e._instance=null===e._instance?new e:e._instance},e.prototype.setOrder=function(t){_.forEach(this._scopes,function(e){return e.setOrder(t)})},e.prototype.setSearchCriteria=function(t){_.forEach(this._scopes,function(e){return e.setSearchCriteria(t)})},e.prototype.setProceedBookingBtnLoading=function(t){_.forEach(this._scopes,function(e){return e.proceedBookingBtnLoading=t})},e.prototype.proceedBookingBtnText=function(t){_.forEach(this._scopes,function(e){return e.proceedBookingBtnText=t})},e.prototype.hintText=function(t){_.forEach(this._scopes,function(e){return e.hintText=t})},e.prototype.setShowPrice=function(t){_.forEach(this._scopes,function(e){return e.showPrice=t})},e.prototype.proceedBookingAction=function(t,i){_.forEach(this._scopes,function(e){e.proceedBookingAction=t,e.clickBookingDisabledAction=i})},e.prototype.show=function(){this._isShown=!0,_.forEach(this._scopes,function(e){return e.showCartPanel()})},e.prototype.isShownPanel=function(){return this._isShown},e.prototype.hide=function(){this._isShown=!1,_.forEach(this._scopes,function(e){return e.hideCartPanel()})},e.prototype.createFrame=function(e){this.isFrameCreated||(AppIntegration.frameCreate(e.href("cart",{},{relative:!1}),{width:"100%",theme:AppIntegration.getProperties().theme,autoScroll:t.AppIntegrationAutoScroll.None},"cart"),this.isFrameCreated=!0)},e.prototype.showMotivationalText=function(t,i){void 0===i&&(i=15e3),_.forEach(this._scopes,function(e){return e.showMotivationalText(t,i)})},e.prototype.hideMotivationalText=function(){_.forEach(this._scopes,function(e){return e.hideMotivationalText()})},e.prototype.initScope=function(e){this._scopes.push(e)},e._instance=null,t.CartPanelManager=e}(tl=tl||{}),!function(t){i.prototype.push=function(e){e.date=t.DateUtil.getUserDate(),this._artifacts.push(e)},i.prototype.pushCollection=function(e){var t=this;_.forEach(e,function(e){t.push(e)})},Object.defineProperty(i.prototype,"artifacts",{get:function(){return this._artifacts},enumerable:!0,configurable:!0});var e=i;function i(){this._artifacts=[]}t.ArtifactLogger=e;o.prototype.push=function(e,t){function i(e){return e+(0!=n?"-"+n:"")}for(var n=0;this._timings[i(e)];)n++;this._timings[i(e)]=t||(new Date).getTime()},Object.defineProperty(o.prototype,"timings",{get:function(){return this._timings},enumerable:!0,configurable:!0}),o.performance=function(){return window.performance?window.performance.timing:{}};var n=o;function o(){this._timings={}}function r(){}t.PerformanceLogger=n,r.getInstance=function(){return null===r._instance&&((r._instance=new r)._artifactLogger=new e,r._instance._performanceLogger=new n),r._instance},Object.defineProperty(r.prototype,"artifactLogger",{get:function(){return this._artifactLogger},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"performanceLogger",{get:function(){return this._performanceLogger},enumerable:!0,configurable:!0}),r.prototype.log=function(){return{milestone:"none",provider:AppIntegration.getProperties().providerId,env:AppIntegration.getEnv(),source:AppIntegration.getSource(),browser:navigator.userAgent,integration:AppIntegration.getTimings(),bookingform:{page:n.performance(),app:this._performanceLogger.timings,artifacts:this._artifactLogger.artifacts}}},r._instance=null,t.SessionLogger=r}(tl=tl||{}),!function(e){i.prototype.isProxy=function(){return!1},i.prototype.open=function(e,t,i,n){var o=this;this.close(),t?(this.frame=document.createElement("iframe"),this.frame.setAttribute("src",e),i&&n?(this.frame.setAttribute("class","payment-frame"),this.frame.setAttribute("height",n+"px")):this.frame.setAttribute("class","hidden-frame"),document.body.appendChild(this.frame)):(this.popup=window.open(e,"_blank","location=no,menubar=no,toolbar=no,scrollbars=yes,status=yes,resizable=yes,width="+i+",height="+n),this.$timeout(function(){o.popup&&o.popup.focus()},0,!1))},i.prototype.redirect=function(e){this.popup?this.popup.location.replace(e):this.frame&&this.frame.setAttribute("src",e)},i.prototype.close=function(){var e=this;if(this.popup){try{this.popup.close()}catch(e){}this.popup=null}this.frame&&this.$timeout(function(){e.frame&&e.frame.parentNode.removeChild(e.frame)},0,!1).then(function(){e.frame=null})},i.prototype.success=function(e,t){this.$state.go(e,{paymentType:t},{reload:!0}),this.close()},i.prototype.failure=function(e,t){this.$state.go(e,{paymentType:t},{reload:!0}),this.close()},i.prototype.getWindow=function(){return this.popup},i.prototype.runInContext=function(e,t){return JSON.stringify(e.apply(this,t?_.map(t,function(e){return JSON.parse(e)}):[])||null)},i.$inject=["$state","$timeout"];var t=i;function i(e,t){this.$state=e,this.$timeout=t}e.PaymentPopupImpl=t;o.prototype.isProxy=function(){return!0},o.prototype.open=function(e,t){throw new Error("invalid operation of PaymentPopupProxy")},o.prototype.redirect=function(e){throw new Error("invalid operation of PaymentPopupProxy")},o.prototype.getWindow=function(){throw new Error("invalid operation of PaymentPopupProxy")},o.prototype.close=function(){this.delegate.close()},o.prototype.success=function(e,t){this.delegate.success(e,t)},o.prototype.failure=function(e,t){this.delegate.failure(e,t)},o.prototype.runInContext=function(e,t){return JSON.parse(this.delegate.runInContext(e,t?_.map(t,function(e){return JSON.stringify(e)}):[]))};var n=o;function o(){this.delegate=r()}function r(){try{return(window.opener||window.parent).paymentPopup||null}catch(e){return null}}e.PaymentPopupProxy=n,app.service("paymentPopup",null==r()?t:n)}(tl=tl||{}),!function(a){var i=function(e,t){this.from=e,this.to=t},s=(a.WindowSizeChangedEventArgs=i,function(e,t,i){this.code=e,this.minWidth=t,this.maxWidth=i}),e=(a.LayoutSize=s,l.prototype._resize=function(e){var t,i,n=this;this.auto&&(t=l._getWindowWidth(),this.current!=(i=(i=_.findLast(_.flattenDeep([this.sizes,this.current]),function(e){e=_.find(n.layoutSizes,{code:e});return e&&t>e.minWidth&&t<e.maxWidth}))||_.head(this.sizes))?e.$applyAsync(function(){n.update(i)}):i==a.LayoutSizeCode.XS&&this.update(i))},l.prototype.sendBroadcast=function(e,t){this.rootScope.$broadcast(a.BroadcastEvent.WindowSizeChanged,new i(e,t))},l.prototype.update=function(e){var t=this,i=(this.sizes.forEach(function(e){t[e]=!1}),this[e]=!0,this.current),n=(this.current=e,this.phone=this.xs,this.desktop=!this.phone,[e+"-view"]);n.push(this.phone?"phone-view":"desktop-view"),n.push("ontouchstart"in document.documentElement?"touch":"no-touch"),this.rootElement.setAttribute("data-layout",n.join(" ")),this.updateRootElementClass(),this.sendBroadcast(i,e)},l.prototype.updateLanguage=function(e){this.rootElement.setAttribute("data-lng","layout-lng-"+e.language().toLowerCase()),this.updateRootElementClass()},l.prototype.updateState=function(e){this.rootElement.setAttribute("data-state","layout-state-"+e),this.updateRootElementClass()},l.prototype.updateExperiment=function(e){e&&e.length&&(e=_.map(e,function(e){return"experiment-"+e}),this.rootElement.setAttribute("data-experiment",e.join(" ")))},l.prototype.updateRootElementClass=function(){this.rootElement.setAttribute("class",[this.rootElement.getAttribute("data-layout"),this.rootElement.getAttribute("data-state"),this.rootElement.getAttribute("data-experiment"),this.rootElement.getAttribute("data-lng")].join(" "))},l.$inject=["$rootScope"],l.LAYOUTS=[a.Layout.Phone,a.Layout.Desktop],l._getWindowWidth=function(){return window.innerWidth||document.documentElement.clientWidth},l._getWindowHeight=function(){return window.innerHeight||document.documentElement.clientHeight},l);function l(e){var t,i=this,n=(this.auto=!0,this.xs=!1,this.sm=!1,this.md=!1,this.lg=!1,this.phone=!1,this.desktop=!1,this.isVisible=!1,this.hasError=!1,AppIntegration.getProperties()),o=a.BookingFormSettings.getInstance().isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan),r=(this.layoutSizes=o?[new s(a.LayoutSizeCode.XS,0,500),new s(a.LayoutSizeCode.SM,480,1020),new s(a.LayoutSizeCode.MD,1e3,1440),new s(a.LayoutSizeCode.LG,1420,Number.MAX_VALUE)]:[new s(a.LayoutSizeCode.XS,0,500),new s(a.LayoutSizeCode.SM,480,960),new s(a.LayoutSizeCode.MD,940,1200),new s(a.LayoutSizeCode.LG,1180,Number.MAX_VALUE)],this.layouts=n.availableLayouts||l.LAYOUTS,this.sizes=[],_.includes(this.layouts,a.Layout.Phone)&&this.sizes.push(a.LayoutSizeCode.XS),_.includes(this.layouts,a.Layout.Desktop)&&(this.sizes.push(a.LayoutSizeCode.SM),this.sizes.push(a.LayoutSizeCode.MD),this.sizes.push(a.LayoutSizeCode.LG)),this.rootScope=e,this.rootElement=document.documentElement,this.updateExperiment(n.experiment),l._getWindowWidth());setInterval(function(){t=l._getWindowWidth(),r!=t&&(r=t,i._resize(e))},200),this._resize(e)}a.LayoutManager=e,app.service("layout",e)}(tl=tl||{}),!function(s){l.prototype.transition=function(e,t,i,n){var o=this.top(),r=l.normalize(i.name),a=l.normalize(e.name);this.updateLayout(e.name),this._layout.isVisible=!l.isStartState(a),this.stateChanged(e,t,i,n),this._back&&this._back.name===a||!r||r===a||o===r||l.isStartState(r)||this._states.push(new s.State(r,n))},l.prototype.back=function(){0<this._states.length&&(this._back=this._states.pop(),this.$state.go(this._back.name,this._back.params))},l.prototype.backTo=function(e,t){if(0<this._states.length){for(;(this._back=this._states.pop())&&this._back.name!=e;);return this._back&&this._back.name==e?this.$state.go(this._back.name,t||this._back.params):this.$state.go(e,t)}},l.prototype.go=function(e,t,i){return this.$state.go(e,t,i)},l.prototype.top=function(){return 0<this._states.length?_.last(this._states).name:null},l.normalize=function(e){return String(e).split(".",2)[0]},l.prototype.stateChanged=function(e,t,i,n){var o=AppIntegration.getProperties().autoScroll;e.name==s.AppState.Prefetch||o==s.AppIntegrationAutoScroll.None||o==s.AppIntegrationAutoScroll.Transition&&!this._states.length&&i&&l.isStartState(i.name)||o==s.AppIntegrationAutoScroll.Transition&&!this._states.length&&e&&l.isStartState(e.name)||t&&t.scrollTo||s.util.IntegrationUtil.scrollTo(0,this._layout.desktop)},l.prototype.updateLayout=function(e){!l.isStartState(e)&&e&&this._layout.updateState(e)},l.isStartState=function(e){return-1!=_.indexOf([s.AppState.Start,s.AppState.StartCancellation,s.AppState.StartContinueBooking,s.AppState.StartEditBooking,s.AppState.StartRestoreBooking,s.AppState.StartApproveBooking,s.AppState.StartChangeCard,s.AppState.StartDeferredPayment,s.AppState.StartPriceList,s.AppState.StartRooms,s.AppState.StartComponents,s.AppState.StartSurvey],e)},l.$inject=["$rootScope","$state","layout"];var e=l;function l(e,r,t){var a=this;this._states=[],this.$state=r,this._layout=t,this._preventNavigation=!1,r.from=null,r.back=function(){a.back()},r.backTo=function(e,t){return a.backTo(e,t)},r.prevState=function(){return a.top()},r.replacePrevState=function(e,t){var i;0<a._states.length&&((i=_.last(a._states)).name=e,i.params=t)},r.lockNavigation=function(){a._preventNavigation=!0},r.unlockNavigation=function(){a._preventNavigation=!1},e.$on("$locationChangeStart",function(e){(a._preventNavigation||a.$state.current.data&&a.$state.current.data.preventNavigation)&&e.preventDefault()}),e.$on("$stateChangeStart",function(e,t,i,n,o){a._preventNavigation?e.preventDefault():a._states.length&&t.name==_.last(a._states).name&&_.isEqual(i,_.last(a._states).params)&&(e.preventDefault(),r.back())}),e.$on("$stateChangeSuccess",function(e,t,i,n,o){r.from=n,a.transition(t,i,n,o),s.SessionLogger.getInstance().artifactLogger.push({kind:s.ArtifactKind.Page,value:t.name}),t.name==s.AppState.Prefetch||t.name==s.AppState.Cart||l.isStartState(t.name)||s.TrackerService.trackGaPage(t.name,{layout:a._layout.desktop?s.Layout.Desktop:s.Layout.Phone,provider:s.BookingFormSettings.getInstance().providerId})}),e.$watch(function(){return a._layout.isVisible},function(){a._layout.isVisible&&a.$state.current.name!=s.AppState.Prefetch&&setTimeout(function(){AppIntegration.hideLoader()},100)}),e.$watch(function(){return a._layout.xs},function(){r.current.abstract||l.isStartState(r.current.name)||r.current.data&&r.current.data.preventNavigation||r.reload()}),this.updateLayout(this.$state.current.name)}s.StateStack=e,app.service("stateStack",e)}(tl=tl||{}),!function(s){e=s.HotelBooking,__extends(i,e);var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}s.AuthData=t;n=s.BookingReference,__extends(o,n);var n,t=o;function o(){return null!==n&&n.apply(this,arguments)||this}s.AuthCredentials=t;Object.defineProperty(r.prototype,"readOnlyMode",{get:function(){return this._readOnlyMode},set:function(e){this._readOnlyMode=e},enumerable:!0,configurable:!0}),r.prototype.autoAuth=function(e){var t,i=this,n=s.BookingFormSettings.getInstance();return!(!n.bookingNumber||!(n.cancellationCode||n.confirmationCode||n.paymentCode))&&((t=new s.BookingReference).bookingNumber=n.bookingNumber,t.cancellationCode=n.cancellationCode,t.confirmationCode=n.confirmationCode,t.paymentCode=n.paymentCode,this.auth(t).then(function(){n.cancellationCode=null,n.confirmationCode=null,n.paymentCode=null,i.$state.go(e.name)}),!0)},r.prototype.restricted=function(e){var t=this;return!(!e.data||!e.data.restrictedRoles)&&!(this.isAuth()&&_.some(e.data.restrictedRoles,function(e){switch(e){case s.AuthRole.Cancellation:case s.AuthRole.EditBooking:return!!t.authData().cancellationCode;case s.AuthRole.PayBooking:return!!t.authData().paymentCode;default:return!1}}))},r.prototype.isAuth=function(){return null!=this._authResult},r.prototype.authData=function(){return this._authResult},r.prototype.credentials=function(){return this.isAuth()?this._credentials:null},r.prototype.auth=function(t){var i=this;return this.serviceFactory.bootstrapService.currentApp.auth(t).then(function(e){return i._authResult=e,i._credentials=t,e&&e.cancellationCode?i.readOnlyMode=!1:e&&e.paymentCode&&(i.readOnlyMode=!0),i._authResult})},r.prototype.updateAuthData=function(e){this.isAuth()&&(this._authResult=e)},r.prototype.logout=function(){this._authResult=null},r.$inject=["$rootScope","$state","serviceFactory"];t=r;function r(e,r,t){var a=this;this.$state=r,this.serviceFactory=t,this._authResult=null,e.$on("$stateChangeStart",function(e,t,i,n,o){a.restricted(t)&&(e.preventDefault(),a.autoAuth(t)||r.go(s.AppState.Auth,{back:t.name}))})}s.AuthService=t,app.service("auth",t)}(tl=tl||{}),!function(s){t.prototype.disableHandler=function(){s.ServiceErrorInformer.getInstance().unsubscribe(this._handleErrorCallable,s.ServiceErrorInformerMessageType.Error)},t.prototype.setRule=function(e){e&&(this._rule=e)},t.prototype.processError=function(t){var i=this,e=s.ModalManager.getInstance();!e.opened()&&s.directive.helper.ErrorHelper.isShowModalForError(t.error_code)&&(this.$state.lockNavigation(),this.layout.hasError=!0,e.open(this.$q.when(function(){AppIntegration.hideLoader();var e=i.serviceFactory.orderService.getOrder();return i.$rootScope.error=t,i.$rootScope.email=e&&e.customer&&e.customer.email,i.$rootScope.afterShowAction=function(){i.$state.unlockNavigation(),i.layout.hasError=!1},i.$compile('<tl-error-modal error="error" email="email" after-show-action="afterShowAction()" />')(i.$rootScope)[0]})),s.directive.helper.ErrorHelper.isOverbookingCode(t.error_code)||s.TrackerService.track("tech",{action:"error-shown",type:"modal",code:t&&t.error_code,message:t&&t.message})),s.directive.helper.ErrorHelper.isShowPageForError(t.error_code)&&(this.$state.go(s.AppState.Error,{errorCode:t.error_code}),AppIntegration.fireEvent(s.AppIntegrationEvent.ClearSearchParams),s.TrackerService.track("tech",{action:"error-shown",type:"page",code:t&&t.error_code,message:t&&t.message})),t.error_code==s.ServiceErrorCode.BookingTemporarilyUnavailable&&!e.opened()&&this._rule.handleBookingTemporarilyUnavailable&&(this.$state.lockNavigation(),this.layout.hasError=!0,this.serviceFactory.bootstrapService.preparePromise.then(function(){e.open(i.$q.when(function(){return AppIntegration.hideLoader(),i.$compile('<tl-status-modal subheader="\'T:error.booking_is_unavailable\'" header="\'T:error.booking_is_unavailable_header\'" text="\'T:error.booking_is_unavailable_description\'" status="\'error\'" hide-close-button="true"/>')(i.$rootScope)[0]}))})),t.error_code!=s.ServiceErrorCode.Reenter&&t.error_code!=s.ServiceErrorCode.Retry||this.serviceFactory.bookingService.chainHotelReservation(function(){i.serviceFactory.orderService.getOrder().number=""}),t.error_code==s.ServiceErrorCode.CaptchaChallenge&&(this.serviceFactory.orderService.getOrder().captchaChallengeFailed=!0,e.close()),s.directive.helper.ErrorHelper.isOverbookingCode(t.error_code)&&(this.serviceFactory.serviceTransport.invalidateCache(),this.serviceFactory.bookingService.invalidateCache()),t.error_code!=s.ServiceErrorCode.TransportError&&t.error_code!=s.ServiceErrorCode.BookingTemporarilyUnavailable&&t.error_code!=s.ServiceErrorCode.CaptchaChallenge&&this.logError(t)},t.prototype.logError=function(t){var e;window.Raven&&(e=_.find(Object.keys(s.ServiceErrorCode),function(e){return s.ServiceErrorCode[e]==t.error_code})||t.error_code,Raven.captureMessage("ErrorHandler: "+e,{extra:t}))},t.$inject=["$rootScope","$q","$compile","$state","serviceFactory","layout"];var e=t;function t(e,t,i,n,o,r){var a=this;this.$rootScope=e,this.$q=t,this.$compile=i,this.$state=n,this.serviceFactory=o,this.layout=r,this._handleErrorCallable={callback:function(e){a.processError(e)}},s.ServiceErrorInformer.getInstance().subscribe(this._handleErrorCallable,s.ServiceErrorInformerMessageType.Error),this._rule=new l}s.ErrorHandler=e;var l=function(){this.handleBookingTemporarilyUnavailable=!0};s.ErrorHandlerRule=l,app.service("errorHandler",e)}(tl=tl||{}),!function(o){function r(){}r.getExperimentName=function(e){return[r.experimentPrefix,e].join("-")},r.trackerEnabled=function(){return!AUTOTEST&&0<=["prod","russoft"].indexOf(AppIntegration.getEnv())},r.getSessionId=function(){var e,t;return r.sessionId||(e=new Date,t=AppIntegration&&AppIntegration.getProperties(),r.sessionId=t&&t.tlTrackerSession?t.tlTrackerSession:[("000"+(e.getUTCFullYear()%2*372+31*e.getUTCMonth()+(e.getUTCDate()-1))).slice(-3),("00000"+(3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds())).slice(-5),("000"+e.getUTCMilliseconds()).slice(-3),("0000000"+Math.floor(1e7*Math.random())).slice(-7)].join("").replace(/^0+/,"")),r.sessionId},r.getUserId=function(){var e;return r.userId||(e=AppIntegration&&AppIntegration.getProperties(),r.userId=e&&e.tlTrackerUser?e.tlTrackerUser:r.getSessionId()),r.userId},r.getExperimentSegment=function(e,t){if(o.BookingFormSettings.getInstance().hasExperiment(o.Experiment.ForceNewExperimentSegment))return _.last(t);var i=r.experimentSegmentsCache[e];return i||(i=(i=r.loadExperimentSegment(e))||t[Math.floor(Math.random()*t.length)],r.experimentSegmentsCache[e]=i,r.saveExperimentSegment(e,String(i))),i},r.trackAnalysis=function(t){var e,i,n=this;r.trackerEnabled()&&(e=function(){var e=_.assignIn({Date:(new Date).moment().format("YYYY-MM-DD"),Source:AppIntegration.getSource(),TlSessionId:n.getSessionId(),TlUserId:n.getUserId(),GoogleAnalyticsKey:o.CookieUtil.getCookieByName("_ga")||""},t);r.sendBeacon("/analysis-api/metric/form-add",r.formatFormData(e)),r.track("analysis-search",e)},this.gaBlocked||"undefined"===ga?e():(i=setTimeout(function(){n.gaBlocked=!0,e()},this.gaBlockedTtl),ga(function(){clearTimeout(i),e()})))},r.trackExperiment=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),r.trackerEnabled()&&(r.track(e,t,i),r.trackGaExperiment(e,t,i))},r.trackGaExperiment=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=!1),r.trackerEnabled()){if(i){i=["ga",e,JSON.stringify(t)].join(" ");if(r.trackEventCache[i])return;r.trackEventCache[i]=!0}window.ga&&ga("send","event","experiment",e,_.isObject(t)?_.map(Object.keys(t),function(e){return t[e]}).join(", "):t)}},r.track=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);t=_.assign(t,this.storedParameters),t=this.trackUserFirstPage(e,t);if(r.trackerEnabled()){if(i){i=[e,JSON.stringify(t)].join(" ");if(r.trackEventCache[i])return;r.trackEventCache[i]=!0}r.trackEventSendQueue.push({type:e,date:new Date,data:t}),r.initTrackEventsFlush()}},r.trackGaPage=function(e,t){void 0===t&&(t=null),r.trackerEnabled()&&window.ga&&ga("send","event","page",e,_.isObject(t)?_.map(Object.keys(t),function(e){return t[e]}).join(", "):t)},r.trackGaPageview=function(){var e;r.trackerEnabled()&&(e=AppIntegration.getProperties(),window.ga&&ga("send","pageview","/booking2/hotel/"+e.providerId+"/"+e.theme+"/"))},r.trackPerformance=function(){r.trackerEnabled()&&r.sendBeacon("//www.travelline.ru/booking2log",JSON.stringify(o.SessionLogger.getInstance().log()),!1)},r.flushTrackEvents=function(){for(var t=new Date,e=[];r.trackEventSendQueue.length;)e.push(r.trackEventSendQueue.shift());e.length&&r.sendBeacon("/ibe/Metric/batch",r.formatFormData({user:r.getUserId(),session:r.getSessionId(),items:_.map(e,function(e){return{type:e.type,timestampMs:e.date.diffInMs(t),data:JSON.stringify(e.data||{})}})}))},r.saveExperimentSegment=function(e,t){try{localStorage.setItem(r.getExperimentName(e),t)}catch(e){}},r.store=function(e){this.storedParameters=_.assign(this.storedParameters,e)},r.trackUserFirstPage=function(e,t){var i=t;return e===this.eventTypePage&&(i=_.assign(t,{isFirstPage:this.isFirstPage}),this.isFirstPage&&(this.isFirstPage=!1)),i},r.initTrackEventsFlush=function(){var e=this;r.trackEventsFlushInited||(r.trackEventsFlushInited=!0,setInterval(function(){e.flushTrackEvents()},5e3))},r.formatFormData=function(t,i){return void 0===i&&(i=""),_.isArray(t)?_.map(t,function(e,t){return r.formatFormData(e,i+"["+t+"]")}).join("&"):_.isObject(t)?_.map(Object.keys(t),function(e){return r.formatFormData(t[e],""==i?e:i+"["+encodeURIComponent(e)+"]")}).join("&"):i+"="+encodeURIComponent(t)},r.loadExperimentSegment=function(e){try{return localStorage.getItem(r.getExperimentName(e))}catch(e){return null}},r.sendBeacon=function(e,t,i){void 0===i&&(i=!0);try{var n,o="application/x-www-form-urlencoded";navigator.sendBeacon?navigator.sendBeacon(e,new Blob([t],{type:o})):((n=new XMLHttpRequest).open("POST",e,i),n.setRequestHeader("Content-Type",o),n.send(t))}catch(e){console.error(e)}},r.eventTypePage="page",r.userId=null,r.sessionId=null,r.experimentPrefix="tl-experiment",r.experimentSegmentsCache={},r.trackEventCache={},r.trackEventSendQueue=[],r.trackEventsFlushInited=!1,r.isFirstPage=!0,r.storedParameters={},r.gaBlocked=!1,r.gaBlockedTtl=5e3,o.TrackerService=r}(tl=tl||{}),app.factory("tl.format",["$locale","$filter",function(i,e){var n={zero:0,one:0,two:1,few:1,many:2,other:1},o=e("date"),t=e("tlToquote"),r=e("tlCurrency"),a=e("tlUnit"),s=e("tlAddress"),l="[MISSING]",c={plural:function(e,t){e=Number(e);if(isNaN(e))return"[ERR]";e=n[i.pluralCat(e)],t=t.split("|");return e>=t.length?t[t.length-1]:t[e]},date:function(e,t){return o(e,t)},toquote:function(e){return t(e)},unit:function(e,t){return a(e,t)},currency:function(e,t){return r(e,t)},address:function(e,t){return s(e,t)},number:function(e,t){e=Number(e),t=t.split("|");return t.length>=e?t[e-1]:String(e)}};return{format:function(e,a){return a=a||{},String(e).replace(/\{([^\}]+?)\}/g,function(e,t){var i,n,o=null,r="";return 0<t.indexOf(" ")&&(t=(n=(i=t).split(" ",3))[0],o=n[1],r=i.replace(t+" ","").replace(o+(2<n.length?" ":""),"")),t=a[t],o?c[o]?c[o](t,r):(console.warn("formatter not found: "+o),l):null!=t?t:l})}}}]),!function(t){app.provider("tl.messages",[function(){var r={};return{$get:["locale","tl.format",function(i,n){var o={getMessage:function(e){if(e&&"T"==e[0]&&":"==e[1]){e=e.substr(2);var t=r[i.language().locale()];if(t&&t[e])return-1!=t[e].indexOf("{T:")&&(t[e]=t[e].replace(/\{(T:\w+[-_:\.\w\d]*)\}/g,function(e,t){return o.getMessage(t)})),t[e];t&&console.error("Unknown message: "+e)}return e},formatMessage:function(e,t){return n.format(o.getMessage(e),t)},define:function(e,t){r[e]=t},getLocaleMessages:function(e){return r[e]},setTranslationMode:function(e){var n;e!=t.TranslationMode.Default&&(n=["__",e.toString()].join(""),_.forIn(r,function(i,e){_.forIn(i,function(e,t){_.includes(t,n)&&(i[t.replace(n,"")]=e)})}))}};return o}]}}])}(tl=tl||{}),!function(o){t.prototype.getOverlayElement=function(){return document.querySelector(".x-overlay")},t.prototype.getPreloaderElement=function(){return document.querySelector(".x-overlay__preloader")},t.prototype.on=function(e){void 0===e&&(e=!0);var t,n=this.getPreloaderElement(),i=this.getOverlayElement();e?((t=function(){var e=o.LayoutManager._getWindowWidth(),t=o.LayoutManager._getWindowHeight(),i=AppIntegration.getPosition();n.style.left=Math.max(Math.min(i.scrollLeft,e-i.screenWidth),0)+"px",n.style.top=Math.max(Math.min(i.scrollTop,t-i.screenHeight),0)+"px",n.style.width=Math.min(i.screenWidth,e)+"px",n.style.height=Math.min(i.screenHeight,t)+"px"})(),n.style.visibility="visible",this.intervalId=setInterval(function(){t()},50)):n.style.visibility="hidden",i.style.display="block"},t.prototype.off=function(){this.getOverlayElement().style.display="none",clearInterval(this.intervalId)};var e=t;function t(){}o.Overlay=e,app.service("overlay",e)}(tl=tl||{}),!function(l){t.prototype._getLanguageContext=function(t){return _.find(this.locale.languages(),function(e){return e.id==t})},t.prototype._getCurrency=function(e){return this.locale.findCurrency(e)},t.prototype._loadCustomMessages=function(e,t){return t==parseInt(t).toString()?this.serviceFactory.serviceTransport.customMessages(l.ApiCustomMessagesBuilder.build(t,e)):((t=this.$q.defer()).resolve({}),t.promise)},t.prototype._setDynamicLocale=function(n,e,o){var r=this,t=(void 0===o&&(o=!1),this.tmhDynamicLocale.set(n.toLowerCase())),e=this._loadCustomMessages(n,e);return this.$q.all([t,e]).then(function(e){var t=angular.injector(["tlBookingForm"]),i=r.messages.getLocaleMessages(n);i&&!o||(i=i||t.get("$messages"),i=_.assign({},i,l.DtoCustomMessagesBuilder.build(e[1])),r.messages.define(n,i),r.setTranslationMode(r._translationMode))})},t.prototype._setLocale=function(e){this.locale.setLocale(e),this.layout.updateLanguage(e.language)},t.prototype.init=function(e,t){e=this._getLanguageContext(e),this._setLocale(e),e=this._getCurrency(t);return this.locale.setCurrency(e),this._setDynamicLocale(this.locale.locale(),this.resolveProviderId())},t.prototype.translate=function(e,t,i){var n=this,o=(void 0===t&&(t=!0),void 0===i&&(i=!1),this.locale.language()),r=this._getLanguageContext(e);if(!r)return this.$q.when();if(!i&&o.locale()==r.language.locale())return this.$q.when();t&&this.overlay.on();e=this._setDynamicLocale(r.language.locale(),this.resolveProviderId(),i),i=this.serviceFactory.bootstrapService.currentApp.translate(r.language);return this.$q.all([e,i]).then(function(){n._setLocale(r),n.setTranslationMode(n._translationMode),n.$q.all(n._languageInformer.notify(new l.LanguageInformerMessage(o,r.language))).then(function(){}).finally(function(){t&&n.overlay.off()})})},t.prototype.setTranslationMode=function(e){this._translationMode=e,this.messages.setTranslationMode(e)},t.prototype.resolveProviderId=function(){return l.BookingFormSettings.getInstance().providerId?l.BookingFormSettings.getInstance().providerId:AppIntegration.getProperties()&&AppIntegration.getProperties().providerId?AppIntegration.getProperties().providerId.toString():""},t.prototype.convert=function(e,t){var i=this,n=(void 0===t&&(t=!0),this.locale.currency()),o=this._getCurrency(e);if(!o||this.locale.currencyId()==o.id)return this.$q.when();t&&this.overlay.on();e=this.serviceFactory.bootstrapService.currentApp.convertCurrency(o);return this.$q.all([e]).then(function(){i.$q.all(i._currencyInformer.notify(new l.CurrencyInformerMessage(n,o))).then(function(){i.locale.setCurrency(o)}).finally(function(){t&&i.overlay.off()})})},t.$inject=["overlay","locale","layout","serviceFactory","tmhDynamicLocale","tl.messages","$q","$rootScope"];var e=t;function t(e,t,i,n,o,r,a,s){this.overlay=e,this.locale=t,this.layout=i,this.messages=r,this.serviceFactory=n,this.tmhDynamicLocale=o,this.$q=a,this.$rootScope=s,this._currencyInformer=l.CurrencyInformer.getInstance(),this._languageInformer=l.LanguageInformer.getInstance(),this._translationMode=l.TranslationMode.Default}l.Translator=e,app.service("translator",e)}(tl=tl||{}),!function(e){function t(){if(t._instance)throw new Error("Error: Instantiation failed: Use ModalManager.getInstance() instead of new.");t._instance=this}t.getInstance=function(){return t._instance=null===t._instance?new t:t._instance},t.prototype.opened=function(){return this._scope&&this._scope.opened()},t.prototype.open=function(e,t){this._scope&&this._scope.open(e,t)},t.prototype.close=function(e){void 0===e&&(e=!1),this._scope&&this._scope.close(e)},t.prototype.initScope=function(e){this._scope=e},t._instance=null,e.ModalManager=t}(tl=tl||{}),!function(e){function t(){if(this._isShown=!1,t._instance)throw new Error("Error: Instantiation failed: Use CopyrightManager.getInstance() instead of new.");var e=angular.element(AppContainer).injector().get("$q");(t._instance=this)._scope=e.defer()}t.getInstance=function(){return t._instance=null===t._instance?new t:t._instance},t.prototype.show=function(){e.BookingFormSettings.getInstance().copyrightAvailable&&(this._isShown=!0,this._scope.promise.then(function(e){e.show()}))},t.prototype.isShownCopyright=function(){return this._isShown},t.prototype.hide=function(){this._isShown=!1,this._scope.promise.then(function(e){e.hide()})},t.prototype.initScope=function(e){this._scope.resolve(e)},t._instance=null,e.CopyrightManager=t}(tl=tl||{}),!function(e){!function(e){function t(){}t.join=function(e){return e.join(t.separator)},t.split=function(e){return e.split(t.separator)},t.separator="!",e.MinimizerUtil=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(r){function a(e){this._properties=e}a.prototype.expand=function(e){var n=this,e=_.map(_.isArray(e)?e:a.createArrayFromObject(e),function(e){return e===a.undefinedValue?void 0:e}),o=_.keys(this._properties);return _.reduce(e,function(e,t,i){i=o[i];return e[i]=r.Function.isDefined(t)?n._properties[i].expand(t):void 0,e},{})},a.prototype.minify=function(i){var n=this,e=_.chain(this._properties).keys().map(function(e){var t=i[e];return r.Function.isDefined(t)?n._properties[e].minify(t):void 0}).value(),t=_.reduce(e,function(e,t,i){return r.Function.isDefined(t)&&(e[String.fromCharCode(a.startIndexCode+i)]=t),e},{}),o=JSON.stringify(t),e=_.chain(e).dropRightWhile(function(e){return r.Function.isNullOrUndefined(e)}).map(function(e){return r.Function.isNullOrUndefined(e)?a.undefinedValue:e}).value();return JSON.stringify(e).length<o.length?e:t},a.createArrayFromObject=function(t){var e=_.chain(Object.keys(t)).sort().last().value();return void 0===e?[]:_.chain(_.range(a.startIndexCode,e.charCodeAt(0)+1)).map(function(e){return t[String.fromCharCode(e)]}).value()},a.startIndexCode="A".charCodeAt(0),a.undefinedValue=-1,r.Minimizer=a}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function t(){}t.prototype.expand=function(e){return e},t.prototype.minify=function(e){return e},t.string=new t,t.number=new t,e.IdentityMinimizer=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function t(e){this._elementMinimizer=e}t.prototype.expand=function(e){var t=this;return _.map(e,function(e){return t._elementMinimizer.expand(e)})},t.prototype.minify=function(e){var t=this;return _.map(e,function(e){return t._elementMinimizer.minify(e)})},e.ArrayMinimizer=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function t(){}t.prototype.expand=function(e){return e?new Date(e*Date.millisecondsInMinute).format("YYYY-MM-DD HH:mm:ss"):void 0},t.prototype.minify=function(e){return e?moment(e).valueOf()/Date.millisecondsInMinute:void 0},t.instance=new t,e.DateMinimizer=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function t(e){this._key=e}t.prototype.expand=function(e){var t={};return t[this._key]=e,t},t.prototype.minify=function(e){return e[this._key]},e.SinglePropertyObjectMinimizer=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(r){function o(){this._keyToMinifiedKey={surl:"a",path:"b",language:"c",cdnUrl:"d",tlTrackerUser:"e",tlTrackerSession:"f",env:"g"},this._minimizer=new r.Minimizer({code_decline_url_success_url:r.IdentityMinimizer.string,name:r.IdentityMinimizer.string}),this._minifiedKeyToKey=_.invert(this._keyToMinifiedKey)}o.prototype.minify=function(e){var t=o.mapUrlParameters(e.decline_url,this._keyToMinifiedKey),i=o.mapUrlParameters(e.success_url,this._keyToMinifiedKey);return this._minimizer.minify({code_decline_url_success_url:r.MinimizerUtil.join([e.code,t,i]),name:e.name})},o.prototype.expand=function(e){var e=this._minimizer.expand(e),t=r.MinimizerUtil.split(e.code_decline_url_success_url),i=t[0],n=t[1],t=t[2];return{code:i,decline_url:o.mapUrlParameters(n,this._minifiedKeyToKey),success_url:o.mapUrlParameters(t,this._minifiedKeyToKey),name:e.name}},o.mapUrlParameters=function(e,n){var o=r.UrlFactory.create(e);return o.search="",r.UrlFactory.create(e).searchParams.forEach(function(e,t){var i=n[t];o.searchParams.append(void 0===i?t:i,e)}),o.searchParams.delete(""),o.href},r.GuaranteeMinimizer=o}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){t.minify=function(e,t){return(e?1:0)+(t?2:0)},t.expand=function(e){return[1===e||3===e,2===e||3===e]};var n=t;function t(){}function i(){this._minimizer=new e.Minimizer({first_name:e.IdentityMinimizer.string,middle_name:e.IdentityMinimizer.string,last_name:e.IdentityMinimizer.string,comment:e.IdentityMinimizer.string,subscribe_email_confirm_sms:e.IdentityMinimizer.number,phones:new e.ArrayMinimizer(new e.Minimizer({phone_number:e.IdentityMinimizer.string,tech_type:e.IdentityMinimizer.string})),emails:new e.ArrayMinimizer(new e.SinglePropertyObjectMinimizer("email_address"))})}i.prototype.expand=function(e){var e=this._minimizer.expand(e),t=n.expand(e.subscribe_email_confirm_sms),i=t[0],t=t[1];return{first_name:e.first_name,middle_name:e.middle_name,last_name:e.last_name,comment:e.comment,subscribe_email:i,confirm_sms:t,contact_info:{phones:e.phones,emails:e.emails}}},i.prototype.minify=function(e){return this._minimizer.minify({first_name:e.first_name,middle_name:e.middle_name,last_name:e.last_name,subscribe_email_confirm_sms:n.minify(e.subscribe_email,e.confirm_sms),phones:e.contact_info.phones,comment:e.comment,emails:e.contact_info.emails})},e.CustomerMinimizer=i}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){var t,i,n,o;function r(){this._valueToMinified={male:1,female:0},this._minifiedToValue=_.invert(this._valueToMinified)}function a(){}function s(){return o.call(this,{first_name:t.IdentityMinimizer.string,middle_name:t.IdentityMinimizer.string,last_name:t.IdentityMinimizer.string,placement:new t.SinglePropertyObjectMinimizer("index"),citizenship:t.IdentityMinimizer.string,sex:new i,postal_code:t.IdentityMinimizer.string,region:t.IdentityMinimizer.string,city:t.IdentityMinimizer.string,birthday:new n,ref:t.IdentityMinimizer.string,age:t.IdentityMinimizer.string,count:t.IdentityMinimizer.string})||this}t=e.urlBookingStorage||(e.urlBookingStorage={}),r.prototype.expand=function(e){return this._minifiedToValue[e]},r.prototype.minify=function(e){return this._valueToMinified[e]},i=r,a.prototype.expand=function(e){return new Date(e*Date.millisecondsInDay).format("YYYY-MM-DD")},a.prototype.minify=function(e){return new Date(e).valueOf()/Date.millisecondsInDay},n=a,o=t.Minimizer,__extends(s,o),t.GuestMinimizer=s}(tl=tl||{}),!function(e){!function(n){function e(){this._minimizer=new n.Minimizer({code_quantity:n.IdentityMinimizer.string,placement_index:n.IdentityMinimizer.number})}e.prototype.expand=function(e){var e=this._minimizer.expand(e),t=n.MinimizerUtil.split(e.code_quantity),i=t[0],t=t[1];return{code:i,quantity:parseInt(t),placement_index:e.placement_index}},e.prototype.minify=function(e){return this._minimizer.minify({code_quantity:n.MinimizerUtil.join([e.code,e.quantity]),placement_index:e.placement_index})},n.ServiceMinimizer=e}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(i){function e(){}e.prototype.expand=function(e){var e=i.MinimizerUtil.split(e),t=e[0],e=e[1];return{vehicle_code:t,quantity:parseInt(e)}},e.prototype.minify=function(e){return i.MinimizerUtil.join([e.vehicle_code,e.quantity])},i.TransferVehicleMinimizer=e}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){var t,i;function n(){return i.call(this,{transfer_code:t.IdentityMinimizer.string,comment:t.IdentityMinimizer.string,car_number:t.IdentityMinimizer.string,departure_location:t.IdentityMinimizer.string,transport_company:t.IdentityMinimizer.string,trip_number:t.IdentityMinimizer.string,date:t.DateMinimizer.instance,vehicles:new t.ArrayMinimizer(new t.TransferVehicleMinimizer)})||this}t=e.urlBookingStorage||(e.urlBookingStorage={}),i=t.Minimizer,__extends(n,i),t.TransferMinimizer=n}(tl=tl||{}),!function(e){!function(o){function e(){this._minimizer=new o.Minimizer({index_kind_code:o.IdentityMinimizer.string,rate_plan_code:o.IdentityMinimizer.string})}e.prototype.expand=function(e){var e=this._minimizer.expand(e),t=o.MinimizerUtil.split(e.index_kind_code),i=t[0],n=t[1],t=t[2];return{index:parseInt(i),kind:n,code:t,rate_plan_code:e.rate_plan_code}},e.prototype.minify=function(e){return this._minimizer.minify({index_kind_code:o.MinimizerUtil.join([e.index,e.kind,e.code]),rate_plan_code:e.rate_plan_code})},o.RoomStayPlacementMinimizer=e}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(r){t.prototype.expand=function(e){var o=this;return{guest_counts:_.map(e,function(e){var e=o._minimizer.expand(e),t=r.MinimizerUtil.split(e.count_age_qualifying_code_placement_index),i=t[0],n=t[1],t=t[2];return{count:parseInt(i),age_qualifying_code:n,placement_index:parseInt(t),guest_ref:e.guest_ref,age:e.age}})}},t.prototype.minify=function(e){var t=this;return _.map(e.guest_counts,function(e){return t._minimizer.minify({count_age_qualifying_code_placement_index:r.MinimizerUtil.join([e.count,e.age_qualifying_code,e.placement_index]),guest_ref:e.guest_ref,age:e.age})})};var e=t;function t(){this._minimizer=new r.Minimizer({count_age_qualifying_code_placement_index:r.IdentityMinimizer.string,guest_ref:r.IdentityMinimizer.string,age:r.IdentityMinimizer.number})}n.prototype.expand=function(e){e=r.MinimizerUtil.split(e);return{code:e[0],category_code:e[1]}},n.prototype.minify=function(e){return r.MinimizerUtil.join([e.code,e.category_code])};var i=n;function n(){}function o(){this._minimizer=new r.Minimizer({rate_plans:new r.ArrayMinimizer(new r.SinglePropertyObjectMinimizer("code")),room_types:new r.ArrayMinimizer(new r.Minimizer({code:r.IdentityMinimizer.string,placements:new r.ArrayMinimizer(new r.RoomStayPlacementMinimizer),preferences:new r.ArrayMinimizer(new i)})),stay_dates:r.IdentityMinimizer.string,guests:new r.ArrayMinimizer(new r.GuestMinimizer),guest_count_info:new e,services:new r.ArrayMinimizer(new r.ServiceMinimizer)})}o.prototype.minify=function(e){return this._minimizer.minify({rate_plans:e.rate_plans,room_types:e.room_types,stay_dates:r.MinimizerUtil.join(_.chain([e.stay_dates.start_date,e.stay_dates.end_date]).map(function(e){return r.DateMinimizer.instance.minify(e)}).value()),guests:e.guests,guest_count_info:e.guest_count_info,services:e.services})},o.prototype.expand=function(e){var e=this._minimizer.expand(e),t=_.map(r.MinimizerUtil.split(e.stay_dates),function(e){return r.DateMinimizer.instance.expand(parseInt(e))}),i=t[0],t=t[1];return{guests:e.guests,rate_plans:e.rate_plans,guest_count_info:e.guest_count_info,room_types:e.room_types,stay_dates:{start_date:i,end_date:t},services:e.services}},r.RequestRoomStayMinimizer=o}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){var t,i;function n(){return i.call(this,{hotel_ref:new t.SinglePropertyObjectMinimizer("code"),transfers:new t.ArrayMinimizer(new t.TransferMinimizer),number:t.IdentityMinimizer.string,room_stays:new t.ArrayMinimizer(new t.RequestRoomStayMinimizer),guarantee:new t.GuaranteeMinimizer,customer:new t.CustomerMinimizer,services:new t.ArrayMinimizer(new t.ServiceMinimizer),promo_code:t.IdentityMinimizer.string,artifacts:new t.IdentityMinimizer,verification:new t.Minimizer({cancellation_code:t.IdentityMinimizer.string,payment_code:t.IdentityMinimizer.string})})||this}t=e.urlBookingStorage||(e.urlBookingStorage={}),i=t.Minimizer,__extends(n,i),t.RequestMinimizer=n}(tl=tl||{}),!function(e){!function(n){t.prototype.expand=function(e){return 0!==e},t.prototype.minify=function(e){return e?1:0},t.instance=new t;var e=t;function t(){}function i(){this._minimizer=new n.Minimizer({language_currency:n.IdentityMinimizer.string,hotel_reservations:new n.ArrayMinimizer(new n.RequestMinimizer),include_extra_stay_options:e.instance,include_guarantee_options:e.instance,gp_token:n.IdentityMinimizer.string,point_of_sale:new n.Minimizer({referrer_code:n.IdentityMinimizer.string,source_url:n.IdentityMinimizer.string,source:n.IdentityMinimizer.string,integration_key:n.IdentityMinimizer.string,utm_parameters:new n.IdentityMinimizer})})}i.prototype.expand=function(e){var e=this._minimizer.expand(e),t=n.MinimizerUtil.split(e.language_currency),i=t[0],t=t[1];return{include_extra_stay_options:e.include_extra_stay_options,include_guarantee_options:e.include_guarantee_options,language:i,hotel_reservations:e.hotel_reservations,currency:t,gp_token:e.gp_token,point_of_sale:e.point_of_sale}},i.prototype.minify=function(e){return this._minimizer.minify({language_currency:n.MinimizerUtil.join([e.language,e.currency]),hotel_reservations:e.hotel_reservations,include_extra_stay_options:e.include_extra_stay_options,include_guarantee_options:e.include_guarantee_options,gp_token:e.gp_token,point_of_sale:e.point_of_sale})},n.ReservationsRequestMinimizer=i}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){var t;function i(){}t=e.urlBookingStorage||(e.urlBookingStorage={}),i.encode=function(e){return t.Base64.encode(JSON.stringify(i._minimizer.minify(e)))},i.decode=function(e){return i._minimizer.expand(JSON.parse(t.Base64.decode(e)))},i._minimizer=new t.ReservationsRequestMinimizer,t.Serializer=i}(tl=tl||{}),!function(e){!function(e){function t(){}t.create=function(e){return new URL(e)},e.UrlFactory=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function s(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65}function t(){}t.encode=function(e){for(var t,i=function(e){for(var t,i=e.length,n=0,o=0;o<i;o++)n+=(t=e.charCodeAt(o))<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;for(var r=new Uint8Array(n),a=0,s=0;a<n;s++)(t=e.charCodeAt(s))<128?r[a++]=t:(t<2048?r[a++]=192+(t>>>6):(t<65536?r[a++]=224+(t>>>12):(t<2097152?r[a++]=240+(t>>>18):(t<67108864?r[a++]=248+(t>>>24):(r[a++]=252+(t>>>30),r[a++]=128+(t>>>24&63)),r[a++]=128+(t>>>18&63)),r[a++]=128+(t>>>12&63)),r[a++]=128+(t>>>6&63)),r[a++]=128+(63&t));return r}(e),e=(3-i.length%3)%3,n="",o=i.length,r=0,a=0;a<o;a++)r|=i[a]<<(16>>>(t=a%3)&24),2!=t&&i.length-a!=1||(n+=String.fromCharCode(s(r>>>18&63),s(r>>>12&63),s(r>>>6&63),s(63&r)),r=0);return 0==e?n:n.substring(0,n.length-e)+(1==e?"=":"==")},t.decode=function(e){for(var t,i=function(e,t){for(var i,n,o,r=e.replace(/[^A-Za-z0-9\+\/]/g,""),a=r.length,s=t?Math.ceil((3*a+1>>>2)/t)*t:3*a+1>>>2,l=new Uint8Array(s),c=0,u=0,d=0;d<a;d++)if(n=3&d,c|=(64<(o=r.charCodeAt(d))&&o<91?o-65:96<o&&o<123?o-71:47<o&&o<58?o+4:43===o?62:47===o?63:0)<<18-6*n,3==n||a-d==1){for(i=0;i<3&&u<s;i++,u++)l[u]=c>>>(16>>>i&24)&255;c=0}return l}(e,void 0),n="",o=i.length,r=0;r<o;r++)t=i[r],n+=String.fromCharCode(251<t&&t<254&&r+5<o?1073741824*(t-252)+(i[++r]-128<<24)+(i[++r]-128<<18)+(i[++r]-128<<12)+(i[++r]-128<<6)+i[++r]-128:247<t&&t<252&&r+4<o?(t-248<<24)+(i[++r]-128<<18)+(i[++r]-128<<12)+(i[++r]-128<<6)+i[++r]-128:239<t&&t<248&&r+3<o?(t-240<<18)+(i[++r]-128<<12)+(i[++r]-128<<6)+i[++r]-128:223<t&&t<240&&r+2<o?(t-224<<12)+(i[++r]-128<<6)+i[++r]-128:191<t&&t<224&&r+1<o?(t-192<<6)+i[++r]-128:t);return n},e.Base64=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function n(){}n.isEqualWithoutUndefinedProperties=function(e,t){return _.isEqualWith(e,t,function(t,i){if(_.every([t,i],_.isPlainObject))return _.chain([t,i]).map(function(e){return _.keys(e)}).flatten().union().every(function(e){return n.isEqualWithoutUndefinedProperties(t[e],i[e])}).value()})},e.ObjectUtil=n}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(e){function t(){}t.isDefined=function(e){return!t.isNullOrUndefined(e)},t.isNullOrUndefined=function(e){return null==e},e.Function=t}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){!function(r){e.IEMaxUrlLength=2083;var t=e;function e(){}r.Constant=t;i.request="request",i.version="serializer";var a=i;function i(){}function s(){}r.SearchParameter=a,s.getReservationRequest=function(e,t){e=r.UrlFactory.create(e).searchParams,t=parseInt(e.get(a.version))===t?e.get(a.request):void 0;return t?r.Serializer.decode(t):void 0},s.getReservationRequestForPayment=function(e,t){var t=s.getReservationRequest(e,t),e=r.UrlFactory.create(e),n=e.searchParams.get(a.request),o=e.searchParams.get(a.version);return t&&n&&o&&_.forEach(t.hotel_reservations,function(e){var t,i;e.guarantee&&(t=e.guarantee.decline_url,(i=r.UrlFactory.create(t)).searchParams.append(a.version,o),i.searchParams.append(a.request,n),e.guarantee.decline_url=s.getValidUrl(i.href,t))}),t},s.tryExpand=function(e,t,i){var n=r.UrlFactory.create(e);return n.searchParams.append(a.version,i.toString()),n.searchParams.append(a.request,r.Serializer.encode(t)),s.isValid(n.href)&&r.ObjectUtil.isEqualWithoutUndefinedProperties(t,s.getReservationRequest(n.href,i))?n.href:e},s.tryExpandWithUrlData=function(e,t){var i=r.UrlFactory.create(e),t=r.UrlFactory.create(t),n=t.searchParams.get(a.request),t=t.searchParams.get(a.version);return n&&t&&(i.searchParams.append(a.version,t),i.searchParams.append(a.request,n),e=s.getValidUrl(i.href,e)),e},s.getValidUrl=function(e,t){return s.isValid(e)?e:t},s.isValid=function(e){return e.length<=t.IEMaxUrlLength},r.Storage=s}(e.urlBookingStorage||(e.urlBookingStorage={}))}(tl=tl||{}),!function(e){var i;(i=e.urlBookingStorage||(e.urlBookingStorage={})).serializerVersion=1,i.getReservationRequest=function(){return i.Storage.getReservationRequestForPayment(window.location.toString(),i.serializerVersion)},i.tryExpand=function(e,t){return i.Storage.tryExpand(e,t,i.serializerVersion)},i.tryExpandWithLocationRequest=function(e){return i.Storage.tryExpandWithUrlData(e,window.location.toString())}}(tl=tl||{}),!function(e){function t(e,t){this.code=e,this.langs=t}t.prototype.isLanguageAvailable=function(e){return!this.langs||this.langs&&-1!==this.langs.indexOf(e)},e.AuthMethod=t}(tl=tl||{}),!function(e){function t(){this._openedPopupsCount=0}Object.defineProperty(t,"instance",{get:function(){var e;return null!=(e=this._instance)?e:this._instance=new t},enumerable:!0,configurable:!0}),t.prototype.countUpOpenedPopup=function(){this._openedPopupsCount++},t.prototype.countDownOpenedPopup=function(){this._openedPopupsCount--},Object.defineProperty(t.prototype,"openedPopupsCount",{get:function(){return this._openedPopupsCount},enumerable:!0,configurable:!0}),e.PopupManager=t}(tl=tl||{}),!function(e){!function(e){function n(){}n.fromRequest=function(e){var t,i={};for(t in e)i[t]=e[t];return i.criterions=e.criterions.map(function(e){return n.fromCriterion(e)}),i},n.fromCriterion=function(e){var t,i,n=!1,o=(e.guests&&e.guests.forEach(function(e){!n&&e.rate_plan_code&&(n=!0)}),""),o=(n&&e.guests?o=e.guests.reduce(function(e,t){return e+(t.hasOwnProperty("age")?"":(e?";":"")+t.count)},""):e.guests&&(o=e.guests.reduce(function(e,t){return e+(t.hasOwnProperty("age")?0:t.count)},0).toString()),{hotels:e.hotels,dates:e.start_date+";"+e.end_date,adults:o.toString(),children:e.guests?e.guests.reduce(function(e,t){return e+(t.hasOwnProperty("age")?(e?";":"")+t.age:"")},""):"",promo_code:e.promo_code,min_room_type_availability:e.min_room_type_availability});return e.room_type_code&&(o.room_type_code=e.room_type_code),e.guests&&e.guests.length&&(t=[],i=[],e.guests.forEach(function(e){e.rate_plan_code&&(e.hasOwnProperty("age")?i:t).push(e.rate_plan_code)}),o.guest_rate_plans=t.length||i.length?t.concat(i).join(";"):""),o.adults||delete o.adults,o.guest_rate_plans||delete o.guest_rate_plans,o.children.length||delete o.children,e.hasOwnProperty("promo_code")||delete o.promo_code,e.hasOwnProperty("min_room_type_availability")&&1!=e.min_room_type_availability||delete o.min_room_type_availability,o},e.HotelAvailabilitySurrogatedHelper=n}(e.api||(e.api={}))}(tl=tl||{}),!function(e){(e.api||(e.api={})).DefaultAgeGroupCode="default"}(tl=tl||{}),!function(e){(e=(e=e.api||(e.api={})).LoyaltyCardResultStatus||(e.LoyaltyCardResultStatus={}))[e.CardFound=0]="CardFound",e[e.CardNotFound=1]="CardNotFound",e[e.CardHasBeenLinkedSuccessfully=2]="CardHasBeenLinkedSuccessfully",e[e.CardHasBeenAlreadyLinked=3]="CardHasBeenAlreadyLinked",e[e.LinkingCardFailed=4]="LinkingCardFailed",e[e.IntegrationNotFound=5]="IntegrationNotFound"}(tl=tl||{}),!function(e){e=e.finder||(e.finder={});function t(e){this.age=e}e.PlacementFinderCriterion=function(){this.children=[]},e.ChildPlacement=t}(tl=tl||{}),!function(n){!function(e){function t(){}t.find=function(e,t,i){for(var n=e.adults,o=_.sortBy(e.children,function(e){return e.age}),r=new a(t,i);0!=n||0!=o.length;)if(0!=n){if(!r.addAdult())return null;n--}else if(!r.addChild(o.pop()))return null;return r.roomStayPlacement},e.PlacementFinder=t;i.prototype.addAdult=function(){if(!_.last(this._adultPlacements))return!1;if(_.last(this._adultPlacements).capacity>this.roomStayPlacement.totalMainBeds)return this.roomStayPlacement.adults++,!0;var e=0;return(e=this._adultExtraPlacements.length?_.last(this._adultExtraPlacements).capacity:e)>this.roomStayPlacement.totalExtraBeds&&(this.roomStayPlacement.adultsExtraBed++,!0)},i.prototype.hasChildPlacement=function(e,t,i){return!!_.find(e,function(e){return e.kind==i&&e.ageGroup.inGroup(t)})},i.prototype.addChild=function(e){if(this._childrenPlacements.length&&(_.last(this._childrenPlacements).capacity>this.roomStayPlacement.totalMainBeds&&this.hasChildPlacement(this._childrenPlacements,e.age,n.GuestPlacementKind.Child)))return this.roomStayPlacement.children.push(new n.ChildPlacement(e.age,null)),!0;if(this._childrenExtraPlacements.length&&(_.last(this._childrenExtraPlacements).capacity>this.roomStayPlacement.totalExtraBeds&&this.hasChildPlacement(this._childrenExtraPlacements,e.age,n.GuestPlacementKind.ExtraChild)))return this.roomStayPlacement.childrenExtraBed.push(new n.ChildPlacement(e.age,null)),!0;return!!(this._roomTypeOccupancy.withoutBeds>this.roomStayPlacement.childrenWithoutBed.length&&this.hasChildPlacement(this._childrenWithoutPlacements,e.age,n.GuestPlacementKind.ChildBandWithoutBed))&&(this.roomStayPlacement.childrenWithoutBed.push(new n.ChildPlacement(e.age,null)),!0)};var a=i;function i(e,t){this._adultPlacements=[],this._adultExtraPlacements=[],this._childrenPlacements=[],this._childrenExtraPlacements=[],this._childrenWithoutPlacements=[],this._roomTypeOccupancy=t,this.roomStayPlacement=new n.RoomStayPlacement,this._adultPlacements=_.sortBy(_.filter(e,function(e){return e.kind==n.GuestPlacementKind.Adult}),function(e){return e.capacity}),this._childrenPlacements=_.sortBy(_.filter(e,function(e){return e.kind==n.GuestPlacementKind.Child}),function(e){return e.capacity}),this._adultExtraPlacements=_.sortBy(_.filter(e,function(e){return e.kind==n.GuestPlacementKind.ExtraAdult}),function(e){return e.capacity}),this._childrenExtraPlacements=_.sortBy(_.filter(e,function(e){return e.kind==n.GuestPlacementKind.ExtraChild}),function(e){return e.capacity}),this._childrenWithoutPlacements=_.filter(e,function(e){return e.kind==n.GuestPlacementKind.ChildBandWithoutBed})}e.AccommodationManager=a}(n.finder||(n.finder={}))}(tl=tl||{}),!function(r){!function(e){function t(){}t.calculate=function(e,t,i,n){var o;return void 0===i&&(i=1),void 0===n&&(n=null),t==r.GuestPlacementKind.Adult||t==r.GuestPlacementKind.ExtraAdult?(o=_.find(e,function(e){return e.capacity==i&&e.kind==t}))?o.price:null:t==r.GuestPlacementKind.Child||t==r.GuestPlacementKind.ExtraChild?(o=_.find(e,function(e){return e.capacity==i&&e.kind==t&&e.ageGroup.inGroup(n)}))?o.price:null:t==r.GuestPlacementKind.ChildBandWithoutBed&&(o=_.find(e,function(e){return e.kind==t&&e.ageGroup.inGroup(n)}))?o.price:null},e.PlacementPriceCalculator=t}(r.calculator||(r.calculator={}))}(tl=tl||{}),!function(e){function t(){}t.getAnimationDelay=function(e){return["-webkit-animation-delay: %DELAYs;","animation-delay: %DELAYs;"].join("").replace(/%DELAY/g,(.2*Math.min(e,8)).toFixed(1))},t.scrollHorizontal=function(o,r,e){void 0===r&&(r=0),void 0===e&&(e=300);var a=o.scrollLeft,s=0,l=Math.max(.1,Math.min(Math.abs(a-r)/e,.8));return new Promise(function(i){function n(){var e=(s+=1/60)/l,t=Math.sin(e*(Math.PI/2));e<1?(window.requestAnimationFrame(n),o.scrollLeft=a+(r-a)*t):(o.scrollLeft=r,i(!0))}n()})},e.AnimationUtil=t}(tl=tl||{}),!function(e){function t(){}t.intersect=function(e,t,i){var n=[];return _.forEach(e,function(e){n.push({item1:e,item2:null})}),_.forEach(t,function(t){var e=_.find(n,function(e){return e.item1&&null==e.item2&&i(e.item1,t)});e?e.item2=t:n.push({item1:null,item2:t})}),n},t.difference=function(e,t,i){e=this.intersect(e,t,i),t=_.filter(e,function(e){return e.item1&&!e.item2}),i=_.filter(e,function(e){return e.item2&&!e.item1});return _.zipWith(t,i,function(e,t){return{item1:e?e.item1:null,item2:t?t.item2:null}})},t.union=function(e,t,n){var o=[],r=t.slice(),i=[];return _.forEach(e,function(e,t){var i=null;r[t]&&n(e,r[t])&&(i=r[t],r[t]=null),o.push({item1:e,item2:i})}),_.forEach(r,function(t){var e;null!=t&&((e=_.find(o,function(e){return e.item1&&null==e.item2&&n(e.item1,t)}))?e.item2=t:i.push(t))}),_.forEach(i,function(e){var t=_.find(o,function(e){return null==e.item2});t?t.item2=e:o.push({item1:null,item2:e})}),o},e.CollectionCalculator=t}(tl=tl||{}),!function(e){function t(){}t.parseTime=function(e){return moment(e,"HH:mm").toDate()},t.toDate=function(e){return t._datesCache[e]||(t._datesCache[e]=moment(e).toDate()),t._datesCache[e].clone()},t.zpad=function(e){return e<10?"0"+e:String(e)},t.dateToString=function(e,t){e=moment(e),e=[e.year(),this.zpad(e.month()+1),this.zpad(e.date())].join("-");return t&&(t=moment(t),e+=" "+[this.zpad(t.hours()),this.zpad(t.minutes()),this.zpad(t.seconds())].join(":")),e},t.timeToString=function(e){e=moment(e);return[this.zpad(e.hours()),this.zpad(e.minutes()),this.zpad(e.seconds())].join(":")},t._datesCache={},e.UnitConverter=t}(tl=tl||{}),!function(o){function e(){}e.getMaxQuantity=function(e,t,i,n){switch(e){case o.ChargeType.PerUse:return Math.min(i,n);case o.ChargeType.PerBooking:case o.ChargeType.PerStay:return 1;case o.ChargeType.PerPerson:return t;case o.ChargeType.PerNight:return 1;case o.ChargeType.PerPersonPerNight:case o.ChargeType.PerOccupancyPerNight:return t;default:return 0}},e.getMinQuantity=function(e,t,i){return e!==o.ChargeType.PerOccupancyPerNight?1:t},o.OptionCalculator=e}(tl=tl||{}),!function(a){var n=function(e,t){this.id=e,this.quantity=t},o=function(){this.roomOptions=[],this.mealPlan=[]},t=function(){this.options=[],this.guestStays=[]},e=(a.OrderOptionsQuantity=t,i._getOptionHaystack=function(e,t,i){return t.chargeType()==a.ChargeType.PerBooking?e.options:t.type()==a.OptionType.Service?i.roomOptions:t.type()==a.OptionType.MealPlan?i.mealPlans:[]},i.calcOptionQuota=function(t,i,n,o,e){var r=this;if(0===i.quantity())return Number.MAX_VALUE;var a=i.quantity();return a-=o-e,e||(e=this.findEnumerableOption(t,i,n))&&(a+=e.getQuantity()),i.quotaUsed()&&(a-=_.chain(t.guestStays).filter(function(e){return 0===o||e.id!==n.id}).map(function(e){return r._getOptionHaystack(t,i,e)}).flatten().filter(function(e){return e.option.code()===i.code()}).reduce(function(e,t){return e+t.getQuantity()},0).value()),a},i.calcPersonQuantity=function(t,e){return t.hasPlacementIndex()?_.find(e.guestPlacements,function(e){return e.index===t.getPlacementIndex()}).guests:e.placement.total()},i.findEnumerableOption=function(e,t,i){return t?_.find(this._getOptionHaystack(e,t,i),function(e){return e.id()==t.id()}):null},i.hasSelectedOption=function(t,i){var n=this;return _.some(t.guestStays,function(e){return _.some(n._getOptionHaystack(t,i,e),function(e){return i.code()==e.code()&&(e.isInclusive()||0<e.getQuantity())})})},i.updateOptionQuantity=function(e,t,i,n){t.chargeType()==a.ChargeType.PerBooking?this.findEnumerableOption(e,t,n).setQuantity(i):0<i&&(t.type()==a.OptionType.Service?n.addOption(t,i):t.type()==a.OptionType.MealPlan&&n.addMealPlan(t,i))},i.addOption=function(e,t,i){e.chargeType()!=a.ChargeType.PerBooking&&(e.type()==a.OptionType.Service?i.addOption(e,t):e.type()==a.OptionType.MealPlan&&i.addMealPlan(e,t))},i.removeOption=function(e,t){e.chargeType()!=a.ChargeType.PerBooking&&(e.type()==a.OptionType.Service?t.removeOption(e):e.type()==a.OptionType.MealPlan&&t.removeMealPlan(e))},i.optionMaxQuantity=function(e,t,i,n,o){return void 0===n&&(n=0),void 0===o&&(o=0),t?a.OptionCalculator.getMaxQuantity(t.chargeType(),this.calcPersonQuantity(t,i),t.quantity(),this.calcOptionQuota(e,t,i,n,o)):0},i.optionMinQuantity=function(e,t){return e?a.OptionCalculator.getMinQuantity(e.chargeType(),this.calcPersonQuantity(e,t),e.quantity()):0},i.optionQuantity=function(e,t,i){e=this.findEnumerableOption(e,t,i);return e?e.getQuantity():0},i.hasSelectedOptions=function(e){var t=_.some(e.options,function(e){return!e.isInclusive()&&0<e.getQuantity()});return _.some(e.guestStays,function(e){return _.some(e.roomOptions,function(e){return!e.isInclusive()})||_.some(e.mealPlans,function(e){return!e.isInclusive()})})||t},i.extendOrderOptions=function(t,i){function n(e,t){return!!_.find(e,function(e){return e.id()==t.id()})}var o=i.getStayOptions(!0),r=_.find(o,{id:_.head(t.guestStays).roomStay.id});r&&r.bookingOptions&&_.forEach(r.bookingOptions,function(e){n(t.options,e)||t.options.push(new a.EnumerableBookingOption(r.roomStay,e,i))}),_.forEach(t.guestStays,function(t){var e=_.find(o,{id:t.roomStay.id});e&&(_.forEach(e.roomStay.getOptions(),function(e){e.includedInPrepayment()||n(t.roomOptions,e)||t.addOption(e,0)}),_.forEach(e.roomStay.getMealPlans(),function(e){e.includedInPrepayment()||n(t.mealPlans,e)||t.addMealPlan(e,0)}))})},i.isOptionSelected=function(e,i){var t=_.some(e.guestStays,function(e){var t=_.some(e.mealPlans,function(e){return e.getQuantity()&&e.id()==i.option.priceableOption.id()}),e=_.some(e.roomOptions,function(e){return e.getQuantity()&&e.id()==i.option.priceableOption.id()});return t||e}),e=_.some(e.options,function(e){return e.getQuantity()&&e.id()==i.option.priceableOption.id()});return t||e},i.getOptionsQuantity=function(e){var i=new t;return _.forEach(e.options,function(e){e.getQuantity()&&(e=new n(e.id(),e.getQuantity()),i.options.push(e))}),i.options=_.sortBy(i.options,function(e){return e.id}),_.forEach(e.guestStays,function(e){var t=new o;t.id=e.id,_.forEach(e.roomOptions,function(e){e.getQuantity()&&(e=new n(e.id(),e.getQuantity()),t.roomOptions.push(e))}),t.roomOptions=_.sortBy(t.roomOptions,function(e){return e.id}),_.forEach(e.mealPlans,function(e){e.getQuantity()&&(e=new n(e.id(),e.getQuantity()),t.mealPlan.push(e))}),t.mealPlan=_.sortBy(t.mealPlan,function(e){return e.id}),i.guestStays.push(t)}),i},i.getOptionMotivatorIconName=function(e){switch(e){case a.OptionMotivator.Stock:return"stock";case a.OptionMotivator.SalesLeader:return"sales-leader";case a.OptionMotivator.HurryUpBooking:return"hurry-up-booking";case a.OptionMotivator.Family:return"family";case a.OptionMotivator.Friends:return"friends"}},i);function i(){}a.OptionUtil=e}(tl=tl||{}),!function(e){Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currency",{get:function(){return this._currency},set:function(e){this._currency=e},enumerable:!0,configurable:!0});var o=t;function t(e,t){this._amount=e,this._currency=t}e.PriceAmount=o;__extends(r,n=o),Object.defineProperty(r.prototype,"term",{get:function(){return this._term},set:function(e){this._term=e},enumerable:!0,configurable:!0});var n,i=r;function r(e,t,i){e=n.call(this,e,t)||this;return e._term=i,e}e.SchedulePriceAmount=i;e.Discount=function(e,t){this.type=e,this.applicabilityType=t},__extends(s,a=o),Object.defineProperty(s.prototype,"code",{get:function(){return this._code},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"tax",{get:function(){return this._storage?this._storage.getTax(this._code):null},enumerable:!0,configurable:!0});var a,i=s;function s(e,t,i,n){t=a.call(this,t,i)||this;return t._code=e,t._storage=n,t}e.TaxAmount=i;c.empty=function(e){return new c(0,0,[],e)},Object.defineProperty(c.prototype,"currency",{get:function(){return this._priceAfterTax.currency},set:function(e){this._priceAfterTax.currency=e,this._priceBeforeTax.currency=e,this._tax=null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"priceAfterTax",{get:function(){return this._priceAfterTax},set:function(e){this._priceAfterTax.amount=e.amount,this._tax=null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"priceBeforeTax",{get:function(){return this._priceBeforeTax},set:function(e){this._priceBeforeTax.amount=e.amount,this._tax=null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tax",{get:function(){return this._tax||(this._tax=new o(this._priceAfterTax.amount-this._priceBeforeTax.amount,this._priceAfterTax.currency)),this._tax},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"taxes",{get:function(){return this._taxes},set:function(e){this._taxes=e},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this._priceBeforeTax.amount+" "+this._priceAfterTax.amount+" "+this.currency.id};var l=c;function c(e,t,i,n){this._priceAfterTax=new o(t,n),this._priceBeforeTax=new o(e,n),this._taxes=i}e.Price=l;Object.defineProperty(u.prototype,"priceBeforeDiscount",{get:function(){return this._priceBeforeDiscount},set:function(e){this._priceBeforeDiscount=e,this._discountAmountBeforeTax=null,this._discountAmountAfterTax=null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"priceAfterDiscount",{get:function(){return this._priceAfterDiscount},set:function(e){this._priceAfterDiscount=e,this._discountAmountBeforeTax=null,this._discountAmountAfterTax=null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"discountAmountBeforeTax",{get:function(){return this._discountAmountBeforeTax||(this._discountAmountBeforeTax=new o(this._priceAfterDiscount.priceBeforeTax.amount-this._priceBeforeDiscount.priceBeforeTax.amount,this._priceAfterDiscount.priceBeforeTax.currency)),this._discountAmountBeforeTax},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"discountAmountAfterTax",{get:function(){return this._discountAmountAfterTax||(this._discountAmountAfterTax=new o(this._priceAfterDiscount.priceAfterTax.amount-this._priceBeforeDiscount.priceAfterTax.amount,this._priceAfterDiscount.priceAfterTax.currency)),this._discountAmountAfterTax},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"currency",{get:function(){return this.priceBeforeDiscount.currency},set:function(e){this._priceBeforeDiscount.currency=e,this._priceAfterDiscount.currency=e,this._discountAmountBeforeTax=null,this._discountAmountAfterTax=null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"discount",{get:function(){return this._discount},set:function(e){this._discount=e},enumerable:!0,configurable:!0}),u.empty=function(e){return new u(new l(0,0,[],e),new l(0,0,[],e))};i=u;function u(e,t,i){this._priceBeforeDiscount=e,this._priceAfterDiscount=t,this._discountAmountBeforeTax=null,this._discountAmountAfterTax=null,this._discount=i}e.PriceWithDiscount=i}(tl=tl||{}),!function(n){i.isAllowOperation=function(e,t){return e&&t&&e.currency.id==t.currency.id},i.validate=function(e,t){if(!i.isAllowOperation(e,t))throw new Error("Algebraic operations are not available for prices with different currencies. Values: "+e.toString()+", "+t.toString())},i.sum=function(e,t){return i.validate(e,t),new n.PriceAmount(e.amount+t.amount,e.currency)},i.sub=function(e,t){return i.validate(e,t),new n.PriceAmount(e.amount-t.amount,e.currency)},i.mul=function(e,t){return new n.PriceAmount(e.amount*t,e.currency)};var o=i;function i(){}n.PriceAmountCalculator=o;a.isAllowOperation=function(e,t){return e&&t&&e.code==t.code&&e.currency.id==t.currency.id},a.validate=function(e,t){if(!a.isAllowOperation(e,t))throw new Error("Algebraic operations are not available for taxes with different currencies and codes. Values: "+e.toString()+", "+t.toString())},a.sum=function(e,t){return a.validate(e,t),new n.TaxAmount(e.code,e.amount+t.amount,e.currency,e._storage)},a.sumTo=function(e,t){a.validate(e,t),e.amount+=t.amount},a.mul=function(e,t){return new n.TaxAmount(e.code,e.amount*t,e.currency,e._storage)},a.mapSum=function(e,t){var i=[];return _.each((e||[]).concat(t||[]),function(t){var e=_.find(i,function(e){return e.code==t.code});e?a.sumTo(e,t):i.push(a.clone(t))}),i},a.mapMul=function(e,t){return _.map(e,function(e){return a.mul(e,t)})},a.clone=function(e){return new n.TaxAmount(e.code,e.amount,e.currency,e._storage)},a.mapClone=function(e){return e?_.map(e,function(e){return new n.TaxAmount(e.code,e.amount,e.currency,e._storage)}):[]};var r=a;function a(){}n.TaxAmountCalculator=r;l.clone=function(e){return e?new n.Price(e.priceBeforeTax.amount,e.priceAfterTax.amount,r.mapClone(e.taxes),e.currency):null},l.copy=function(e,t){t&&e&&(e.priceAfterTax=t.priceAfterTax,e.priceBeforeTax=t.priceBeforeTax,e.taxes=t.taxes,e.currency=t.currency)},l.isAllowOperation=function(e,t){return e&&t&&e.currency.id==t.currency.id},l.validate=function(e,t){if(!l.isAllowOperation(e,t))throw new Error("Algebraic operations are not available for prices with different currencies. Values: "+e.toString()+", "+t.toString())},l.sumTo=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e.forEach(function(e){t&&e&&(l.validate(e,t),t.priceAfterTax=o.sum(t.priceAfterTax,e.priceAfterTax),t.priceBeforeTax=o.sum(t.priceBeforeTax,e.priceBeforeTax),t.taxes=r.mapSum(t.taxes,e.taxes))})},l.mulTo=function(e,t,i){l.validate(t,e),e.priceAfterTax=o.mul(t.priceAfterTax,i),e.priceBeforeTax=o.mul(t.priceBeforeTax,i),e.taxes=r.mapMul(t.taxes,i)},l.sum=function(e,t){return l.validate(e,t),new n.Price(o.sum(e.priceBeforeTax,t.priceBeforeTax).amount,o.sum(e.priceAfterTax,t.priceAfterTax).amount,r.mapSum(e.taxes,t.taxes),e.currency)},l.sub=function(e,t){return l.validate(e,t),new n.Price(o.sub(e.priceBeforeTax,t.priceBeforeTax).amount,o.sub(e.priceAfterTax,t.priceAfterTax).amount,[],e.currency)},l.mul=function(e,t){return new n.Price(o.mul(e.priceBeforeTax,t).amount,o.mul(e.priceAfterTax,t).amount,r.mapMul(e.taxes,t),e.currency)},l.clean=function(e,t){void 0===t&&(t=null),e&&(e.priceAfterTax=new n.PriceAmount(0,e.priceAfterTax.currency),e.priceBeforeTax=new n.PriceAmount(0,e.priceAfterTax.currency),e.taxes=[],t&&(e.currency=t))},l.equal=function(e,t){return e.currency==t.currency&&(e.priceAfterTax.amount==t.priceAfterTax.amount&&e.priceBeforeTax.amount==t.priceBeforeTax.amount)};var s=l;function l(){}function e(){}n.PriceCalculator=s,e.copy=function(e,t){t&&e&&(e.priceAfterDiscount=t.priceAfterDiscount,e.priceBeforeDiscount=t.priceBeforeDiscount,e.discount=t.discount)},e.clone=function(e){return e?new n.PriceWithDiscount(s.clone(e.priceBeforeDiscount),s.clone(e.priceAfterDiscount),_.cloneDeep(e.discount)):null},e.clean=function(e,t){s.clean(e.priceAfterDiscount,t=void 0===t?null:t),s.clean(e.priceBeforeDiscount,t),e.discount=void 0},e.mulTo=function(e,t,i){e.priceAfterDiscount=s.mul(t.priceAfterDiscount,i),e.priceBeforeDiscount=s.mul(t.priceBeforeDiscount,i)},e.sumTo=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e.forEach(function(e){t&&e&&(t.priceAfterDiscount=s.sum(t.priceAfterDiscount,e.priceAfterDiscount),t.priceBeforeDiscount=s.sum(t.priceBeforeDiscount,e.priceBeforeDiscount),!_.isNull(t.discount)&&(_.isUndefined(t.discount)&&e.discount||t.discount&&e.discount&&t.discount.type==e.discount.type)?t.discount=new n.Discount(e.discount.type,e.discount.applicabilityType):t.discount=null)})},e.subFrom=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e.forEach(function(e){t&&e&&(t.priceAfterDiscount=s.sub(t.priceAfterDiscount,e.priceAfterDiscount),t.priceBeforeDiscount=s.sub(t.priceBeforeDiscount,e.priceBeforeDiscount))})},e.isAllowOperation=function(e,t){return e&&t&&s.isAllowOperation(e.priceBeforeDiscount,t.priceBeforeDiscount)&&s.isAllowOperation(e.priceAfterDiscount,t.priceAfterDiscount)},n.PriceWithDiscountCalculator=e}(tl=tl||{}),!function(o){function e(){}e.getPricesByDate=function(e){var i=[],n=0;return _.forEach(e,function(e){_.forEach(e.rates,function(t){var e=_.find(i,function(e){return t.date.isEqualDate(e.date)});e||(e=new o.GuestPlacementRates(t.date),i.push(e)),e.rates[n]=t.price}),n++}),i},o.PlacementRateCalculator=e}(tl=tl||{}),!function(a){a.IPriceFormatSettings=function(){},s.format=function(e,t,i,n,o,r){r=this._parseFormat(r=r||s.DEFAULT_FORMAT,t,i,e.currency.id),t=r.showAmount?this._wrapHtml(this.formatAmountString(e,r,i,n),"amount"):s.CURRENCY_SIGN,n=r.showCurrency?this._wrapHtml(this.formatCurrencyString(e,r,o),"currency"):"",0!==i.posPre.length&&1<n.length&&r.showAmount&&!r.isCurrencyFullTitle&&(n+=s.THIN_SPACE_SIGN),e=t.replace(s.CURRENCY_SIGN,r.isCurrencyFullTitle?"":n)+(r.isCurrencyFullTitle?" "+n:"");return(e=s._trim(e)).split(s.WHITESPACE_SIGN).join(s.THIN_SPACE_SIGN)},s._parseFormat=function(e,t,i,n){var o=e+","+t.DECIMAL_SEP+","+i.minFrac+","+n;if(s._formatCache[o])return s._formatCache[o];var r=new a.IPriceFormatSettings,e=/%(\d*).?(\d*)d?[sS]?/.exec(e);return r.decimalSeparator=t.DECIMAL_SEP,r.fractionSize=""!=e[2]?Number(e[2]):i.minFrac,r.isCurrencyFullTitle=0<e[0].indexOf("S"),r.showAmount=0<e[0].indexOf("d"),r.showCurrency=r.isCurrencyFullTitle||0<e[0].indexOf("s"),r.trimTrailingZeros=""==e[2],"BYN"==n&&(r.fractionSize=2,r.trimTrailingZeros=!1),s._formatCache[o]=r},s._wrapHtml=function(e,t){return["<",s.WRAP_ELEMENT,' class="',t,'">',e,"</",s.WRAP_ELEMENT,">"].join("")},s._trim=function(e){var t="</"+s.WRAP_ELEMENT+">",i=new RegExp(a.StringUtil.escapeRegEx(s.WHITESPACE_SIGN+t)+"$");return e.replace(i,t)},s.formatAmountString=function(e,t,i,n){n=n(Math.abs(e.amount),t.fractionSize);return t.trimTrailingZeros&&(t=t.decimalSeparator+Array(t.fractionSize+1).join("0"),n=n.replace(t,"")),n=e.amount<0?i.negPre+n+i.negSuf:i.posPre+n+i.posSuf},s.formatCurrencyString=function(e,t,i){t=t.isCurrencyFullTitle?"T:currency.full."+e.currency.id:"T:currency."+e.currency.id;return t=i(t,{amount:e.amount.toFixed()})},s.DEFAULT_FORMAT="%ds",s.CURRENCY_SIGN="¤",s.WHITESPACE_SIGN=" ",s.THIN_SPACE_SIGN=" ",s.WRAP_ELEMENT="span",s._formatCache={};var e=s;function s(){}a.PriceFormat=e}(tl=tl||{}),!function(t){var i=function(e,t){void 0===t&&(t=[]),this.category=e,this.features=t},e=(t.RoomFeatureMap=i,n.getImportantFeatures=function(e){for(var t=[],i=(_.forEach(e,function(e){e.iconPosition&&(t[e.iconPosition-1]=e)}),0),n=0;n<Math.max(t.length,5)&&i<e.length;n++,i++){var o=e[i];o.iconPosition?n--:t[n]?i--:t[n]=o}return _.filter(t,function(e){return!!e})},n.groupByCategory=function(e){return _.map(_.groupBy(e,function(e){return e.category&&e.category.id}),function(e){return new i(_.head(e).category,e)})},n.sortByPriority=function(e){return _.sortBy(e,function(e){e=n.FEATURE_PRIORITY.indexOf(e.kind);return 0<=e?e:Number.MAX_VALUE})},n.getRoomFeatureIcon=function(e){e=n.getRoomFeatureFileName(e);return t.SvgManager.loadIcon(e)},n.getRoomFeatureFileName=function(e){switch(e){case"wifi_internet":case"internet":return"images/features/wifi.4bacc155.svg";case"air_conditioning":case"central_air_conditioning":case"air_conditioning_individually_controlled_in_room":return"images/features/air-conditioner.6031187a.svg";case"single_bed":case"orthopedic_mattress":case"bunk_beds":return"images/features/single.e15c15f5.svg";case"two_double_beds":case"two_full_beds":case"two_single_beds":case"two_single_or_big_double_bed":return"images/features/twin.735ac8f5.svg";case"king_bed":case"queen_bed":case"double_bed":case"full_bed":case"three_double_beds":return"images/features/double.2e40fd90.svg";case"tv":case"two_tv":case"satellite_television":case"cable_television":case"interactive_web_tv":case"home_cinema":case"hbo":case"chinese_channel":return"images/features/tv.401017f0.svg";case"telephone":case"ip_telephone":case"two_line_phone":return"images/features/grandpa-phone.959baba5.svg";case"hairdryer":return"images/features/hairdryer.e0379b4a.svg";case"dvd_player":case"movies":return"images/features/multimedia.589caacb.svg";case"karaoke":case"media_center":return"images/features/karaoke.e6837266.svg";case"alarm_clock":return"images/features/alarm.4cd02b41.svg";case"fan":return"images/features/fan.1fe2c188.svg";case"fan_coil":return"images/features/fan-coil.bba21b78.svg";case"scales":return"images/features/scales.e9773dc7.svg";case"coffee_machine":return"images/features/coffee-machine.54f27a71.svg";case"cooler":case"cooler_on_the_floor":return"images/features/cooler.a829de42.svg";case"microwave":return"images/features/microwave.c2eb7765.svg";case"lamp":case"desk_lamps":return"images/features/lamp.70f6f9f5.svg";case"pc":return"images/features/laptop.2f0aaaa4.svg";case"stove":case"kitchen":return"images/features/kitchen-stove.dda0fd96.svg";case"radio":return"images/features/radio.e23660d5.svg";case"security_system":return"images/features/security-system.3cae1789.svg";case"iron":return"images/features/iron.0013ba08.svg";case"fax":return"images/features/fax.7c41f043.svg";case"refrigerator":return"images/features/refrigerator.11ac7d44.svg";case"electronic_locks":return"images/features/electronic-lock.ea056d63.svg";case"luggage_stand":case"commode":return"images/features/bedside-table.d7ae20cb.svg";case"hangers":return"images/features/hanger.24d8dec0.svg";case"closet_for_clothes":case"wardrobe":case"furniture set":return"images/features/cupboard.562d39ec.svg";case"sofa_bed":case"living_area":case"soft_furniture":return"images/features/sofa.4aa7bc7c.svg";case"journal_table":case"desk":case"cabinet":case"conference_table":return"images/features/desk.fe349d90.svg";case"cosmetic_mirror":case"mirror":return"images/features/mirror.08ba4c7e.svg";case"armchairs":case"exclusive_furniture":case"armchair":return"images/features/armchair.ca385945.svg";case"dinner_table":case"dinner_zone":return"images/features/table.9564fe5b.svg";case"padded_stools":return"images/features/poof.b6901a10.svg";case"chairs":return"images/features/chair.150857f0.svg";case"carpet":case"carpet_covering":return"images/features/carpet.f2f4baa7.svg";case"bathroom":case"bathtub":case"jacuzzi_bathroom":case"aeromassage_bath":case"hydromassage_bath":case"additional_bathroom":case"shared_bathroom":return"images/features/bathroom.db8cc0fe.svg";case"shower_cabin":case"hydromassage_shower":case"shower":return"images/features/shower.1a7072d1.svg";case"bath_towels":case"beach_towels":return"images/features/towel.7f3cb586.svg";case"bathroom_amenities":case"sauna":return"images/features/sauna.991ce1fc.svg";case"bathroom_with_wc":case"additional_bathroom_with_wc":case"bidet":case"toilet":case"toilet_bowl":case"separate_closet":return"images/features/toilet.5951923d.svg";case"hygienic_aids":case"beauty_aids":case"toiletry":return"images/features/cosmetics.cf400bc0.svg";case"slippers":return"images/features/slippers.5e2a9fcb.svg";case"bathrobe":return"images/features/bathrobe.30bab324.svg";case"safe":return"images/features/safe.38f3680b.svg";case"balcony":case"balcony_with_view":case"balcony_with_deck_chairs":case"loggia":case"terrace":return"images/features/balcony.e39254b2.svg";case"ironing_board":case"trouser_press":return"images/features/ironing-board.029beeea.svg";case"daily_press":case"information_card":return"images/features/newspaper.5868512f.svg";case"fireplace":return"images/features/fireplace.e2fbccf6.svg";case"drinking_water":case"mineral_water":return"images/features/bottled-water.f65f3837.svg";case"minibar":case"bar":return"images/features/mini-bar.4fdbf480.svg";case"cookware":case"set_of_dishes":return"images/features/cookware.e4fe21c9.svg";case"maid_service":return"images/features/service.8495c01e.svg";case"writing_utensils":return"images/features/writing-materials.a1208957.svg";case"dishwasher":return"images/features/dishwasher.03b7dacc.svg";case"washing_machine":return"images/features/washer.3399f676.svg";case"kettle":return"images/features/kettle.7ff00b32.svg";case"tea_set":return"images/features/tea-set.3ceac435.svg";case"sink":return"images/features/sink.ebe3d38e.svg";case"heating":return"images/features/heating.c981ecbc.svg";case"water_heater":return"images/features/boiler.01d9315e.svg";case"sea_view":case"city_view":case"river_view":case"garden_view":case"court_view":return"images/features/view.b13e758d.svg";case"two_rooms":case"two_bedrooms":return"images/features/room-2.e0b3aa3b.svg";case"three_rooms":return"images/features/room-3.fd97280f.svg";case"four_rooms":return"images/features/room-4.292f5365.svg";case"tile_covering":return"images/features/tile.424b7cdd.svg";case"bath_or_shower":return"images/features/bath-or-shower.153236fb.svg";case"three_single_beds":return"images/features/three-single-beds.cc9448d3.svg";case"warm_floor":case"hardwood_floors":return"images/features/warm-floor.7d5995b0.svg";case"heater":return"images/features/heater.d888c1c1.svg";case"hypoallergenic_linen":return"images/features/hypoallergenic-linen.cb8bed5f.svg";case"private_room_entrance":return"images/features/private-room-entrance.136fa19d.svg";case"soundproofed_room":return"images/features/soundproofed-room.771d57d2.svg";case"window_to_hotel_atrium":return"images/features/window-to-hotel-atrium.90b439e5.svg";case"window_leaf":return"images/features/window-leaf.801d5691.svg";case"smoking":return"images/features/smoking.e475fcec.svg";case"non_smoking_room":case"no_smoking":return"images/features/no-smoking.b667f4e1.svg";case"two_king_size_beds":return"images/features/two-king-size-beds.11c324cf.svg";case"two_queen_size_beds":return"images/features/two-queen-size-beds.06c0ab43.svg";case"pillows_menu":return"images/features/pillows-menu.56314f4b.svg";case"child_rollaway":return"images/features/child-rollaway.2ea5f926.svg";case"view_race_track":return"images/features/view-race-track.55e78367.svg";case"usb":return"images/features/usb.54ebebbf.svg";case"park_view":return"images/features/park.7d500cf9.svg";case"studio_couch":return"images/features/couch.a97daba3.svg";case"nightstand":return"images/features/nightstand.9dfe1fb4.svg";case"window_screen":return"images/features/mosquito-net.c66611ea.svg";case"glasses":return"images/features/glasses.5a7992a3.svg";case"pool":return"images/features/pool.c787c6d3.svg";case"smart_home_system":return"images/features/smart-house.17298e9a.svg";default:return"images/features/no-icon.e2b637c8.svg"}},n.FEATURE_PRIORITY=["wifi_internet","air_conditioning","single_bed","two_double_beds","two_single_beds","two_full_beds","double_bed","child_rollaway","king_bed","queen_bed","full_bed","safe","two_tv","tv","ip_telephone","telephone","hairdryer","bathroom","additional_bathroom","additional_bathroom_with_wc","bath_or_shower","shower"],n);function n(){}t.RoomFeatureManager=e}(tl=tl||{}),!function(e){var t=function(){this.suit=[],this.other=[]},i=(e.RoomStayFilterOption=t,n.applyRoomTypeCriteria=function(e,n,o){var r=new t;return e.forEach(function(e){var t,i;t=e,((0==(i=o).length||_.some(t.roomStayRatePlans,function(t){return _.some(i,function(e){return e==t.ratePlan.id})}))&&(0==(t=n).length||-1<t.indexOf(e.roomType.id))?r.suit:r.other).push(e)}),r},n.sortRatePlansByPriority=function(e,i,n){return void 0===n&&(n=!1),_.forEach(e,function(e){e.roomStayRatePlans=_.sortBy(e.roomStayRatePlans,function(e){var t=i.indexOf(e.ratePlan.id);return-1==t?e.ratePlan.promo&&n&&!e.hasRestrictedRoomStays()?i.length:Number.MAX_VALUE:t})}),e},n);function n(){}e.RoomStayFilter=i}(tl=tl||{}),!function(l){function e(){}e.uiGuestPlacementsToRoomStayPlacement=function(e){var i=new l.RoomStayPlacement,n=l.BookingFormSettings.getInstance();return _.forEach(e,function(e){var t=null;null!=e.age&&(t=n.childrenAgeGroupByAge(e.age)),e.kind==l.GuestPlacementKind.Adult?i.adults++:e.kind==l.GuestPlacementKind.ExtraAdult?i.adultsExtraBed++:e.kind==l.GuestPlacementKind.ChildBandWithoutBed?i.childrenWithoutBed.push(t):e.kind==l.GuestPlacementKind.ExtraChild?i.childrenExtraBed.push(t):e.kind==l.GuestPlacementKind.Child?i.children.push(t):t||i.adults++}),i},e.getPlacementsFromAppParams=function(e){for(var t=[],i=e.adults&&!0!==e.adults?e.adults.toString().split(","):[],n=e.children&&!0!==e.children?e.children.toString().split(","):[],o=e.childrenAge&&!0!==e.childrenAge?e.childrenAge.toString().split(","):[],r=0;r<_.max([i.length,n.length,o.length]);r++){var a=!_.isEmpty(i[r])&&0<_.parseInt(i[r])?_.parseInt(i[r]):1,s=_.isEmpty(o[r])?0<_.parseInt(n[r])?_.map(new Array(_.parseInt(n[r])),function(){return new l.SearchCriteriaChildPlacement(0)}):[]:_.chain(o[r].split(";")).map(function(e){return _.parseInt(e)}).filter(function(e){return!isNaN(e)}).map(function(e){return new l.SearchCriteriaChildPlacement(e)}).value();t.push(new l.SearchCriteriaPlacement(a,s))}return t},e.guestPlacementsToPlacement=function(e){var i=new l.RoomStayPlacement;return _.forEach(e,function(t){t.kind==l.GuestPlacementKind.Adult?i.adults+=t.adults:t.kind==l.GuestPlacementKind.ExtraAdult&&(i.adultsExtraBed+=t.adults),_.forEach(t.childrenPlacements,function(e){t.kind==l.GuestPlacementKind.ChildBandWithoutBed?i.childrenWithoutBed.push(e):t.kind==l.GuestPlacementKind.ExtraChild||t.kind==l.GuestPlacementKind.ExtraAdult?i.childrenExtraBed.push(e):t.kind!=l.GuestPlacementKind.Child&&t.kind!=l.GuestPlacementKind.Adult||i.children.push(e)})}),i},l.PlacementManager=e}(tl=tl||{}),!function(n){function e(){}e.split=function(e,t){void 0===t&&(t=" ");var i=(e=_.trim(e)).split(t).pop();return{head:e.substring(0,e.lastIndexOf(t)+1),tail:i}},e.capitalize=function(e){return!e.length||4256<=e[0].charCodeAt(0)&&e[0].charCodeAt(0)<=4351?e:e[0].toUpperCase()+e.substr(1)},e.escapeRegEx=function(e){return String(e).replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")},e.copyToClipboard=function(e){var t,i=document.createElement("textarea");i.value=e,i.style.position="absolute",i.style.left="-99999px",document.body.appendChild(i),i.select();try{t=document.execCommand("copy")}catch(e){t=!1}finally{n.HtmlUtil.remove(i)}return t},n.StringUtil=e}(tl=tl||{}),!function(a){function t(){}t.convertToHotelDate=function(e,t){return moment(moment(e).utc().utcOffset(t).format("YYYY-MM-DD HH:mm")).toDate()},t.getHotelDate=function(e){return t.convertToHotelDate(new Date,e)},t.getUserDate=function(){return(new Date).format("YYYY-MM-DD HH:mm:ss Z")},t.makeFullWeeks=function(e,t,i,n,o){var r=a.Locale.getInstance().firstDayOfWeek(),t=(7+t.getDay()-r)%7,i=(6-(i.getDay()-r))%7,r=_.map(new Array(t),function(e,t){return n(t)}).reverse(),t=_.map(new Array(i),function(e,t){return o(t)});return[].concat(r).concat(e).concat(t)},t.sliceDaysArrayByWeeks=function(e){for(var t=[],i=0;i<e.length/7;i++)t.push(e.slice(7*i,7*i+7));return t},t.getWeekDays=function(){for(var e=["su","mo","tu","we","th","fr","sa"],t=0;t<a.Locale.getInstance().firstDayOfWeek();t++)e.push(e.shift());return e},t.getWeekInfoDays=function(t){return _.map(a.DateUtil.getWeekDays(),function(e){return{modifier:a.DateUtil.isWeekend(e)?"-weekend":"",name:t("T:datepicker.week_day."+e)}})},t.isWeekend=function(e){return _.includes(["sa","su"],e)},t.daysInMonth=function(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},t.durationToText=function(e,t){return e.asMinutes()<=1?t.getMessage("T:duration.seconds"):e.asHours()<=1?t.formatMessage("T:duration.minutes",{cnt:Math.ceil(e.asMinutes())}):e.asDays()<=1?t.formatMessage("T:duration.hours",{cnt:Math.ceil(e.asHours())}):t.formatMessage("T:duration.days",{cnt:Math.ceil(e.asDays())})},t.sortPeriodsByProximity=function(e,o){return _.sortBy(e,function(e){var t=e.startDate.getTime(),e=e.endDate&&e.endDate.getTime()||Number.POSITIVE_INFINITY,i=o.startDate.getTime(),n=o.endDate.getTime();return e<i?i-e:t-n})},a.DateUtil=t}(tl=tl||{}),!function(e){function t(){}t.suggest=function(e){e=Mailcheck.suggest(e||"",t.DOMAINS,t.TOP_LEVEL_DOMAINS);return e?e.full:""},t.DOMAINS=["aol.com","bcaoo.com","bigmir.net","bk.ru","bluewin.ch","gmail.com","gmx.net","googlemail.com","hanmail.net","hotmail.com","hotmail.co.uk","hotmail.fr","i.ua","icloud.com","inbox.ru","lenta.ru","list.ru","live.com","live.ru","mac.com","mail.ru","mail.bg","mail.com","mail.ua","meta.ua","msn.com","my.com","myrambler.ru","narod.ru","naver.com","ngs.ru","outlook.com","protonmail.com","qq.com","rambler.ru","ro.ru","sibmail.com","t-online.de","tut.by","ua.fm","ukr.net","web.de","ya.ru","yahoo.com","yahoo.co.id","yahoo.co.jp","yahoo.co.uk","yahoo.de","yahoo.fr","yandex.ru","yandex.by","yandex.com","yandex.ua","ymail.com"],t.TOP_LEVEL_DOMAINS=[],t.REG_EXP=/^(?:[\u00A0-\u03FF\uF900-\uFDCF\uE000-\uFFFF-a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9](?:[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9-]*[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9])?\.)+[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9](?:[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9-]*[\u00A0-\uD7FF\uE000-\uFFFF-a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i,e.EmailUtil=t}(tl=tl||{}),!function(t){function e(){}e.isSuitableRoomCapacity=function(i,e){return 0==e.length||t.BookingFormSettings.getInstance().isManualAccommodationMode()||_.some(e,function(e){var t=_.map(e.children,function(e){return e.age}),t=_.filter(t,function(t){return _.some(i.occupancy.withoutBedsAgeGroups,function(e){return e.inGroup(t)})}).length;return!(e.total()>i.occupancy.total+Math.min(i.occupancy.withoutBeds,t))&&!(e.adults>i.occupancy.maxAdult)})},e.showRoomCapacity=function(e){return e.occupancy&&!t.BookingFormSettings.getInstance().hasFeature(t.Feature.HideRoomCapacity)&&!_.includes([t.RoomTypeUnitKind.PlaceInRoom,t.RoomTypeUnitKind.Service],e.kind)},t.RoomTypeUtil=e}(tl=tl||{}),!function(a){!function(e){function r(){}r.isHotelReservationStatusSuccess=function(e){return e==a.HotelBookingStatus.Pending||e==a.HotelBookingStatus.Confirmed},r.hasNonInclusiveOptions=function(e){return!!e&&(!!e.transfers.length||(!!r.hasNonInclusiveBookingOptions(e)||r.hasNonInclusiveRoomTypeOptions(e)))},r.hasNonInclusiveRoomTypeOptions=function(e){return _.some(e.guestStays,function(e){var t=_.some(e.roomStay.getMealPlans(),function(e){return!e.isInclusive});return _.some(e.roomStay.getOptions(),function(e){return!e.isInclusive})||t})},r.hasNonInclusiveBookingOptions=function(e){return _.some(e.options,function(e){return!e.isInclusive()})},r.hasSelectedNonInclusiveOptions=function(e){return!!e&&(!!r.hasSelectedTransfers(e)||(!!r.hasSelectedNonInclusiveRoomOptions(e)||r.hasSelectedNonInclusiveBookingOptions(e)))},r.hasSelectedTransfers=function(e){return _.some(e.transfers,function(e){return e.isSelected()})},r.hasSelectedNonInclusiveBookingOptions=function(e){return _.some(e.options,function(e){return!e.isInclusive()&&0<e.getQuantity()})},r.hasSelectedNonInclusiveRoomOptions=function(e){return _.some(e.guestStays,function(e){var t=_.some(e.mealPlans,function(e){return!e.isInclusive()&&0<e.getQuantity()}),e=_.some(e.roomOptions,function(e){return!e.isInclusive()&&0<e.getQuantity()});return t||e})},r.findRoomUpgradeOffer=function(e,t){if(!e||!e.guestStays||1!=e.guestStays.length)return null;var n=_.head(e.guestStays);if(n.roomStay.isRoomStayOffer||!n.roomStay.price)return null;if(0<n.placement.totalChildren)return null;if(n.arrival().price()&&0<n.arrival().price().priceAfterTax.amount||n.departure().price()&&0<n.departure().price().priceAfterTax.amount)return null;var o=_.map(a.BookingFormSettings.getInstance().getRoomUpgradeSuggestions(n.roomStay.roomType.id),function(e){return e.targetRoomTypeId}),e=_.filter(t,function(e){e=e.roomStay;if(e.isRoomStayOffer||!e.price||e.price.priceAfterDiscount.priceAfterTax.amount<=n.roomStay.price.priceAfterDiscount.priceAfterTax.amount)return!1;var t=e.price.priceAfterDiscount.priceAfterTax.amount/n.roomStay.price.priceAfterDiscount.priceAfterTax.amount<=1.3,i=_.includes(o,e.roomType.id);if(!i&&!t)return!1;if(e.ratePlan.id!=n.roomStay.ratePlan.id||e.roomType.id==n.roomStay.roomType.id)return!1;if(e.roomType.kind==a.RoomTypeUnitKind.PlaceInRoom)return!1;if(e.roomType.kind==a.RoomTypeUnitKind.Service)return!1;i=a.PlacementManager.guestPlacementsToPlacement(e.guestPlacementOptions);return n.placement.totalAdults==i.totalAdults&&(!(n.placement.adultsExtraBed<i.adultsExtraBed)&&(r._optionsHash(n.roomStay.getOptions())==r._optionsHash(e.getOptions())&&r._optionsHash(n.roomStay.getMealPlans())==r._optionsHash(e.getMealPlans())))});return _.chain(e).sortBy(function(e){e=_.indexOf(o,e.roomStay.roomType.id);return-1===e?1/0:e},function(e){return e.roomStay.price.priceAfterDiscount.priceAfterTax.amount}).head().valueOf()},r._optionsHash=function(e){return _.sortBy(_.map(e,function(e){return[e.code(),e.inclusive(),e.quantity()].join("-")})).join(",")},e.OrderUtil=r}(a.util||(a.util={}))}(tl=tl||{}),!function(t){t.IHandleBlockableEventParams=function(){},i.getAbsoluteHeight=function(e){var t=window.getComputedStyle(e),t=parseFloat(t.marginTop)+parseFloat(t.marginBottom);return Math.ceil(e.offsetHeight+t)},i.fireEvent=function(e,t){var i;return document.createEvent?((i=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),!e.dispatchEvent(i)):(i=document.createEventObject(),e.fireEvent("on"+t,i))},i.fireClick=function(e){e.triggerHandler?e.triggerHandler(t.EventType.Click):e.click?e.click():i.fireEvent(e,t.EventType.Click)},i.transform=function(e,t){e.style.transform=t,e.style.webkitTransform=t},i.toggleClass=function(e,t,i){if(void 0===i&&(i=null),!e)return!1;var n=e.className.split(" ");(i=null==i?-1==n.indexOf(t):i)?-1==n.indexOf(t)&&n.push(t):n=n.filter(function(e){return e!=t}),e.className=n.join(" ")},i.handleBlockableEvent=function(e){for(var t=e.event.target;t.getAttribute("rel")!=e.targetRel;){if(t.getAttribute("rel")==e.blockerRel)return;t=t.parentNode}e.handler&&e.handler(e.event)},i.remove=function(e){e.parentNode.removeChild(e)},i.getThemeColors=function(e){var t,i={},n=window.getComputedStyle(document.documentElement);for(t in e){if(!e.hasOwnProperty(t))return null;var o=n.getPropertyValue(e[t]);if(!o)return null;i[t.toString()]=o.toString()}return i},i.inViewport=function(e,t){var e=e.getBoundingClientRect(),i=AppIntegration.getPosition(),n=(null==t?void 0:t.scrollTop)||i.scrollTop,o=(null==t?void 0:t.scrollLeft)||i.scrollLeft,e={top:n+e.top,left:o+e.left,right:o+e.right,bottom:n+e.bottom},r=n,a=o,o=o+((null==t?void 0:t.clientWidth)||i.screenWidth),n=n+((null==t?void 0:t.clientHeight)||i.screenHeight);return AppIntegration.isAvailable()&&(e.top-=i.scrollTop,e.bottom-=i.scrollTop,e.left-=i.scrollLeft,e.right-=i.scrollLeft),e.bottom>r&&e.top<n&&e.right>a&&e.left<o};var e=i;function i(){}t.HtmlUtil=e}(tl=tl||{}),!function(o){!function(e){function n(){}function t(){}n.scrollTo=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),AppIntegration.scrollTo(e+(t?AppIntegration.getPosition().screenHeight*n.ScrollTopOffset:0),i)},n.ScrollTopOffset=-.25,e.IntegrationUtil=n,t.fireSearchRoomsEvent=function(e,t){AppIntegration.fireEvent(o.AppIntegrationEvent.SearchRooms,{arrivalDate:e.checkInDate.format("YYYY-MM-DD"),departureDate:e.checkOutDate.format("YYYY-MM-DD"),nights:e.nights()+(t==o.StayUnitKind.Night?0:1),promoCode:e.promoCode||"",guests:_.map(e.placements,function(e){return{adults:e.adults,children:_.map(e.children,function(e){return e.age})}}),language:e.language.language(),currency:e.currency.id})},t.fireShowVisitorsOnlineWidgetEvent=function(e){t._isVisitorsOnlineWidgetShown||(t._isVisitorsOnlineWidgetShown=!0,this.fireShowSnackbarEvent({message:e,icon:o.SnackbarIcon.People,closeTimeoutMs:o.SnackbarCloseTimeout.Long,priority:o.SnackbarPriority.Low}))},t.fireHideVisitorsOnlineWidgetEvent=function(){this.fireHideSnackbarEvent()},t.fireShowSnackbarEvent=function(e){var t={show:!0,priority:o.SnackbarPriority.Default,kind:o.AppIntegrationEvent.Snackbar,layout:o.DeviceUtil.isMobile()?o.Layout.Phone:o.Layout.Desktop,theme:o.HtmlUtil.getThemeColors(o.ComponentTheme.SnackBar)};AppIntegration.fireEvent(o.AppIntegrationEvent.Snackbar,_.assignIn(t,e))},t.fireHideSnackbarEvent=function(){AppIntegration.fireEvent(o.AppIntegrationEvent.Snackbar,{show:!1})},t.fireNoAvailableRoomsEvent=function(e){AppIntegration.fireEvent(o.AppIntegrationEvent.NoAvailableRooms,{now:(new Date).moment().format("YYYY-MM-DD"),arrivalDate:e.checkInDate.format("YYYY-MM-DD"),departureDate:e.checkOutDate.format("YYYY-MM-DD"),guests:e.guests(),language:e.language.language(),currency:e.currency.id})},t.fireBookingStepChangedEvent=function(e){AppIntegration.fireEvent(o.AppIntegrationEvent.BookingStepChanged,{step:e})},t.fireCopyToClipboard=function(e,t,i){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.CopyToClipboard,target:e,success:t,text:i})},t.trackType=function(e,t){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.Type,field:e,value:t})},t.trackInteract=function(){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.Interact})},t.trackSelectRoom=function(e){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.SelectRoom,rooms:_.map(e,function(e){return e.roomStay.roomType.name}),ids:_.map(e,function(e){return e.roomStay.roomType.id}),prices:_.map(e,function(e){e=e.getGuestPlacementsPrice()?e.getGuestPlacementsPrice().priceAfterDiscount.priceAfterTax:null;return{amount:e?e.amount:0,currency:e?e.currency.id:""}})})},t.trackUpgradeRoom=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.UpgradeRoom,upgrades:o.IntegrationBuilder.buildRoomUpgrade(e,t)})},t.trackChangeOptions=function(e){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.UpdateOptions,options:o.IntegrationBuilder.buildOptions(e),transfers:o.IntegrationBuilder.buildTransfers(e.transfers)})},t.trackClick=function(e,t){void 0===t&&(t=""),AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.Click,target:e,value:t})},t.trackChangeDates=function(e,t){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.ChangeDates,arrival:e.format("YYYY-MM-DD HH:mm"),departure:t.format("YYYY-MM-DD HH:mm")})},t.trackChangeOrderPrice=function(e){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.ChangeOrderPrice,amount:e?e.amount:0,currency:e?e.currency.id:o.Locale.getInstance().currencyId()})},t.trackSearchRooms=function(n,e){AppIntegration.fireEvent(o.AppIntegrationEvent.TrackUserAction,{action:o.AppIntegration__TrackUserAction__UserAction.SearchRooms,arrival:n.checkInDate.format("YYYY-MM-DD"),departure:n.checkOutDate.format("YYYY-MM-DD"),adults:n.adults(),children:n.children(),language:n.language.language(),rooms:_.chain(e).filter(function(e){return!e.isRoomStayOffer&&!!e.price}).groupBy(function(e){return e.roomType.id}).map(function(e){var t=_.minBy(e,function(e){return e.price.priceAfterDiscount.priceBeforeTax.amount});if(!t)return null;var i=o.PlacementManager.guestPlacementsToPlacement(t.guestPlacementOptions);return{id:e[0].roomType.id,room:e[0].roomType.name,adults:i.totalAdults,children:i.totalChildren,price:t.price.priceAfterDiscount.priceBeforeTax.amount,currency:n.currency.id}}).value()})},t._isVisitorsOnlineWidgetShown=!1,e.IntegrationEvent=t}(o.util||(o.util={}))}(tl=tl||{}),!function(a){function e(){}e.getRoomStartState=function(e,t,i,n,o){var r=a.BookingFormSettings.getInstance(),o=o===a.AppState.PriceList?(n&&(t.roomTypeIds=[n]),new a.State(a.AppState.Start)):r.isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan)?r.isModeTurnedOn(a.BookingFormMode.SharedRoomView)?new a.State(a.AppState.RoomsGuestAccommodation):new a.State(a.AppState.SharedRatePlans):r.isModeTurnedOn(a.BookingFormMode.RoomsSearchCriteriaView)||r.isModeTurnedOn(a.BookingFormMode.CampBookingForm)?new a.State(a.AppState.RoomsSearchCriteria):r.isModeTurnedOn(a.BookingFormMode.CertificateBookingForm)?new a.State(a.AppState.CertificateList):e==a.AccommodationMode.Auto?n?(t.roomTypeIds=[n],new a.State(a.AppState.RoomInfo,{roomId:n})):new a.State(a.AppState.Rooms):e==a.AccommodationMode.Manual?i==a.Layout.Phone?n?(t.roomTypeIds=[n],new a.State(a.AppState.RoomInfo,{roomId:n})):new a.State(a.AppState.Rooms):(t.roomTypeIds=[n],new a.State(a.AppState.Rooms)):new a.State(a.AppState.SearchFilter);return o},a.StateUtil=e}(tl=tl||{}),!function(e){function r(){}r.serialize=function(i,n){return void 0===n&&(n=""),Array.isArray(i)?i.map(function(e,t){return r.serialize(e,n+"["+t+"]")}).join("&"):null!==i&&"object"==typeof i?(o=[],Object.keys(i).forEach(function(e){var t=""==n?e:n+"."+e,e=r.serialize(i[e],t);e&&o.push(e)}),o.join("&")):n+"="+encodeURIComponent(i);var o},r.expandUrlWithQueryParams=function(e,t,i){void 0===i&&(i="&");var n=-1<e.indexOf("?")?"&":"?";return[e,Object.keys(t).map(function(e){return[encodeURIComponent(e),encodeURIComponent(t[e])].join("=")}).join(i)].join(n)},e.UrlUtil=r}(tl=tl||{}),!function(a){!function(e){function t(){}t.addPreference=function(e,t,i,n,o,r){e.push(new a.RoomPreferenceWithRoomType(i,n,o,r)),_.forEach(_.filter(t,function(e){return e.roomStay.roomType.id==i&&e.placementRef==r}),function(e){e.addRoomPreference(n,o)})},t.removePreference=function(e,t,i,n,o){_.remove(e,function(e){return e.roomTypeId==i&&e.preferenceCategoryCode==n&&e.placementRef==o}),_.forEach(_.filter(t,function(e){return e.roomStay.roomType.id==i&&e.placementRef==o}),function(e){e.removeRoomPreference(n)})},e.PreferenceUtil=t}(a.util||(a.util={}))}(tl=tl||{}),!function(e){function t(){}t.hasExtraStay=function(e){if(!_.every(e.guestStays,function(e){return e.arrivalExtraStay.standardTime&&e.departureExtraStay.standardTime}))return!1;var t=_.some(e.guestStays,function(e){return e.arrivalExtraStay.options.length}),e=_.some(e.guestStays,function(e){return e.departureExtraStay.options.length});return t||e},t.hasGuestStayExtraStay=function(e){return 1<e.arrivalExtraStay.options.length||1<e.departureExtraStay.options.length},e.ExtraStayUtil=t}(tl=tl||{}),!function(n){function e(){}e.show=function(e,i,t){e.serviceTransport.visitorsOnline(t).catch(function(){return 0}).then(function(e){var t=e||(e=4,t=10,Math.floor(Math.random()*(t-e+1))+e),e=i.formatMessage("T:visitors_online_widget.message",{number:t});n.util.IntegrationEvent.fireShowVisitorsOnlineWidgetEvent(e)})},n.VisitorsOnlineWidgetUtil=e}(tl=tl||{}),!function(a){!function(e){function r(){}r.fireRoomsIsAvailableImpl=function(e,t){var e=e?"rooms-available":"no-rooms",i=(new Date).moment().format("YYYY-MM-DD"),n=t.checkInDate.format("YYYY-MM-DD"),o=t.checkOutDate.format("YYYY-MM-DD"),i=[e,t.providerId+", "+i+", "+t.guests()+", "+n+" - "+o].join("-");r._roomsIsAvailableCache[i]||(r._roomsIsAvailableCache[i]=!0,a.TrackerService.trackAnalysis({Type:e,ProviderId:t.providerId,BookingStartDate:n,BookingEndDate:o,IsPromoCodeApplied:!!t.promoCode}))},r.fireRoomsSuccess=function(e){try{a.TrackerService.trackAnalysis({Type:"rooms-available-success",ProviderId:e.providerId,BookingStartDate:e.arrivalDate,BookingEndDate:e.departureDate})}catch(e){}},r.fireRoomsIsAvailable=function(e){try{r.fireRoomsIsAvailableImpl(!0,e)}catch(e){}},r.fireRoomsNotAvailable=function(e){try{r.fireRoomsIsAvailableImpl(!1,e)}catch(e){}},r.appendSearchParams=function(e,t,i){return t&&(e=_.assignIn(e,{arrival:t.checkInDate.format("YYYY-MM-DD"),departure:t.checkOutDate.format("YYYY-MM-DD"),nights:t.stayDuration(a.BookingFormSettings.getInstance().stayUnitKind).value,adults:t.adults(),children:t.children(),hasPromoCode:!!t.promoCode,placements:_.map(t.placements,function(e){return{adults:e.adults,children:e.children&&e.children.length||0,childrenAge:_.map(e.children,function(e){return e.age})}})})),i&&(t=_.filter(i,function(e){return!e.isRoomStayOffer&&e.price}),e=_.assignIn(e,{foundRoomsCount:_.size(_.groupBy(t,function(e){return e.roomType.id})),foundRatesCount:_.size(_.groupBy(t,function(e){return e.ratePlan.id})),accommodationMode:a.BookingFormSettings.getInstance().accommodationMode})),e},r.appendOrderParams=function(e,t){var i=t.totalPrice();return e=_.assignIn(e,{arrival:t.stayDates.startDate.format("YYYY-MM-DD"),departure:t.stayDates.endDate.format("YYYY-MM-DD"),nights:t.stayDates.duration().value,priceAfterTax:i.priceAfterTax.amount,priceBeforeTax:i.priceBeforeTax.amount,currency:i.currency.id,providerCurrency:t.provider.currency.id,hasPromoCode:!!t.promoCode,guests:t.totalGuests(),rooms:t.guestStays.length,transfers:_.reduce(t.transfers,function(e,t){return e+(t.getQuantity()||0)},0),services:_.reduce(t.guestStays,function(t,e){return _.forEach([e.roomOptions,e.mealPlans],function(e){_.forEach(e,function(e){t+=e.isInclusive()?0:e.getQuantity()})}),t},0),placements:_.map(t.guestStays,function(e){return{adults:e.placement.totalAdults,children:e.placement.totalChildren}})})},r.getBookingFormMode=function(){var e=a.BookingFormSettings.getInstance();return e.isCertificatesBookingForm()?a.tracker.BookingFormMode.Certificates:e.isServicesBookingForm()?a.tracker.BookingFormMode.Services:e.isCampBookingForm()?a.tracker.BookingFormMode.Camp:e.isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan)?e.isModeTurnedOn(a.BookingFormMode.SharedRoomView)?a.tracker.BookingFormMode.Resort:a.tracker.BookingFormMode.Sanatorium:a.tracker.BookingFormMode.Hotel},r._roomsIsAvailableCache={},e.TrackerEvent=r}(a.util||(a.util={}))}(tl=tl||{}),!function(t){function i(){}i.getFlagIcon=function(e){e=i.getFlagFileName(e);return t.SvgManager.loadIcon(e)},i.getFlagFileName=function(e){switch(e){case"RUS":return"images/flags/ru.a91c994c.svg";case"GBR":return"images/flags/gb.9da7bd05.svg";case"USA":return"images/flags/us.f27b8d2c.svg";case"FRA":return"images/flags/fr.798947d3.svg";case"DEU":return"images/flags/de.a98227b1.svg";case"CHN":return"images/flags/cn.42644ed0.svg";case"ITA":return"images/flags/it.8263a0e9.svg";case"ESP":return"images/flags/es.d181ec12.svg";case"POL":return"images/flags/pl.04d0161d.svg";case"UKR":return"images/flags/ua.afd77f68.svg";case"KAZ":return"images/flags/kz.00ee696c.svg";case"GEO":return"images/flags/ge.1d55134c.svg";case"CZE":return"images/flags/cz.d6704e2e.svg";case"FIN":return"images/flags/fi.6c5722ed.svg";case"SWE":return"images/flags/se.9bcfe76b.svg";case"LVA":return"images/flags/lv.264c0f64.svg";case"BGR":return"images/flags/bg.5d1eaff8.svg";case"JPN":return"images/flags/jp.aff17ea0.svg";case"NLD":return"images/flags/nl.fe192491.svg";case"AUS":return"images/flags/au.b4e3de95.svg";case"IND":return"images/flags/in.fa2c3baf.svg";case"BEL":return"images/flags/be.df929af8.svg";case"AUT":return"images/flags/at.b52d851f.svg";case"CHE":return"images/flags/ch.92652c5b.svg";case"ROU":return"images/flags/ro.bdda034f.svg";case"MEX":return"images/flags/mx.853dfdf0.svg";case"SVK":return"images/flags/sk.cd0818ac.svg";case"CAN":return"images/flags/ca.b6023f89.svg";case"NOR":return"images/flags/no.ef7ce23c.svg";case"HUN":return"images/flags/hu.5010e68d.svg";case"PRT":return"images/flags/pt.a9acef55.svg";case"DNK":return"images/flags/dk.ab13cace.svg";case"IRL":return"images/flags/ie.5c341368.svg";case"SAU":return"images/flags/sa.2ceeeb4c.svg";case"GRC":return"images/flags/gr.aa2591df.svg";case"IDN":return"images/flags/id.00794ce1.svg";case"SVN":return"images/flags/si.91a7f60e.svg";case"NZL":return"images/flags/nz.48468757.svg";case"TUR":return"images/flags/tr.c0fc585e.svg";case"PHL":return"images/flags/ph.2d4e4a92.svg";case"CYP":return"images/flags/cy.cc99406f.svg";case"HRV":return"images/flags/hr.b86d40c6.svg";case"SGP":return"images/flags/sv.svg";case"MYS":return"images/flags/my.959575ad.svg";case"LBN":return"images/flags/lb.e0a2e8a2.svg";default:return""}},t.FlagManager=i}(tl=tl||{}),!function(e){function o(){}o.loadIcon=function(e){var t,i,n;if(e)return o._iconFileNameMap[e]||(t=e.match(/\/([^\/.]+)(\.[^.]+)?\.svg/)[1],i="icon-"+t,o._iconFileNameMap[e]="#"+t,document.getElementById(i)||((n=new XMLHttpRequest).open("GET",e,!0),n.onreadystatechange=function(){var e;4==n.readyState&&200==n.status&&((e=document.createElement("div")).setAttribute("id",i),e.style.display="none",e.innerHTML=n.responseText,document.body.appendChild(e))},n.send(null))),o._iconFileNameMap[e]},o._iconFileNameMap={},e.SvgManager=o}(tl=tl||{}),!function(e){function t(){}t.getCookieByName=function(e){e=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},e.CookieUtil=t}(tl=tl||{}),!function(e){function t(){}t.isMobile=function(){try{return"mobile"==t.getParser().getDevice().type}catch(e){return!1}},t.getPlatform=function(){try{return t.getParser().getDevice()}catch(e){return null}},t.getBrowser=function(){try{return t.getParser().getBrowser()}catch(e){return null}},t.getOS=function(){try{return t.getParser().getOS()}catch(e){return null}},t.getParser=function(){return t._parser||(t._parser=window.UAParser?new UAParser:null)},e.DeviceUtil=t}(tl=tl||{}),!function(n){function o(){}o.getParam=function(t){try{return localStorage.getItem(t)}catch(e){return n.CookieUtil.getCookieByName(t)}},o.setParam=function(e,t){try{localStorage.setItem(e,t)}catch(e){}},o.removeParam=function(e){try{localStorage.removeItem(e)}catch(e){}},o.getGpToken=function(e){var t=o.getCrmCampaignKey(e);if(t)return o.getGpTokenByCrmCampaignKey(t,e)},o.setGpToken=function(e,t){e=o.getCrmCampaignKey(e);if(e)return o.setGpTokenByCrmCampaignKey(e,t)},o.removeGpToken=function(e){e=o.getCrmCampaignKey(e);e&&o.removeGpTokenByCrmCampaignKey(e)},o.setGpTokenByCrmCampaignKey=function(e,t){e=o.getGpTokenStorageKey(e);o.setParam(e,t)},o.removeGpTokenByCrmCampaignKey=function(e){e=o.getGpTokenStorageKey(e);o.removeParam(e)},o.getGpTokenByCrmCampaignKey=function(e,t){var e=o.getGpTokenStorageKey(e),i=o.getParam(e);if(i)return i;i=""+n.GuestProfileParam.TokenPrefix+t,t=o.getParam(i);return t&&(o.removeParam(i),o.setParam(e,t)),t||void 0},o.getGpTokenStorageKey=function(e){return""+n.GuestProfileParam.TokenPrefix+e},o.getCrmCampaignKey=function(e){e=o.getParam(""+n.GuestProfileParam.CrmCampaignKeyPrefix+e);return e||void 0},o.setCrmCampaignKey=function(e,t){o.setParam(""+n.GuestProfileParam.CrmCampaignKeyPrefix+e,t)},Object.defineProperty(o,"gpAuthCode",{get:function(){return o.getParam(n.GuestProfileParam.AuthCode)},enumerable:!0,configurable:!0}),Object.defineProperty(o,"authServiceKind",{get:function(){return o.getParam(n.GuestProfileParam.AuthService)},enumerable:!0,configurable:!0}),Object.defineProperty(o,"expiresAt",{get:function(){return o.getParam(n.GuestProfileParam.ExpiresAt)},enumerable:!0,configurable:!0}),o.isUserAuthenticated=function(e){return!!o.getGpToken(e)},o.isAuthCodeExpired=function(){return!!o.expiresAt&&o.hasExpirationDateArrived(new Date(o.expiresAt))},o.hasExpirationDateArrived=function(e){var t=(new Date).toISOString();return e.toISOString()<t},o.clearStorage=function(e){o.removeGpToken(e),o.clearConfirmationStageValues()},o.clearConfirmationStageValues=function(){o.removeParam(n.GuestProfileParam.AuthCode),o.removeParam(n.GuestProfileParam.AuthService),o.removeParam(n.GuestProfileParam.ExpiresAt),o.removeParam(n.GuestProfileParam.AuthFlowKind)},n.GuestProfileUtil=o}(tl=tl||{}),!function(e){(t=e.QueueType||(e.QueueType={}))[t.YandexSchedule=0]="YandexSchedule",t[t.GuestStaysOfferAvailability=1]="GuestStaysOfferAvailability",i.getInstance=function(e){return i._instance[e]||(i._instance[e]=new i(e)),i._instance[e]},i.prototype.push=function(e,t,i,n){var o=this,e=(this.$q=e,this.action=i,this.size=n,this.$q.defer());return this.queue.push({params:t,defer:e}),setTimeout(function(){return o.process()}),e.promise},i.prototype.process=function(){var e,i=this;!this.processed&&this.queue.length&&(this.processed=!0,e=_.take(this.queue,this.size),_.each(e,function(t){i.action(t.params).then(function(e){t.defer.resolve(e)})}),this.$q.all(_.map(e,function(e){return e.defer.promise})).finally(function(){i.queue.splice(0,i.size),i.processed=!1,i.process()}))},i._instance=[];var t=i;function i(e){if(this.size=1,this.queue=[],this.processed=!1,i._instance[e])throw new Error("Error: Instantiation failed: Use QueueManager.getInstance(queueType) instead of new.");i._instance[e]=this}e.QueueManager=t}(tl=tl||{}),!function(n){function i(){}i.getPromotions=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _.filter(n.BookingFormSettings.getInstance().promotions,function(e){return _.includes(t,e.discountType)})},i.getMostValuablePromotion=function(e){return e.length?_.maxBy(e,function(e){return e.discountValue}):void 0},i.getPromotionsForPeriod=function(e,t){return _.filter(e,function(e){return i.isPromotionApplicableForPeriod(e,t)})},i.getMostValuablePromotionForPeriod=function(e,t){return i.getMostValuablePromotion(i.getPromotionsForPeriod(e,t))},i.isPromotionApplicableForRoomTypes=function(e,t){return 0===e.roomTypes.length||0===t.length||0!==_.intersection(t,e.roomTypes).length},i.isPromotionApplicableForRatePlans=function(e,t){return 0===e.ratePlans.length||0===t.length||0!==_.intersection(t,e.ratePlans).length},i.isPromotionApplicableForPeriod=function(e,t){return _.some(e.stayPeriods,function(e){return t.endDate>=e.startDate&&(null===e.endDate||t.startDate<=e.endDate)})},i.isPromotionAppliedForPartialPeriod=function(e,i){return _.some(e.stayPeriods,function(e){var t=e.startDate>i.startDate&&null!==e.endDate&&e.endDate>=i.endDate,e=e.startDate<=i.startDate&&null!==e.endDate&&e.endDate<i.endDate;return t||e})},i.getNearestValidStayPeriods=function(e,t,i){e=n.DateUtil.sortPeriodsByProximity(e,t);return _.chain(e).take(i).sortBy(function(e){return e.startDate.getTime()}).value()},n.PromotionUtil=i}(tl=tl||{}),!function(l){var e,i,n,o,r,a,s,c,u;function t(){var e=null!==i&&i.apply(this,arguments)||this;return e.elementsCount=10,e.roomsAvailabilities=[],e.availabilityDates=[],e.slideDirection={left:n.AvailabilityCalendarInformerMessageType.SlideLeft,right:n.AvailabilityCalendarInformerMessageType.SlideRight},e.slideButtonState={prev:!1,next:!1},e.activateSliderNextButton={callback:function(){e.slideButtonState.next=!0,e.$scope.$applyAsync()}},e.deactivateSliderNextButton={callback:function(){e.slideButtonState.next=!1,e.$scope.$applyAsync()}},e.activateSliderPrevButton={callback:function(){e.slideButtonState.prev=!0,e.$scope.$applyAsync()}},e.deactivateSliderPrevButton={callback:function(){e.slideButtonState.prev=!1,e.$scope.$applyAsync()}},e.updateAvailabilityCalendarSettings={callback:function(e){}},e}function d(e,t,i){this.date=e,this.customCssClass=t,this.leftPosition=i}function p(e,t,i,n,o){this.isLoaded=!1,this._checkAvailabilityAction=e,this.date=t,this.roomType=i,this.customCssClass=n,this.leftPosition=o,this.isAvailable=null,this.guests=null,this.price=l.Price.empty(l.Locale.getInstance().currency()),this._currency=l.Locale.getInstance().currency();e={callback:_.bind(this.onCurrencyChange,this)};l.CurrencyInformer.getInstance().subscribe(e)}function m(){}e=l.directive||(l.directive={}),n=e.helper||(e.helper={}),o=function(e,t){this.checkInDate=e,this.checkOutDate=t,this.opened=!1},n.AvailabilityCalendarData=o,i=l.BookingController,__extends(t,i),t.prototype.init=function(){i.prototype.init.call(this);var e=this.bookingService.getSearchCriteria(),t=l.BookingFormSettings.getInstance();this.calendarData=new o(e.checkInDate.clone(),e.checkOutDate.clone()),this.calendarAvailablePeriod=n.CalendarHelper.availablePeriod(t,this.bookingService.getProvider())},t.prototype.onSelectDates=function(e,t){var i=this.bookingService.getSearchCriteria(),n=l.BookingFormSettings.getInstance(),e=(i.checkInDate=e,i.checkOutDate=t,l.StateUtil.getRoomStartState(n.accommodationMode,i,this.layout.phone?l.Layout.Phone:l.Layout.Desktop,this.calendarData.roomTypeId,this.$state.current.name));this.bookingService.setSearchCriteria(i),this.orderService.cleanOrder(),l.TrackerService.track("select-availability-calendar-date"),this.$state.go(e.name,e.params,{reload:!0})},t.prototype.availabilityChoiceAction=function(e,t){t.isAvailable&&(this.calendarData.element=e.currentTarget,this.calendarData.roomTypeId=t.roomType.id,this.calendarData.minLos=t.minLos,this.calendarData.checkInDate=t.date,this.calendarData.checkOutDate=t.date.addDays(t.minLos.value+(t.minLos.kind==l.StayUnitKind.Night?0:-1)),l.BookingFormSettings.getInstance().stayUnitKind==l.StayUnitKind.Night?this.calendarAvailablePeriod.checkOut.startDate=t.date.addDays(1):this.calendarAvailablePeriod.checkOut.startDate=t.date,this.calendarData.opened=!0)},t.prototype.checkRoomTypeAvailability=function(t,i,e){var n=this,o=(e=(e=void 0===e?null:e)||l.Locale.getInstance().currency(),this.bookingService.getSearchCriteria()),r=this.serviceFactory.bookingService.getRatePlans();return{calendarSettings:l.AvailabilityCalendarService.getAvailabilityCalendarSettings(),availability:this.availabilityCalendarService.getRoomTypeAvailabilityGroup(new l.RoomTypeAvailabilityCriterion(t,o.providerId,e),i),rules:this.$q.all(_.map(r,function(e){return n.bookingRuleService.getRatePlanBookingRule(t,e,i,o.promoCode)})).catch(function(){return[]})}},t.prototype.initLazyLoad=function(){function r(){a.elementsCount+=10,a.$scope.$applyAsync()}var a=this;setTimeout(function(){var e,t,i,n,o=document.querySelector('[rel="availability-wrapper"]');!o||(e=o.querySelector('[rel="availability-loader"]'))&&(a.layout.desktop?(t=setInterval(function(){e.offsetParent?l.HtmlUtil.inViewport(e)&&r():clearInterval(t)},500),a.$scope.$on("$destroy",function(){clearInterval(t)})):((i=o.querySelector('[rel="availability-content"]')).scrollHeight===i.clientHeight&&r(),n=_.throttle(function(){e.offsetParent&&l.HtmlUtil.inViewport(e,i)&&r()},500),angular.element(i).bind("scroll",n),a.$scope.$on("$destroy",function(){angular.element(i).unbind("scroll",n)})))},500)},t.prototype.applyMobileMode=function(){var o=this,r=setInterval(function(){var e,t,i=document.querySelector('[rel="availability-wrapper"]'),n=AppIntegration.getPosition().screenHeight;i?i.clientHeight>n&&((e=i.querySelector('[rel="availability-content"]')).style.maxHeight=n-(i.clientHeight-e.clientHeight)+"px",l.HtmlUtil.toggleClass(i,"-scroll"),t=_.throttle(function(){l.HtmlUtil.toggleClass(i,"-scroll-end",e.scrollHeight==e.clientHeight+e.scrollTop)},100),angular.element(e).bind("scroll",t),o.$scope.$on("$destroy",function(){angular.element(e).unbind("scroll",t)}),clearInterval(r)):clearInterval(r)},100)},t.prototype.getRoomsAvailabilitiesAction=function(e){return this.roomsAvailabilities[e].roomAvailabilities},t.prototype.getDateAvailabilitiesAction=function(){return this.availabilityDates},t.prototype.buildRoomsAvailabilities=function(){var i=this;this.roomsAvailabilities=_.map(this.bookingService.getRoomTypes(),function(t){var e=u.getDatePriceSliderElements(i.availabilityCalendarSettings,t,i.checkRoomTypeAvailability,null==(e=_.find(i.roomsAvailabilities,function(e){return e.roomType.id===t.id}))?void 0:e.roomAvailabilities);return new r(i.availabilityCalendarSettings.checkInDate,t,e)})},t.prototype.buildDateAvailability=function(){var e=u.getDateSliderElements(this.availabilityCalendarSettings);this.availabilityDates=this.availabilityDates.length?_.sortBy(_.uniqBy(__spreadArrays(this.availabilityDates,e),function(e){return e.date.getTime()}),function(e){return e.date.getTime()}):e},t.prototype.slide=function(e){var t=this;this.availabilityCalendarSettings.startDate=u.getStartDateByDirection(this.availabilityCalendarSettings,e),this.buildDateAvailability(),this.buildRoomsAvailabilities(),this.$timeout(function(){return t.sliderInformer.notify(e)})},t.prototype.subscribeSliderEvents=function(){var t=this;this.updateAvailabilityCalendarSettings.callback=function(e){t.availabilityCalendarSettings&&(e.count&&(t.availabilityCalendarSettings.rendererDatesCount=e.count+1),e.date&&(t.availabilityCalendarSettings.startDate=u.getStartDate(t.availabilityCalendarSettings,e.date.resetTime())))},this.sliderInformer.subscribe(this.activateSliderNextButton,n.AvailabilityCalendarInformerMessageType.ActivateSliderNextButton),this.sliderInformer.subscribe(this.deactivateSliderNextButton,n.AvailabilityCalendarInformerMessageType.DeactivateSliderNextButton),this.sliderInformer.subscribe(this.activateSliderPrevButton,n.AvailabilityCalendarInformerMessageType.ActivateSliderPrevButton),this.sliderInformer.subscribe(this.deactivateSliderPrevButton,n.AvailabilityCalendarInformerMessageType.DeactivateSliderPrevButton),this.sliderInformer.subscribe(this.updateAvailabilityCalendarSettings,n.AvailabilityCalendarInformerMessageType.UpdateSliderState)},t.prototype.unsubscribeSliderEvents=function(){this.sliderInformer.unsubscribe(this.activateSliderNextButton,n.AvailabilityCalendarInformerMessageType.ActivateSliderNextButton),this.sliderInformer.unsubscribe(this.deactivateSliderNextButton,n.AvailabilityCalendarInformerMessageType.DeactivateSliderNextButton),this.sliderInformer.unsubscribe(this.activateSliderPrevButton,n.AvailabilityCalendarInformerMessageType.ActivateSliderPrevButton),this.sliderInformer.unsubscribe(this.deactivateSliderPrevButton,n.AvailabilityCalendarInformerMessageType.DeactivateSliderPrevButton),this.sliderInformer.unsubscribe(this.updateAvailabilityCalendarSettings,n.AvailabilityCalendarInformerMessageType.UpdateSliderState)},e=t,n.PageWithAvailabilityCalendarController=e,r=function(t,e,i){this.roomAvailabilities=[],this.roomType=e,this.roomAvailabilities=i,this.selectedRoomAvailability=_.find(this.roomAvailabilities,function(e){return e.date.isEqualDate(t)})},n.RoomAvailabilities=r,d.prototype.show=function(){},a=d,n.DateSliderElement=a,s=function(){},n.PeriodPrice=s,p.prototype.onCurrencyChange=function(e){if(this._currency=e.to,this.isLoaded)return this.isAvailable=null,this.loadAvailabilityData()},p.prototype.loadAvailabilityData=function(){var a=this,n=this._checkAvailabilityAction(this.date,this.roomType,this._currency),s=l.BookingFormSettings.getInstance().stayUnitKind;return n.availability.then(function(e){var o=null,r=null;_.each(e.availabilities,function(e){var t,i,n;e.isAvailable&&(t=_.find(e.pricing,function(e){return e.date.isEqualDate(a.date)}),i=o&&_.find(o.pricing,function(e){return e.date.isEqualDate(a.date)}),n=new l.StayDuration(s,e.endDate.diffInDays(e.startDate)+(s==l.StayUnitKind.Night?0:1)),(!o||t.price.priceAfterTax.amount<i.price.priceAfterTax.amount)&&(o=e),(!r||n.value<r.value)&&(r=n))}),n.rules.then(function(e){var t,e=_.filter(e,function(e){return!e.forbidden&&_.includes(e.roomTypes,a.roomType.id)}),i=_.min(_.map(e,function(e){return e.minLos})),i=r&&1<r.value?r:new l.StayDuration(s,i||1);o&&o.isAvailable?(a.isAvailable=!0,a.guests=o.guests,a.minLos=i,t=_.find(o.pricing,function(e){return e.date.isEqualDate(a.date)}),l.PriceCalculator.copy(a.price,(t||o).price)):(a.isAvailable=0<e.length&&i.value>n.calendarSettings.maxNights,a.guests=null,a.minLos=i,l.PriceCalculator.clean(a.price))})})},p.prototype.show=function(){this.isLoaded||(this.loadAvailabilityData(),this.isLoaded=!0)},c=p,n.DatePriceSliderElement=c,m.getSliderElementCustomCssClass=function(e,t){var i="";return t.isEqualDate(e.checkInDate)?i="_type_period-start":t.isEqualDate(e.checkOutDate)?i="_type_period-end":t>=e.checkInDate&&t<=e.checkOutDate&&(i="_type_selected-period"),i},m.initAvailabilityCalendarSettings=function(e,t){var i=l.BookingFormSettings.getInstance(),n=i.stayStoreAvailabilityCalendarSettings,i=i.availabilityCalendarSettings,n=n&&n.isAvailable?n:i,o=e>=n.startDate&&e<=n.endDate,r=this.getSliderWidth(n.startDate,n.endDate);return new l.RoomTypeAvailabilityCalendarSettings(i.isAvailable&&o,e,t,n.startDate,n.endDate,n.maxNights,null,r)},m.getStartDateByDirection=function(e,t,i){i=(i=void 0===i?e.startDate:i).addDays(t===n.AvailabilityCalendarInformerMessageType.SlideRight?e.rendererDatesCount:-e.rendererDatesCount);return this.getStartDate(e,i)},m.getStartDate=function(e,t){t=(t=void 0===t?e.startDate:t).clone();return t=(t=t.addDays(e.rendererDatesCount)>e.maxDate?e.maxDate.addDays(-e.rendererDatesCount):t)<e.minDate?e.minDate:t},m.getEndDate=function(e,t,i){e=e.addDays(t);return e=i<e?i:e},m.getSliderWidth=function(e,t){return(t.diffInDays(e)+1)*this.sliderElementWidth},m.getSlideLeftPosition=function(e,t){return e.diffInDays(t)*this.sliderElementWidth},m.getDateSliderElements=function(t){var e=this.getStartDate(t);return _.map(this.getDaysInRange(e,this.getEndDate(e,t.rendererDatesCount,t.maxDate)),function(e){return new a(e.clone(),m.getSliderElementCustomCssClass(t,e),m.getSlideLeftPosition(e,t.minDate))})},m.getDatePriceSliderElements=function(t,i,n,e){var o=this,r=this.getStartDate(t),r=_.map(this.getDaysInRange(r,this.getEndDate(r,t.rendererDatesCount,t.maxDate)),function(e){return new c(n,e,i,m.getSliderElementCustomCssClass(t,e),o.getSlideLeftPosition(e,t.minDate))});return e?_.sortBy(_.uniqBy(__spreadArrays(e,r),function(e){return e.date.getTime()}),function(e){return e.date.getTime()}):r},m.findRoomTypeMinPrice=function(e,t){var i=new s;return _.each(e,function(e){e.roomTypeId==t.id&&e.isAvailable&&(!i.price||i.price.priceAfterTax.amount>e.price.priceAfterTax.amount)&&(i.price=e.price,i.datePeriod=new l.DatePeriod(e.startDate,e.endDate))}),i.price?i:null},m.getPeriodPriceDescriptionMessage=function(e,t){var i,n,o="";return e&&e.datePeriod&&(e=e.datePeriod,n=l.BookingFormSettings.getInstance().stayUnitKind,i=e.endDate.diffInDays(e.startDate),n==l.StayUnitKind.Day&&i++,n=new l.StayDuration(n,i),o=t.formatMessage(1==i?"T:rooms.date_price":"T:rooms.period_price",{nights:n,startDate:e.startDate,endDate:e.endDate})),o},m.getDaysInRange=function(t,e){return _.times(e.diffInDays(t)+1,function(e){return t.addDays(e)})},m.sliderElementWidth=80,u=m,n.AvailabilityCalendarHelper=u}(tl=tl||{}),!function(r){var e;(function(e){function t(){}t.SlideLeft="SlideLeft",t.SlideRight="SlideRight",t.SlideTo="SlideTo",t.ActivateSliderNextButton="ActivateSliderNextButton",t.DeactivateSliderNextButton="DeactivateSliderNextButton",t.ActivateSliderPrevButton="ActivateSliderPrevButton",t.DeactivateSliderPrevButton="DeactivateSliderPrevButton",t.UpdateSliderState="UpdateSliderState",e.AvailabilityCalendarInformerMessageType=t;n=r.Informer,__extends(o,n),o.getInstance=function(){return o._instance=null===o._instance?new o:o._instance},o.prototype.subscribe=function(e,t,i){return n.prototype.subscribe.call(this,e,this.toHash(t,i))},o.prototype.notify=function(e,t,i){n.prototype.notify.call(this,this.toHash(e,t),i)},o.prototype.unsubscribe=function(e,t,i){n.prototype.unsubscribe.call(this,e,this.toHash(t,i))},o.prototype.toHash=function(e,t){return t?[e,t].join("-"):e.toString()},o._instance=null;var n,i=o;function o(){var e;if(o._instance)throw new Error("Error: Instantiation failed: Use Locale.getInstance() instead of new.");return e=n.call(this)||this,o._instance=e}e.AvailabilityCalendarInformer=i})((e=r.directive||(r.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(i){var e;(function(t){function e(e,t,i,n,o){this.date=null,this.viewportCapacity=null,this.viewport=e,this.slider=t,this.getItems=i,this.isPrevButtonDisabled=!1,this.isNextButtonDisabled=!1,this.settings=n,this.$q=o}e.prototype.slideAt=function(e){var t=this.date.addDays(e*this.getViewportCapacity());t<this.settings.minDate&&(t=this.settings.minDate);var i=(i=this.getElement(t))||(-1==e?_.head(this.slider.children):_.last(this.slider.children));this.slide(i,t)},e.prototype.slideTo=function(e){function t(){o&&i.slide(o,e),n.resolve()}var i=this,n=this.$q.defer(),o=this.getElement(e);return o?t():setTimeout(function(){o=i.getElement(e),t()}),n.promise},e.prototype.update=function(){this.viewportCapacity=null,this.slide(this.getElement(this.date),this.date,!0)},e.prototype.getViewportCapacity=function(){var e;return null===this.viewportCapacity&&(e=parseFloat(window.getComputedStyle(this.viewport).width),this.viewportCapacity=Math.floor(e/t.AvailabilityCalendarHelper.sliderElementWidth)),this.viewportCapacity},e.prototype.getElement=function(e){return this.slider.querySelector("[data-key='"+e.format("YYYY-MM-DD")+"']")},e.prototype.animate=function(e){i.HtmlUtil.transform(this.slider,"translate("+e+"px, 0)")},e.prototype.resolveDate=function(e,t,i){return this.date&&this.date>e&&this.date.addDays(this.getViewportCapacity())>this.settings.maxDate&&(e=e.addDays(-(this.getViewportCapacity()-this.settings.maxDate.diffInDays(this.date)-1))),e=t&&null!=i&&i.date&&e.addDays(this.getViewportCapacity())>i.date?i.date.addDays(-this.getViewportCapacity()):e},e.prototype.slide=function(e,t,i){var n=this,o=(void 0===i&&(i=!1),this.getItems()),r=this.viewport.getBoundingClientRect().width,i=this.resolveDate(t,i,_.last(o)),i=(t.isEqualDate(i)||(e=this.getElement(t=i)),this.date=t,this.isPrevButtonDisabled=this.date.resetTime()<=this.settings.minDate,this.isNextButtonDisabled=this.date.addDays(this.getViewportCapacity()-1).resetTime()>=this.settings.maxDate,parseInt(e.style.left));i>=this.slider.clientWidth-r&&(i=this.slider.clientWidth-r),this.animate(-i),setTimeout(function(){return n.showContent(e,o)})},e.prototype.showContent=function(e,t){for(var e=Math.min(t.length-1-this.getViewportCapacity(),__spreadArrays(this.slider.children).indexOf(e)),i=Math.min(e+this.getViewportCapacity(),t.length-1),n=e;n<=i;n++)t[n].show()},t.AvailabilitySlider=e})((e=i.directive||(i.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(l){var e;(function(e){function s(){}s.availablePeriod=function(e,t){var t=e.bookingRule&&e.bookingRule.minAvailDate?e.bookingRule.minAvailDate.getDate().resetTime():l.DateUtil.getHotelDate(t.timeZone.offset),i=e.bookingRule&&e.bookingRule.maxAvailDate?e.bookingRule.maxAvailDate.getDate().resetTime():t.addDays(s.DefaultQuantityOpenDays),n=i.addDays(-1).resetTime(),e=t.addDays(e.stayUnitKind==l.StayUnitKind.Day?0:1).resetTime();return new l.CalendarAvailablePeriod(new l.DatePeriod(t,n),new l.DatePeriod(e,i))},s.dateCustomClass=function(e,t,i){var n=[];return t<e&&e<i&&n.push("_range_in"),e.isEqualDate(t)&&n.push("_range_start"),e.isEqualDate(i)&&n.push("_range_end"),n.join(" ")},s.boundDate=function(e,t,i){return e=(e=e.resetTime()<t.resetTime()?t:e).resetTime()>i.resetTime()?i:e},s.checkInDateDisabledKind=function(e,t,i){return t.resetTime()<e.getDate().resetTime()?l.CalendarDateDisabledKind.Enabled:i&&i.forbidden?l.CalendarDateDisabledKind.Disabled:i&&i.closeArrival?l.CalendarDateDisabledKind.Muted:l.CalendarDateDisabledKind.Enabled},s.checkOutDateDisabledKind=function(e,t,i,n,o,r){if(void 0===r&&(r=!1),i&&i.forbidden&&e==l.StayUnitKind.Day)return l.CalendarDateDisabledKind.Disabled;var a=s.unavailableByMinLos(o,t,n,e),o=s.unavailableByMaxLos(o,t,n,e);return a||o?r?l.CalendarDateDisabledKind.Forbidden:l.CalendarDateDisabledKind.Muted:i&&i.closeDeparture?l.CalendarDateDisabledKind.Muted:l.CalendarDateDisabledKind.Enabled},s.unavailableByMinLos=function(e,t,i,n){i=i.minLos?i.minLos.value:0;return!!t&&t.resetTime()<e.resetTime().addDays(i+(n==l.StayUnitKind.Night?0:-1))},s.unavailableByMaxLos=function(e,t,i,n){i=i.maxLos?i.maxLos.value:Number.MAX_VALUE;return!!t&&t.resetTime()>e.resetTime().addDays(i+(n==l.StayUnitKind.Night?0:-1))},s.DefaultQuantityOpenDays=90,e.CalendarHelper=s})((e=l.directive||(l.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(u){var e;(function(c){function e(e,t,i,n,o){this.bookingRuleAction=e,this.datePriceAction=t,this.$q=i,this.messageFilter=n,this.datepickerSettings=o,this.lastHintId=0,this.hasRestrictions=!1,this.bookingFormSettings=u.BookingFormSettings.getInstance(),this.stayUnitKind=this.bookingFormSettings.stayUnitKind}e.prototype.getDateInfo=function(e,t,i,n){return!e||t?this.getCheckInDateInfo(i,t):this.getCheckOutDateInfo(e,i,n)},e.prototype.getDateTooltipHtml=function(e,t,i){return!e||t||i.diffInDays(e)<(this.isDayStayMode()?1:0)?this.getCheckInTooltipHtml(i):this.getCheckOutTooltipHtml(e,i)},e.prototype.getCheckInRestrictionText=function(e,t,i){var n=null;return c.CalendarHelper.unavailableByMinLos(e,t,i.restrictions,this.bookingFormSettings.stayUnitKind)?n=this.messageFilter("T:datepicker.choose.departure_min_los",{days:i.restrictions.minLos}):c.CalendarHelper.unavailableByMaxLos(e,t,i.restrictions,this.bookingFormSettings.stayUnitKind)&&(n=this.messageFilter("T:datepicker.choose.departure_max_los",{days:i.restrictions.maxLos})),n},e.prototype.getCheckOutRestrictionText=function(e,t,i){var n,o=t.diffInDays(e)+(this.isDayStayMode()?1:0);return this.datepickerSettings.disablePeriod?n=this.messageFilter("T:datepicker.result_without_period",{checkIn:e}):(o=new u.StayDuration(this.stayUnitKind,o),c.CalendarHelper.unavailableByMinLos(e,t,i.restrictions,this.bookingFormSettings.stayUnitKind)?n=this.messageFilter("T:datepicker.choose.close_departure_min_los",{checkIn:e,checkOut:t,nights:o,days:i.restrictions.minLos}):c.CalendarHelper.unavailableByMaxLos(e,t,i.restrictions,this.bookingFormSettings.stayUnitKind)?n=this.messageFilter("T:datepicker.choose.close_departure_max_los",{checkIn:e,checkOut:t,nights:o,days:i.restrictions.maxLos}):i.isClose&&(n=this.messageFilter("T:datepicker.choose.close_departure",{checkIn:e,checkOut:t,nights:o}))),n},e.prototype.getHintHtml=function(i,n,e){var o,r=this,a=++this.lastHintId,s=n&&n.diffInDays(i)<(this.isDayStayMode()?1:0);return i?(o=n?this.messageFilter(n<i?"T:datepicker.arrival":e.endSelected?this.datepickerSettings.disablePeriod?"T:datepicker.result_light":"T:datepicker.result":"T:datepicker.departure_result",{checkIn:n<i?n:i,checkOut:n,nights:new u.StayDuration(this.stayUnitKind,n.diffInDays(i)+(this.isDayStayMode()?1:0))}):this.messageFilter(e.startSelected&&!e.endSelected?"T:datepicker.arrival_result":this.datepickerSettings.disablePeriod?"T:datepicker.arrival_light":"T:datepicker.arrival",{checkIn:i}),this.$q.all([this.getCheckInRestrictions(s?n:i),this.getCheckOutRestrictions(i,n)]).then(function(e){var t;if(a===r.lastHintId)return t=e[0],e=e[1],t.isClose?r.messageFilter("T:datepicker.choose.close_arrival",{checkIn:i}):t.disabledKind==u.CalendarDateDisabledKind.Disabled?r.isDayStayMode()?r.messageFilter(t.disabledKind!=u.CalendarDateDisabledKind.Disabled?o:"T:datepicker.choose.unavailable",{checkIn:n||i}):r.getCheckInRestrictions((n||i).addDays(-1)).then(function(e){return r.messageFilter(e.disabledKind!=u.CalendarDateDisabledKind.Disabled?n&&!s?o:"T:datepicker.choose.only_departure":"T:datepicker.choose.unavailable",{checkIn:n||i})}):e&&!s&&(n?r.getCheckOutRestrictionText(i,n,e):r.getCheckInRestrictionText(i,n,e))||o})):(o=this.messageFilter(e.isStartDate?this.datepickerSettings.disablePeriod?"T:datepicker.choose.date":"T:datepicker.choose.arrival":"T:datepicker.choose.departure"),this.$q.when(o))},e.prototype.isDayStayMode=function(){return this.stayUnitKind==u.StayUnitKind.Day},e.prototype.mixRatePlansRules=function(e){var t=this,i={};return _.each(e,function(e){_.isNull(e.roomTypes)||(i.forbidden=(_.isUndefined(i.forbidden)||i.forbidden)&&e.forbidden,e.forbidden||(i.minLos=t.findMin(i.minLos,e.minLos),i.minAdvBooking=t.findMin(i.minAdvBooking,e.minAdvBooking),i.maxLos=t.findMax(i.maxLos,e.maxLos),i.maxAdvBooking=t.findMax(i.maxAdvBooking,e.maxAdvBooking)))}),i.hasRestriction=i.forbidden||1<i.minLos||i.maxLos<Number.MAX_VALUE,i},e.prototype.findMin=function(e,t){return _.isUndefined(e)||(t||0)<e?t||0:e},e.prototype.findMax=function(e,t){return _.isUndefined(e)||e<(t||Number.MAX_VALUE)?t||Number.MAX_VALUE:e},e.prototype.getCheckInDateInfo=function(n,o){var r=this;return this.$q.all([this.datePriceAction(n),this.bookingRuleAction(n)]).then(function(e){var t=e[0],e=e[1],i=r.bookingFormSettings.bookingRule.minAvailDate,i=c.CalendarHelper.checkInDateDisabledKind(i,n,e);return e.hasRestriction&&!r.hasRestrictions&&(r.hasRestrictions=!0),{isSelectable:!0,isLowPrice:null==t?void 0:t.lowPrice,disabledKind:i,textHtml:r.getDateTextHtml(n,o,t)}})},e.prototype.getCheckOutDateInfo=function(r,a,s){var l=this;return this.$q.all([this.datePriceAction(a),this.bookingRuleAction(a),this.bookingRuleAction(r)]).then(function(e){var t=e[0],i=e[1],e=e[2],n=l.bookingFormSettings.bookingRule.minAvailDate,o={minLos:e&&new u.StayDuration(l.stayUnitKind,e.minLos||0),maxLos:e&&new u.StayDuration(l.stayUnitKind,e.maxLos||Number.MAX_VALUE)},o=[c.CalendarHelper.checkOutDateDisabledKind(l.stayUnitKind,a,i,o,r,!0)];return l.hasRestrictions||!e.hasRestriction&&!i.hasRestriction||(l.hasRestrictions=!0),a.diffInDays(r)<(l.isDayStayMode()?0:1)&&(o=[c.CalendarHelper.checkInDateDisabledKind(n,a,i)],_.includes(o,u.CalendarDateDisabledKind.Muted)||o.push(u.CalendarDateDisabledKind.Muted)),{isSelectable:!a.isEqualDate(r)||l.isDayStayMode(),isLowPrice:null==t?void 0:t.lowPrice,disabledKind:o,textHtml:l.getDateTextHtml(a,s,t)}})},e.prototype.getCheckInTooltipHtml=function(i){var n=this;return this.bookingRuleAction(i).then(function(e){var t;return e.forbidden?(t=['<span class="c3 bold">',n.messageFilter("T:datepicker.tooltip.unavailable"),"</span>"].join(""),n.isDayStayMode()||n.isDayStayMode()?t:n.bookingRuleAction(i.addDays(-1)).then(function(e){return e.forbidden?t:['<span class="c3 bold">',n.messageFilter("T:datepicker.tooltip.only_departure"),"</span>"].join("")})):e.closeArrival?['<span class="c3 bold">',n.messageFilter("T:datepicker.tooltip.close_arrival",{checkIn:i}),"</span>"].join(""):null})},e.prototype.getCheckOutTooltipHtml=function(t,i){var n=this;return this.getCheckOutRestrictions(t,i).then(function(e){return e.disabledKind==u.CalendarDateDisabledKind.Enabled?n.getDurationTooltipHtml(t,i):n.getRestrictionTooltipHtml(t,i,e)})},e.prototype.getCheckInRestrictions=function(i){var n=this;return this.bookingRuleAction(i).then(function(e){var t=n.bookingFormSettings.bookingRule.minAvailDate;return{disabledKind:c.CalendarHelper.checkInDateDisabledKind(t,i,e),isClose:e&&e.closeArrival}})},e.prototype.getCheckOutRestrictions=function(n,o){var r=this;return this.$q.all([this.bookingRuleAction(n),o&&this.bookingRuleAction(o)]).then(function(e){var t=e[0],e=e[1],i=r.bookingFormSettings.stayUnitKind,t={minLos:t&&new u.StayDuration(i,t.minLos||0),maxLos:t&&new u.StayDuration(i,t.maxLos||Number.MAX_VALUE)},i=c.CalendarHelper.checkOutDateDisabledKind(i,o,e,t,n);return o&&o.diffInDays(n)<(r.isDayStayMode()?0:1)?null:{isClose:e&&e.closeDeparture,restrictions:t,disabledKind:i}})},e.prototype.getDurationTooltipHtml=function(e,t){e=new u.RoomStayStayDate(e,t,u.BookingFormSettings.getInstance().stayUnitKind).duration();return['<span class="c3 bold">',this.messageFilter("T:datepicker.tooltip.duration",{days:e}),"</span>"].join("")},e.prototype.getRestrictionTooltipHtml=function(e,t,i){var n;if(c.CalendarHelper.unavailableByMinLos(e,t,i.restrictions,this.bookingFormSettings.stayUnitKind))n=this.messageFilter("T:datepicker.tooltip.min_los",{days:i.restrictions.minLos});else if(c.CalendarHelper.unavailableByMaxLos(e,t,i.restrictions,this.bookingFormSettings.stayUnitKind))n=this.messageFilter("T:datepicker.tooltip.max_los",{days:i.restrictions.maxLos});else{if(!i.isClose)return null;n=this.messageFilter("T:datepicker.tooltip.close_departure")}return['<span class="c3 bold">',n,"</span>"].join("")},e.prototype.getDateTextHtml=function(e,t,i){return!i||!this.isDayStayMode()&&!this.datepickerSettings.disablePeriod&&t&&e.isEqualDate(t)?null:this.messageFilter("T:datepicker.date_price",{price:i.price})},c.CalendarDateInfoProvider=e})((e=u.directive||(u.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(r){var e;(function(e){function t(e,t,i){this.$scope=e,this.$q=t,this.availabilityCalendarService=i,this.calendarPriceList={},this.calendarCriteriaCache=[],this.MONTHS_PER_REQUEST=1}t.prototype.getMinPriceDate=function(e){var t=this,i=this.getDatePrice(e);return i?this.$q.when(i):this.loadMinPrices(e).then(function(){return t.$q.when(t.getDatePrice(e))})},t.prototype.getDatePrice=function(i){var e=0==r.Locale.getInstance().firstDayOfWeek()?i.date.moment().week():i.date.moment().isoWeek(),n={},e=_.filter(this.calendarPriceList[e],function(e){if(i.roomTypeIds.length&&!_.includes(i.roomTypeIds,e.roomTypeId))return!1;var t=e.date.toDateString();return(!n[t]||e.price.amount<n[t])&&(n[t]=e.price.amount),i.date.isEqualDate(e.date)});if(!e.length)return null;var e=_.minBy(e,function(e){return e.price.amount}),t=1==_.uniq(_.map(n)).length;return e.lowPrice=!t&&e.price.amount<=_.min(_.values(n)),0!==e.price.amount?e:null},t.prototype.buildMinPriceCriterion=function(e){var t=e.startDate.clone(),i=t.clone().addMonths(this.MONTHS_PER_REQUEST);return t.setDate(1),i.setDate(0),e.startDate=t,e.endDate=i,e},t.prototype.buildPriceList=function(e){var n=this,o=0!==r.Locale.getInstance().firstDayOfWeek();_.each(e,function(e){var t=e.price.priceAfterTax,i=o?e.date.moment().isoWeek():e.date.moment().week(),t={price:t,week:i,date:e.date,guests:e.guests,roomTypeId:String(e.roomTypeId)};n.calendarPriceList[i]||(n.calendarPriceList[i]=[]),n.calendarPriceList[i].push(t)})},t.prototype.loadMinPrices=function(e){var t=this,i=r.BookingFormSettings.getInstance().providerId,n=r.Locale.getInstance().currency(),i=this.buildMinPriceCriterion(new r.RoomTypeAvailabilityCriterion(e.date,i,n)),o=__spreadArrays([i.startDate.toDateString(),i.endDate.toDateString(),i.currency.id],e.roomTypeIds).join("-");return this.availabilityCalendarService.getRoomTypesAvailability(i,e.roomTypeIds,!0).then(function(e){_.includes(t.calendarCriteriaCache,o)||(t.buildPriceList(e),t.calendarCriteriaCache.push(o))})},e.CalendarPriceProvider=t})((e=r.directive||(r.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(e){(function(e){function t(){}t.Connect="cart.connect",t.Show="cart.show",t.Hide="cart.hide",t.ShowMotivationalText="cart.showMotivationalText",t.HideMotivationalText="cart.hideMotivationalText",t.ShowOrder="cart.showOrder",t.HideOrder="cart.hideOrder",t.ProceedBooking="cart.proceedBooking",t.ClickBookingDisabled="cart.clickBookingDisabled",t.UpdateOrder="cart.updateOrder",t.Resize="cart.resize",t.SetViewMode="cart.SetViewMode",e.uiCartEvent=t,e.uiCartDelayedEvent=function(e,t){void 0===t&&(t={}),this.name=e,this.params=t}})((e=e.directive||(e.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(n){var e;(function(e){function t(){}t.getTooltipText=function(e,t,i){e=new n.RoomStayStayDate(e,t,n.BookingFormSettings.getInstance().stayUnitKind).duration();return 0<e.value?i("T:datepicker.duration",{days:e}):null},e.DurationTooltipHelper=t})((e=n.directive||(n.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(e){(function(e){function i(){}i.isBirthdaySame=function(e,t){return(e?e.toString():"")==(t?t.toString():"")},i.isGuestInfoEqual=function(e,t){return t.firstName==e.firstName&&t.middleName==e.middleName&&t.lastName==e.lastName&&t.citizenship==(_.isUndefined(e.citizenship)?void 0:e.citizenship.countryCode3)&&t.postalCode==e.postalCode&&t.region==e.region&&t.city==e.city&&t.sex==e.sex&&i.isBirthdaySame(t.birthday,e.birthday)},i.copyGuestInfo=function(e,t){t.firstName=e.firstName,t.middleName=e.middleName,t.lastName=e.lastName,t.citizenship=_.isUndefined(e.citizenship)?void 0:e.citizenship.countryCode3,t.defaultCitizenship=_.isUndefined(e.citizenship)?void 0:e.citizenship.countryCode3,t.postalCode=e.postalCode,t.region=e.region,t.city=e.city,t.sex=e.sex,t.birthday=e.birthday,t.placementIndex=e.placementIndex},e.EditGuestsInfoHelper=i})((e=e.directive||(e.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(n){!function(e){var t;function i(){return null!==t&&t.apply(this,arguments)||this}e=e.helper||(e.helper={}),t=n.EditBookingController,__extends(i,t),i.prototype.tearDown=function(e){t.prototype.tearDown.call(this,e),e.errors=this.errors,e.order=this.order,e.modifiedBooking=this.modifiedBooking},i.prototype.tearUp=function(e){t.prototype.tearUp.call(this,e),this.errors=e.errors,this.order=e.order,this.modifiedBooking=e.modifiedBooking},i.prototype.init=function(){t.prototype.init.call(this),this._bookingFormSettings=n.BookingFormSettings.getInstance(),this._placementUtil=new n.PlacementUtil(this.messages),this._provider=this.editBookingService.getProvider(),this.booking=this.editBookingService.getBooking()},i.prototype._getRoomStayCapacity=function(e){return _.reduce(e.guestPlacementOptions,function(e,t){return e+(t.capacity||0)},0)},i.prototype._initOrder=function(){this.order=this.orderService.createOrderFromHotelBooking(this.booking,n.Locale.getInstance().language(),n.Locale.getInstance().currency())},i.prototype._verifyOrder=function(e,t){var i=this,n=(void 0===e&&(e=!1),(t=void 0===t?!0:t)&&this.overlayOn(),this.$q.defer()),e=this.editBookingService.buildOrder("","",e);return this.editBookingService.verifyOrder(e).then(function(e){i.modifiedBooking=i.editBookingService.buildHotelBooking(e),i.errors=null,n.resolve(e)}).catch(function(e){i.errors=e,n.reject(i.errors)}).finally(function(){t&&i.overlayOff()}),n.promise},i.prototype._hasError=function(e){return!!_.find(this.errors,{error_code:e})},i.prototype._isPrepaymentTypeEqual=function(){return!!this.booking.prepayment==!!this.modifiedBooking.prepayment},i.prototype.isPrepaymentEqual=function(){return!(!_.isUndefined(this.booking.prepayment)||!_.isUndefined(this.modifiedBooking.prepayment))||!!this._isPrepaymentTypeEqual()&&this.booking.prepayment.amount==this.modifiedBooking.prepayment.amount},i.prototype.isPriceChangeValid=function(){return this.modifiedBooking.paymentSystem.type==n.PaymentSystemType.Cash||this.isPrepaymentEqual()},i.prototype.getPlacementDescription=function(e){e=n.PlacementManager.guestPlacementsToPlacement(e.guestPlacementOptions);return this._placementUtil.getPlacementOrderDescription(e,this.showAgeGroup)},i.prototype.getPriceDetailsNode=function(t){var i=this;return this.$q.when(function(){var e=i.$scope;return e.guestPlacementsGroups=[t.guestPlacementOptions],e.price=t.price,e.roomTypeUnit=new n.RoomTypeUnit(t.roomType.kind),e.duration=t.stayDates.duration(),i.$compile('<tl-price-details guest-placements-groups="guestPlacementsGroups" total-price="price" room-type-unit="roomTypeUnit" show-age-group="showAgeGroup" num-nights="duration"></tl-price-details>')(i.$scope)[0]})},i.prototype.getAnimationDelay=function(e){return n.AnimationUtil.getAnimationDelay(e)},i.prototype.getPriceDiff=function(e,t){return void 0===t&&(t=this.originalRoomStay.stayPrice.priceAfterDiscount),n.PriceCalculator.sum(e,n.PriceCalculator.mul(t,-1))},i.prototype.getAbsPrice=function(e){return e.priceAfterTax.amount<0?n.PriceCalculator.mul(e,-1):e},i.prototype.getAbsPriceAmount=function(e){e=this.getAbsPrice(e);return e.taxes.length&&this._bookingFormSettings.showNetPrices?e.priceBeforeTax:e.priceAfterTax},i.prototype.getDiscountPercentage=function(e){return n.directive.helper.PriceHelper.calculateDiscountInPercentage(e)},i.prototype.confirmBooking=function(){var t=this,i=(this.overlayOn(),this.orderService.populateFromHotelBooking(this.modifiedBooking),this.$q.defer());return this.editBookingService.confirmBooking(this.editBookingService.buildOrder()).then(function(e){t.editBookingService.setBooking(t.editBookingService.buildHotelBooking(e)),t.errors=null,t.goToResult(),i.resolve(t.modifiedBooking)}).catch(function(e){t.errors=e,t.goToResult(),i.reject(t.errors)}).finally(function(){t.overlayOff(),t.editBookingService.invalidateCache()}),i.promise},i.prototype.goToConfirm=function(){},i.prototype.goToResult=function(){},e.EditRoomStayPageController=i}(n.directive||(n.directive={}))}(tl=tl||{}),!function(i){var e;(function(e){function t(){}t.isShowModalForError=function(e){return!_.includes([i.ServiceErrorCode.EndDateIsInvalid,i.ServiceErrorCode.StartDateIsInvalid,i.ServiceErrorCode.Reenter,i.ServiceErrorCode.Retry,i.ServiceErrorCode.CreditCardHasExpired,i.ServiceErrorCode.CreditCardNumberIsInvalidOrMissing,i.ServiceErrorCode.BookingTemporarilyUnavailable,i.ServiceErrorCode.CaptchaChallenge],e)&&!this.isShowPageForError(e)},t.isShowPageForError=function(e){return _.includes([i.ServiceErrorCode.UnableToProcess,i.ServiceErrorCode.InternalServerError],e)},t.isOverbookingCode=function(e){return _.includes([i.ServiceErrorCode.NoMatchFound,i.ServiceErrorCode.InvalidRoomType,i.ServiceErrorCode.RateUnavailable,i.ServiceErrorCode.RateDeactivated,i.ServiceErrorCode.NoAvailability,i.ServiceErrorCode.NonExistentServiceId,i.ServiceErrorCode.NonExistentServiceType,i.ServiceErrorCode.InvalidPromoCode,i.ServiceErrorCode.ArrivalDateIsNotAvailable,i.ServiceErrorCode.DepartureDateIsNotAvailable,i.ServiceErrorCode.RatePromoCodeRestricted,i.ServiceErrorCode.RateNotExists,i.ServiceErrorCode.RoomNotExists,i.ServiceErrorCode.BookingStatusInvalid],e)},t.isAlreadyPaidCode=function(e){return _.includes([i.ServiceErrorCode.BookingStatusInvalid],e)},t.isServiceUnavailableCode=function(e){return _.includes([i.ServiceErrorCode.NonExistentServiceId,i.ServiceErrorCode.NonExistentServiceType],e)},e.ErrorHelper=t})((e=i.directive||(i.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(a){var e;(function(e){function t(){}function i(){}t.UnknownError=-1,t.Success=0,t.AudienceAppNotSpecified=1,t.UnknownAudienceApp=2,t.AccountAlreadyExists=3,t.InvalidLoginOrPassword=4,t.InvalidLoginForPasswordReset=5,t.WrongDeviceTicket=6,t.WrongCode=7,t.TooManyAttempts=8,e.GuestLoginResponseCodes=t,i.CommonLogIn="common-log-in",i.AddingInfo="adding-info",i.AddLoyaltyCard="add-loyalty-card",i.Register="register",i.ResetPassword="reset-password",i.LogIn="log-in",i.ProfileNotLoadedError="profile-not-loaded-error",i.SuccessfullyLoyaltyCardLinking="successfully-loyalty-card-linking-status",i.SuccessfullyLoyaltyCardIssuing="successfully-loyalty-card-issuing",i.FailedLoyaltyCardLinking="failed-loyalty-card-linking",e.GuestLogInModalView=i;e.LoginData=function(){},o.prototype.clear=function(){this.email=null,this.firstName=null,this.lastName=null,this.password=null,this.phone=new a.CustomerPhoneNumber};var n=o;function o(){this.phone=new a.CustomerPhoneNumber}function r(){}e.UiGuestAccount=n,r.getPreLogInMotivationText=function(e,t){return e.registrationDiscounts&&e.touristDiscounts&&e.hasLoyaltyProgram()?t.getMessage("T:guest_log_in.motivator_all"):!e.registrationDiscounts||e.touristDiscounts||e.hasLoyaltyProgram()?e.registrationDiscounts||!e.touristDiscounts||e.hasLoyaltyProgram()?e.registrationDiscounts||e.touristDiscounts||!e.hasLoyaltyProgram()?e.touristDiscounts||e.registrationDiscounts||e.hasLoyaltyProgram()?(i=[],e.registrationDiscounts&&i.push(t.getMessage("T:guest_log_in.motivator_for_registration")),e.touristDiscounts&&i.push(t.getMessage("T:guest_log_in.motivator_for_tourist")),e.hasLoyaltyProgram()&&i.push(t.getMessage("T:guest_log_in.motivator_for_loyalty")),[t.getMessage("T:guest_log_in.motivator_common"),i.join(t.getMessage("T:guest_log_in.motivator_separator"))].join("")):t.getMessage("T:guest_log_in.motivator_default"):t.getMessage("T:guest_log_in.motivator_loyalty_only"):t.getMessage("T:guest_log_in.motivator_tourist_only"):t.getMessage("T:guest_log_in.motivator_registration_only");var i},e.GuestLoginHelper=r})((e=a.directive||(a.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(h){var e;(function(e){function t(e,t,i,n){this.$q=e,this.roomStaysRuleResolver=t,this.bookingService=i,this.bookingRuleService=n}function i(e,t,i){this.$q=e,this.bookingService=t,this.bookingRuleService=i}t.prototype.findRoomStays=function(){var i=this;return this._getRoomStaysWithUnsuitableLosPromise().then(function(e){var t=e[0],e=e[1];return(t=t&&t.slice()).length&&e&&i._mixRatePlansWithUnsuitableLos(t,e),{roomStays:t,ratePlanBookingRules:e}})},t.prototype._getRoomStaysWithUnsuitableLosPromise=function(){var i=this,n=h.BookingFormSettings.getInstance(),o=this.bookingService.getSearchCriteria(),r=[];return n.mixUnsuitableByLosRatePlans&&_.map(this.bookingService.getRatePlans(),function(t){_.map(i.bookingService.getRoomTypes(),function(e){r.push(i.bookingRuleService.getRatePlanBookingRuleByDateRange(o,n.stayUnitKind,t,e).catch(function(){return{minLos:1,minAdvBooking:0,maxLos:Number.MAX_VALUE,maxAdvBooking:Number.MAX_VALUE,forbidden:!1}}).then(function(e){return{ratePlanCode:t.id,rule:e}}))})}),this.$q.all([this.roomStaysRuleResolver(),this.$q.all(r)])},t.prototype._mixRatePlansWithUnsuitableLos=function(r,e){var a=this,s=this.bookingService.getRoomTypes(),l=this.bookingService.getRatePlans(),c=this.bookingService.getSearchCriteria(),u=h.BookingFormSettings.getInstance(),d=u.originalAccommodationMode==h.AccommodationMode.Auto&&!c.children(),p=_.min(_.map(c.placements,function(e){return e.total()})),m=_.min(_.map(c.placements,function(e){return e.adults})),g={};_.forEach(e,function(n){var e=c.nights()+(u.stayUnitKind==h.StayUnitKind.Night?0:1),t=c.checkInDate.diffInDays(h.DateUtil.getHotelDate(a.bookingService.getProvider().timeZone.offset)),i=1<n.rule.minLos&&n.rule.minLos>e,e=n.rule.maxLos&&n.rule.maxLos<e,o=!n.rule.minAdvBooking||t>=n.rule.minAdvBooking,t=!n.rule.maxAdvBooking||t<=n.rule.maxAdvBooking;!n.rule.forbidden&&o&&t&&(i||e)&&_.forEach(s,function(e){if(!n.rule.roomTypes||_.includes(n.rule.roomTypes,e.id)){var t=e.id+"-"+n.ratePlanCode,i=_.find(l,function(e){return e.id==n.ratePlanCode});if(i&&(!i.withChildrenOnly||!d)){if(u.originalAccommodationMode==h.AccommodationMode.Auto){if(p>e.occupancy.total)return;if(m>e.occupancy.maxAdult)return}g[t]||(g[t]=!0,(t=new h.RoomStay(t,"",e,[i],null)).ratePlanRestriction=new h.RatePlanRestriction(n.ratePlanCode,u.stayUnitKind,n.rule.minLos,n.rule.maxLos),r.push(t))}}})})},e.HotelAvailabilityRoomStaysFinder=t,i.prototype.findClosestAvailableDates=function(t,e,i){var n=h.BookingFormSettings.getInstance().stayUnitKind;return this.bookingRuleService.getNearestAvailableDates(t,!0,e?[e.id]:null,i).then(function(e){return e=_.filter(e,function(e){return e&&!(e.startDate.isEqualDate(t.checkInDate)&&e.endDate.isEqualDate(t.checkOutDate))}),_.map(e,function(e){return new h.RoomStayStayDate(e.startDate,e.endDate,n)})}).catch(function(){return null})},e.HotelAvailabilityClosestAvailableDatesFinder=i})((e=h.directive||(h.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(n){!function(e){var t;function i(){var e=t.call(this)||this;if(e._topic="multiroom",e._criteriaPlacements=[],e._guestStays=[],i._instance)throw new Error("Error: Instantiation failed: Use MultiRoomChoiceCalculator.getInstance() instead of new.");return e._informer=n.OrderInformer.getInstance(),e._bookingFormSettings=n.BookingFormSettings.getInstance(),i._instance=e}e=e.helper||(e.helper={}),t=n.Informer,__extends(i,t),i.getInstance=function(){return i._instance=null===i._instance?new i:i._instance},i.prototype.init=function(e,t){var i=this;this._addRoomStaysObserver={callback:_.bind(this.addedGuestStay,this)},this._removeGuestStaysObserver={callback:_.bind(this.removedGuestStay,this)},this._informer.subscribe(this._addRoomStaysObserver,n.OrderInformerMessageType.AddGuestStays),this._informer.subscribe(this._removeGuestStaysObserver,n.OrderInformerMessageType.RemoveGuestStays),this._criteria=e,this._criteriaPlacements=e.placements,_.each(t,function(e){i._guestStays.push(e)})},i.prototype.destruct=function(){this._informer.unsubscribe(this._addRoomStaysObserver,n.OrderInformerMessageType.AddGuestStays),this._informer.unsubscribe(this._removeGuestStaysObserver,n.OrderInformerMessageType.RemoveGuestStays),this._criteriaPlacements=[],this._guestStays=[]},i.prototype.addedGuestStay=function(e){var t=this;_.each(e.guestStays,function(e){t._guestStays.push(e)}),this.inform()},i.prototype.removedGuestStay=function(e){var i=this;_.each(e.guestStays,function(t){_.remove(i._guestStays,function(e){return e.id==t.id})}),this.inform()},i.prototype.inform=function(){var t=this;this.subscribers.hasOwnProperty(this._topic)&&_.each(this.subscribers[this._topic],function(e){t.doInform(e)})},i.prototype.doInform=function(e){e.callback(this.calculate(e.roomStay))},i.prototype.calculate=function(e){return{availableQuota:this.calculateAvailableQuota(e),selectedQuantity:this.calculateSelectedQuantity(e),restrictedByRatePlan:this.isRestrictedByRatePlan(e)}},i.prototype.isRestrictedByRatePlan=function(e){return!this.existCommonPaymentSystems(e)||!this.isRatePlansCurrencyAreSame(e)},i.prototype.existCommonPaymentSystems=function(e){var t;return!this._guestStays.length||((t=_.map(this._guestStays,function(e){return _.map(e.roomStay.paymentOptions,function(e){return e.paymentSystem.id})})).push(_.map(e.paymentOptions,function(e){return e.paymentSystem.id})),_.intersection.apply(this,t).length)},i.prototype.isRatePlansCurrencyAreSame=function(e){if(this._guestStays.length&&_.head(this._guestStays).roomStay.ratePlans[0].currency.id!=e.ratePlans[0].currency.id)return!1;return!0},i.prototype.calculateAvailableQuota=function(t){if(this.isRestrictedByRatePlan(t))return 0;var i=0;return _.each(this._guestStays,function(e){e.roomStay.roomTypeQuotaId==t.roomTypeQuotaId&&e.roomStay.id!=t.id&&i++}),Math.max(t.quantity-i,0)},i.prototype.calculateSelectedQuantity=function(t){var i=0;return _.each(this._guestStays,function(e){e.roomStay.id==t.id&&i++}),i},i.prototype.enroll=function(e){t.prototype.subscribe.call(this,e,this._topic),this.doInform(e)},i.prototype.unenroll=function(e){t.prototype.unsubscribe.call(this,e,this._topic)},i.prototype.isMultiChoiceMode=function(){return this._bookingFormSettings.isManualAccommodationMode()||1<this._criteria.placements.length},i._instance=null,e.MultiRoomChoiceCalculator=i,e.MultiRoomChoiceCalculatorMessage=function(){}}(n.directive||(n.directive={}))}(tl=tl||{}),!function(e){t=e.Informer,__extends(n,t),n.getInstance=function(){return n._instance=null===n._instance?new n:n._instance},n.prototype.subscribe=function(e){return t.prototype.subscribe.call(this,e,n._messageTopic)},n.prototype.unsubscribe=function(e){t.prototype.unsubscribe.call(this,e,n._messageTopic)},n.prototype.notify=function(t){return _.map(this.subscribers[n._messageTopic],function(e){return e.callback(t)})},n._instance=null,n._messageTopic="currency-update";var t,i=n;function n(){var e;if(n._instance)throw new Error("Error: Instantiation failed: Use CurrencyInformer.getInstance() instead of new.");return e=t.call(this)||this,n._instance=e}e.CurrencyInformer=i,e.CurrencyInformerMessage=function(e,t){this.from=e,this.to=t}}(tl=tl||{}),!function(e){t=e.Informer,__extends(n,t),n.getInstance=function(){return n._instance=null===n._instance?new n:n._instance},n.prototype.subscribe=function(e){return t.prototype.subscribe.call(this,e,n._messageTopic)},n.prototype.unsubscribe=function(e){t.prototype.unsubscribe.call(this,e,n._messageTopic)},n.prototype.notify=function(t){return _.map(this.subscribers[n._messageTopic],function(e){return e.callback(t)})},n._instance=null,n._messageTopic="language-update";var t,i=n;function n(){var e;if(n._instance)throw new Error("Error: Instantiation failed: Use LanguageInformer.getInstance() instead of new.");return e=t.call(this)||this,n._instance=e}e.LanguageInformer=i,e.LanguageInformerMessage=function(e,t){this.from=e,this.to=t}}(tl=tl||{}),!function(e){u.subscribe=function(e,i,t,n){function o(){_.each(s,function(e){e()})}var r,a,s=[],l=function(e){},c=function(e){};return n&&(u.currencyInformer.subscribe(r={callback:function(e){var t=i.defer();return setTimeout(function(){o(),l&&l(e),t.resolve()},0),t.promise}}),e.$on("$destroy",function(){u.currencyInformer.unsubscribe(r)})),t&&(u.languageInformer.subscribe(a={callback:function(e){var t=i.defer();return setTimeout(function(){o(),c&&c(e),t.resolve()},0),t.promise}}),e.$on("$destroy",function(){u.languageInformer.unsubscribe(a)})),{notifier:function(e){s.push(e)},update:function(){o()},onCurrencyChanged:function(e){l=e},onLanguageChanged:function(e){c=e}}},u.currencyInformer=e.CurrencyInformer.getInstance(),u.languageInformer=e.LanguageInformer.getInstance();var t=u;function u(){}e.NotifierHelper=t}(tl=tl||{}),!function(o){var e;(function(e){function t(e){this.messages=e}t.prototype.getOrderString=function(i){var n=this,e=[o.RoomTypeUnitKind.Room,o.RoomTypeUnitKind.PlaceInRoom,o.RoomTypeUnitKind.Cottage,o.RoomTypeUnitKind.Apartment,o.RoomTypeUnitKind.Service,o.RoomTypeUnitKind.GuestRoom,o.RoomTypeUnitKind.Camp,o.RoomTypeUnitKind.Studio,o.RoomTypeUnitKind.Flat,o.RoomTypeUnitKind.House,o.RoomTypeUnitKind.Villa];return _.chain(e).map(function(e){var t=n.countByRoomTypeKind(i,e);return 0===t?void 0:n.formatOrderPart(new o.RoomTypeUnit(e),t)}).without(void 0).value().join(", ")},t.prototype.countByRoomTypeKind=function(e,t){return _.filter(null==e?void 0:e.guestStays,function(e){return e.roomStay.roomType.kind==t}).length},t.prototype.formatOrderPart=function(e,t){var i=e.prefix?e.prefix+".":"";return t+"&nbsp;"+this.messages.formatMessage("T:unit."+i+e.kind,{value:t})},e.OrderHelper=t})((e=o.directive||(o.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(i){function o(){}o.getUrls=function(e,t){void 0===t&&(t=null);var i=e.getScope(),n=e.getPaymentType();return{popupUrl:o.getPaymentUrl(i.$state.href(e.getPaymentPopupState(),{bookingNumber:t,paymentType:n},{relative:!0})),successUrl:o.getPaymentUrl(i.$state.href(e.getPaymentResultState(),{result:"success",paymentType:n},{relative:!0})),failureUrl:o.getPaymentUrl(i.$state.href(e.getPaymentResultState(),{result:"failure",paymentType:n},{relative:!0}))}},o.getPaymentUrl=function(e){var t=i.BookingFormSettings.getInstance(),e=["surl="+encodeURIComponent(i.ServiceTransport.serviceBaseUrl),"path="+encodeURIComponent(e.slice(1)),"language="+encodeURIComponent(i.Locale.getInstance().languageId())],t=(t.cdnHost&&e.push("cdnUrl="+encodeURIComponent(t.cdnHost)),e.push("tlTrackerUser="+encodeURIComponent(i.TrackerService.getUserId())),e.push("tlTrackerSession="+encodeURIComponent(i.TrackerService.getSessionId())),AppIntegration&&AppIntegration.getEnv&&AppIntegration.getEnv());return t&&e.push("env="+encodeURIComponent(t)),e.push("r="+Math.random()),location.protocol+"//"+location.host+location.pathname+"?"+e.join("&")},o.getPaymentStrategy=function(e,t){t=t||i.PaymentType.convert(e.$stateParams.paymentType);return!t||t!=i.PaymentType.ChangeCard&&t!=i.PaymentType.DeferredPayment?new i.BookingPaymentStrategy(e):new i.EditBookingPaymentStrategy(e,t)},o.resolvePaymentState=function(){return i.BookingFormSettings.getInstance().isModeTurnedOn(i.BookingFormMode.CertificateBookingForm)?i.AppState.Payment_Certificate:i.AppState.Payment},o.contactsFormHash="contactInformation",o.paymentHash="paymentInformation",o.captchaHash="captchaChallenge",o.mirConditionsBlockHash="mirConditionsBlock",i.PaymentUtil=o}(tl=tl||{}),!function(a){Object.defineProperty(e.prototype,"icon",{get:function(){return i.getIconName(this.kind)},enumerable:!0,configurable:!0});var t=e;function e(e,t){this.kind=e,this.placements=t}a.PlacementIcon=t;n.getIconName=function(e){return e==a.GuestPlacementKind.Adult||e==a.GuestPlacementKind.ExtraAdult?"adult":e==a.GuestPlacementKind.ChildBandWithoutBed?"child-no-place":"child"},n.getPlacementIcons=function(e){return[new t(a.GuestPlacementKind.Adult,e.adults),new t(a.GuestPlacementKind.Child,e.children.length),new t(a.GuestPlacementKind.ExtraAdult,e.adultsExtraBed),new t(a.GuestPlacementKind.ExtraChild,e.childrenExtraBed.length),new t(a.GuestPlacementKind.ChildBandWithoutBed,e.childrenWithoutBed.length)]},n.prototype.formatAdultPlacements=function(e){return this.messages.formatMessage("T:placement.adults",{adults:e})},n.prototype.groupByAge=function(e){return _.chain(e).groupBy(function(e){return e.age}).sortBy(function(e){return _.head(e).age}).value()},n.prototype.formatChildrenPlacements=function(e,i){var n=this,o=(void 0===i&&(i=!1),[]),e=this.groupByAge(e);return _.forEach(e,function(e){var t=_.head(e);o.push(i?n.messages.formatMessage("T:placement.children_range",{children:e.length,min:t.ageGroup.minAge,max:t.ageGroup.maxAge}):n.messages.formatMessage(0==t.age?"T:placement.children_under_year":"T:placement.children",{children:e.length,age:t.age}))}),o};var i=n;function n(e){var r=this;this.getPerUnitOptionDescription=function(e,t){void 0===t&&(t=!0);var i,n=[];if(0<e.adults&&n.push(r.messages.formatMessage("T:option.per_unit_for_adults",{count:1,adults:e.adults})),_.some(e.childrenPlacements)&&(i=r.groupByAge(e.childrenPlacements),n.push(_.map(i,function(e){var t=_.head(e);return r.messages.formatMessage("T:option.per_unit_for_children",{count:1,children:e.length,min:t.ageGroup.minAge,max:t.ageGroup.maxAge})}).join(", "))),t)switch(e.kind){case a.GuestPlacementKind.Adult:case a.GuestPlacementKind.Child:break;case a.GuestPlacementKind.ExtraAdult:case a.GuestPlacementKind.ExtraChild:n.push(r.messages.getMessage("T:placement.extra_bed"));break;case a.GuestPlacementKind.ChildBandWithoutBed:n.push(r.messages.getMessage("T:placement.without_bed"))}return n.join(" ")},this.getPlacementOptionDescription=function(e,t){void 0===t&&(t=!0);var i,n=[];if(0<e.adults&&n.push(r.messages.formatMessage("T:common.adults",{adults:1})),_.some(e.childrenPlacements)&&(i=r.groupByAge(e.childrenPlacements),n.push(_.map(i,function(e){var t=_.head(e);return r.messages.formatMessage("T:common.children_range",{children:e.length,min:t.ageGroup.minAge,max:t.ageGroup.maxAge})}).join(", "))),t)switch(e.kind){case a.GuestPlacementKind.Adult:case a.GuestPlacementKind.Child:break;case a.GuestPlacementKind.ExtraAdult:case a.GuestPlacementKind.ExtraChild:n.push(r.messages.getMessage("T:placement.extra_bed"));break;case a.GuestPlacementKind.ChildBandWithoutBed:n.push(r.messages.getMessage("T:placement.without_bed"))}return n.join(" ")},this.getPlacementDescription=function(e,t,i,n){var o=[];switch(0<e.adults&&o.push(r.formatAdultPlacements(e.adults)),0<e.adultsExtraBed&&o.push(r.formatAdultPlacements(e.adultsExtraBed)),0<e.children.length&&o.push(r.formatChildrenPlacements(e.children,n).join(", ")),0<e.childrenExtraBed.length&&o.push(r.formatChildrenPlacements(e.childrenExtraBed,n).join(", ")),0<e.childrenWithoutBed.length&&o.push(r.formatChildrenPlacements(e.childrenWithoutBed,n).join(", ")),o=[o.join(", ")],t){case a.GuestPlacementKind.Adult:case a.GuestPlacementKind.Child:break;case a.GuestPlacementKind.ExtraAdult:case a.GuestPlacementKind.ExtraChild:o.push(r.messages.getMessage("T:placement.extra_bed"));break;case a.GuestPlacementKind.ChildBandWithoutBed:o.push(r.messages.getMessage("T:placement.without_bed"))}return o=[o.join(" ")],i&&o.push(i.name),o.join(", ")},this.getPlacementOrderDescription=function(e,t){var i=[];return 0<e.adults&&i.push(r.messages.formatMessage("T:placement.adults",{adults:e.adults})),0<e.children.length&&i.push(_.map(r.formatChildrenPlacements(e.children,t),function(e){return e})),0<e.adultsExtraBed&&i.push(r.messages.formatMessage("T:placement.adults",{adults:e.adultsExtraBed})+" "+r.messages.getMessage("T:placement.extra_bed")),0<e.childrenExtraBed.length&&i.push(_.map(r.formatChildrenPlacements(e.childrenExtraBed,t),function(e){return e+" "+r.messages.getMessage("T:placement.extra_bed")})),0<e.childrenWithoutBed.length&&i.push(_.map(r.formatChildrenPlacements(e.childrenWithoutBed,t),function(e){return e+" "+r.messages.getMessage("T:placement.without_bed")})),(i=_.flatten(i)).join(", ")},this.getGuestRatePlanPlacementDescription=function(e){var t=[];return 0<e.adults&&t.push(r.messages.formatMessage("T:placement.adults",{adults:e.adults})),0<e.children.length&&_.forEach(e.children,function(e){0==e.age?t.push(r.messages.formatMessage("T:filter.under_year",{})):t.push(r.messages.formatMessage("T:filter.child_age",{age:e.age}))}),t.join(", ")},this.getPlacementKindDescription=function(e,t){var i=[];return e==a.GuestPlacementKind.Adult||e==a.GuestPlacementKind.ExtraAdult?i.push(r.messages.formatMessage("T:common.adults",{adults:1})):_.isUndefined(t)?i.push(r.messages.formatMessage("T:common.children",{children:1})):0==t?i.push(r.messages.formatMessage("T:filter.under_year",{})):i.push(r.messages.formatMessage("T:filter.child_age",{age:t})),i.push('&#32;<span class="c1">'),i.push(r.getPlacementBedDescription(e)),i.push("</span>"),i.join("")},this.getOrderRoomPlacementDescription=function(e){var t=[];return 0<e.adults&&t.push(r.messages.formatMessage("T:placement.adults",{adults:e.adults})),0<e.children&&(0<t.length&&t.push(", "),t.push(r.messages.formatMessage("T:placement.children_without_age",{children:e.children}))),t.push('&#32;<span class="c1">'+r.getPlacementBedDescription(e.kind)+"</span>"),t.join("")},this.getPlacementBedDescription=function(e){return e==a.GuestPlacementKind.Adult||e==a.GuestPlacementKind.Child?r.messages.getMessage("T:placement.regular_bed"):e==a.GuestPlacementKind.ExtraAdult||e==a.GuestPlacementKind.ExtraChild?r.messages.getMessage("T:placement.extra_bed"):e==a.GuestPlacementKind.ChildBandWithoutBed?r.messages.getMessage("T:placement.without_bed"):void 0},this.getCriteriaPlacementDescription=function(e){var t,i,n=[],o=e.children.length;return n.push(r.messages.formatMessage("T:placement.adults",{adults:e.adults})),1<=o&&(i=t=void 0,n.push("+"),i=1==o?(t=0==(e=_.chain(e.children).map(function(e){return e.age}).head().value())?"T:placement.children_under_year":"T:placement.children",{children:o,age:e}):(t="T:placement.children_without_age",{children:o}),n.push(r.messages.formatMessage(t,i))),n.join(" ")},this.getPlacementNote=function(){var e=a.BookingFormSettings.getInstance(),t=_.maxBy(e.childrenAgeGroups,function(e){return e.maxAge}),t=t?t.maxAge:0;if(e.adultOnly)return r.messages.formatMessage("T:filter.note.adult_only",{minAdultAge:e.minGuestAge||e.adultAge});e=_.head(e.childrenAgeGroups);return e.ageGroupCode===a.api.DefaultAgeGroupCode&&0===e.minAge?null:0===e.minAge?r.messages.formatMessage("T:filter.note.adult",{minAdultAge:t}):r.messages.formatMessage("T:filter.note.adults_and_children",{minAdultAge:t,minChildAge:e.minAge,maxChildAge:t})},this.messages=e}a.PlacementUtil=i}(tl=tl||{}),!function(n){function g(){}g._parsePosition=function(e){var n={left:!1,right:!1,center:!1,top:!1,bottom:!1,middle:!1,hOffset:null,hOffsetUnit:null,vOffset:null,vOffsetUnit:null},e=e.split(" ");return _.each(e,function(e){var e=e.match(/^(\w+)\+?(-?\d+)?([%|\w]*?)?$/),t=e[1],i=e[2],e=e[3];n.hasOwnProperty(t)&&(n[t]=!0,n[((t="left"==t||"right"==t||"center"==t)?"h":"v")+"Offset"]=_.parseInt(i),n[(t?"h":"v")+"OffsetUnit"]=e)}),n},g._applyHOffset=function(e,t){var i=0;return e.left?i+=0:e.right?i+=t.width:e.center&&(i+=t.width/2),e.hOffset&&(t="%"==e.hOffsetUnit?t.width*(e.hOffset/100):e.hOffset,e.left?i+=t:i-=t),i},g._applyVOffset=function(e,t){var i=0;return e.top?i+=0:e.middle?i+=t.height/2:e.bottom&&(i+=t.height),e.vOffset&&(i-="%"==e.vOffsetUnit?t.height*(e.vOffset/100):e.vOffset),i},g._getScreen=function(){var e=AppIntegration.getPosition(),t=n.LayoutManager._getWindowWidth(),i=n.LayoutManager._getWindowHeight(),t={left:Math.max(Math.min(e.scrollLeft,t-e.screenWidth),0),top:Math.max(Math.min(e.scrollTop,i-e.screenHeight),0),width:Math.min(e.screenWidth,t),height:Math.min(e.screenHeight,i)};return(t=AppIntegration.isAvailable()?t:{left:e.scrollLeft,top:e.scrollTop,width:e.screenWidth,height:e.screenHeight}).left+=5,t.top+=5,t.width-=10,t.height-=10,t},g._flipProps=function(e,t,i){e=_.clone(e);return e[t]?(e[t]=!1,e[i]=!0):e[i]&&(e[t]=!0,e[i]=!1),e},g.position=function(e,t,i,n,o,r){void 0===o&&(o=!0),void 0===r&&(r=!0);function a(e,t){var i=window.pageXOffset+p.left-g._applyHOffset(e,d)+g._applyHOffset(t,p),t=!((e=window.pageYOffset+p.top-g._applyVOffset(e,d)+g._applyVOffset(t,p))<u.top)&&_.parseInt(window.getComputedStyle(document.querySelector(".tl-container"),null).getPropertyValue("padding-bottom"))||0;return{left:i,top:e,fitH:i<u.left?u.left-i:Math.min(u.left+u.width-(i+d.width),0),fitV:e<u.top?u.top-e:Math.min(u.top+u.height-(e+d.height)-t,0)}}var s,l,c,u=g._getScreen(),d=e.getBoundingClientRect(),p=t.getBoundingClientRect(),e=g._parsePosition(i),t=g._parsePosition(n),i=a(e,t),n=0,m=0;return 0!=i.fitV&&(0==(c=a(s=g._flipProps(e,"top","bottom"),l=g._flipProps(t,"top","bottom"))).fitV?(i=c,e=s,t=l):o&&(n=i.fitV)),0!=i.fitH&&(0==(c=a(s=g._flipProps(e,"left","right"),l=g._flipProps(t,"left","right"))).fitH?i.left=c.left:r&&(m=i.fitH)),i.top+=n,i.left+=m,i},n.PositionHelper=g}(tl=tl||{}),!function(o){var e;(function(e){function t(){}t.calculateDiscountInPercentage=function(e){var t,i,n=null;return e&&(i=((t=o.BookingFormSettings.getInstance().showNetPrices)?e.priceBeforeDiscount.priceBeforeTax:e.priceBeforeDiscount.priceAfterTax).amount,n=(n=((t?e.priceAfterDiscount.priceBeforeTax:e.priceAfterDiscount.priceAfterTax).amount-i)/i*100).toFixed(1<Math.abs(n)?0:1)),0<=n?n:["−",Math.abs(n)].join("")},e.PriceHelper=t})((e=o.directive||(o.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(n){n.RatePlanUtil=function(e,t){var i=this;this.paymentSystemsText=[],this.getPaymentSystemPriority=function(e){switch(e.type){case n.PaymentSystemType.Cash:return e.paymentSystemCode!=n.PaymentSystemCode.AtOffice?1:2;case n.PaymentSystemType.GuaranteeNoprepay:return 3;case n.PaymentSystemType.CreditCard:return 4;case n.PaymentSystemType.SBP:return 5;case n.PaymentSystemType.Prepay:case n.PaymentSystemType.Guarantee:return 6;case n.PaymentSystemType.MoneyOrder:return 7;case n.PaymentSystemType.PaymentService:return 8;default:return 9}},this.getSortedByPriorityPaymentSystems=function(){return _.chain(i.paymentSystems).uniqBy(function(e){return e.paymentSystemCode==n.PaymentSystemCode.AtOffice?e.type+"."+e.paymentSystemCode:e.type}).sortBy(function(e){return i.getPaymentSystemPriority(e)}).value()},this.getPaymentSystemText=function(e){if(e.paymentSystemCode===n.PaymentSystemCode.ReservMaster)return"T:payment_type.terminal";switch(e.type){case n.PaymentSystemType.Cash:return e.paymentSystemCode==n.PaymentSystemCode.AtOffice?"T:payment_type.office":n.BookingFormSettings.getInstance().isServicesBookingForm()?"T:payment_type.cash_services":"T:payment_type.cash";case n.PaymentSystemType.Prepay:return"T:payment_type.prepay";case n.PaymentSystemType.Guarantee:return"T:payment_type.guarantee";case n.PaymentSystemType.GuaranteeNoprepay:return"T:payment_type.guarantee_noprepay";case n.PaymentSystemType.CreditCard:return"T:payment_type.credit_card";case n.PaymentSystemType.MoneyOrder:return"T:payment_type.cashless";case n.PaymentSystemType.PaymentService:return"T:payment_type.payment_service";case n.PaymentSystemType.Credit:return"T:payment_type.installment";case n.PaymentSystemType.SBP:return"T:payment_type.sbp";default:return""}},this.getPaymentSystemsText=function(){return _.map(i.getSortedByPriorityPaymentSystems(),function(e){return i.getPaymentSystemText(e)})},this.getPaymentSystemsCount=function(){return i.paymentSystemsText.length},this.getPaymentSystems=function(){return i.paymentSystemsText},this.messages=e,this.paymentSystems=t,this.paymentSystemsText=this.getPaymentSystemsText()}}(tl=tl||{}),!function(m){var e;(function(e){function r(){}r.handle=function(e,t,i){r.handleCurrencyRestriction(t),r.handleQuotaRestriction(e.quotas,t),r.handleAvailabilityBlockRestriction(t),1<i.length&&r.handlePaymentSystemsRestriction(t),r.handleWithChildrenOnlyRestriction(t)},r.handleCurrencyRestriction=function(e){var t=null;_.forEach(e,function(e){if(null!=t)return!1;_.forEach(e.roomStays,function(e){if(null!=t)return!1;_.forEach(e.guests,function(e){if(null!=e.guestRatePlan)return t=e.guestRatePlan,!1})})}),r.unsetRestriction(e,m.uiRestriction.Currency),null!=t&&_.forEach(e,function(e){_.forEach(e.roomStays,function(e){_.forEach(e.guests,function(e){_.forEach(e.guestRatePlans,function(e){e.ratePlan.currency.id!=t.ratePlan.currency.id&&e.restrictions.push(new c)})})})})},r.handleAvailabilityBlockRestriction=function(e){r.unsetRestriction(e,m.uiRestriction.AvailabilityBlock),_.forEach(e,function(e){_.forEach(e.roomStays,function(e){var t=_.find(e.guests,function(e){return null!=e.guestRatePlan});null!=t&&_.forEach(e.guests,function(e){_.forEach(e.guestRatePlans,function(e){e.roomTypeQuotaId!=t.guestRatePlan.roomTypeQuotaId&&r.setRestriction(e.restrictions,new o)})})})})},r.handlePaymentSystemsRestriction=function(e){var i=this,t=[],n=(_.forEach(e,function(e){_.forEach(e.roomStays,function(e){_.forEach(e.guests,function(e){null!=e.guestRatePlan&&t.push(e.guestRatePlan)})})}),_.map(t,function(e){return _.map(e.paymentSystems,function(e){return e.id})})),o=_.intersection.apply(this,n);r.unsetRestriction(e,m.uiRestriction.PaymentSystem),_.forEach(e,function(e){_.forEach(e.roomStays,function(e){_.forEach(e.guests,function(e){_.forEach(e.guestRatePlans,function(e){var t;o.length&&(t=_.map(e.paymentSystems,function(e){return e.id}),_.intersection.apply(i,[o,t]).length||r.setRestriction(e.restrictions,new s))})})})})},r.handleWithChildrenOnlyRestriction=function(e){r.unsetRestriction(e,m.uiRestriction.WithChildrenOnly),_.forEach(e,function(e){_.forEach(e.roomStays,function(e){var t=_.find(e.guests,function(e){return null!=e.guestRatePlan});t&&_.forEach(e.guests,function(e){_.forEach(e.guestRatePlans,function(e){t.guestRatePlan.ratePlan.withChildrenOnly?t.guestRatePlan.ratePlan.id!=e.ratePlan.id&&r.setRestriction(e.restrictions,new d):e.ratePlan.withChildrenOnly&&r.setRestriction(e.restrictions,new d)})})})})},r.setRestriction=function(e,t){e.push(t)},r.unsetRestriction=function(e,i){_.forEach(e,function(e){_.forEach(e.roomStays,function(e){_.forEach(e.guests,function(e){_.forEach(e.guestRatePlans,function(e){var t=_.findIndex(e.restrictions,function(e){return e.type==i});0<=t&&e.restrictions.splice(t,1)})})})})},r.handleQuotaRestriction=function(n,e){var o=[];_.forEach(e,function(e){_.forEach(e.roomStays,function(e){e=_.find(e.guests,function(e){return null!=e.guestRatePlan});null!=e&&(o[e.guestRatePlan.roomTypeQuotaId]=o.hasOwnProperty(e.guestRatePlan.roomTypeQuotaId)?++o[e.guestRatePlan.roomTypeQuotaId]:1)})}),r.unsetRestriction(e,m.uiRestriction.OverQuota),_.forEach(e,function(e){_.forEach(e.roomStays,function(e){var i=_.find(e.guests,function(e){return null!=e.guestRatePlan});_.forEach(e.guests,function(e){_.forEach(e.guestRatePlans,function(e){var t;e.roomTypeQuotaId&&(t=o.hasOwnProperty(e.roomTypeQuotaId)?o[e.roomTypeQuotaId]:0)&&n[e.roomTypeQuotaId]&&t>=n[e.roomTypeQuotaId].quantity&&_.isUndefined(i)&&e.restrictions.push(new a)})})})})},e.uiRestrictionManager=r;function t(e,t){this.roomTypeQuotaId=e,this.quantity=t}e.uiRestrictionManagerCriteria=function(){this.quotas=[]};e.uiRestrictionManagerQuotaCriteria=t,i.prototype.message=function(){return"T:shared_room_restriction.over_quota"},Object.defineProperty(i.prototype,"type",{get:function(){return m.uiRestriction.OverQuota},enumerable:!0,configurable:!0});var a=i;function i(){}e.OverQuotaUiRestriction=a;n.prototype.message=function(){return"T:shared_room_restriction.payment_system"},Object.defineProperty(n.prototype,"type",{get:function(){return m.uiRestriction.PaymentSystem},enumerable:!0,configurable:!0});var s=n;function n(){}e.PaymentSystemUiRestriction=s;l.prototype.message=function(){return"T:shared_room_restriction.availability_block"},Object.defineProperty(l.prototype,"type",{get:function(){return m.uiRestriction.OverQuota},enumerable:!0,configurable:!0});var o=l;function l(){}e.AvailabilityBlockRestriction=o;u.prototype.message=function(){return"T:shared_room_restriction.currency"},Object.defineProperty(u.prototype,"type",{get:function(){return m.uiRestriction.Currency},enumerable:!0,configurable:!0});var c=u;function u(){}e.CurrencyUiRestriction=c;p.prototype.message=function(){return"T:shared_room_restriction.with_children_only"},Object.defineProperty(p.prototype,"type",{get:function(){return m.uiRestriction.WithChildrenOnly},enumerable:!0,configurable:!0});var d=p;function p(){}e.WithChildrenOnlyUiRestriction=d})((e=m.directive||(m.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(l){var e;(function(e){function t(){}t.getRatePlanFilterOptions=function(e,t,i,n){var o={},r={},a={},e=(_.forEach(e,function(e){var t=e.ratePlans[0].id,i=(a[t]=a[t]||e.hasRestriction(l.RoomStayRestrictionKind.PromotionalCode),e.price||e.isRoomStayOffer&&(null==(i=_.chain(e.guestPlacementOptions).filter(function(e){return e.kind==l.GuestPlacementKind.Adult&&!!e.price}).minBy(function(e){return e.price.priceAfterDiscount.priceAfterTax.amount}).value())?void 0:i.price));(!o[t]||!e.isRoomStayOffer&&i&&o[t].priceAfterDiscount.priceAfterTax.amount>i.priceAfterDiscount.priceAfterTax.amount)&&(o[t]=i)}),_.forEach(i,function(e){var t=r[e.ratePlanCode],i=void 0===t?1:t.minLos.value,t=void 0===t?Number.MAX_VALUE:t.maxLos.value;r[e.ratePlanCode]=new l.RatePlanRestriction(e.ratePlanCode,n,Math.max(e.rule.minLos,i),Math.min(e.rule.maxLos,t))}),_.filter(t,function(e){return o.hasOwnProperty(e.id)})),s=l.BookingFormSettings.getInstance();return _.map(e,function(e){return{ratePlan:e,restrictedByPromotionCode:a[e.id],ratePlanRestriction:r[e.id],price:o[e.id],isAutoApplyPromoCodeRatePlan:s.isAutoApplyPromoCodeRatePlan(e.id)}})},t.getRoomStaysFilterAccommodation=function(e,o){var r;if(e&&o)return r={},_.forEach(e,function(e){var t=l.PlacementManager.guestPlacementsToPlacement(e.guestPlacementOptions),i=0,n=0;_.forEach(l.PlacementUtil.getPlacementIcons(t),function(t){t.placements&&(_.forEach(o.placements,function(e){e.kind==t.kind&&e.placements==t.placements&&i++}),n++)}),r[e.id]=o.placements.length==i&&i==n}),r},t.hasPromoRatePlans=function(e){return _.some(e,function(e){return(e.promo||e.hasPromoDiscount)&&!e.hasRestriction(l.RoomStayRestrictionKind.PromotionalCode)})},t.getEarliestArrivalDate=function(e){var t=_.head(e).stayDates.startDate;return _.forEach(e,function(e){e.stayDates.startDate.moment().isBefore(t.moment())&&(t=e.stayDates.startDate)}),t},t.getLatestDepartureDate=function(e){var t=_.head(e).stayDates.endDate;return _.forEach(e,function(e){e.stayDates.endDate.moment().isAfter(t.moment())&&(t=e.stayDates.endDate)}),t},e.RoomStayHelper=t})((e=l.directive||(l.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(e){(function(e){function t(){}function i(){}function n(){this._storage=[]}t.Search="search",t.Init="init",t.Reset="reset",e.UiFilterAction=t,i.prototype.store=function(e){this._storage=e},i.prototype.restore=function(){return this._storage},e.UiAccommodationFilterStorage=i,n.prototype.store=function(e){var t=this;this._storage=[],_.forEach(e,function(e){t._storage.push({filterName:e.id,selectedCodes:e.getSelectedCodes()})})},n.prototype.restore=function(i){_.forEach(this._storage,function(e){var t=_.find(i,{id:e.filterName});t&&t.setSelectedCodes(e.selectedCodes)})},n.prototype.isEmpty=function(){var t=!0;return _.forEach(this._storage,function(e){e.selectedCodes.length&&e.selectedCodes[0]!=n.ResetCode&&(t=!1)}),t},n.ResetCode="reset",e.UiFilterStorage=n;e.UiFilterOption=function(e,t,i){void 0===i&&(i=""),this.relatedIds=[],this.code=e,this.name=t,this.categoryIconName=i,this.selected=!1},r.prototype.isValuable=function(){var t=this;return _.some(this.options,function(e){return e.relatedIds.length!=t.matchAll.length})},r.prototype.findOption=function(e){return _.find(this.options,{code:e})},r.prototype.setSelectedCodes=function(e){},r.prototype.getSelectedCodes=function(){return[]},r.prototype.filter=function(){return[]},r.prototype.reset=function(){};var o=r;function r(e,t,i){this.options=[],this.matchAll=[],this.id=e,this.name=t,this.matchAll=i,this.isMultiSelect=!1}__extends(l,a=o),l.prototype.setSelectedCodes=function(e){e=this.findOption(_.head(e));_.isUndefined(e)||((this.selected=e).selected=!0)},l.prototype.getSelectedCodes=function(){return this.selected?[this.selected.code]:[]},l.prototype.filter=function(){return this.selected?this.selected.relatedIds:this.matchAll},l.prototype.reset=function(){this.selected=_.head(this.options)};var a,s=l;function l(){return null!==a&&a.apply(this,arguments)||this}e.UiFilter=s;__extends(u,c=o),u.prototype.setSelectedCodes=function(t){_.forEach(this.options,function(e){e.selected=_.includes(t,e.code)}),this.onOptionChange()},u.prototype.getSelectedCodes=function(){return _.map(_.filter(this.options,{selected:!0}),function(e){return e.code})},u.prototype.filter=function(){return this.getSelectedCodes().length?_.uniq(_.flatten(_.map(_.filter(this.options,{selected:!0}),function(e){return e.relatedIds}))):this.matchAll},u.prototype.reset=function(){_.forEach(this.options,function(e){e.selected=!1}),this.allSelected=!1},u.prototype.markAll=function(){this.allSelected?_.forEach(this.options,function(e){e.selected=!0}):this.reset()},u.prototype.onOptionChange=function(){this.allSelected=!_.some(this.options,{selected:!1})};var c,s=u;function u(e,t,i){e=c.call(this,e,t,i)||this;return e.showSelectAll=!0,e.isMultiSelect=!0,e}e.UiMultiSelectFilter=s})((e=e.directive||(e.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(a){var e;(function(e){function t(e){this._roomStayRatePlans=[],this._roomStayRatePlans=e}t.prototype.buildMealPlanFilter=function(){var e=_.map(this._roomStayRatePlans,function(e){return e.id}),i=new a.directive.helper.UiFilter(a.FilterId.MealPlan,"T:room-stay-filter.meal",e),t=new a.directive.helper.UiFilterOption(a.directive.helper.UiFilterStorage.ResetCode,"T:room-stay-filter.select_reset","food"),o=(t.relatedIds=e,i.options.push(t),i.selected=t,new a.directive.helper.UiFilterOption("meal_exclusive","T:room-stay-filter.meal_exclusive","food")),r=[];return _.forEach(this._roomStayRatePlans,function(n){_.forEach(n.roomStays,function(e){var t=0,i=e.getMealPlans().length;_.forEach(e.getMealPlans(),function(e){e.inclusive()&&(r.push({uiRoomStayRatePlanId:n.id,mealPlan:e}),t++)}),0===t&&(0<i&&(o.description="T:room-stay-filter.meal_exclusive_hint"),o.relatedIds.push(n.id))})}),_.forEach(r,function(e){var t=i.findOption(e.mealPlan.code());t?t.relatedIds.push(e.uiRoomStayRatePlanId):((t=new a.directive.helper.UiFilterOption(e.mealPlan.code(),e.mealPlan.name(),"food")).relatedIds.push(e.uiRoomStayRatePlanId),i.options.push(t))}),o.relatedIds.length&&i.options.push(o),i},t.prototype.buildFreeCancellationFilter=function(){var e=_.map(this._roomStayRatePlans,function(e){return e.id}),t="cancellation-rule",i=new a.directive.helper.UiFilter(a.FilterId.FreeCancellation,"T:room-stay-filter.cancellation",e),n=new a.directive.helper.UiFilterOption(a.directive.helper.UiFilterStorage.ResetCode,"T:room-stay-filter.select_reset",t),o=(n.relatedIds=e,i.options.push(n),i.selected=n,new a.directive.helper.UiFilterOption("free_cancellation","T:room-stay-filter.free_cancellation",t));return _.forEach(this._roomStayRatePlans,function(e){_.some(e.roomStays,function(e){return e.cancellationInfo&&e.cancellationInfo.isFreeCancellation})&&o.relatedIds.push(e.id)}),o.relatedIds.length&&i.options.push(o),i},t.prototype.buildPaymentFilter=function(){var e=_.map(this._roomStayRatePlans,function(e){return e.id}),n=new a.directive.helper.UiFilter(a.FilterId.Payment,"T:room-stay-filter.payment",e),o=new a.RatePlanUtil(null,[]),t=new a.directive.helper.UiFilterOption(a.directive.helper.UiFilterStorage.ResetCode,"T:room-stay-filter.select_reset","purse"),i=(t.relatedIds=e,n.options.push(t),n.selected=t,[]);return _.forEach(this._roomStayRatePlans,function(t){_.forEach(t.roomStays,function(e){_.forEach(e.paymentOptions,function(e){i.push({uiRoomStayRatePlanId:t.id,paymentSystem:e.paymentSystem})})})}),i=_.sortBy(i,function(e){return o.getPaymentSystemPriority(e.paymentSystem)}),_.forEach(i,function(e){var t=o.getPaymentSystemText(e.paymentSystem),i=n.findOption(t);i?i.relatedIds.push(e.uiRoomStayRatePlanId):((i=new a.directive.helper.UiFilterOption(t,t,"purse")).relatedIds.push(e.uiRoomStayRatePlanId),n.options.push(i))}),n},t.prototype.buildRoomOptionsFilter=function(){var e=_.map(this._roomStayRatePlans,function(e){return e.id}),n=new a.directive.helper.UiMultiSelectFilter(a.FilterId.RoomOptions,"T:room-stay-filter.options",e);return n.description="T:room-stay-filter.options_description",_.forEach(this._roomStayRatePlans,function(i){var e=_.flatten(_.map(i.roomStays,function(e){return _.filter(e.getOptions(),{isInclusive:!0})}));_.forEach(e,function(e){var t=n.findOption(e.id());t?t.relatedIds.push(i.id):((t=new a.directive.helper.UiFilterOption(e.id(),e.name())).relatedIds.push(i.id),n.options.push(t))})}),n},e.RoomStayRatePlanFilterBuilder=t})((e=a.directive||(a.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(p){e.None="none",e.Top="top",e.Center="center",e.Bottom="bottom";var n=e;function e(){}function t(){}p.SelectAutoScroll=n,t.scrollToSelected=function(e,t,i){t&&i&&i!=n.None?i==n.Center?e.scrollTop=t.offsetTop-e.clientHeight/2+t.clientHeight:i==n.Bottom?e.scrollTop=t.offsetTop-e.clientHeight+t.clientHeight:i==n.Top&&(e.scrollTop=t.offsetTop):e.scrollTop=0},t.fitOnScreen=function(e,t){var i=e.getBoundingClientRect(),n=_.parseInt(window.getComputedStyle(document.querySelector(".tl-container"),null).getPropertyValue("padding-bottom"))||0,o=AppIntegration.getPosition(),r=p.LayoutManager._getWindowWidth(),a=p.LayoutManager._getWindowHeight(),o=o.screenHeight+o.scrollTop,s=window.getComputedStyle(t),l=t.getBoundingClientRect(),c=l.width+(_.parseInt(s.getPropertyValue("margin-left"))||0)+(_.parseInt(s.getPropertyValue("margin-right"))||0),l=l.height+(_.parseInt(s.getPropertyValue("margin-top"))||0)+(_.parseInt(s.getPropertyValue("margin-bottom"))||0),s=e.clientWidth,e=e.clientHeight,u=i.left+c<r,a=i.top+e+l<a-n,o=i.top+e+l<o-n,n=0,d=0,s=-c+s,u=(!u&&0<i.left+s&&(n=s),-l-e);a&&o||!(0<i.top+u)||(d=u),n=Math.min(r-i.left-c,n),p.HtmlUtil.transform(t,"translate("+n+"px, "+d+"px)")},p.SelectHelper=t}(tl=tl||{}),!function(n){var e;((e=n.directive||(n.directive={})).helper||(e.helper={})).Slider=function(e,t,i){var r=this;this.lastTranslateItem=0,this.viewportCapacity=null,this.slideAt=function(e){var t=r.slider.children.length-1;-1==e&&t-r.getViewportCapacity()<r.lastTranslateItem?r.slide(t-2*r.getViewportCapacity()+1):r.slide(r.lastTranslateItem+r.getViewportCapacity()*e)},this.slideTo=function(e){r.slide(_.indexOf(r.items,e))},this.update=function(){r.viewportCapacity=null,r.slide(r.lastTranslateItem)},this.rangeTranslate=function(e){var t=r.slider.children[r.slider.children.length-1].getBoundingClientRect().right-r.slider.children[0].getBoundingClientRect().left,i=r.viewport.getBoundingClientRect().width;return 0<=i-t?(r.isPrevButtonDisabled=!0,r.isNextButtonDisabled=!0,0):(0<=e?(r.isPrevButtonDisabled=!(e=0),r.isNextButtonDisabled=!1):e<=i-t?(e=i-t,r.isPrevButtonDisabled=!1,r.isNextButtonDisabled=!0):(r.isPrevButtonDisabled=!1,r.isNextButtonDisabled=!1),e)},this.rangeItemIndex=function(e){return e=Math.max(e,0),e=Math.min(e,r.slider.children.length-1)},this.animate=function(e){n.HtmlUtil.transform(r.slider,"translate("+e+"px, 0)")},this.getOffsetFromParent=function(e){return r.slider.children[e].getBoundingClientRect().left-r.slider.getBoundingClientRect().left},this.slide=function(e){e=r.rangeItemIndex(e),r.lastTranslateItem=e;for(var t=r.rangeTranslate(-r.getOffsetFromParent(e)),t=(r.animate(t),r.getViewportCapacity()),i=Math.min(e,r.rangeItemIndex(r.slider.children.length-t-1)),n=r.rangeItemIndex(e+t),o=i;o<=n;o++)r.items[o].show()},this.getViewportCapacity=function(){var e,t;return null===r.viewportCapacity&&(e=parseFloat(window.getComputedStyle(r.viewport).width),t=parseFloat(window.getComputedStyle(r.slider.children[0]).width),r.viewportCapacity=Math.floor(e/t)),r.viewportCapacity},this.viewport=e,this.slider=t,this.items=i,this.isPrevButtonDisabled=!1,this.isNextButtonDisabled=!1}}(tl=tl||{}),!function(i){var e;(function(e){function t(){}t.reloadPage=function(e){e.current.name!=i.AppState.Rooms_List&&e.current.name!=i.AppState.Rooms_FilteredList||e.go(i.AppState.Rooms,{},{reload:!0}),e.current.name!=i.AppState.RoomsSearchCriteria_All&&e.current.name!=i.AppState.RoomsSearchCriteria_Filtered||e.go(i.AppState.RoomsSearchCriteria,{},{reload:!0}),e.current.name!=i.AppState.RoomInfo&&e.current.name!=i.AppState.SharedRatePlans&&e.current.name!=i.AppState.SharedRatePlans_List&&e.current.name!=i.AppState.SharedRatePlans_FilteredList&&e.current.name!=i.AppState.RoomsGuestAccommodation&&e.current.name!=i.AppState.RatePlansGuestAccommodation&&e.current.name!=i.AppState.Rooms_Grid||e.reload()},e.StateHelper=t})((e=i.directive||(i.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(i){var e;(function(e){function t(){}t.resolveTaxAmountsKind=function(e){e=_.map(e,function(e){return e&&e.tax});return t.resolveTaxesKind(e)},t.resolveTaxesKind=function(e){var t=null;return _.each(e,function(e){e&&t!=i.TaxUnitKind.TaxAndFee&&(e.type==i.TaxType.Tax?t=t==i.TaxUnitKind.Fee?i.TaxUnitKind.TaxAndFee:i.TaxUnitKind.Tax:e.type==i.TaxType.Fee&&(t=t==i.TaxUnitKind.Tax?i.TaxUnitKind.TaxAndFee:i.TaxUnitKind.Fee))}),t||i.TaxUnitKind.TaxAndFee},e.TaxHelper=t})((e=i.directive||(i.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(n){t.prototype.getTimeLabel=function(e){return this.timeLabel+(e?"to":"from")},t.prototype.getDateLabel=function(e){return this.dateLabel+(e?"to":"from")};var e=t;function t(){this.stationLabel="",this.tripNumberLabel="",this.wagonNumberLabel="",this.departurePlaceLabel="",this.transportCompanyLabel="",this.additionalInfoLabel="additional",this.timeLabel="",this.dateLabel=""}n.BaseForm=e;__extends(r,i=e);var i,o=r;function r(){var e=null!==i&&i.apply(this,arguments)||this;return e.stationLabel="train_station",e.tripNumberLabel="train_trip_number",e.wagonNumberLabel="wagon_number",e.timeLabel="train_arrival_",e.dateLabel="train_arrival_date_",e}n.TrainForm=o;__extends(l,a=e);var a,s=l;function l(){var e=null!==a&&a.apply(this,arguments)||this;return e.stationLabel="air_station",e.tripNumberLabel="air_trip_number",e.departurePlaceLabel="air_flight_from",e.transportCompanyLabel="air_flight_company",e.timeLabel="air_arrival_",e.dateLabel="air_arrival_date_",e}n.AirForm=s;__extends(d,c=e);var c,u=d;function d(){var e=null!==c&&c.apply(this,arguments)||this;return e.stationLabel="bus_station",e.tripNumberLabel="bus_trip_number",e.timeLabel="bus_arrival_",e.dateLabel="bus_arrival_date_",e}n.BusForm=u;__extends(g,p=e);var p,m=g;function g(){return null!==p&&p.apply(this,arguments)||this}n.CustomForm=m;f.getForm=function(e){switch(e){case n.TransferType.Airport:return new s;case n.TransferType.Bus:return new u;case n.TransferType.Railway:return new o;case n.TransferType.Custom:return new m;default:throw Error("Unexpected transfer type")}};var h=f;function f(){}function v(){}function y(e,t){this.hours24=null,this.hours12=null,this.timePeriodKind=null,this.minutes=null,this._is24HoursLocale=t,e&&(this.initMinutes(e),this._is24HoursLocale?this.init24hours(e):this.init12hours(e))}function b(){}function S(){}n.TransferFormHelper=h,v.getDirection=function(e,t,i){t=i.formatMessage("T:transfer.provider_name",{type:t}),i=v.getEndPoint(e,i),t=_.map([t,i],function(e){return n.StringUtil.capitalize(e)});return e.transferOffer.transfer.isToHotelDirection&&_.reverse(t),t.join(" → ")},v.getEndPoint=function(e,t){var i=h.getForm(e.transferOffer.transfer.transferType),t=i.stationLabel?t.getMessage("T:transfer."+i.stationLabel):void 0,i=null!=(i=e.transferOffer.transfer.endPoint)?i:e.transferOffer.transfer.name;return _.chain([t,i]).without(void 0).join(" ").value()},n.TransferUtil=v,y.prototype.initMinutes=function(e){this.minutes=parseInt(e.format("m"))},y.prototype.init24hours=function(e){this.hours24=parseInt(e.format("H"))},y.prototype.init12hours=function(e){this.hours12=parseInt(e.format("h")),this.timePeriodKind="AM"==e.format("A")?n.TimePeriodKind.Am:n.TimePeriodKind.Pm},y.prototype.timeFrom24Hours=function(){return _.isNull(this.minutes)||_.isNull(this.hours24)?null:new Date(0,0,0,this.hours24,this.minutes)},y.prototype.timeFrom12Hours=function(){var e;return _.isNull(this.minutes)||_.isNull(this.timePeriodKind)||_.isNull(this.hours12)?null:(e=this.hours12+":"+this.minutes+" "+this.timePeriodKind,e=moment(e,"hh:mm A"),this.minutes=parseInt(e.format("m")),this.hours24=parseInt(e.format("H")),this.timeFrom24Hours())},Object.defineProperty(y.prototype,"time",{get:function(){return this._is24HoursLocale?this.timeFrom24Hours():this.timeFrom12Hours()},enumerable:!0,configurable:!0}),y.prototype.switchLocale=function(){this._is24HoursLocale?this.init12hours(this.time):this.timeFrom12Hours(),this._is24HoursLocale=!this._is24HoursLocale},n.LocaleTime=y,Object.defineProperty(b,"current",{get:function(){return b._number},enumerable:!0,configurable:!0}),b.getNext=function(){return++this._number},b._number=0,n.TransferNumberProvider=b,S.countClickEvent=function(){this._clickEventsCount++},S.getClickEventsCount=function(){return this._clickEventsCount},S._clickEventsCount=0,n.TransferMetricsProvider=S}(tl=tl||{}),!function(t){function i(){}i.getDownloadUrl=function(e){return e+(t.DeviceUtil.isMobile()?"":i.downloadUrlParam)},i.getPrintUrl=function(e){return e+i.printUrlParam},i.downloadUrlParam="&save=1",i.printUrlParam="&print_on_open=1",t.VoucherUtil=i}(tl=tl||{}),!function(i){var e;(function(e){function t(){}t.resolveUiDiscountType=function(e){return _.includes([i.DiscountType.Tourist,i.DiscountType.Registration,i.DiscountType.PromotionCode,i.DiscountType.Loyalty],e)},t.getIcon=function(e){switch(e){case i.DiscountType.Tourist:case i.DiscountType.Registration:case i.DiscountType.Loyalty:return"reward";case i.DiscountType.PromotionCode:return"unlock2"}return null},t.getLabel=function(e,t){switch(e){case i.DiscountType.Tourist:case i.DiscountType.Registration:case i.DiscountType.Loyalty:return t.getMessage("T:discount.personal");case i.DiscountType.PromotionCode:return t.getMessage("T:discount.promocode")}return null},e.DiscountHelper=t})((e=i.directive||(i.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(o){function r(){}r.setIsRegistered=function(e){this._isRegistered=e;try{return localStorage.setItem(this._isRegisteredKey,this._isRegistered.toString())}catch(e){}},r.isRegistered=function(){if(_.isUndefined(this._isRegistered))try{this._isRegistered="true"==localStorage.getItem(this._isRegisteredKey)}catch(e){}return this._isRegistered},r.findPaymentSystemWithCashback=function(e){return e&&_.find(e,function(e){return r.isPaymentSystemWithCashback(e)})},r.findPaymentOptionWithCashback=function(e){return e&&_.find(e,function(e){return r.isPaymentSystemWithCashback(e.paymentSystem)})},r.isPaymentSystemWithCashback=function(e){return e&&e.hasMirCashback},r.isPaymentOptionWithFullPrepayment=function(e,t){return e.paymentSystem.type==o.PaymentSystemType.CreditCard&&e.prepayment&&Math.round(t.priceBeforeTax.amount)===Math.round(e.prepayment.amount)&&t.priceBeforeTax.currency.id===e.prepayment.currency.id},r.findPrepaymentAmount=function(e){return e&&e.transactionAmount&&"RUB"===e.transactionAmount.currency.id?e.transactionAmount:e&&e.prepayment&&"RUB"===e.prepayment.currency.id?e.prepayment:null},r.findCashbackAmount=function(e){var t=o.BookingFormSettings.getInstance().promoMirSettings;if(!t||!e)return null;var e=r.findPrepaymentAmount(e);return e&&e.currency.id==t.maxCashback.currency.id?((e=o.PriceAmountCalculator.mul(e,.01*t.cashbackPercent)).amount=Math.floor(e.amount),e.amount>t.maxCashback.amount?t.maxCashback:e):null},r.isStayLengthValid=function(e){var t=o.BookingFormSettings.getInstance().promoMirSettings;if(!t||!e)return!1;var i=o.BookingFormSettings.getInstance().stayUnitKind;return t.minNights+(i==o.StayUnitKind.Night?0:1)<=e.duration().value},r.isArrivalDateValid=function(e){var t=o.BookingFormSettings.getInstance().promoMirSettings;if(!t||!e)return!1;e=moment(e.startDate.resetTime());return!e.isBefore(t.bookingPeriod.startDate)&&!e.isAfter(t.bookingPeriod.endDate)},r.isShowingMotivator=function(e){var t=o.BookingFormSettings.getInstance().promoMirSettings;if(!t)return!1;e=moment(e.resetTime());return!e.isAfter(t.bookingPeriod.endDate)&&!e.isBefore(t.bookingPeriod.startDate.addMonths(-1))},r.isDepartureDateValid=function(e){var t=o.BookingFormSettings.getInstance().promoMirSettings;if(!t)return!1;e=moment(e.endDate.resetTime());return!e.isBefore(t.bookingDeparturePeriod.startDate)&&!e.isAfter(t.bookingDeparturePeriod.endDate)},r.isBookingPeriodValid=function(e){return!(!o.BookingFormSettings.getInstance().promoMirSettings||!e)&&(this.isArrivalDateValid(e)&&this.isDepartureDateValid(e))},r.getCurrentShowPeriod=function(){var e=o.BookingFormSettings.getInstance().promoMirShowPeriod;if(!e)return null;var t=moment(o.DateUtil.convertToHotelDate(new Date,"+03:00").resetTime());return!t.isBefore(e.startDate)&&!t.isAfter(e.endDate)?o.MirShowPeriod.Running:t.isAfter(e.endDate)?o.MirShowPeriod.Over:o.MirShowPeriod.NotStarted},r.isShowPeriodValid=function(){return this.getCurrentShowPeriod()==o.MirShowPeriod.Running},r.showMirPromotional=function(e,t,i){if(!e||!t&&!i||!o.BookingFormSettings.getInstance().isMirCashbackAvailable())return!1;var n=r.isBookingPeriodValid(e),e=r.isStayLengthValid(e),i=i&&i.length&&!!r.findPaymentOptionWithCashback(i),t=t&&t.length&&!!r.findPaymentSystemWithCashback(t);return n&&e&&(i||t)},r.getMirCashbackDescription=function(e){var t=_.find(e.guestStays,function(e){return!!e.roomStay.cancellationInfo.mirCashbackDescription});return r.findPaymentOptionWithCashback(e.paymentOptions)&&!_.isUndefined(t)&&t.roomStay.cancellationInfo.mirCashbackDescription},r.getMessageParams=function(){var e=o.BookingFormSettings.getInstance(),t=e.promoMirSettings,i=e.promoMirShowPeriod;if(!t||!i)return{};e=e.stayUnitKind;return{nights:new o.StayDuration(e,t.minNights+(e==o.StayUnitKind.Night?0:1)),cbPercent:t.cashbackPercent,maxCbAmount:t.maxCashback,promoShowPeriodStart:i.startDate,promoShowPeriodEnd:i.endDate,bookingPeriodStart:t.bookingPeriod.startDate,bookingPeriodEnd:t.bookingPeriod.endDate,bookingDeparturePeriodStart:t.bookingDeparturePeriod.startDate,bookingDeparturePeriodEnd:t.bookingDeparturePeriod.endDate}},r.canOpenNewPage=function(){var e=AppIntegration&&AppIntegration.getPosition(),e=e&&e.screenHeight;return e&&e<850||o.DeviceUtil.isMobile()},r.canOpenRegisterModal=function(){var e=o.DeviceUtil.getBrowser(),t=o.DeviceUtil.getOS();if(!e||!t)return!0;var t=t.name,i=e.name,e=parseInt((e.version||"99").split(".")[0],10);return("Internet Explorer"!==i&&"Microsoft Edge"!==i||!(e<=18))&&(!("Windows"===t&&"Firefox"===i&&e<=54)&&(!("Windows"===t&&"Chrome"===i&&e<=50)&&!("Windows"===t&&"Opera"===i&&e<=46)))},r.isTlDomain=function(){var t=AppIntegration&&AppIntegration.getSource();return _.some(this._tlDomains,function(e){return t&&-1!=t.indexOf(e)})},r.isRosturismReferer=function(){var t=AppIntegration&&AppIntegration.getProperties()&&AppIntegration.getProperties().utm_source;return _.some(this._tlRosturismSources,function(e){return t==e})},r.isTestOrder=function(e){return e&&_.some(e.guestStays,function(e){return e.roomStay&&e.roomStay.ratePlan&&0<=e.roomStay.ratePlan.name.toLocaleLowerCase().indexOf("тестмир")})},r._isRegisteredKey="tl-mir-registered-2",r._tlDomains=["b.tlintegration.com","qatl.ru"],r._tlRosturismSources=["Rostourism"],o.MirCashbackUtil=r}(tl=tl||{}),!function(e){(function(e){function t(){}t.getRatePlansNames=function(e,t){return _.chain(e).map(function(e){return null==(e=t.getRatePlan(e))?void 0:e.name}).filter(function(e){return null!=e}).value()},t.getRoomTypesNames=function(e,t){return _.chain(e).map(function(e){return null==(e=t.getRoom(e))?void 0:e.name}).filter(function(e){return null!=e}).value()},e.PromoCodeHelper=t})((e=e.directive||(e.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(a){var e;(function(e){function t(e){this._order=e}t.prototype._getBookingOptions=function(){return this._order.options},t.prototype._getGuestStaysOptions=function(){return _.chain(this._order.guestStays).map(function(e){return e.roomOptions.concat(e.mealPlans)}).flatten().value()},t.prototype._getOptions=function(){return this._getBookingOptions().concat(this._getGuestStaysOptions())},t.prototype._getSpecialOptions=function(){return _.filter(this._getGuestStaysOptions(),function(e){var t=e.option.chargeType();return!e.isInclusive()&&(t===a.ChargeType.PerPerson||t===a.ChargeType.PerPersonPerNight)})},t.prototype._getSpecialOptionsPrice=function(){var t=a.Price.empty(this._order.totalPrice().currency);return _.forEach(this._getSpecialOptions(),function(e){a.PriceCalculator.isAllowOperation(t,e.getTotalPrice())&&a.PriceCalculator.sumTo(t,e.getTotalPrice())}),t},t.prototype.getOptionsPrice=function(){var t=a.Price.empty(this._order.totalPrice().currency);return _.forEach(this._getOptions(),function(e){a.PriceCalculator.isAllowOperation(t,e.getTotalPrice())&&a.PriceCalculator.sumTo(t,e.getTotalPrice())}),t},t.prototype.getSpecialOptionsQuantityMetrics=function(e){var o=this,t=(void 0===e&&(e=this._order.guestStays),0),r=0;return _.forEach(e,function(n){var e;_.forEach(n.roomOptions.concat(n.mealPlans),function(e){var t=e.getQuantity(),i=a.OptionUtil.optionMaxQuantity(o._order,e.option,n);e.isInclusive()||0==t||t==i||r++}),e=(e=n.roomStay.getOptions()).concat(n.roomStay.getMealPlans()),e=_.filter(e,function(e){var t=e.chargeType();return!e.inclusive()&&(t===a.ChargeType.PerPerson||t===a.ChargeType.PerPersonPerNight)}),e=_.filter(e,function(t){return!t.hasPlacementIndex()||_.some(_.filter(n.guestPlacements,function(e){return e.index===t.getPlacementIndex()}))}),t+=_.reduce(e,function(e,t){return e+a.OptionUtil.optionMaxQuantity(o._order,t,n)},0)}),{maxQuantity:t,changed:r}},t.prototype.getLog=function(e){return{page:e,segment:a.TrackerService.getExperimentSegment(a.Experiment.ServicesViewMode,a.ServicesViewModeExperiment.getSegments()),isSeveralRooms:1<this._order.guestStays.length,roomsCount:this._order.guestStays.length,hasServices:_.some(this._getOptions()),servicesPriceAmount:this.getOptionsPrice().priceAfterTax.amount,servicesPriceCurrency:this.getOptionsPrice().priceAfterTax.currency.id,hasSpecialServices:_.some(this._getSpecialOptions()),suggestedSpecialServicesCount:this.getSpecialOptionsQuantityMetrics().maxQuantity,changedSpecialServicesCount:this.getSpecialOptionsQuantityMetrics().changed,specialServicesPriceAmount:this._getSpecialOptionsPrice().priceAfterTax.amount,specialServicesPriceCurrency:this._getSpecialOptionsPrice().priceAfterTax.currency.id,orderPriceAmount:this._order.totalPrice().priceAfterTax.amount,orderPriceCurrency:this._order.totalPrice().priceAfterTax.currency.id}},e.ServicesExperimentHelper=t})((e=a.directive||(a.directive={})).helper||(e.helper={}))}(tl=tl||{}),!function(e){function t(){this.optionCategories=[],this.options=[],this.meals=[],this.transfers=[],this.ratePlans=[],this.ratePlanCategories=[],this.paymentSystems=[],this.countries=[],this.roomFeatureCategories=[],this.rooms=[],this.stayOptions=[],this.bookingStayOptions=[],this.stayOfferOptions=[],this.vehicles=[],this.taxes=[]}t.prototype.setStayOptions=function(e){this.stayOptions=e},t.prototype.setStayOfferOptions=function(e){this.stayOfferOptions=e},t.prototype.setBookingStayOptions=function(e){this.bookingStayOptions=e},t.prototype.getStayOptions=function(e){return void 0===e&&(e=!1),this.stayOptions.concat(this.stayOfferOptions).concat(e?this.bookingStayOptions:[])},t.prototype.setProvider=function(e){this.provider=e},t.prototype.getProvider=function(){return this.provider},t.prototype.setCountries=function(e){this.countries=e},t.prototype.getCountry=function(t){return _.find(this.countries,function(e){return e.countryCode3==t})},t.prototype.setRooms=function(e){this.rooms=e},t.prototype.getRoom=function(t){return _.find(this.rooms,function(e){return e.id==t})},t.prototype.setRoomFeatureCategories=function(e){this.roomFeatureCategories=e},t.prototype.getRoomFeatureCategory=function(t){return _.find(this.roomFeatureCategories,function(e){return e.id==t})},t.prototype.setOptionCategories=function(e){this.optionCategories=e},t.prototype.getOptionCategory=function(t){return _.find(this.optionCategories,function(e){return e.id==t})},t.prototype.setOptions=function(e){this.options=e},t.prototype.getOption=function(t){return _.find(this.options,function(e){return e.id==t})},t.prototype.setMeals=function(e){this.meals=e},t.prototype.getMeal=function(t){return _.find(this.meals,function(e){return e.id==t})},t.prototype.setRatePlans=function(e){this.ratePlans=e},t.prototype.getRatePlan=function(t){return _.find(this.ratePlans,function(e){return e.id==t})},t.prototype.setRatePlanCategories=function(e){this.ratePlanCategories=e},t.prototype.getRatePlanCategory=function(t){return _.find(this.ratePlanCategories,function(e){return e.id==t})},t.prototype.setPaymentSystems=function(e){this.paymentSystems=e},t.prototype.getPaymentSystem=function(t){return _.find(this.paymentSystems,function(e){return e.code==t})},t.prototype.setTransfers=function(e){this.transfers=e},t.prototype.getTransfer=function(t){return _.find(this.transfers,function(e){return e.id==t})},t.prototype.setVehicles=function(e){this.vehicles=e},t.prototype.getVehicle=function(t){return _.find(this.vehicles,function(e){return e.id==t})},t.prototype.setTaxes=function(e){this.taxes=e},t.prototype.getTax=function(t){return _.find(this.taxes,function(e){return e.id==t})},t.prototype.getHotelAvailabilityInfo=function(){return this.hotelAvailabilityInfo},t.prototype.setHotelAvailabilityInfo=function(e){this.hotelAvailabilityInfo=e},t.prototype.getSurveyConfig=function(){return this.surveyConfig},t.prototype.setSurveyConfig=function(e){this.surveyConfig=e},t.prototype.clean=function(){this.setStayOptions([]),this.setStayOfferOptions([]),this.setBookingStayOptions([]),this.setProvider(null),this.setCountries([]),this.setRoomFeatureCategories([]),this.setRooms([]),this.setOptionCategories([]),this.setOptions([]),this.setMeals([]),this.setRatePlans([]),this.setRatePlanCategories([]),this.setPaymentSystems([]),this.setTransfers([]),this.setVehicles([]),this.setTaxes([]),this.setHotelAvailabilityInfo(null),this.setSurveyConfig(null)},e.ServiceStorage=t}(tl=tl||{}),!function(e){function t(){}t.setPointOfSale=function(e,t,i,n,o,r,a){e.point_of_sale={},t&&(e.point_of_sale.source=t),i&&(e.point_of_sale.source_url=i),n&&(e.point_of_sale.referrer_code=n),o&&(e.point_of_sale.integration_key=o),r&&(e.point_of_sale.utm_parameters=r),a&&(e.point_of_sale.roistat_parameters=a)},e.ApiBuilderAbstract=t}(tl=tl||{}),!function(s){e=s.ApiBuilderAbstract,__extends(i,e),i.build=function(e,t,i,n,o,r){var a={hotel:e.providerId,start_date:s.UnitConverter.dateToString(e.startDate),end_date:s.UnitConverter.dateToString(e.endDate),currency:e.currency.id};return _.isUndefined(t)||(a.max_nights=t),_.isUndefined(i)||(a.aggregate_dates=i),_.isUndefined(n)||(a.shared=n),_.some(r)&&(a.room_types=_.map(r,function(e){return{code:e}})),s.GuestProfileUtil.isUserAuthenticated(e.providerId)&&(a.gp_token=s.GuestProfileUtil.getGpToken(e.providerId)),s.ApiBuilderAbstract.setPointOfSale(a,o),a};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}s.ApiRoomTypeAvailabilityBuilder=t}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.setPromoCode=function(e,t){t&&_.forEach(e,function(e){e.promo_code=t})},n.setCurrency=function(e,t){t&&(e.currency=t.id)},n.setBookingReference=function(e,t){t&&(e.hotel_reservation_ref={number:t.bookingNumber,verification:{cancellation_code:t.cancellationCode}})};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.AvailabilityBuilderAbstract=i}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e){return{include_payment_systems:!0,hotel:{code:e}}};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiBookingFormSettingsBuilder=i}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e,t){return{language:t.locale(),include_countries:!0,hotel:{code:e}}};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiCommonInfoBuilder=i}(tl=tl||{}),!function(o){e=o.AvailabilityBuilderAbstract,__extends(r,e),r.build=function(e,t,i,n){t={include_rates:!0,include_transfers:!0,include_all_placements:t=null==t?o.BookingFormSettings.getInstance().isManualAccommodationMode()&&!o.BookingFormSettings.getInstance().isModeTurnedOn(o.BookingFormMode.SharedAccommodationRatePlan):t,include_promo_restricted:!0,language:e.language.locale(),criterions:t?r.buildCriteriaWithoutAccommodation(e):r.buildCriteriaWithAccommodation(e,i)};return o.GuestProfileUtil.isUserAuthenticated(e.providerId)&&(t.gp_token=o.GuestProfileUtil.getGpToken(e.providerId)),o.AvailabilityBuilderAbstract.setPromoCode(t.criterions,e.promoCode),o.AvailabilityBuilderAbstract.setCurrency(t,e.currency),o.AvailabilityBuilderAbstract.setBookingReference(t,n),o.ApiBuilderAbstract.setPointOfSale(t,e.source),t},r.buildCriteriaWithoutAccommodation=function(e){return[{ref:"0",min_room_type_availability:1,start_date:o.UnitConverter.dateToString(e.checkInDate),end_date:o.UnitConverter.dateToString(e.checkOutDate),hotels:[{code:e.providerId}],guests:[]}]},r.buildChildren=function(e){return _.map(e,function(e){return{age:e.age,count:1}})},r.buildCriteriaWithAccommodation=function(e,t){return e.placements.length?r.buildCriteriaByPlacements(e,t):r.buildCriteriaByRatePlans(e)},r.buildCriteriaByRatePlans=function(e){var t={ref:"0",min_room_type_availability:1,start_date:o.UnitConverter.dateToString(e.checkInDate),end_date:o.UnitConverter.dateToString(e.checkOutDate),guests:[],hotels:[{code:e.providerId}]},i=[];return _.each(e.guestRatePlans,function(t){t.adults&&i.push({count:t.adults,rate_plan_code:t.ratePlan.id}),_.each(t.children,function(e){i.push({count:1,age:e.age,rate_plan_code:t.ratePlan.id})})}),t.guests=i,[t]},r.buildCriteriaByPlacements=function(i,n){var e=_.map(i.placements,function(e){return{ref:e.ref.toString(),min_room_type_availability:1,start_date:o.UnitConverter.dateToString(i.checkInDate),end_date:o.UnitConverter.dateToString(i.checkOutDate),hotels:[{code:i.providerId}]}});return _.forEach(e,function(t){var e=_.find(i.placements,function(e){return e.ref==t.ref});e.roomTypeId?(n||(t.room_type_code=e.roomTypeId),t.guests=[],_.each(e.adultPlacements,function(e){t.guests.push({count:1,rate_plan_code:e.ratePlanId})}),_.each(e.children,function(e){t.guests.push({count:1,age:e.age,rate_plan_code:e.ratePlanId})})):t.guests=[{count:e.adults}].concat(r.buildChildren(e.children))}),e};var e,t=r;function r(){return null!==e&&e.apply(this,arguments)||this}o.ApiHotelAvailabilityBuilder=t}(tl=tl||{}),!function(n){e=n.AvailabilityBuilderAbstract,__extends(o,e),o.build=function(e,t){var i={include_rates:!0,include_transfers:!0,include_promo_restricted:!0,language:e.language.locale(),criterions:o.buildCriterion(e)};return n.GuestProfileUtil.isUserAuthenticated(e.providerId)&&(i.gp_token=n.GuestProfileUtil.getGpToken(e.providerId)),n.AvailabilityBuilderAbstract.setPromoCode(i.criterions,e.promoCode),n.AvailabilityBuilderAbstract.setCurrency(i,e.currency),n.AvailabilityBuilderAbstract.setBookingReference(i,t),n.ApiBuilderAbstract.setPointOfSale(i,e.source),i},o.buildCriterion=function(e){return[{ref:"1",start_date:n.UnitConverter.dateToString(e.checkInDate),end_date:n.UnitConverter.dateToString(e.checkOutDate),hotels:[{code:e.providerId}]}]};var e,t=o;function o(){return null!==e&&e.apply(this,arguments)||this}n.ApiHotelOfferAvailabilityBuilder=t}(tl=tl||{}),!function(o){e=o.ApiBuilderAbstract,__extends(i,e),i.build=function(e,t,i,n){t={language:t.locale(),hotels:[{code:e}]};return o.GuestProfileUtil.isUserAuthenticated(e)&&(t.gp_token=o.GuestProfileUtil.getGpToken(e)),n&&(t.promo_code=n),o.ApiBuilderAbstract.setPointOfSale(t,i),t};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}o.ApiHotelInfoBuilder=t}(tl=tl||{}),!function(a){e=a.ApiBuilderAbstract,__extends(i,e),i.build=function(e,t,i,n){var o=t.moment().quarter(),t=new Date(t.getFullYear(),0,1,0,0,0,0),r=t.moment().quarter(o).toDate(),t=t.moment().quarter(o+1).add(-1,"days").toDate(),o={hotel:e,start_date:a.UnitConverter.dateToString(r),end_date:a.UnitConverter.dateToString(t),shared:i};return n&&a.ApiBuilderAbstract.setPointOfSale(o,n),o};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}a.ApiHotelBookingRulesBuilder=t}(tl=tl||{}),!function(s){e=s.ApiBuilderAbstract,__extends(i,e),i.build=function(e,t,i,n,o){var r=i.moment().month(),i=new Date(i.getFullYear(),0,1,0,0,0,0),a=i.moment().month(r).toDate(),i=i.moment().month(r+1).add(-1,"days").toDate(),r={hotel:e,rate_plans:_.map(t,function(e){return{code:e}}),start_date:s.UnitConverter.dateToString(a),end_date:s.UnitConverter.dateToString(i)};return o&&(r.promo_code=o),n&&s.ApiBuilderAbstract.setPointOfSale(r,n),r};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}s.ApiRatePlanBookingRulesBuilder=t}(tl=tl||{}),!function(c){e=c.ApiBuilderAbstract,__extends(u,e),u.buildCustomer=function(e){var t=[{phone_number:e.phone.number()||"+",tech_type:""}],i=(e.confirmSms&&t.push({phone_number:e.phone.number()||"+",tech_type:"mobile"}),e.comment);return e.travelPurposeIsBusiness&&(i+="\nЯ путешествую по работе"),{first_name:e.firstName,middle_name:e.middleName,last_name:e.lastName,comment:i,confirm_sms:e.confirmSms,subscribe_email:e.subscribeEmail,contact_info:{phones:t,emails:[{email_address:e.email}]}}},u.buildTransfers=function(e){var t=[];return null!=e&&_.forEach(e,function(e){e.isSelected()&&t.push(i.build(e))}),t},u.buildOptions=function(e,i){var n=[];return null!=e&&_.forEach(e,function(e){var t;!e.isInclusive()&&0<e.getQuantity()&&(t={code:e.option.code(),quantity:e.getQuantity()},e.option.hasPlacementIndex()&&(t.placement_index=i[e.option.getPlacementIndex()]),n.push(t))}),n},u.buildBookingOptions=function(e){var t=[];return _.forEach(e,function(e){!e.isInclusive()&&0<e.getQuantity()&&t.push({code:e.option.code(),quantity:e.getQuantity()})}),t},u.buildGuests=function(o,e,r){if(!_.some(o,function(e){return e.firstName&&e.lastName}))return[];var a=0,s=[],l=!1;return _.forEach(e,function(e){for(var t=0;t<e.guests;t++){var i,n=o[a]||null;n&&n.firstName&&n.lastName?(l=l||e.kind==c.GuestPlacementKind.Adult,i={first_name:n.firstName,middle_name:n.middleName,last_name:n.lastName,placement:{index:r[e.index]}},n.citizenship&&(i.citizenship=n.citizenship),n.sex&&(i.sex=n.sex.toString()),n.postalCode&&(i.postal_code=n.postalCode),n.region&&(i.region=n.region),n.city&&(i.city=n.city),n.birthday&&(i.birthday=c.UnitConverter.dateToString(n.birthday)),s.push(i)):s.push({first_name:"",middle_name:"",last_name:"",placement:{index:r[e.index]}}),++a}}),l?s:[]},u.build=function(e,t,i,n,o){void 0===o&&(o=!1);var r=e.provider,a=e.guestStays.map(function(e){var t=e.roomStay,i=[],n=1,o={},r=(_.forEach(e.guestPlacements,function(e){var t={index:n,kind:e.kind,code:e.code};e.ratePlan&&(t.rate_plan_code=e.ratePlan.id),i.push(t),o[e.index]=n,n++}),[]),a=(_.forEach(e.guestPlacements,function(t){t.adults&&r.push({count:t.adults,age_qualifying_code:c.AgeQualifyingCode.Adult,placement_index:o[t.index]}),_.forEach(t.childrenPlacements,function(e){r.push({count:1,age_qualifying_code:c.AgeQualifyingCode.Child,age:e.age,placement_index:o[t.index]})})}),u.buildGuests(e.guests,e.guestPlacements,o)),s=_.union(u.buildOptions(e.roomOptions,o),u.buildOptions(e.mealPlans,o)),l=_.map(_.filter(e.roomPreferences,function(e){return e.selected}),function(e){return{code:e.roomPreference.code,category_code:e.roomPreference.categoryCode}}),e={stay_dates:{start_date:c.UnitConverter.dateToString(e.roomStay.stayDates.startDate,e.arrival().time()),end_date:c.UnitConverter.dateToString(e.roomStay.stayDates.endDate,e.departure().time())},room_types:[{code:t.roomType.id,placements:i,preferences:l}],rate_plans:_.map(t.ratePlans,function(e){return{code:e.id}}),guest_count_info:{guest_counts:r},services:s};return a.length&&(e.guests=a),e}),a={hotel_ref:{code:r.id},room_stays:a,transfers:this.buildTransfers(e.transfers),services:this.buildBookingOptions(e.options)},t=(e.number&&(a.number=e.number),(e.cancellationCode||e.paymentCode)&&(a.verification={},e.cancellationCode&&(a.verification.cancellation_code=e.cancellationCode),e.paymentCode&&(a.verification.payment_code=e.paymentCode)),t&&i&&(a.guarantee={code:t.code,success_url:i,decline_url:n}),e.pointOfSale),i=((t&&t.source===c.BookingSourceCode.Extranet&&e.customer.phone.number()||e.customer.email&&e.customer.email.length)&&(a.customer=u.buildCustomer(e.customer)),e.promoCode&&(a.promo_code=e.promoCode),e.artifacts&&(a.artifacts=e.artifacts),{language:e.language.locale(),hotel_reservations:[a],currency:e.currency().id,include_extra_stay_options:o});return c.GuestProfileUtil.isUserAuthenticated(r.id)&&(i.gp_token=c.GuestProfileUtil.getGpToken(r.id)),e.captchaChallengeToken&&(i.captcha_challenge={response:e.captchaChallengeToken}),c.ApiBuilderAbstract.setPointOfSale(i,t&&t.source,t&&t.sourceUrl,t&&t.referrerCode,t&&t.integrationKey,t&&t.utmParameters,t&&t.roistatParameters),i},u.buildIncompleteReservation=function(e,t,i){e=u.build(e,null,null,null);return e.include_extra_stay_options=t,e.include_guarantee_options=i,e};var e,t=u;function u(){return null!==e&&e.apply(this,arguments)||this}c.ApiHotelReservationBuilder=t;n.build=function(e){switch(e.transferOffer.transfer.transferType){case c.TransferType.Bus:return this.buildBus(e);case c.TransferType.Airport:return this.buildAirport(e);case c.TransferType.Custom:return this.buildCustom(e);case c.TransferType.Railway:return this.buildRailway(e)}},n.buildVehicles=function(e){var t=[];return _.forEach(e.vehicles,function(e){e.quantity&&t.push({vehicle_code:e.id,quantity:e.quantity})}),t},n.buildBus=function(e){return{transfer_code:e.transferOffer.id,date:c.UnitConverter.dateToString(e.date,e.time||new Date),vehicles:this.buildVehicles(e),comment:e.additionalInfo,trip_number:e.tripNumber}},n.buildCustom=function(e){return{transfer_code:e.transferOffer.id,comment:e.additionalInfo,vehicles:this.buildVehicles(e)}},n.buildAirport=function(e){return{transfer_code:e.transferOffer.id,date:c.UnitConverter.dateToString(e.date,e.time||new Date),vehicles:this.buildVehicles(e),comment:e.additionalInfo,trip_number:e.tripNumber,departure_location:e.departurePlace,transport_company:e.transportCompany}},n.buildRailway=function(e){return{transfer_code:e.transferOffer.id,date:c.UnitConverter.dateToString(e.date,e.time||new Date),vehicles:this.buildVehicles(e),comment:e.additionalInfo,trip_number:e.tripNumber,car_number:e.seatNumber}};var i=n;function n(){}}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e,t){return{language:t.locale(),hotel:{code:e}}};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiBookingFormInfoBuilder=i}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e,t,i){var n={hotel_reservation_refs:[{number:e.bookingNumber}]};return null!==e.cancellationCode?n.hotel_reservation_refs[0].verification={cancellation_code:e.cancellationCode}:null!==e.confirmationCode?n.hotel_reservation_refs[0].verification={cancellation_code:e.confirmationCode}:null!==e.unfinishedBookingSign?n.hotel_reservation_refs[0].verification={unfinished_booking_sign:e.unfinishedBookingSign}:null!==e.paymentCode&&(n.hotel_reservation_refs[0].verification={payment_code:e.paymentCode}),t&&(n.language=t),i&&(n.currency=i),n};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiReadReservationBuilder=i}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e,t,i,n){e={hotel_reservation_refs:[{number:e,verification:{cancellation_code:t}}]};return i&&(e.reasons=_.map(i,function(e){return{code:e.code,text:e.text}})),n&&(e.language=n),e};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiCancelReservationBuilder=i}(tl=tl||{}),!function(e){function t(){}t.build=function(e,t){return{language:t,hotel:{code:e}}},e.ApiCustomMessagesBuilder=t}(tl=tl||{}),!function(n){function e(){}e.build=function(e,t,i){return{user_id:n.TrackerService.getUserId(),session_id:n.TrackerService.getSessionId(),value:e.value.toString(),message:e.message||"",booking_number:t.number,provider_id:t.provider.id,locale:i.locale(),price:t.total.priceAfterDiscount.priceAfterTax.amount.toString(),currency:t.total.currency.id,provider:t.provider.name,city:t.provider.contactInfo?t.provider.contactInfo.address().city+", "+t.provider.contactInfo.address().country.name:"",payment_type:t.paymentSystem.type,phone:t.customer.phone.number()}},n.ApiCustomerFeedbackBuilder=e}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e,t){var i={hotel_reservation_refs:[{number:e.number}]};return null!==e.cancellationCode&&(i.hotel_reservation_refs[0].verification={cancellation_code:e.cancellationCode}),t&&(i.language=t),i};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiDeletePersonalDataBuilder=i}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e){var t={hotel_reservation_refs:[{number:e.number}]};return null!==e.cancellationCode?t.hotel_reservation_refs[0].verification={cancellation_code:e.cancellationCode}:null!==e.paymentCode&&(t.hotel_reservation_refs[0].verification={payment_code:e.paymentCode}),t},n.buildFromCredentials=function(e,t){return{hotel_reservation_refs:[{number:e,verification:{cancellation_code:t}}]}};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiHotelReservationRulesBuilder=i}(tl=tl||{}),!function(e){t=e.ApiBuilderAbstract,__extends(n,t),n.build=function(e,t){return{hotel_reservation_refs:[{number:e.bookingNumber,verification:{cancellation_code:e.cancellationCode}}],language:t}};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.ApiRestoreReservationBuilder=i}(tl=tl||{}),!function(e){function t(){}t.buildSettings=function(e){return{lang:e.locale()}},t.buildTicket=function(e,t,i,n){return{hotelId:_.parseInt(t),bookingPageUrl:i,lang:n.locale(),arrivalDate:e.checkInDate.format("YYYY-MM-DD"),nights:e.nights,name:e.name,email:e.email,phone:e.phone.number(),comment:e.comment,roomTypeCode:e.roomTypeId,ratePlanCode:e.ratePlanId}},t.buildTicketStatus=function(e,t,i){return{ticketId:e,bookingId:i,status:t}},e.ApiWishListBuilder=t}(tl=tl||{}),!function(r){e=r.ApiBuilderAbstract,__extends(i,e),i.build=function(e,t,i,n,o){t={hotel:e.providerId,start_date:r.UnitConverter.dateToString(e.checkInDate),end_date:r.UnitConverter.dateToString(e.checkOutDate),prefer_exact_dates:!!t};return n?t.rate_plans=_.map(n,function(e){return{code:e}}):t.shared=i,o&&(t.promo_code=o),e.source&&r.ApiBuilderAbstract.setPointOfSale(t,e.source),t};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}r.ApiNearestAvailableDatesBuilder=t}(tl=tl||{}),!function(e){function t(){}t.buildAdvatagesRequest=function(e,t){return{hotel_code:e,language:t.language()+"-"+t.region().toLocaleUpperCase()}},e.ApiBestPriceGuaranteeBuilder=t}(tl=tl||{}),!function(e){function t(){}t.buildAccount=function(e){return{email:e.email,phoneNumber:e.phone&&e.phone.number(),firstName:e.firstName,lastName:e.lastName,password:e.password}},e.ApiGuestProfileBuilder=t}(tl=tl||{}),!function(e){function t(){}t.buildSendRequest=function(e,t){var i=_.chain(e.categories).map(function(e){return e.questions}).flatten().filter(function(e){return!!e.mark}).map(function(e){return{id:e.id,mark:e.mark}}).value();return{id:e.id,comment:t,answers:i,sign:e.sign,number:e.bookingNumber}},t.buildConfigRequest=function(e,t,i,n,o){e={providerId:e,language:t};return i&&(e.number=i),n&&(e.sign=n),o&&(e.preview=o),e},e.ApiSurveyBuilder=t}(tl=tl||{}),!function(r){function o(){}o._translateProps=function(e,n,o,r,a){_.forEach(e,function(e){var t=e[n],i=_.find(o,function(e){return e[r]==t});i&&a(e,i)})},o._getCurrency=function(e){return o._currencies[e]||(o._currencies[e]=r.Locale.getInstance().findCurrency(e)),o._currencies[e]},o._toTaxes=function(e,t,i){return _.map(e||[],function(e){return new r.TaxAmount(e.code,e.amount||0,t,i)})},o._toPrepayment=function(e){return new r.PriceAmount(e.amount,this._getCurrency(e.currency))},o._toPrice=function(e,t){return e.hasOwnProperty("price_before_tax")||e.hasOwnProperty("price_after_tax")?new r.Price(e.price_before_tax,e.price_after_tax,o._toTaxes(e.taxes,this._getCurrency(e.currency),t),o._getCurrency(e.currency)):null},o._toPriceWithDiscount=function(e,t){if(!e.hasOwnProperty("price_before_tax")&&!e.hasOwnProperty("price_after_tax"))return null;var i=this._getCurrency(e.currency),t=o._toTaxes(e.taxes,i,t),n=new r.Price(e.price_before_tax,e.price_after_tax,t,i),t=e.discount?new r.Price(e.discount.basic_before_tax,e.discount.basic_after_tax,t,i):n,i=e.discount&&e.discount.type?new r.Discount(r.DiscountType.convert(e.discount.type),r.DiscountApplicabilityType.convert(e.discount.applicability_type)):null;return new r.PriceWithDiscount(t,n,i)},o._toPaymentOption=function(e,t,i,n){var t=t.getPaymentSystem(e.code),o=new r.DtoLoanPaymentScheduleBuilder(t,e,i,n);return t?new r.PaymentOption(t,o.isPaymentSystemWithSchedule()?function(){return o.build()}:null):null},o._currencies={},r.DtoBuilderAbstract=o}(tl=tl||{}),!function(i){e=i.DtoBuilderAbstract,__extends(n,e),n.buildCountries=function(e){e=e.map(function(e){return new i.Country(e.name,e.calling_code,e.code_alpha_2,e.code_alpha_3)});return this.sortCountries(e),e},n.translateCountries=function(e,t){this._translateProps(t,"countryCode3",e,"code_alpha_3",function(e,t){e.name=t.name}),this.sortCountries(t)},n.sortCountries=function(e){e.sort(function(e,t){return e.name.localeCompare(t.name)})},n.build=function(e,t){i.SessionLogger.getInstance().performanceLogger.push("commonInfoBuildStart"),t.setCountries(this.buildCountries(e.countries)),i.SessionLogger.getInstance().performanceLogger.push("commonInfoBuildEnd")},n.translate=function(e,t){this.translateCountries(e.countries,t.countries)};var e,t=n;function n(){return null!==e&&e.apply(this,arguments)||this}i.DtoCommonInfoBuilder=t}(tl=tl||{}),!function(d){e=d.DtoBuilderAbstract,__extends(p,e),p.getProviderInfo=function(e){return e.hotels[0]},p.toIcon=function(e){return e?new d.Image(e.url):null},p.toImages=function(e){return _.map(e,function(e){return new d.Image(e.url)})},p.buildRatePlanFeatures=function(e){return _.map(e,function(e){return new d.RatePlanFeature(e.name)})},p.toSize=function(e){return e?new d.RoomTypeSize(d.LengthUnitKind.convert(e.unit),e.value):null},p.buildRatePlanCategories=function(e){return _.map(e.rate_plan_categories,function(e){return new d.RatePlanCategory(e.code,e.name,e.promo||!1)})},p.translateRatePlanCategories=function(e,t){d.DtoBuilderAbstract._translateProps(t.ratePlanCategories,"id",e.rate_plan_categories,"code",function(e,t){e.name=t.name})},p.buildRatePlans=function(e,t,i){var n=this,o=i.isModeTurnedOn(d.BookingFormMode.SharedAccommodationRatePlan);return _.map(_.filter(e.rate_plans,function(e){return o==!!e.shared_accommodation}),function(e){return new d.RatePlan(e.code,e.name,e.shared_accommodation,e.short_description,e.description,t.getRatePlanCategory(e.category_code),d.Locale.getInstance().findCurrency(e.currency),e.full_prepayment,e.treatment,e.with_children_only,e.promo,n.toIcon(e.icon),n.toImages(e.images),n.buildRatePlanFeatures(e.features))})},p.translateRatePlans=function(e,t){var i=this;d.DtoBuilderAbstract._translateProps(t.ratePlans,"id",e.rate_plans,"code",function(e,t){e.name=t.name,e.description=t.description,e.shortDescription=t.short_description,e.features=i.buildRatePlanFeatures(t.features)})},p.buildOptionCategories=function(i){return _.map(i.service_categories,function(e){var t=new d.OptionCategory(e.code,e.name,e.description);return t.sortingKey=_.indexOf(i.service_categories,e),t})},p.translateOptionCategories=function(e,t){d.DtoBuilderAbstract._translateProps(t.optionCategories,"id",e.service_categories,"code",function(e,t){e.name=t.name,e.description=t.description})},p.buildOptions=function(i,n){return _.map(p.getServices(i),function(e){var t=new d.Option(e.code,e.name,e.description,d.ChargeType.convert(e.charge_type),d.OptionApplicabilityType.convert(e.applicability_type),_.isUndefined(e.require_prepayment)?e.included_in_prepayment:e.require_prepayment,e.require_guaranteed_payment,e.quantity||0);return t.category=n.getOptionCategory(e.category_code),t.sortingKey=_.indexOf(i.services,e),t.images=_.map(e.images,function(e){return new d.Image(e.url)}),t})},p.translateOptions=function(e,t){d.DtoBuilderAbstract._translateProps(t.options,"id",p.getServices(e),"code",function(e,t){e.name=t.name,e.description=t.description})},p.buildMealPlans=function(i,n){return _.map(p.getMealPlans(i),function(e){var t=new d.Meal(e.code,e.name,e.description,d.MealPlanType.convert(e.meal_plan_type),d.ChargeType.convert(e.charge_type),d.OptionApplicabilityType.convert(e.applicability_type),_.isUndefined(e.require_prepayment)?e.included_in_prepayment:e.require_prepayment,e.require_guaranteed_payment,e.quantity||0);return t.category=n.getOptionCategory(e.category_code),t.sortingKey=_.indexOf(i.services,e),t.images=_.map(e.images,function(e){return new d.Image(e.url)}),t})},p.translateMealPlans=function(e,t){d.DtoBuilderAbstract._translateProps(t.meals,"id",p.getMealPlans(e),"code",function(e,t){e.name=t.name,e.description=t.description})},p.buildTransfers=function(e){return _.map(e.transfers,function(e){var t=d.TransferDirection.convert(e.direction)==d.TransferDirection.ToHotel,i=_.isUndefined(e.included_in_prepayment)?e.require_guaranteed_payment:e.included_in_prepayment;return new d.Transfer(e.transfer_code,e.name,e.description,d.TransferType.convert(e.kind),i,e.require_guaranteed_payment,e.endpoint_name,t)})},p.translateTransfers=function(e,t){d.DtoBuilderAbstract._translateProps(t.transfers,"id",e.transfers,"transfer_code",function(e,t){e.name=t.name,e.description=t.description,e.endPoint=t.endpoint_name})},p.buildVehicles=function(e){return _.map(e.vehicles,function(e){return new d.Vehicle(e.vehicle_code,e.name,e.description,e.capacity)})},p.translateVehicles=function(e,t){d.DtoBuilderAbstract._translateProps(t.vehicles,"id",e.vehicles,"vehicle_code",function(e,t){e.name=t.name,e.description=t.description})},p.buildPaymentSystems=function(e){return _.map(e.guarantees,function(e){return new d.PaymentSystem(e.code,e.type,e.payment_system_code,e.has_mir_cashback)})},p.translatePaymentSystems=function(e,t){t.setPaymentSystems(p.buildPaymentSystems(e))},p.buildTaxes=function(e){return _.map(e.taxes,function(e){return new d.Tax(e.code,e.kind,e.name,e.description)})},p.translateTaxes=function(e,t){d.DtoBuilderAbstract._translateProps(t.taxes,"id",e.taxes,"code",function(e,t){e.name=t.name,e.description=t.description})},p.buildRoomFeatureCategories=function(e){return _.map(e.amenity_categories,function(e){return new d.RoomFeatureCategory(e.code,e.name)})},p.translateRoomFeatureCategories=function(e,t){d.DtoBuilderAbstract._translateProps(t.roomFeatureCategories,"id",e.amenity_categories,"code",function(e,t){e.name=t.name})},p.buildRooms=function(e,l,c){var u=this;return _.map(e.room_types,function(e){var t=e.amenities?_.map(e.amenities,function(e){return new d.RoomFeature(e.name,e.kind,e.category_code,e.icon_position,l)}):[],i=e.preferences?_.map(e.preferences,function(e){return new d.RoomPreference(e.category_code,e.category_name,e.code,e.name)}):[],n=p.buildContactInfo(e.contact_info,l),o=d.RoomTypeUnitKind.convert(e.kind)||d.RoomTypeUnitKind.Room,r=(c.isServicesBookingForm()&&(o=d.RoomTypeUnitKind.Service),c.isCampBookingForm()&&(o=d.RoomTypeUnitKind.Camp),d.BookingFormSettings.getInstance()),a=[],s=(_.forEach(e.child_extra_bed_age_groups,function(e){e=r.childrenAgeGroupByCode(e.code);_.isUndefined(e)||a.push(new d.AgeGroup(e.minAge,e.maxAge))}),[]);return _.forEach(e.child_without_bed_age_groups,function(e){e=r.childrenAgeGroupByCode(e.code);_.isUndefined(e)||s.push(new d.AgeGroup(e.minAge,e.maxAge))}),new d.RoomType(e.code,o,e.name,e.description,n,t,i,u.toImages(e.images),u.toSize(e.size),e.rooms_quantity,new d.RoomTypeOccupancy(e.max_occupancy,e.max_adult_occupancy,e.max_extra_bed_occupancy,e.max_without_bed_occupancy,e.accommodate_adults_on_extra_bed,a,s))})},p.translateRooms=function(i,e){var n=this;d.DtoBuilderAbstract._translateProps(e.rooms,"id",i.room_types,"code",function(e,t){e.name=t.name,e.description=t.description,e.size=n.toSize(t.size)}),_.forEach(e.rooms,function(e){var t=_.find(i.room_types,{code:e.id});t&&(t.contact_info&&p.translateContactInfo(t.contact_info,e.contactInfo),t.amenities&&d.DtoBuilderAbstract._translateProps(e.features,"kind",t.amenities,"kind",function(e,t){e.name=t.name}),t.preferences&&d.DtoBuilderAbstract._translateProps(e.preferences,"code",t.preferences,"code",function(e,t){e.name=t.name,e.categoryName=t.category_name}))})},p.buildContactInfo=function(e,t){if(!e||!e.addresses[0])return null;var i=e.addresses[0],n=new d.Address,t=(n.city=i.city_name,n.county=i.county,n.region=i.region,n.postalCode=i.postal_code,n.addressLines=i.address_line,n.country=t.getCountry(i.country_code),n.latitude=i.latitude,n.longitude=i.longitude,n.remark=i.remark,_.map(e.emails,function(e){return e.email_address})),i=_.map(e.phones,function(e){var t=new d.Phone;return t.number=e.phone_number,t.type=d.PhoneType.convert(e.tech_type),t});return new d.ContactInfo(n,t,i)},p.translateContactInfo=function(e,t){if(!t||!e||!e.addresses[0])return null;e=e.addresses[0],t=t.address();t.city=e.city_name,t.county=e.county,t.region=e.region,t.postalCode=e.postal_code,t.addressLines=e.address_line,t.latitude=e.latitude,t.longitude=e.longitude,t.remark=e.remark},p.buildBookingSettings=function(e,t){var i=this.getProviderInfo(e),n=i.age_groups;t.adultOnly=!!i.adult_only,t.minGuestAge=i.min_guest_age,t.registrationDiscounts=i.registration_discounts,t.touristDiscounts=i.tourist_discounts,t.loyaltyDiscounts=i.loyalty_discounts,t.displayPromoCodeBlock=i.promo_rate_plans,t.stayUnitKind=d.StayUnitKind.convert(i.stay_unit_kind),t.copyrightAvailable=!_.includes(["UKR"],null==(i=null==(i=i.contact_info)?void 0:i.addresses[0])?void 0:i.country_code),0!==n.length||t.adultOnly||(n=[{code:d.api.DefaultAgeGroupCode,min_age:t.minGuestAge,max_age:t.adultAge}]),t.childrenAgeGroups=_.map(n,function(e){return new d.BookingFormSettingsChildrenAgeGroup(e.code,e.min_age,e.max_age)}),this.buildPromotions(e,t)},p.buildPromotions=function(e,t){t.promotions=_.map(this.getProviderInfo(e).promotions,function(e){return new d.Promotion(e.discount_type,e.discount_value,_.map(e.stay_periods,function(e){return new d.DatePeriod(d.UnitConverter.toDate(e.start_date),e.end_date?d.UnitConverter.toDate(e.end_date):null)}),e.rate_plans,e.room_types)})},p.getMealPlans=function(e){return _.filter(e.services,function(e){return e.kind==d.ServiceKind.Meal})},p.getServices=function(e){return _.filter(e.services,function(e){return e.kind==d.ServiceKind.Common})},p.build=function(e,t,i){d.SessionLogger.getInstance().performanceLogger.push("hotelInfoBuildStart"),t.setOptionCategories(this.buildOptionCategories(this.getProviderInfo(e))),t.setOptions(this.buildOptions(this.getProviderInfo(e),t)),t.setMeals(this.buildMealPlans(this.getProviderInfo(e),t)),t.setPaymentSystems(this.buildPaymentSystems(this.getProviderInfo(e))),t.setRoomFeatureCategories(this.buildRoomFeatureCategories(this.getProviderInfo(e))),t.setRooms(this.buildRooms(this.getProviderInfo(e),t,i)),t.setRatePlanCategories(this.buildRatePlanCategories(this.getProviderInfo(e))),t.setRatePlans(this.buildRatePlans(this.getProviderInfo(e),t,i)),t.setTransfers(this.buildTransfers(this.getProviderInfo(e))),t.setVehicles(this.buildVehicles(this.getProviderInfo(e))),t.setTaxes(this.buildTaxes(this.getProviderInfo(e))),d.SessionLogger.getInstance().performanceLogger.push("hotelInfoBuildEnd")},p.translate=function(e,t){this.translateRoomFeatureCategories(e,t),this.translateRooms(e,t),this.translateOptionCategories(e,t),this.translateOptions(e,t),this.translateMealPlans(e,t),this.translatePaymentSystems(e,t),this.translateRatePlanCategories(e,t),this.translateRatePlans(e,t),this.translateTransfers(e,t),this.translateVehicles(e,t),this.translateTaxes(e,t)};var e,t=p;function p(){return null!==e&&e.apply(this,arguments)||this}d.DtoHotelInfoBuilder=t}(tl=tl||{}),!function(n){e=n.DtoBuilderAbstract,__extends(i,e),i.build=function(e,t){var i=new n.Provider(e.code,e.name,null!=(i=n.ProviderTypeUnitKind.convert(e.type))?i:n.ProviderTypeUnitKind.Hotel,n.Locale.getInstance().findCurrency(e.currency));i.checkInTime=n.UnitConverter.parseTime(e.policy.check_in_time),i.checkOutTime=n.UnitConverter.parseTime(e.policy.check_out_time),e.last_booking_date&&(i.lastBookingDate=moment.duration(e.last_booking_date)),e.use_health_centre_booking_form&&(i.useHealthCentreBookingForm=e.use_health_centre_booking_form),i.contactInfo=n.DtoHotelInfoBuilder.buildContactInfo(e.contact_info,t),i.timeZone=new n.TimeZone(e.timezone.name,e.timezone.offset),e.images&&e.images.length&&(i.images=_.map(e.images,function(e){return new n.Image(e)})),e.logo&&e.logo.url&&(i.logo=new n.Image(e.logo.url)),t.setProvider(i)},i.translate=function(e,t){t=t.getProvider();t.name=e.name,t.logo&&t.logo.setUrl(e.logo.url),n.DtoHotelInfoBuilder.translateContactInfo(e.contact_info,t.contactInfo)};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}n.DtoProviderBuilder=t}(tl=tl||{}),!function(o){e=o.DtoBuilderAbstract,__extends(r,e),r.build=function(e,i){var n=[];return _.each(e?e.room_type_availability:[],function(t){_.each(t.availability_date,function(e){n.push(r.buildRoomTypeAvailability(e,t.id_room_type,i))})}),n},r.buildRoomTypeAvailabilityGroup=function(e,t,i,n){e=_.find(e?e.room_type_availability:[],function(e){return e.id_room_type==i.id});return new o.RoomTypeAvailabilityGroup(i.id,r.buildRoomTypeAvailabilities(e,t,i,n))},r.buildRoomTypeAvailabilities=function(e,t,i,n){return _.sortBy(_.map(_.filter(e?e.availability_date:[],function(e){return o.UnitConverter.toDate(e.period.start_date).isEqualDate(t.startDate)}),function(e){return r.buildRoomTypeAvailability(e,i.id,n)}),function(e){return e.endDate})},r.buildRoomTypeAvailability=function(e,t,i){var n=!e.period;return new o.RoomTypeAvailability(n?null:o.UnitConverter.toDate(e.period.start_date),n?null:o.UnitConverter.toDate(e.period.end_date),n?o.UnitConverter.toDate(e.date):null,e.guests,t,e.is_available,o.DtoBuilderAbstract._toPrice(e.price,i),e.pricing&&e.pricing.length?_.map(e.pricing,function(e){return new o.RoomTypeAvailabilityPricing(o.UnitConverter.toDate(e.date),o.DtoBuilderAbstract._toPrice(e.price,i))}):[])};var e,t=r;function r(){return null!==e&&e.apply(this,arguments)||this}o.DtoRoomTypeAvailabilityBuilder=t}(tl=tl||{}),!function(l){var e,c=function(){this.adults=0,this.children=[]},u=(l.GuestCountInfo=c,e=l.DtoBuilderAbstract,__extends(t,e),t.buildPlacementRates=function(e,t,i,n){if(void 0===n&&(n=!1),!e||0==e.length)return[];e=_.find(e,function(e){return!(e.placement.kind!=t.kind||e.placement.code!=t.code||n&&e.placement.index!=t.index||t.rate_plan_code&&e.rate_plan_code!=t.rate_plan_code)});return _.map(e.rates,function(e){return new l.PlacementRate(l.UnitConverter.toDate(e.date),l.DtoBuilderAbstract._toPrice(e,i))})},t);function t(){return null!==e&&e.apply(this,arguments)||this}l.DtoBaseHotelAvailabilityPlacementBuilder=u;__extends(o,i=u),o.prototype.buildGuestCountInfo=function(e,t){for(var i=new c,n=l.BookingFormSettings.getInstance(),o=_.filter(e,function(e){return e.placement.index==t.index}),r=0;r<t.capacity;r++){var a=o[r]||_.head(o),s=null;(s=a&&a.hasOwnProperty("age")?n.childrenAgeGroupByAge(a.age):s)?i.children.push(new l.ChildPlacement(a.age,new l.AgeGroup(s.minAge,s.maxAge))):i.adults++}return i},o.prototype.build=function(r,e,a){var s=this;return _.map(e,function(e){var t=r.placement_rates&&0<r.placement_rates.length,i=l.DtoBuilderAbstract._toPriceWithDiscount(e,a),n=s.buildGuestCountInfo(r.guests,e),o=l.BookingFormSettings.getInstance().childrenAgeGroupByCode(e.age_group),o=o?new l.AgeGroup(o.minAge,o.maxAge):null;return new l.GuestPlacement(e.index,l.GuestPlacementKind.convert(e.kind),e.code,null,o,e.capacity,i,function(){return u.buildPlacementRates(r.placement_rates,e,a,!0)},t,n.adults,n.children)})};var i,n=o;function o(){return null!==i&&i.apply(this,arguments)||this}l.DtoHotelAvailabilityPlacementBuilder=n;__extends(a,r=u),a.prototype.buildGuestCountInfo=function(e,i){var n=new c,o=l.BookingFormSettings.getInstance();return e&&e.guest_counts?_.forEach(e.guest_counts,function(e){var t;e.placement_index==i.index&&((t=o.childrenAgeGroupByAge(e.age))?n.children.push(new l.ChildPlacement(e.age,new l.AgeGroup(t.minAge,t.maxAge))):n.adults++)}):(e=i.hasOwnProperty("age_group")?o.childrenAgeGroupByCode(i.age_group):null)?n.children.push(new l.ChildPlacement(e.minAge,new l.AgeGroup(e.minAge,e.maxAge))):n.adults++,n},a.prototype.build=function(r,e,a){var s=this;return _.map(e,function(e){var t=r.placement_rates&&0<r.placement_rates.length,i=l.DtoBuilderAbstract._toPriceWithDiscount(e,a),n=s.buildGuestCountInfo(r.guest_count_info,e),o=e.hasOwnProperty("min_age")&&e.hasOwnProperty("max_age")?new l.AgeGroup(e.min_age,e.max_age):null;return new l.GuestPlacement(e.index,l.GuestPlacementKind.convert(e.kind),e.code,a.getRatePlan(e.rate_plan_code),o,1,i,function(){return u.buildPlacementRates(r.placement_rates,e,a)},t,n.adults,n.children)})};var r,n=a;function a(){return null!==r&&r.apply(this,arguments)||this}l.DtoHotelAvailability2PlacementBuilder=n;__extends(d,s=u),d.prototype.build=function(o,e,r){return _.map(e,function(e){var t=o.placement_rates&&0<o.placement_rates.length,i=l.DtoBuilderAbstract._toPriceWithDiscount(e,r),n=l.BookingFormSettings.getInstance().childrenAgeGroupByCode(e.age_group),n=n?new l.AgeGroup(n.minAge,n.maxAge):null;return new l.GuestPlacement(e.index,l.GuestPlacementKind.convert(e.kind),e.code,null,n,e.capacity,i,function(){return u.buildPlacementRates(o.placement_rates,e,r)},t,null,null)})};var s,n=d;function d(){return null!==s&&s.apply(this,arguments)||this}l.DtoHotelOfferAvailabilityPlacementBuilder=n}(tl=tl||{}),!function(n){function e(){}function t(){}function i(){}e.prototype.canOffer=function(e,t,i){return _.every(i,function(e){return!!e.sharedAccommodation})},n.DtoHotelAvailability2RoomStayFilter=e,t.prototype.canOffer=function(e,t,i){return _.every(i,function(e){return!e.sharedAccommodation})},n.DtoHotelAvailabilityRoomStayFilter=t,i.prototype.canOffer=function(e,t,i){return n.BookingFormSettings.getInstance().isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)?_.every(i,function(e){return!!e.sharedAccommodation}):_.every(i,function(e){return!e.sharedAccommodation})&&t.kind!=n.RoomTypeUnitKind.PlaceInRoom&&t.kind!=n.RoomTypeUnitKind.Service&&_.some(e.room_types[0].placements,function(e){return 0<=_.indexOf([n.GuestPlacementKind.Child,n.GuestPlacementKind.ExtraChild,n.GuestPlacementKind.ChildBandWithoutBed],e.kind)})&&_.some(e.room_types[0].placements,function(e){return e.kind==n.GuestPlacementKind.Adult&&e.capacity!=t.occupancy.total||0<=_.indexOf([n.GuestPlacementKind.ExtraAdult,n.GuestPlacementKind.ExtraChild,n.GuestPlacementKind.ChildBandWithoutBed],e.kind)})},n.DtoHotelOfferAvailabilityRoomStayFilter=i}(tl=tl||{}),!function(g){e=g.DtoBuilderAbstract,__extends(h,e),h.buildOptionId=function(e){return[e.code,e.placement_index,e.inclusive].join("-")},h.buildMealPlans=function(e,n){var o=[];return _.forEach(e,function(e){var t,i=_.find(n.meals,{id:e.code});i&&(t=g.DtoBuilderAbstract._toPrice(e.price,n),o.push(new g.MealPlan(h.buildOptionId(e),i,t,e.placement_index,e.inclusive)))}),o},h.buildRoomOptions=function(e,n){var o=[];return _.forEach(e,function(e){var t,i=_.find(n.options,{id:e.code});i&&i.pricing!=g.ChargeType.PerBooking&&(t=g.DtoBuilderAbstract._toPrice(e.price,n),o.push(new g.RoomOption(h.buildOptionId(e),i,t,e.placement_index,e.inclusive,e.quota_used,e.quantity)))}),o},h.buildBookingOptions=function(e,n){var o=[];return _.forEach(e,function(e){var t,i=_.find(n.options,{id:e.code})||_.find(n.meals,{id:e.code});i&&i.pricing==g.ChargeType.PerBooking&&(t=g.DtoBuilderAbstract._toPrice(e.price,n),o.push(new g.RoomOption(h.buildOptionId(e),i,t,null,e.inclusive,e.quota_used,e.quantity)))}),o},h.buildVehicles=function(e,i){return _.filter(_.map(e,function(e){var t=i.getVehicle(e.vehicle_code);return t?new g.VehicleOption(t,g.DtoBuilderAbstract._toPrice(e.price,i)):null}),function(e){return null!=e})},h.buildTransfers=function(i,e,n){return _.filter(_.map(e,function(e){var t=n.getTransfer(e.transfer_code),e=h.buildVehicles(e.vehicles,n);return t&&e.length?new g.TransferOption(new g.TransferOffer(t,e,n),_.map(e,function(e){return new g.EnumerableVehicleOption(i,t,e,n)})):null}),function(e){return null!=e})},h.buildPaymentOptions=function(e,t,i,n){return _.filter(_.map(e,function(e){return g.DtoBuilderAbstract._toPaymentOption(e,t,i,n)}),function(e){return null!=e})},h.buildCancellationInfo=function(e,t){e=e.rate_plans[0].cancel_penalty_group;return e?new g.CancellationPenaltyDescriptiveInfo(t.id,e.description,e.free_cancellation,e.show_description,e.mir_cashback_description):null},h.buildRoomStay=function(e,t,i,n,o,r,a,s,l){var c=_.map(e.rate_plans,function(e){return n.getRatePlan(e.code)}),u=n.getRoom(e.room_types[0].code);if(_.some(c,function(e){return!e})||!u||!r.canOffer(e,u,c))return null;var r=_.head(e.room_types).limited_inventory_count,r=r?new g.RoomTypeUnit(u.kind,r):null,d=e.total?g.DtoBuilderAbstract._toPriceWithDiscount(e.total,n):null,p=h.getServicesByReferences(e.services,i),i=h.getRawRoomStayId(e,a),m=h.getRawRoomStayPlacementsCode(e),i=new g.RoomStay(i,m,u,c,d,function(){return o.build(e,_.head(e.room_types).placements,n)},function(){return h.buildPaymentOptions(e.guarantees,n,s,l)},function(){return h.buildRoomOptions(p,n)},function(){return h.buildMealPlans(p,n)},r);return i.stayDates=new g.RoomStayStayDate(g.UnitConverter.toDate(e.stay_dates.start_date),g.UnitConverter.toDate(e.stay_dates.end_date),a.stayUnitKind),i.cancellationInfo=h.buildCancellationInfo(e,c[0]),e.restrictions&&(i.restrictions=_.map(e.restrictions,function(e){return g.RoomStayRestrictionKind.convert(e)})),i.promo=_.some(i.ratePlans,function(e){return e.promo}),i.hasPromoDiscount=_.some(e.rate_plans,function(e){return e.promo}),_.isUndefined(t)||h.buildRoomStayQuota(i,e,t),i},h.buildRoomStays=function(e,n,o,r,a,s,l,c,u){var d=g.BookingFormSettings.getInstance(),p=[];return _.forEach(e,function(t){var i=h.buildRoomStay(t,n,o,a,s,l,d,c,u);i&&p.push(new g.StayOption(i,function(){var e=h.getTransfersByReferences(t.transfers,r);return h.buildTransfers(i,e,a)},function(){var e=h.getServicesByReferences(t.services,o);return h.buildBookingOptions(e,a)}))}),p},h.buildRoomStayQuota=function(e,t,i){i=_.find(i,function(e){return e.rph==_.head(t.room_types).room_type_quota_rph});e.quantity=i.quantity,e.roomTypeQuotaId=i.rph},h.buildHotelAvailabilityInfo=function(e,t){var e=_.head(e),i=new g.HotelAvailabilityInfo;return e&&(i.noRoomType=e.no_room_type_availability_message),t.setHotelAvailabilityInfo(i),i},h.translateRoomStays=function(e,t,i,n,o){h.translateStayOptions(e,i.getStayOptions(!0),i,n,o),h.translateHotelAvailabilityInfo(t,i)},h.translateStayOptions=function(i,e,n,o,r){_.each(e,function(e){var t=h.getRawRoomStay(i,e);t&&(e.roomStay.cancellationInfo.cancellationText=t.rate_plans[0].cancel_penalty_group.description,e.roomStay.cancellationInfo.mirCashbackDescription=t.rate_plans[0].cancel_penalty_group.mir_cashback_description,e.roomStay.paymentOptions=h.buildPaymentOptions(t.guarantees,n,o,r))})},h.translateHotelAvailabilityInfo=function(e,t){e&&e.length&&((t.getHotelAvailabilityInfo()||new g.HotelAvailabilityInfo).noRoomType=_.head(e).no_room_type_availability_message)},h.getRawRoomStay=function(e,t,i){void 0===i&&(i=!1);var n=!!_.head(t.roomStay.guestPlacementOptions).ratePlan;return _.find(e,function(e){return _.map(e.rate_plans,function(e){return e.code}).join(",")==_.map(t.roomStay.ratePlans,function(e){return e.id}).join(",")&&e.room_types[0].code==t.roomStay.roomType.id&&e.room_types[0].placements.length==t.roomStay.guestPlacementOptions.length&&_.sortBy(_.map(e.room_types[0].placements,function(e){return[e.code,e.kind,i?e.index:"",n&&e.rate_plan_code||""].join("-")})).join(",")==_.sortBy(_.map(t.roomStay.guestPlacementOptions,function(e){return[e.code,e.kind,i?e.index:"",n&&e.ratePlan?e.ratePlan.id:""].join("-")})).join(",")})},h.getRawRoomStayId=function(e,i){function t(e){var t=[];return _.forEach(e,function(e){e=e.hasOwnProperty("age")?i.childrenAgeGroupByAge(e.age):null;t.push([e?e.minAge:""].join("_"))}),t}var n=["rs","rt"+e.room_types[0].code];_.forEach(e.rate_plans,function(e){n.push("rp"+e.code)}),_.forEach(e.room_types[0].placements,function(e){var t;e.hasOwnProperty("age_group")?t=i.childrenAgeGroupByCode(e.age_group):e.hasOwnProperty("min_age")&&(t=i.childrenAgeGroupByAge(e.min_age)),n.push([e.code,e.kind,e.rate_plan_code?1:e.capacity,e.rate_plan_code||"",t?t.minAge:"",t?t.maxAge:""].join("_"))});return e.guest_count_info?n=n.concat(t(e.guest_count_info.guest_counts)):e.guests&&(n=n.concat(t(e.guests))),n.join("-")},h.getRawRoomStayPlacementsCode=function(e){var t=[];return _.forEach(e.room_types[0].placements,function(e){t.push([e.kind,e.capacity].join("_"))}),t.join("-")},h.convertGuestPlacementsCurrency=function(n,o,r,a){void 0===a&&(a=!1),_.each(o.roomStay.guestPlacementOptions,function(t){var e=_.find(n.room_types,{code:o.roomStay.roomType.id}),e=_.find(e.placements,function(e){return!(e.code!=t.code||e.kind!=t.kind||a&&e.index!=t.index||t.ratePlan&&t.ratePlan.id!=e.rate_plan_code)}),i=(g.PriceWithDiscountCalculator.copy(t.price,g.DtoBuilderAbstract._toPriceWithDiscount(e,r)),_.find(n.placement_rates,function(e){return!(e.placement.code!=t.code||e.placement.kind!=t.kind||a&&e.placement.index!=t.index||t.ratePlan&&e.rate_plan_code!=t.ratePlan.id)}));_.each(t.rates,function(t){var e=_.find(i.rates,function(e){return g.UnitConverter.toDate(e.date).isEqualDate(t.date)});g.PriceCalculator.copy(t.price,g.DtoBuilderAbstract._toPrice(e,r))})})},h.convertOptionsCurrency=function(i,e,n){_.each(e.roomStay.getOptions(),function(e){var t=_.find(i,{code:e.code()});g.PriceCalculator.copy(e.pricePerUnit,g.DtoBuilderAbstract._toPrice(t.price,n)),g.PriceCalculator.copy(e.price,e.pricePerUnit)})},h.convertMealPlanCurrency=function(i,e,n){_.each(e.roomStay.getMealPlans(),function(e){var t=_.find(i,{code:e.code()});g.PriceCalculator.copy(e.pricePerUnit,g.DtoBuilderAbstract._toPrice(t.price,n)),g.PriceCalculator.copy(e.price,e.pricePerUnit)})},h.convertBookingOptionsCurrency=function(i,e,n){_.each(e.bookingOptions,function(e){var t=_.find(i,{code:e.code()});g.PriceCalculator.copy(e.pricePerUnit,g.DtoBuilderAbstract._toPrice(t.price,n)),g.PriceCalculator.copy(e.price,e.pricePerUnit)})},h.convertTransfersCurrency=function(t,e,n){_.each(e.transfers,function(e){var i=_.find(t,{transfer_code:e.id});_.each(e.vehicles,function(e){var t=_.find(i.vehicles,{vehicle_code:e.id});g.PriceCalculator.copy(e.option.price,g.DtoBuilderAbstract._toPrice(t.price,n))})})},h.getTransfersByReferences=function(e,i){return _.map(e,function(t){return null==t.rph?t:_.find(i,function(e){return e.rph==t.rph})})},h.getServicesByReferences=function(e,i){return _.map(e,function(t){if(null==t.rph)return t;var e=_.clone(_.find(i,function(e){return e.rph==t.rph}));return e&&(e.placement_index=t.placement_index),e})};var e,t=h;function h(){return null!==e&&e.apply(this,arguments)||this}g.DtoBaseHotelAvailabilityBuilder=t}(tl=tl||{}),!function(r){e=r.DtoBaseHotelAvailabilityBuilder,__extends(a,e),a.prototype.getStayOptions=function(e){return e.stayOptions},a.prototype.setStayOptions=function(e,t){t.setStayOptions(e)},a.convertRoomOptionTotalPriceCurrency=function(e,t,i){e.total&&t.roomStay.price&&(e=r.DtoBuilderAbstract._toPriceWithDiscount(e.total,i),t.roomStay.price.priceBeforeDiscount=e.priceBeforeDiscount,t.roomStay.price.priceAfterDiscount=e.priceAfterDiscount)},a.prototype.translate=function(e,t,i,n){return r.DtoBaseHotelAvailabilityBuilder.translateRoomStays(e.room_stays,e.availability_result,t,i,n)},a.prototype.convertCurrency=function(n,o){_.forEach(this.getStayOptions(o),function(e){var t,i=r.DtoBaseHotelAvailabilityBuilder.getRawRoomStay(n.room_stays,e,!0);i&&(a.convertRoomOptionTotalPriceCurrency(i,e,o),r.DtoBaseHotelAvailabilityBuilder.convertGuestPlacementsCurrency(i,e,o,!0),t=r.DtoBaseHotelAvailabilityBuilder.getServicesByReferences(i.services,n.services),r.DtoBaseHotelAvailabilityBuilder.convertMealPlanCurrency(t,e,o),r.DtoBaseHotelAvailabilityBuilder.convertOptionsCurrency(t,e,o),t=r.DtoBaseHotelAvailabilityBuilder.getTransfersByReferences(i.transfers,n.transfers),r.DtoBaseHotelAvailabilityBuilder.convertTransfersCurrency(t,e,o),t=r.DtoBaseHotelAvailabilityBuilder.getServicesByReferences(i.services,n.services),r.DtoBaseHotelAvailabilityBuilder.convertBookingOptionsCurrency(t,e,o))})},a.prototype.build=function(e,t,i,n){r.SessionLogger.getInstance().performanceLogger.push("hotelAvailabilityBuildStart");e=r.DtoBaseHotelAvailabilityBuilder.buildRoomStays(e.room_stays,e.room_type_quotas,e.services,e.transfers,t,new r.DtoHotelAvailabilityPlacementBuilder,new r.DtoHotelAvailabilityRoomStayFilter,i,n);return this.setStayOptions(e,t),r.SessionLogger.getInstance().performanceLogger.push("hotelAvailabilityBuildEnd"),e};var e,t=a;function a(){return null!==e&&e.apply(this,arguments)||this}r.DtoHotelAvailabilityBuilder=t}(tl=tl||{}),!function(s){e=s.DtoHotelAvailabilityBuilder,__extends(l,e),l.prototype.build=function(i,n,o,r,e){void 0===e&&(e=!1),s.SessionLogger.getInstance().performanceLogger.push("hotelAvailability2BuildStart"),i=_.cloneDeep(i),_.forEach(i.room_stays,function(e){var t;_.forEach(e.guests,function(e){e.placement.index+=1}),_.forEach(null==(t=e.guest_count_info)?void 0:t.guest_counts,function(e){e.placement_index+=1}),_.forEach(e.room_types,function(e){_.forEach(e.placements,function(e){e.index+=1})}),_.forEach(e.placement_rates,function(e){e.placement.index+=1}),_.forEach(e.services,function(e){void 0!==e.placement_index&&(e.placement_index+=1)})});var a=[];return _.forEach(i.room_stay_groups,function(e,t){e=l.getRoomStaysByReferences(e.room_stays,i.room_stays),e=s.DtoBaseHotelAvailabilityBuilder.buildRoomStays(e,i.room_type_quotas,i.services,i.transfers,n,new s.DtoHotelAvailability2PlacementBuilder,new s.DtoHotelAvailability2RoomStayFilter,o,r);_.forEach(e,function(e){e.groupRef="g"+t,a.push(e)})}),e?this.setStayOptions(this.getStayOptions(n).concat(a),n):this.setStayOptions(a,n),s.SessionLogger.getInstance().performanceLogger.push("hotelAvailability2BuildEnd"),a},l.getRoomStaysByReferences=function(e,i){return _.map(e,function(t){return _.find(i,function(e){return e.rph==t.rph})})};var e,t=l;function l(){return null!==e&&e.apply(this,arguments)||this}s.DtoHotelAvailability2Builder=t}(tl=tl||{}),!function(r){e=r.DtoBaseHotelAvailabilityBuilder,__extends(i,e),i.prototype.getStayOptions=function(e){return e.stayOfferOptions},i.prototype.setStayOptions=function(e,t){_.each(e,function(e){e.roomStay.isRoomStayOffer=!0}),t.setStayOfferOptions(e)},i.prototype.translate=function(e,t,i,n){return r.DtoBaseHotelAvailabilityBuilder.translateRoomStays(e.room_stays,e.availability_result,t,i,n)},i.prototype.convertCurrency=function(n,o){_.forEach(this.getStayOptions(o),function(e){var t,i=r.DtoBaseHotelAvailabilityBuilder.getRawRoomStay(n.room_stays,e);i&&(r.DtoBaseHotelAvailabilityBuilder.convertGuestPlacementsCurrency(i,e,o),t=r.DtoBaseHotelAvailabilityBuilder.getServicesByReferences(i.services,n.services),r.DtoBaseHotelAvailabilityBuilder.convertMealPlanCurrency(t,e,o),r.DtoBaseHotelAvailabilityBuilder.convertOptionsCurrency(t,e,o),t=r.DtoBaseHotelAvailabilityBuilder.getTransfersByReferences(i.transfers,n.transfers),r.DtoBaseHotelAvailabilityBuilder.convertTransfersCurrency(t,e,o),t=r.DtoBaseHotelAvailabilityBuilder.getServicesByReferences(i.services,n.services),r.DtoBaseHotelAvailabilityBuilder.convertBookingOptionsCurrency(t,e,o))})},i.prototype.build=function(e,t,i,n){r.SessionLogger.getInstance().performanceLogger.push("hotelOfferAvailabilityBuildStart");e=r.DtoBaseHotelAvailabilityBuilder.buildRoomStays(e.room_stays,e.room_type_quotas,e.services,e.transfers,t,new r.DtoHotelOfferAvailabilityPlacementBuilder,new r.DtoHotelOfferAvailabilityRoomStayFilter,i,n);return this.setStayOptions(e,t),r.SessionLogger.getInstance().performanceLogger.push("hotelOfferAvailabilityBuildEnd"),e};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}r.DtoHotelOfferAvailabilityBuilder=t}(tl=tl||{}),!function(n){e=n.DtoBuilderAbstract,__extends(o,e),o.build=function(t,e){e.hotel_ref&&e.hotel_ref.code&&(t.providerId=e.hotel_ref.code),t.forceShowPromoCodes=e.force_show_promo_codes,t.requireAgreeWithBookingTerms=e.terms_agree_required,t.useLicenceAgreement=e.use_licence_agreement,t.requireAgreeWithSanatoriumCardForm=e.sanatorium_card_form_required,t.requireAgreeWithCancellationPolicy=e.cancellation_policy_agree_required,t.availableLanguages=o.buildLanguages(e.languages),t.availableCurrencies=o.buildCurrencies(e.currencies),t.isTaxesEnabled=e.taxes_enabled,t.forceMailDistributionSubscribe=e.force_mail_distribution_subscribe,t.forceSendSmsConfirmation=e.force_send_sms_confirmation,t.maxTariffsInRoomCard=e.max_tariffs_in_room_card,t.showNetPrices=e.show_net_prices,t.showRatePlansFilter=e.show_rate_plans_filter,t.mixUnsuitableByLosRatePlans=e.show_unavailable_rate_plans,t.completeGuestListRequired=e.complete_guest_list_required,t.bookingCancellationPrevention=e.booking_cancellation_prevention,t.onlineCheckinEnabled=e.online_checkin_enabled,t.optionCategoryCollapsed=e.option_category_collapsed,t.forceShowClosestAvailableDates=e.force_show_closest_available_dates,t.showCustomerFeedbackForm=e.show_customer_feedback_form,t.completeGuestListRequire=e.complete_guest_list_require,t.travelPurposeRequired=e.travel_purpose_required,t.businessTravelPurposeDeadline=e.business_travel_deadline?n.UnitConverter.toDate(e.business_travel_deadline):null,_.isArray(e.metasearches)&&_.forEach(e.metasearches,function(e){e=n.MetaSearchKind.convert(e);_.isUndefined(e)||t.metaSearches.push(e)}),o.buildGuestDetailing(t,e.guest_data_detalization),o.buildExperiments(t,e.experiments),o.buildFeatures(t,e.features),o.buildBookingFormModes(t,e.modes),o.buildAvailabilityCalendarSettings(t,e.availability_calendar_settings),o.buildStayStoreAvailabilityCalendarSettings(t,e.staystore_availability_calendar_settings),o.buildMotivators(t,e.motivators),o.buildAuthMethods(t,e.auth_methods),t.bestPriceGuaranteeBannerEnabled=e.best_price_guarantee_banner_enabled,t.bestPriceGuaranteePriceEnabled=t.bestPriceGuaranteeBannerEnabled&&e.best_price_guarantee_price_enabled,t.showPriceInCalendar=e.show_price_in_calendar,t.maxBookingPeriod=e.max_booking_period,o.buildPromoMirSettings(t,e.promo_mir_settings),o.buildPromoMirShowPeriod(t,e.promo_mir_settings),t.forceDisablePromoMir=e.force_disable_promo_mir,o.buildCampSchedule(t,e.camp_schedule_stay_periods),o.buildLoyaltySettings(t,e.loyalty_settings),o.buildRoomUpgradeSuggestions(t,e.room_upgrade_options),o.buildCustomScripts(t,e.custom_scripts)},o.buildAvailabilityCalendarSettings=function(e,t){e.availabilityCalendarSettings=new n.AvailabilityCalendarSettings(t.is_available,t.period&&n.UnitConverter.toDate(t.period.start_date),t.period&&n.UnitConverter.toDate(t.period.end_date),t.max_nights)},o.buildStayStoreAvailabilityCalendarSettings=function(e,t){e.stayStoreAvailabilityCalendarSettings=new n.StayStoreAvailabilityCalendarSettings(t.is_available,t.period&&n.UnitConverter.toDate(t.period.start_date),t.period&&n.UnitConverter.toDate(t.period.end_date),t.max_nights)},o.buildLanguages=function(e){var i=n.Locale.getInstance().languages();return e&&e.length?_.filter(_.map(e,function(e){var t=e.toLocaleLowerCase();return"en"==t&&(t="en-gb"),_.find(i,function(e){return e.language.language()==t||e.language.locale()==t})}),function(e){return!!e}):i},o.buildCurrencies=function(e){var i=n.Locale.getInstance().currencies();return e&&e.length?_.filter(_.map(e,function(t){return _.find(i,function(e){return e.id==t})}),function(e){return!!e}):i},o.buildGuestDetailing=function(e,t){e.guestDetailing.citizenship=t.citizenship,e.guestDetailing.city=t.city,e.guestDetailing.comments=t.comments,e.guestDetailing.region=t.region,e.guestDetailing.sex=t.sex,e.guestDetailing.postalCode=t.postal_code,e.guestDetailing.birthday=t.birthday},o.buildExperiments=function(t,e){_.isArray(e)&&0<e.length&&_.forEach(e,function(e){_.isUndefined(n.Experiment.convert(e.name))||t.experiments.push(e.name)})},o.buildFeatures=function(t,e){_.isArray(e)&&0<e.length&&_.forEach(e,function(e){_.isUndefined(n.Feature.convert(e.name))||t.features.push(e.name)})},o.buildBookingFormModes=function(t,e){_.isArray(e)&&0<e.length&&(_.forEach(e,function(e){_.isUndefined(n.BookingFormMode.convert(e))||t.modes.push(e)}),(t.isModeTurnedOn(n.BookingFormMode.SharedRoomView)&&t.isModeTurnedOn(n.BookingFormMode.SharedAccommodationRatePlan)||t.isModeTurnedOn(n.BookingFormMode.RoomsGridView)||t.isModeTurnedOn(n.BookingFormMode.CertificateBookingForm))&&(t.accommodationMode=n.AccommodationMode.Auto,t.originalAccommodationMode=t.accommodationMode),t.isServicesBookingForm()&&(t.accommodationMode=n.AccommodationMode.Manual,t.originalAccommodationMode=t.accommodationMode))},o.buildMotivators=function(e,t){var i;t&&(_.isArray(t.best_room_types)&&(e.motivators.bestRoomTypes=t.best_room_types),_.isUndefined(t.best_payment_system_type)||(i=n.PaymentSystemType.convert(t.best_payment_system_type),_.isUndefined(i)||(e.motivators.bestPaymentSystemType=i)),e.motivators.isVisitorsOnlineEnabled=t.visitors_online_enabled,e.motivators.isRoomUpgradeEnabled=t.room_upgrade_enabled,e.motivators.isLastBookingDateEnabled=t.last_booking_date_enabled,e.motivators.showTreatment=t.show_treatment,e.motivators.hideNoFood=t.hide_no_food,e.motivators.promoRatePlans=t.promo_rate_plans,_.isArray(t.services)&&o.buildOptionMotivators(e,t.services))},o.buildAuthMethods=function(e,t){e.authMethods=_.map(t,function(e){var t=new n.AuthMethod(e.code);return _.isUndefined(e.langs)||(t.langs=e.langs),t})},o.buildPromoMirSettings=function(e,t){var i;t&&t.cashback_percent&&t.booking_period&&t.booking_departure_period&&((i=new n.PromoMirSettings).bookingPeriod={startDate:n.UnitConverter.toDate(t.booking_period.start_date),endDate:n.UnitConverter.toDate(t.booking_period.end_date)},i.bookingDeparturePeriod={startDate:n.UnitConverter.toDate(t.booking_departure_period.start_date),endDate:n.UnitConverter.toDate(t.booking_departure_period.end_date)},i.minNights=t.min_nights,i.cashbackPercent=t.cashback_percent,i.maxCashback=new n.PriceAmount(t.max_cashback_amount,new n.Currency(t.max_cashback_currency)),e.promoMirSettings=i)},o.buildPromoMirShowPeriod=function(e,t){var i;t&&t.promo_show_period&&((i=new n.PromoMirShowPeriod).startDate=n.UnitConverter.toDate(t.promo_show_period.start_date),i.endDate=n.UnitConverter.toDate(t.promo_show_period.end_date),e.promoMirShowPeriod=i)},o.buildCampSchedule=function(e,t){e.campSchedule=_.map(t,function(e){return new n.CampScheduleStayPeriod(e.title,new n.DatePeriod(n.UnitConverter.toDate(e.start_date),n.UnitConverter.toDate(e.end_date)))})},o.buildLoyaltySettings=function(e,t){var i;_.isUndefined(t)||((i=new n.BookingFormSettingsLoyalty).enabled=t.enabled,e.loyaltySettings=i)},o.buildRoomUpgradeSuggestions=function(e,t){_.isUndefined(t)||(e.roomUpgradeSuggestions=_.map(t,function(e){return{sourceRoomTypeId:e.source_room_type_code,targetRoomTypeId:e.target_room_type_code}}))},o.buildCustomScripts=function(e,t){_.isUndefined(t)||(e.customScripts=t)},o.buildOptionMotivators=function(e,t){e.motivators.options=_.chain(t).groupBy(function(e){return e.service_code}).map(function(e,t){return{code:t,motivators:_.map(e,function(e){return n.OptionMotivator.convert(e.motivator_code)})}}).value()};var e,t=o;function o(){return null!==e&&e.apply(this,arguments)||this}n.DtoBookingFormSettingsBuilder=t}(tl=tl||{}),!function(t){e=t.DtoBuilderAbstract,__extends(n,e),n.build=function(e){return new t.BookingFormInfo(e.terms,e.privacy_policy)};var e,i=n;function n(){return null!==e&&e.apply(this,arguments)||this}t.DtoBookingFormInfoBuilder=i}(tl=tl||{}),!function(d){e=d.DtoBuilderAbstract,__extends(p,e),p.buildOptionId=function(e){return[e.code,e.placement_index,e.inclusive].join("-")},p.buildOptions=function(e,i){var n=[];return _.forEach(e,function(e){e.code||(e.code=_.uniqueId("tmp"));var t=(t=i.getOption(e.code))||new d.Option(e.code,e.name,e.description,d.ChargeType.convert(e.charge_type),void 0===e.placement_index?d.OptionApplicabilityType.AllGuests:d.OptionApplicabilityType.DependsOnAccommodation,e.require_prepayment,e.require_guaranteed_payment,e.quantity||0);n.push(new d.BookingOption(p.buildOptionId(e),t,d.DtoBuilderAbstract._toPrice(e.price,i),e.placement_index,e.quantity,e.inclusive))}),n},p.buildMealPlan=function(e,i){var n=[];return _.forEach(e,function(e){var t=(t=i.getMeal(e.code))||new d.Meal(e.code,e.name,e.description,d.MealPlanType.convert(e.meal_plan_type),d.ChargeType.convert(e.charge_type),void 0===e.placement_index?d.OptionApplicabilityType.AllGuests:d.OptionApplicabilityType.DependsOnAccommodation,e.require_prepayment,e.require_guaranteed_payment,e.quantity||0);n.push(new d.BookingMealPlan(p.buildOptionId(e),t,d.DtoBuilderAbstract._toPrice(e.price,i),e.placement_index,e.quantity,e.inclusive))}),n},p.buildTransfers=function(e,n){var o=[];return _.forEach(e,function(e){var t=n.getTransfer(e.transfer_code),i=(t||(i=d.TransferDirection.convert(e.direction)==d.TransferDirection.ToHotel,t=new d.Transfer(e.transfer_code,e.name,"",d.TransferType.convert(e.kind),e.require_prepayment,e.require_guaranteed_payment,e.endpoint_name,i)),new d.BookingTransfer(t,p.buildTransferVehicles(e.vehicles,n)));e.date&&(i.date=d.UnitConverter.toDate(e.date),i.time=d.UnitConverter.toDate(e.date)),i.transportCompany=e.transport_company,i.departurePlace=e.departure_location,i.additionalInfo=e.comment,i.tripNumber=e.trip_number,i.seatNumber=e.car_number,o.push(i)}),o},p.buildTransferVehicles=function(e,i){var n=[];return _.forEach(e,function(e){var t=(t=i.getVehicle(e.vehicle_code))||new d.Vehicle(e.vehicle_code,e.name,"",null);n.push(new d.BookingTransferVehicle(t,d.DtoBuilderAbstract._toPrice(e.price,i),e.quantity))}),n},p.buildPaymentSystem=function(e,t){t=t.getPaymentSystem(e.code);return t||((t=new d.PaymentSystem(e.code,e.type,e.payment_system_code,e.has_mir_cashback)).paymentSystemCode=e.payment_system_code,t.internalCode=e.payment_system_internal_code),e.name&&(t.name=e.name),e.subname&&(t.subname=e.subname),_.isBoolean(e.is_deferred_payment)&&(t.isDeferredPayment=e.is_deferred_payment),t},p.buildRoomType=function(e,t){var i,n=t.getRoom(e.code);return n||(i=d.RoomTypeUnitKind.convert(e.kind)||d.RoomTypeUnitKind.Room,d.BookingFormSettings.getInstance().isServicesBookingForm()&&(i=d.RoomTypeUnitKind.Service),d.BookingFormSettings.getInstance().isCampBookingForm()&&(i=d.RoomTypeUnitKind.Camp),t=d.DtoHotelInfoBuilder.buildContactInfo(e.contact_info,t),n=new d.RoomType(e.code,i,e.name,e.description,t,[],[],null,null,null,null)),n},p.buildRatePlan=function(e,t,i){return i.getRatePlan(e.code)||new d.RatePlan(e.code,e.name,e.shared_accommodation,null,e.description,null,t,!1,!1,!1,!1)},p.buildRoomPreferences=function(e,t){return _.map(e,function(e){return new d.BookingRoomTypePreference(e.category_code,e.category_name,e.code,e.name)})},p.buildGuestPlacements=function(a,s,l,c){var u=d.BookingFormSettings.getInstance().isModeTurnedOn(d.BookingFormMode.SharedAccommodationRatePlan);return _.map(a.room_types[0].placements,function(t){var e=null!=t.min_age&&null!=t.max_age?new d.AgeGroup(t.min_age,t.max_age):null,i=u?_.find(l,function(e){return e.id==t.rate_plan_code}):null,n=p._toPrice(t,c),o=0,r=[];_.forEach(s.guestCounts,function(e){e.guestPlacementIndex==t.index&&(e.childPlacement?r.push(e.childPlacement):o++)});return new d.GuestPlacement(t.index,t.kind,t.code,i,e,i&&i.sharedAccommodation?1:t.capacity,new d.PriceWithDiscount(n,n),function(){return _.sortBy(_.flatten(_.map(_.filter(a.placement_rates,function(e){return e.placement.kind==t.kind&&e.placement.code==t.code&&(!i||e.rate_plan_code==i.id)}),function(e){return _.map(e.rates,function(e){return new d.PlacementRate(d.UnitConverter.toDate(e.date),d.DtoBuilderAbstract._toPrice(e,c))})})),function(e){return e.date})},a.placement_rates&&0<a.placement_rates.length,o,r)})},p.buildGuestCountInfo=function(e,r){var a=new d.BookingGuestCountInfo,s=d.BookingFormSettings.getInstance();s.isModeTurnedOn(d.BookingFormMode.SharedAccommodationRatePlan);return e&&e.guest_counts&&e.guest_counts.length?(a.adults=e.adults,a.children=e.children,a.guestCounts=[],_.forEach(e.guest_counts,function(t){var e,i=_.find(r,function(e){return t.placement_index==e.index}),n=null;t.hasOwnProperty("age")&&((e=s.childrenAgeGroupByAge(t.age))?n=new d.AgeGroup(e.minAge,e.maxAge):i&&null!=i.min_age&&null!=i.max_age&&(n=new d.AgeGroup(i.min_age,i.max_age)));for(var o=0;o<(t.count||1);o++)a.guestCounts.push(new d.BookingGuestCount(d.AgeQualifyingCode.convert(t.age_qualifying_code),n?new d.ChildPlacement(t.age,n):null,i?i.index:null))})):(a.adults=0,a.children=0,a.guestCounts=[],_.forEach(r,function(e){for(var t=s.childrenAgeGroupByAge(e.min_age),i=0;i<(e.capacity||1);i++)t?a.children++:a.adults++,a.guestCounts.push(new d.BookingGuestCount(t?d.AgeQualifyingCode.Child:d.AgeQualifyingCode.Adult,t?new d.ChildPlacement(t.minAge,new d.AgeGroup(t.minAge,t.maxAge)):null,e.index))})),a},p.buildCustomerInfo=function(e){var t=new d.CustomerInfo,e=(t.firstName=e.customer.first_name,t.lastName=e.customer.last_name,t.middleName=e.customer.middle_name,t.comment=e.customer.comment,t.subscribeEmail=e.customer.subscribe_email,t.confirmSms=e.customer.confirm_sms,t.email=e.customer.contact_info.emails[0].email_address,e.customer.contact_info.phones.length?e.customer.contact_info.phones[0].phone_number:"");return t.phone=d.CustomerPhoneNumber.fromString(e),t},p.buildRoomStayId=function(e){var t=["rs","rt"+e.roomType.id];return _.forEach(e.ratePlans,function(e){t.push("rp"+e.id)}),_.forEach(e.guestPlacements,function(e){t.push([e.code,e.kind,e.ratePlan?1:e.capacity,e.ratePlan?e.ratePlan.id:"",e.ageGroup?e.ageGroup.minAge:"",e.ageGroup?e.ageGroup.maxAge:""].join("_"))}),e.guestCountInfo&&_.forEach(e.guestCountInfo.guestCounts,function(e){t.push([e.childPlacement&&e.childPlacement.ageGroup?e.childPlacement.ageGroup.minAge:""].join("_"))}),t.join("-")},p.buildPlacementsCode=function(e){var t=[];return _.forEach(e.guestPlacements,function(e){t.push([e.kind,e.capacity].join("_"))}),t.join("-")},p.buildTaxes=function(e,t){e&&e.taxes&&_.forEach(e.taxes,function(e){!t.getTax(e.code)&&e.hasOwnProperty("name")&&t.taxes.push(new d.Tax(e.code,e.kind,e.name,e.description))})},p.buildTotalWithDiscount=function(e,t){return p.buildTaxes(e,t),p._toPriceWithDiscount(e,t)},p.buildBooking=function(t,o){var r=this,a=new d.HotelBooking,i={},e=(_.forEach(t.room_stays,function(e){_.forEach(e.guest_count_info.guest_counts,function(e,t){i[e.placement_index]=t+1})}),t=_.cloneDeep(t),_.forEach(t.room_stays,function(e){_.forEach(e.guests,function(e){e.placement.index=i[e.placement.index]}),_.forEach(e.guest_count_info.guest_counts,function(e){e.placement_index=i[e.placement_index]}),_.forEach(e.room_types,function(e){_.forEach(e.placements,function(e){e.index=i[e.index]})}),_.forEach(e.placement_rates,function(e){e.placement.index=i[e.placement.index]}),_.forEach(e.services,function(e){e.placement_index=i[e.placement_index]})}),t.guarantee_info&&t.guarantee_info.guarantees[0]),s=(a.number=t.number,a.cancellationCode=t.cancellation_code,a.paymentCode=t.payment_code,a.deferredPaymentUrl=t.deferred_payment_url,a.status=d.HotelBookingStatus.convert(t.status),a.customer=p.buildCustomerInfo(t),a.bookingDate=d.UnitConverter.toDate(t.create_date),a.paymentSystem=e?p.buildPaymentSystem(e,o):null,a.provider=o.provider||new d.Provider(t.hotel_ref.code,t.hotel_ref.name,null!=(n=d.ProviderTypeUnitKind.convert(t.hotel_ref.type))?n:d.ProviderTypeUnitKind.Hotel,d.Locale.getInstance().findCurrency(t.currency)),a.options=p.buildOptions(t.services,o),a.transfers=p.buildTransfers(t.transfers,o),a.promoCode=t.promo_code,a.artifacts=t.artifacts,t.cancellation_info&&(a.cancellationInfo=new d.BookingCancellationInfo(d.UnitConverter.toDate(t.cancellation_info.cancellation_date),t.cancellation_info.cancellation_message,d.CancellationSubject.convert(t.cancellation_info.cancellation_subject))),t.point_of_sale&&(a.pointOfSale={referrerCode:t.point_of_sale.referrer_code||"",sourceUrl:t.point_of_sale.source_url||"",source:t.point_of_sale.source||"",integrationKey:t.point_of_sale.integration_key||"",utmParameters:t.point_of_sale.utm_parameters||null}),t.hotel_ref&&t.hotel_ref.stay_unit_kind?d.StayUnitKind.convert(t.hotel_ref.stay_unit_kind):d.BookingFormSettings.getInstance().stayUnitKind),n=_.find(d.Locale.getInstance().languages(),function(e){return _.includes([e.language.locale(),e.language.language()],t.language.toLocaleLowerCase())});return a.language=n?n.language:null,a.total=p.buildTotalWithDiscount(t.total,o),a.voucherUrl=t.order_url,e&&(a.paymentUrl=e.payment_url),t.guarantee_info&&(t.guarantee_info.prepayment&&(a.prepayment=p._toPrepayment(t.guarantee_info.prepayment)),t.guarantee_info.paid&&(a.paid=p._toPrepayment(t.guarantee_info.paid))),t.guarantee_info&&(t.guarantee_info.status&&(a.paymentGuaranteeStatus=d.PaymentGuaranteeStatus.convert(t.guarantee_info.status)),t.guarantee_info.pay_before&&(a.paymentDeadline=d.UnitConverter.toDate(t.guarantee_info.pay_before))),a.roomStays=_.map(t.room_stays,function(e,t){var i=new d.BookingRoomStay,t=(i.index=t,i.guests=_.map(e.guests,function(e){var t=new d.BookingGuestInfo;return t.firstName=e.first_name,t.middleName=e.middle_name,t.lastName=e.last_name,t.citizenship=o.getCountry(e.citizenship),t.birthday=e.birthday?d.UnitConverter.toDate(e.birthday):null,t.sex=d.GuestInfoSex.convert(e.sex),t.city=e.city,t.region=e.region,t.postalCode=e.postal_code,t.placementIndex=e.placement.index,t}),i.mealPlans=p.buildMealPlan(_.filter(e.services,function(e){return e.kind==d.ServiceKind.Meal}),o),i.roomOptions=p.buildOptions(_.filter(e.services,function(e){return e.kind==d.ServiceKind.Common}),o),i.stayDates=new d.RoomStayStayDate(d.UnitConverter.toDate(e.stay_dates.start_date),d.UnitConverter.toDate(e.stay_dates.end_date),s),i.roomType=p.buildRoomType(e.room_types[0],o),_.map(e.rate_plans,function(e){return p.buildRatePlan(e,a.total.currency,o)})),n=(i.ratePlans=t,i.ratePlan=_.head(t),p.buildGuestCountInfo(e.guest_count_info,e.room_types[0].placements)),n=(i.guestCountInfo=n,i.roomPreferences=p.buildRoomPreferences(e.room_types[0].preferences,o),i.guestPlacements=p.buildGuestPlacements(e,n,t,o),e.extra_stay_charge&&(e.extra_stay_charge.early_arrival&&(i.arrivalExtraStay=r._toPrice(e.extra_stay_charge.early_arrival.price,o)),e.extra_stay_charge.late_departure&&(i.departureExtraStay=r._toPrice(e.extra_stay_charge.late_departure.price,o))),i.price=p.buildTotalWithDiscount(e.total,o),e.stay_total&&(i.stayPrice=p.buildTotalWithDiscount(e.stay_total,o)),e.rate_plans[0].cancel_penalty_group);return i.cancellationInfo=new d.CancellationPenaltyDescriptiveInfo(n.code,n.description,n.free_cancellation,n.show_description),i.isPriceDetailsAvailable=!_.isUndefined(e.placement_rates)&&0<e.placement_rates.length,i.id=p.buildRoomStayId(i),i.placementsCode=p.buildPlacementsCode(i),i}),a},p.convertCurrency=function(e,t,i){p.buildPaymentSystems(e,i.paymentSystems),p.buildExtraStay(e,t,i)},p.translate=function(e,t,i){p.buildPaymentSystems(e,i.paymentSystems),p.buildExtraStayCharge(e,t)},p.toExtraStayPriceTime=function(e,t){return new d.ExtraStayPriceTime(p._toPrice(e.price,t),d.UnitConverter.toDate(e.date),d.UnitConverter.parseTime(e.local_time),e.forbidden)},p.buildExtraStay=function(e,t,i){p.buildExtraStayCharge(e,t),p.buildExtraStayChargeOptions(e,t,i)},p.getRawRoomStay=function(e,t,i,n){var o=!!_.head(t.guestPlacements).ratePlan,t=_.groupBy(e.room_stays,function(e){return _.sortBy(_.map(e.room_types[0].placements,function(e){return[e.code,e.kind,o&&e.rate_plan_code||""].join("-")})).join(",")});return t[i]?t[i][n]:void 0},p.getRoomStayGroups=function(e){return _.groupBy(e,function(e){var t=!!_.head(e.guestPlacements).ratePlan;return _.sortBy(_.map(e.guestPlacements,function(e){return[e.code,e.kind,t&&e.ratePlan?e.ratePlan.id:""].join("-")})).join(",")})},p.buildExtraStayCharge=function(n,e){_.forEach(p.getRoomStayGroups(e.guestStays),function(e,i){_.forEach(e,function(e,t){t=p.getRawRoomStay(n,e,i,t);t&&(e.arrivalExtraStay.standardTime=d.UnitConverter.parseTime(t.extra_stay_charge_options.base_check_in_time),e.departureExtraStay.standardTime=d.UnitConverter.parseTime(t.extra_stay_charge_options.base_check_out_time),e.arrivalExtraStay.description=t.extra_stay_charge_options.early_arrival_rule_description,e.departureExtraStay.description=t.extra_stay_charge_options.late_departure_rule_description)})})},p.buildExtraStayChargeOptions=function(r,e,n){function a(e,t,i){e&&(t.options=_.filter(_.map(e,function(e){return p.toExtraStayPriceTime(e,n)}),function(e){return!e.isForbidden()})),t.options.length||t.options.push(new d.ExtraStayPriceTime(null,i,t.standardTime)),t.priceTime&&_.includes(t.options,t.priceTime)||(t.priceTime=p.getExtraStayTime(t.options,i))}_.forEach(p.getRoomStayGroups(e.guestStays),function(e,o){_.forEach(e,function(e,t){var i,n,t=p.getRawRoomStay(r,e,o,t);t&&t.extra_stay_charge_options&&(i=d.UnitConverter.toDate(t.stay_dates.start_date),n=d.UnitConverter.toDate(t.stay_dates.end_date),a(t.extra_stay_charge_options.early_arrival,e.arrivalExtraStay,i),a(t.extra_stay_charge_options.late_departure,e.departureExtraStay,n))})})},p.getExtraStayTime=function(e,t){return _.find(e,function(e){return!e.isForbidden()&&e.time().isEqualTime(t)})||_.find(e,function(e){return!e.isForbidden()})},p.buildPrepayment=function(o,e,r,a,s){o.paymentOptions=_.map(e.guarantee_options,function(t){var e=_.find(o.paymentOptions,function(e){return e.paymentSystem.code==t.code}),i=_.find(r,{code:t.code}),n=new d.DtoLoanPaymentScheduleBuilder(i,t,a,s),i=new d.PaymentOption(i,n.isPaymentSystemWithSchedule()?function(){return n.build()}:null);return i.prepayment=p._toPrepayment(t.prepayment),i.transactionAmount=t.transaction_amount?p._toPrepayment(t.transaction_amount):null,i.specificPrepayment=t.specific_prepayment?p._toPrepayment(t.specific_prepayment):null,e&&(i.id=e.id),t.texts.payment_due_date_description&&(i.paymentDueDateDescription=t.texts.payment_due_date_description),i});var e=d.BookingFormSettings.getInstance(),t=e.isMirCashbackAvailable()||d.MirCashbackUtil.isTestOrder(o);o.paymentOptions=_.filter(e.hasFeature(d.Feature.PreventOverrideMirPaymentSystemSortOrder)?o.paymentOptions:_.sortBy(o.paymentOptions,function(e){return e.paymentSystem.hasMirCashback}),function(e){return!e.paymentSystem.hasMirCashback||t})},p.buildPaymentSystemOffices=function(e){return e.texts.office_locations.map(function(e){var t=new d.PaymentSystemOffice;return t.address=e.address,t.phone=e.phone,t.weekdayEnd=e.weekday_end,t.weekdayStart=e.weekday_start,t.weekendEnd=e.weekend_end,t.weekendStart=e.weekend_start,t})},p.buildPaymentSystemLogo=function(e){return e?new d.PaymentSystemLogo(e.code,e.title):null},p.buildExtraGuarantees=function(e){return new d.ExtraGuarantee(e.name,e.payment_system_code,p._toPrepayment(e.prepayment))},p.buildPaymentSystems=function(e,n){var o=this;_.each(e.guarantee_options,function(e){var t,i=_.find(n,{code:e.code});i||(i=new d.PaymentSystem(e.code,e.type,e.payment_system_code,e.has_mir_cashback),n.push(i)),i.name=e.name,i.subname=e.subname,i.description=e.texts.description,i.logo=o.buildPaymentSystemLogo(e.logo),i.paymentSystemInformation=e.texts.payment_system_information,i.currencyConvertationNotice=e.texts.currency_convertation_notice,i.paymentInstruction=e.texts.payment_instruction,i.prepaymentInformation=e.texts.prepayment_information,i.cancellationPolicy=e.texts.cancellation_policy,i.paymentSystemCode=e.payment_system_code,i.internalCode=e.payment_system_internal_code,i.siteUrl=e.site_url,i.requirePrepayment=e.require_prepayment,i.isDeferredPayment=e.is_deferred_payment,i.primaryPaymentSystemCode=null!=(t=e.primary_guarantee_code)?t:e.payment_system_code,e.logos&&e.logos.length&&(i.paymentSystemLogos=_.map(e.logos,function(e){return o.buildPaymentSystemLogo(e)})),e.texts.office_locations&&e.texts.office_locations.length&&(i.offices=o.buildPaymentSystemOffices(e)),e.layout_size&&(i.layout=new d.PaymentSystemLayout(e.layout_size.width,e.layout_size.height)),e.extra_guarantees&&(i.extraGuarantees=_.map(e.extra_guarantees,function(e){return o.buildExtraGuarantees(e)}))})};var e,t=p;function p(){return null!==e&&e.apply(this,arguments)||this}d.DtoHotelReservationBuilder=t}(tl=tl||{}),!function(i){function e(){}e.buildRules=function(e){return _.map(e.booking_rules,function(e){return new i.HotelBookingRule(i.UnitConverter.toDate(e.date),e.room_types,e.forbidden,e.min_los,e.min_los_arrival,e.min_adv_booking,e.max_los,e.max_los_arrival,e.max_adv_booking,e.cta,e.ctd)})},e.findRule=function(e,t){return _.find(e,function(e){return e.date.isEqualDate(t)})||new i.HotelBookingRule(t)},i.DtoHotelBookingRulesBuilder=e}(tl=tl||{}),!function(g){function o(){}o.buildRulesByDate=function(e,t){var i=g.UnitConverter.dateToString(t);return _.map(_.filter(e.booking_rules,function(e){return e.date===i}),function(e){return new g.RatePlanBookingRule(e.code,g.UnitConverter.toDate(e.date),e.room_types,e.forbidden,e.min_los,e.min_los_arrival,e.min_adv_booking,e.max_los,e.max_los_arrival,e.max_adv_booking,e.cta,e.ctd)})},o.findRule=function(e,t,i,n){return(n?_.find(e,function(e){return e.date.isEqualDate(t)&&e.ratePlanCode===i&&_.includes(e.roomTypes,n)}):o.mergeRules(_.filter(e,function(e){return e.date.isEqualDate(t)&&e.ratePlanCode===i}),t,i))||new g.RatePlanBookingRule(i,t)},o.mergeRules=function(e,t,i){var n=this,o=[],r=!!e.length,a=void 0,s=void 0,l=void 0,c=void 0,u=void 0,d=void 0,p=!!e.length,m=!!e.length;return _.each(e,function(e){o=__spreadArrays(o,e.roomTypes),r=e.forbidden&&r,p=e.closeArrival&&p,m=e.closeDeparture&&m,e.forbidden||(a=n.findMin(a,e.minLos),s=n.findMin(s,e.minLosArrival),l=n.findMin(l,e.minAdvBooking),c=n.findMax(c,e.maxLos),u=n.findMax(u,e.maxLosArrival),d=n.findMax(d,e.maxAdvBooking))}),new g.RatePlanBookingRule(i,t,o,r,a,s,l,c,u,d,p,m)},o.findMin=function(e,t){return _.isUndefined(e)||(t||0)<e?t||0:e},o.findMax=function(e,t){return _.isUndefined(e)||e<(t||Number.MAX_VALUE)?t||Number.MAX_VALUE:e},g.DtoRatePlanBookingRulesBuilder=o}(tl=tl||{}),!function(e){t=e.DtoHotelReservationBuilder,__extends(n,t);var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.DtoReadReservationBuilder=i}(tl=tl||{}),!function(e){t=e.DtoBuilderAbstract,__extends(n,t),n.build=function(e){return e&&e.custom_messages?e.custom_messages:{}};var t,i=n;function n(){return null!==t&&t.apply(this,arguments)||this}e.DtoCustomMessagesBuilder=i}(tl=tl||{}),!function(n){e=n.DtoBuilderAbstract,__extends(i,e),i.build=function(e,t,i){t=t||new n.BookingSettings;e=_.find(e.hotel_reservation_rules,function(e){return e.number==i});return e&&(e.personal_data_delete_date&&(t.personalDataDeleteDate=n.UnitConverter.toDate(e.personal_data_delete_date)),t.restoreReservationAvailable=e.restore_reservation_available,t.cancelReservationAvailable=e.cancel_reservation_available,e.modifiable&&(t.modifiable.stayDates=e.modifiable.stay_dates,t.modifiable.customerInfo=e.modifiable.customer_info,t.modifiable.guestsInfo=e.modifiable.guests_info,t.modifiable.deleteRoomStay=e.modifiable.delete_room_stay,t.modifiable.ratePlan=e.modifiable.rate_plan,t.modifiable.roomType=e.modifiable.room_type,t.modifiable.service=e.modifiable.service)),t};var e,t=i;function i(){return null!==e&&e.apply(this,arguments)||this}n.DtoBookingSettingsBuilder=t}(tl=tl||{}),!function(r){function e(){}e.buildSettings=function(e){var t=new r.WishListSettings,i=(t.enabled=e.isEnabled,t.showName=e.doesShowNameField,t.isNameRequired=e.isNameFieldRequired,t.showPhone=e.doesShowPhoneField,t.isPhoneRequired=e.isPhoneFieldRequired,t.showEmail=e.doesShowEmailField,t.isEmailRequired=e.isEmailFieldRequired,t.showComment=e.doesShowCommentField,new Date),n=new r.BookingAvailabilityDate(i,30,r.BookingAvailabilityUnit.day),o=new r.BookingAvailabilityDate(i,1,r.BookingAvailabilityUnit.year);return t.maxStayDurationFromToday=e.maxStayDurationFromToday?new r.BookingAvailabilityDate(i,e.maxStayDurationFromToday.duration,e.maxStayDurationFromToday.timeUnit):n,t.maxArrivalDate=e.maxArrivalDate?new r.BookingAvailabilityDate(i,e.maxArrivalDate.duration,e.maxArrivalDate.timeUnit):o,t},e.buildLegalDocuments=function(e){return new r.BookingFormInfo("",e.privacyPolicy)},r.DtoWishListBuilder=e}(tl=tl||{}),!function(t){function e(){}e.build=function(e){return e?_.map(e.stay_dates,function(e){return new t.DatePeriod(t.UnitConverter.toDate(e.start_date),t.UnitConverter.toDate(e.end_date))}):null},t.DtoNearestAvailableDatesBuilder=e}(tl=tl||{}),!function(t){function e(e,t,i,n){this.paymentSystem=e,this.prepaymentGuarantee=t,this.serviceTransport=i,this.$q=n}e.prototype.isPaymentSystemWithSchedule=function(){return _.includes([t.PaymentSystemCode.YandexKasssaInstallments,t.PaymentSystemCode.Moneywall],this.paymentSystem.paymentSystemCode)},e.prototype.build=function(){switch(this.paymentSystem.paymentSystemCode){case t.PaymentSystemCode.YandexKasssaInstallments:return this.buildYandexKassa();case t.PaymentSystemCode.Moneywall:return this.buildMoneyWall();default:return null}},e.prototype.buildMoneyWall=function(){return this.$q.when(this.toSchedulePrice(this.prepaymentGuarantee.loan_payment_schedule))},e.prototype.buildYandexKassa=function(){var i=this,n=this.prepaymentGuarantee.installments_schedule;if(!n)return null;var e={amount:n.amount,currency:n.currency,payment_system_id:n.payment_system_id};return this.serviceTransport.getYandexCreditSchedule(e).then(function(e){var t=[];return _.times(e.term,function(){t.push({amount:e.amount,currency:n.currency,term:e.term})}),i.toSchedulePrice(t)})},e.prototype.toSchedulePrice=function(e){return _.map(e,function(e){return new t.SchedulePriceAmount(e.amount,new t.Currency(e.currency))})},t.DtoLoanPaymentScheduleBuilder=e}(tl=tl||{}),!function(t){function e(){}e.buildAdvantages=function(e){return _.map(e.items,function(e){return new t.BestPriceGuaranteeAdvantage(e.text)})},t.DtoBestPriceGuaranteeBuilder=e}(tl=tl||{}),!function(a){function e(){}e.build=function(e,t,i,n,o){var r=new a.SurveyConfig;r.id=e.id,r.providerId=e.provider_id,r.welcomeText=e.welcome_text,r.categories=e.categories&&_.map(e.categories,function(e){return new a.CategoryQuestion(e.id,e.name,_.map(e.questions,function(e){return new a.Question(e.id,e.text)}))}),r.showSteps=e.show_steps,r.bookingNumber=i,r.sign=n,r.available=!!r.categories&&!!r.categories.length,r.theme=e.theme,r.errors=this.resolveErrors(e.errors),r.preview=o,t.setSurveyConfig(r)},e.resolveErrors=function(e){return e&&_.map(e,function(e){return _.includes(a.SurveyErrorType,e.code)?e.code:a.SurveyErrorType.Unknown})},e.translate=function(e,t){t.surveyConfig.welcomeText=e.welcome_text,_.each(e.categories,function(e){var i=_.find(t.surveyConfig.categories,{id:e.id});i&&(i.name=e.name,_.each(e.questions,function(e){var t=_.find(i.questions,{id:e.id});t&&(t.text=e.text)}))})},a.DtoSurveyBuilder=e}(tl=tl||{}),!function(n){function e(){}e.build=function(e,t){var i=new n.finder.PlacementFinderCriterion;return i.adults=e,i.children=_.map(t,function(e){return new n.finder.ChildPlacement(e.age)}),i},n.PlacementFinderCriterionBuilder=e}(tl=tl||{}),!function(e){function r(){}r.buildPrice=function(e){return{amount:e?e.priceAfterTax.amount:0,currency:e?e.currency.id:""}},r.buildRoom=function(e){return{id:e.roomType.id,room:e.roomType.name,price:r.buildPrice(e.price.priceAfterDiscount)}},r.buildRoomUpgrade=function(e,t){var i=[];return e&&t&&i.push({previousRoom:r.buildRoom(e),currentRoom:r.buildRoom(t)}),i},r.buildTransfers=function(e){var i=[];return _.forEach(e,function(e){var t;e.getQuantity()&&(t=[],_.forEach(e.vehicles,function(e){e.quantity&&t.push({name:e.option.vehicle.name,quantity:e.quantity,capacity:e.option.vehicle.capacity,price:r.buildPrice(e.option.price)})}),i.push({id:e.id,name:e.transferOffer.transfer.name,endPoint:e.transferOffer.transfer.endPoint,vehicles:t}))}),i},r.buildOptionsGroup=function(e,n){var o=[];return _.forEach(e,function(t){var e,i;t.getQuantity()&&(e={id:t.code(),name:t.option.name(),quantity:t.getQuantity(),price:r.buildPrice(t.getTotalPrice()),rate:null,room:null},n&&(n.roomStay.ratePlan.sharedAccommodation?(i=_.find(n.roomStay.guestPlacementOptions,function(e){return t.option.getPlacementIndex()===e.index}),_.isUndefined(i)||(e.rate=i.ratePlan.name,e.room=n.roomStay.roomType.name)):(e.rate=n.roomStay.ratePlan.name,e.room=n.roomStay.roomType.name)),o.push(e))}),o},r.buildOptions=function(e){var t=r.buildOptionsGroup(e.options);return _.forEach(e.guestStays,function(e){t=(t=t.concat(r.buildOptionsGroup(e.mealPlans,e))).concat(r.buildOptionsGroup(e.roomOptions,e))}),t},e.IntegrationBuilder=r}(tl=tl||{}),!function(s){function l(){}l.buildOrderOptions=function(e,i,n){var o=[];return _.forEach(e,function(t){var e=_.find(i.bookingOptions,function(e){return e.id()==t.id()}),e=new s.EnumerableBookingOption(i.roomStay,e,n,t.quantity());o.push(e)}),o},l.buildOrderTransfers=function(t,e){e=e.transfers;return _.forEach(e,function(i){var e=_.find(t,function(e){return e.transfer.id==i.transferOffer.transfer.id});i.time=e.date,i.date=e.date,i.transportCompany=e.transportCompany,i.departurePlace=e.departurePlace,i.additionalInfo=e.additionalInfo,i.tripNumber=e.tripNumber,i.seatNumber=e.seatNumber,_.forEach(e.vehicles,function(t){var e=_.find(i.vehicles,function(e){return e.id==t.vehicle.id});i.vehicleOn(e.id,t.quantity)})}),e},l.buildTransferOptions=function(e,n,o){return _.map(e,function(e){var t=_.map(e.vehicles,function(e){return new s.VehicleOption(e.vehicle,e.price)}),i=new s.TransferOffer(e.transfer,t,o),e=_.map(i.vehicles,function(e){return new s.EnumerableVehicleOption(n,i.transfer,e,o)});return new s.TransferOption(i,e)})},l.buildGuestInfo=function(e){var t=new s.GuestInfo;return t.firstName=e.firstName,t.middleName=e.middleName,t.lastName=e.lastName,t.citizenship=e.citizenship?e.citizenship.countryCode3:null,t.postalCode=e.postalCode,t.region=e.region,t.city=e.city,t.sex=e.sex,t.birthday=e.birthday,t.placementIndex=e.placementIndex,t.defaultCitizenship=t.citizenship,t},l.buildBookingOptions=function(e){return _.map(e,function(e){return new s.RoomOption(e.id(),e.getOption(),e.getPricePerUnit(),null,e.inclusive(),!1,0)})},l.buildRoomStayOptions=function(e){return _.map(e,function(e){return new s.RoomOption(e.id(),e.option,e.getPricePerUnit(),e.getPlacementIndex(),e.inclusive(),!1,0)})},l.buildRoomStayMealPlans=function(e){return _.map(e,function(e){return new s.MealPlan(e.id(),e.meal,e.getPricePerUnit(),e.getPlacementIndex(),e.inclusive())})},l.buildRoomStay=function(e){var t,i=new s.RoomStay(e.id,e.placementsCode,e.roomType,e.ratePlans,e.stayPrice||(t=s.PriceCalculator.clone(e.price.priceAfterDiscount),_.each(e.roomOptions,function(e){t=s.PriceCalculator.sub(t,e.getPrice())}),_.each(e.mealPlans,function(e){t=s.PriceCalculator.sub(t,e.getPrice())}),e.arrivalExtraStay&&(t=s.PriceCalculator.sub(t,e.arrivalExtraStay)),(t=e.departureExtraStay?s.PriceCalculator.sub(t,e.departureExtraStay):t).taxes=e.price.priceAfterDiscount.taxes,new s.PriceWithDiscount(t,t)),function(){return e.guestPlacements},null,function(){return l.buildRoomStayOptions(e.roomOptions)},function(){return l.buildRoomStayMealPlans(e.mealPlans)});return i.stayDates=new s.RoomStayStayDate(e.stayDates.startDate,e.stayDates.endDate,e.stayDates.stayUnitKind),i.cancellationInfo=e.cancellationInfo,i.promo=_.some(i.ratePlans,function(e){return e.promo}),i},l.buildGuestStayExtraStayPrice=function(e,t){t.arrivalExtraStay&&e.arrivalExtraStay.priceTime.price(t.arrivalExtraStay),t.departureExtraStay&&e.departureExtraStay.priceTime.price(t.departureExtraStay)},l.buildGuestStayOptions=function(i,n,e){_.forEach(e.roomOptions,function(t){var e=_.find(n,function(e){return e.code()==t.code()&&e.getPlacementIndex()==t.getPlacementIndex()});i.addOption(e,t.quantity())})},l.buildGuestStayMeals=function(i,n,e){_.forEach(e.mealPlans,function(t){var e=_.find(n,function(e){return e.code()==t.code()&&e.getPlacementIndex()==t.getPlacementIndex()});i.addMealPlan(e,t.quantity())})},l.buildGuestStayPreferences=function(i,e){_.forEach(e.roomPreferences,function(t){var e=_.find(i.roomPreferences,function(e){return e.roomPreference.code==t.code&&e.roomPreference.categoryCode==t.categoryCode});e&&(e.selected=!0)})},l.buildGuestStays=function(n,e,o,r,a){a.stayOptions=[],a.stayOfferOptions=[],a.bookingStayOptions=[],_.forEach(e.roomStays,function(e){var t=l.buildRoomStay(e),i=(a.bookingStayOptions.push(new s.StayOption(t,function(){return l.buildTransferOptions(r,t,a)},function(){return l.buildBookingOptions(o)})),n.addRoomStay(t));l.buildGuestStayExtraStayPrice(i,e),l.buildGuestStayOptions(i,t.getOptions(),e),l.buildGuestStayMeals(i,t.getMealPlans(),e),l.buildGuestStayPreferences(i,e),i.guests=_.map(e.guests,function(e){return l.buildGuestInfo(e)})})},l.build=function(e,t,i){t.currency(e.total.currency),t.bookingDate=e.bookingDate,t.promoCode=e.promoCode,t.provider=e.provider,t.customer=e.customer.clone(),t.paymentSystem=e.paymentSystem,t.paymentGuaranteeStatus=e.paymentGuaranteeStatus,t.number=e.number,t.cancellationCode=e.cancellationCode||null,t.paymentCode=e.paymentCode||null,t.artifacts=e.artifacts,t.pointOfSale=e.pointOfSale,l.buildGuestStays(t,e,e.options,e.transfers,i);var n=_.head(i.bookingStayOptions);return t.options=l.buildOrderOptions(e.options,n,i),t.transfers=l.buildOrderTransfers(e.transfers,n),t},s.HotelBookingOrderBuilder=l}(tl=tl||{}),!function(i){function n(){}n.buildGuests=function(e,t){_.forEach(e.guests,function(e){t.guests.push(e.clone())})},n.buildRoomOptions=function(e,i){_.forEach(e.roomOptions,function(t){var e=_.find(i.roomStay.getOptions(),function(e){return e.code()==t.option.code()&&0<t.getQuantity()});e&&i.addOption(e,t.getQuantity())})},n.buildMealPlans=function(e,i){_.forEach(e.mealPlans,function(t){var e=_.find(i.roomStay.getMealPlans(),function(e){return e.code()==t.option.code()&&0<t.getQuantity()});e&&i.addMealPlan(e,t.getQuantity())})},n.buildRoomPreferences=function(e,i){_.forEach(e.roomPreferences,function(t){var e;t.selected&&(e=_.find(i.roomPreferences,function(e){return e.roomPreference.code==t.roomPreference.code}),_.isUndefined(e)||(e.selected=!0))})},n.buildExtraStay=function(e,t){t.arrivalExtraStay=new i.OrderExtraStay(new i.ExtraStayPriceTime(null,e.arrivalExtraStay.priceTime.time(),e.arrivalExtraStay.priceTime.providerTime())),t.departureExtraStay=new i.OrderExtraStay(new i.ExtraStayPriceTime(null,e.departureExtraStay.priceTime.time(),e.departureExtraStay.priceTime.providerTime()))},n.buildGuestStay=function(e,t){n.buildGuests(e,t),n.buildRoomOptions(e,t),n.buildMealPlans(e,t),n.buildRoomPreferences(e,t),n.buildExtraStay(e,t)},n.build=function(e,t,i){i=e.addRoomStay(i),n.buildGuestStay(t,i),i=_.findIndex(e.guestStays,function(e){return e.id==t.id});return e.removeGuestStay(t),e.guestStays.splice(i,0,_.last(e.guestStays)),e.guestStays.splice(-1,1),e},i.ModificationOrderBuilder=n}(tl=tl||{}),!function(n){function i(){}function e(e){this._result=e.clone(),this._result.placements=[]}i.buildSearchCriteriaPlacement=function(e){var t=0,i=[];return _.each(e.guestPlacements,function(e){t+=e.adults,_.each(e.childrenPlacements,function(e){i.push(new n.SearchCriteriaChildPlacement(e.age))})}),new n.SearchCriteriaPlacement(t,i)},i.build=function(e,t){t=t?[t]:e.roomStays,t=new n.SearchCriteria(e.provider.id,_.map(t,function(e){return i.buildSearchCriteriaPlacement(e)}),_.head(t).stayDates.startDate,_.head(t).stayDates.endDate,e.language,_.head(t).price.currency,e.pointOfSale.source);return e.promoCode&&(t.promoCode=e.promoCode),t},n.SearchCriteriaBuilder=i,e.prototype.buildPlacement=function(e){var i=new n.SearchCriteriaPlacement(0);return i.roomTypeId=e.roomTypeId,_.forEach(e.guests,function(e){var t;null===e.age?(t=new n.SearchCriteriaAdultPlacement(e.guestRatePlan.ratePlan.id),i.adultPlacements.push(t)):(t=new n.SearchCriteriaChildPlacement(e.age,e.guestRatePlan.ratePlan.id),i.children.push(t))}),i},e.prototype.build=function(e){var t=this;return _.forEach(e,function(e){t._result.placements.push(t.buildPlacement(e))}),this._result},n.SearchCriteriaSharedRoomStaysBuilder=e}(tl=tl||{}),!function(s){function e(e,t,i,n){this._roomType=e,this._roomStays=t,this._placements=i,this._placementRef=n,this._uiSharedRoom=new s.uiSharedGuestAccommodation}e.prototype.buildRoomType=function(){this._uiSharedRoom.roomType=this._roomType},e.prototype.buildRoomStays=function(){var o=this;_.forEach(this._placements,function(t){var e,i,n;!_.isUndefined(o._placementRef)&&t.ref!=o._placementRef||(n=s.PlacementFinderCriterionBuilder.build(t.adults,t.children),e=_.filter(o._roomStays,function(e){return!!e.ratePlanRestriction||e.isRoomStayOffer&&(!e.ratePlan.withChildrenOnly||0<t.children.length)}),i=_.flatten(_.map(e,function(e){return e.guestPlacementOptions})),n=s.finder.PlacementFinder.find(n,i,o._roomType.occupancy),n=new r(n,i,o._roomType,e).build(),_.every(n.guests,function(e){return _.some(e.guestRatePlans,function(e){return e.price||e.isRestrictedByPromotionCode})})&&o._uiSharedRoom.roomStays.push(n))})},e.prototype.buildPlacementRef=function(){_.isUndefined(this._placementRef)||(this._uiSharedRoom.placementRef=this._placementRef)},e.prototype.build=function(){return this.buildRoomType(),this.buildRoomStays(),this.buildPlacementRef(),this._uiSharedRoom},s.uiSharedGuestAccommodationBuilder=e;t.prototype.buildGuestPlacements=function(){var i,n=this;this._roomStayPlacement&&(i=s.BookingFormSettings.getInstance().isModeTurnedOn(s.BookingFormMode.CalculateAdultsSeparatelyFromChildren),_.times(this._roomStayPlacement.adults,function(){var e=i?n._roomStayPlacement.adults:n._roomStayPlacement.totalMainBeds;n._uiSharedRoomStay.guests.push(n.buildGuestPlacement(s.GuestPlacementKind.Adult,e))}),_.times(this._roomStayPlacement.adultsExtraBed,function(){var e=i?n._roomStayPlacement.adultsExtraBed:n._roomStayPlacement.totalExtraBeds;n._uiSharedRoomStay.guests.push(n.buildGuestPlacement(s.GuestPlacementKind.ExtraAdult,e))}),_.forEach(this._roomStayPlacement.children,function(e){var t=i?n._roomStayPlacement.children.length:n._roomStayPlacement.totalMainBeds;n._uiSharedRoomStay.guests.push(n.buildGuestPlacement(s.GuestPlacementKind.Child,t,e.age))}),_.forEach(this._roomStayPlacement.childrenExtraBed,function(e){var t=i?n._roomStayPlacement.childrenExtraBed.length:n._roomStayPlacement.totalExtraBeds;n._uiSharedRoomStay.guests.push(n.buildGuestPlacement(s.GuestPlacementKind.ExtraChild,t,e.age))}),_.forEach(this._roomStayPlacement.childrenWithoutBed,function(e){n._uiSharedRoomStay.guests.push(n.buildGuestPlacement(s.GuestPlacementKind.ChildBandWithoutBed,1,e.age))}))},t.prototype.buildGuestRatePlans=function(n,o,r){if(!_.some(this._guestPlacements,function(e){return e.kind===n&&e.capacity===o}))return[];var a=[];return _.forEach(this._roomStays,function(e){var t=e.hasRestriction(s.RoomStayRestrictionKind.PromotionalCode),i=s.calculator.PlacementPriceCalculator.calculate(e.guestPlacementOptions,n,o,r);(null!=i||e.ratePlanRestriction||t)&&((i=new s.uiGuestRatePlan(e.ratePlan,i,e.roomTypeQuotaId)).isRestrictedByPromotionCode=t,i.paymentSystems=_.map(e.paymentOptions,function(e){return e.paymentSystem}),e.ratePlanRestriction&&(i.ratePlanRestriction=e.ratePlanRestriction),e.limitedInventoryCount&&(i.limitedInventoryCount=e.limitedInventoryCount),e.cancellationInfo&&(i.cancellationInfo=e.cancellationInfo),(t=e.inclusiveMealPlan())&&(i.inclusiveMealPlan=t),i.options=e.getOptions(),i.stayDates=e.stayDates,i.promo=e.promo,a.push(i))}),a},t.prototype.buildGuestPlacement=function(e,t,i){void 0===t&&(t=1);var n=new s.uiGuestPlacement(e,i=void 0===i?null:i);return n.guestRatePlans=this.buildGuestRatePlans(e,t,i),n},t.prototype.build=function(){return this._uiSharedRoomStay.roomTypeId=this._roomType.id,this.buildGuestPlacements(),this._uiSharedRoomStay};var r=t;function t(e,t,i,n){this._roomStayPlacement=e,this._guestPlacements=t,this._roomType=i,this._roomStays=n,this._uiSharedRoomStay=new s.uiSharedRoomStay}s.uiSharedRoomStayBuilder=r}(tl=tl||{}),!function(i){function e(e,t){this.order=e,this.paymentOptions=t,this.uiOptions=[],this.isTestOrder=i.MirCashbackUtil.isTestOrder(e)}e.prototype.build=function(){return this.groupByPrimaryPaymentSystemCode().removeOptionsByNonPromotionalMirMonths().sortOptionsByMir(),this.uiOptions},e.prototype.groupByPrimaryPaymentSystemCode=function(){var t=this,e=_(this.paymentOptions).groupBy(function(e){return e.paymentSystem.primaryPaymentSystemCode}).sortBy(function(e){return t.paymentOptions.indexOf(_.head(e))}).value();return this.uiOptions=_.map(e,function(e){return new i.uiPaymentOption(_.find(e,function(e){return e.paymentSystem.code===e.paymentSystem.primaryPaymentSystemCode}),_.find(e,function(e){return e.paymentSystem.code!==e.paymentSystem.primaryPaymentSystemCode}))}),this},e.prototype.removeOptionsByNonPromotionalMirMonths=function(){var t=this;return this.uiOptions=_.filter(this.uiOptions,function(e){return t.isTestOrder||!i.MirCashbackUtil.isPaymentSystemWithCashback(e.paymentSystem)||i.MirCashbackUtil.isShowingMotivator(t.order.stayDates.startDate)}),this},e.prototype.sortOptionsByMir=function(){return i.BookingFormSettings.getInstance().hasFeature(i.Feature.PreventOverrideMirPaymentSystemSortOrder)||(this.uiOptions=_.sortBy(this.uiOptions,function(e){return i.MirCashbackUtil.isPaymentSystemWithCashback(e.paymentSystem)?0:1})),this},i.uiPaymentOptionBuilder=e}(tl=tl||{}),!function(n){function e(){}e.buildBookingRules=function(e,t){var i;e.booking_rules&&(i=e.booking_rules,e=n.DateUtil.getHotelDate(e.timezone.offset).resetTime(),t.bookingRule=new n.BookingFormSettingsBookingRule(new n.BookingAvailabilityDate(e,i.availability_min_date.duration,i.availability_min_date.time_unit),new n.BookingAvailabilityDate(e,i.availability_max_date.duration,i.availability_max_date.time_unit)))},e.buildDefaultCurrency=function(e,t){t.defaultCurrency=n.Locale.getInstance().findCurrency(e.currency)},n.BookingFormSettingsBuilder=e}(tl=tl||{}),!function(i){function e(){}e.build=function(e,t){return _.map(e.preferences,function(e){return new i.EnumerableRoomPreference(e,!1,t)})},e.buildWithSelectedPreferences=function(i,e,t,n){t=this.build(i,t);return _.forEach(t,function(t){t.selected=!!_.find(e,function(e){return e.preferenceCategoryCode==t.roomPreference.categoryCode&&e.preferenceCode==t.roomPreference.code&&e.roomTypeId==i.id&&e.placementRef==n})}),t},e.buildWithGuestStays=function(e,t,i,n){var o=this.build(e,i);return _.forEach(t,function(e){_.forEach(e.roomPreferences,function(t){var e=!!_.find(o,function(e){return e.selected&&e.roomPreference.categoryCode==t.roomPreference.categoryCode&&t.roomPreference.placementRef==n});t.selected&&!e&&(e=_.find(o,function(e){return e.roomPreference.code==t.roomPreference.code&&e.roomPreference.categoryCode==t.roomPreference.categoryCode&&t.roomPreference.placementRef==n}),_.isUndefined(e)||(e.selected=!0))})}),o},i.PreferenceBuilder=e}(tl=tl||{}),!function(e){function t(){}function l(e,t){this._isCacheEnabled=!1,this.$q=e,this._storageName=t,this._isCacheEnabled=this._checkIsCacheEnabled()}t.Session="sessionStorage",t.Local="localStorage",e.BrowserStorageCacheName=t,l.prototype.setCacheSync=function(e,t,i){return this._setCache(e,t,!1,i)},l.prototype.setCache=function(e,t,i){return this._setCache(e,t,!0,i)},l.prototype._setCache=function(e,t,i,n){var o=this;if(!this._isCacheEnabled)return!1;var r,a=l._toStorageKey(e),s=l._toStorageHashTtl(a);return t?this._storage().getItem(a)||(r=function(e){var t=(new Date).addMinutes(n.minutes());try{o._storage().setItem(a,JSON.stringify(e)),o._storage().setItem(s,t.getTime().toString())}catch(e){}},i?t.then(function(e){r(e)}):r(t)):(this._storage().removeItem(s),this._storage().removeItem(a)),!0},l.prototype.getCacheSync=function(e){return this._getCache(e)},l.prototype.getCache=function(e){e=this._getCache(e);return e?this.$q.when(e):null},l.prototype._getCache=function(e){if(!this._isCacheEnabled)return null;var e=l._toStorageKey(e),t=l._toStorageHashTtl(e),i=_.parseInt(this._storage().getItem(t)),n=this._storage().getItem(e);return n&&i&&i>(new Date).getTime()?JSON.parse(n):(this._storage().removeItem(t),this._storage().removeItem(e),null)},l.prototype.removeCache=function(e){var t;this._isCacheEnabled&&(e=l._toStorageKey(e),t=l._toStorageHashTtl(e),this._storage().removeItem(t),this._storage().removeItem(e))},l.prototype.invalidateCache=function(){var t=this;this._isCacheEnabled&&_.filter(_.keys(this._storage()),function(e){l._isServiceCacheKey(e)&&t._storage().removeItem(e)})},l.prototype._storage=function(){return window[this._storageName]},l.prototype._checkIsCacheEnabled=function(){try{var e=""+Math.random(),t=(this._storage().setItem(l._storageTestKey,e),this._storage().getItem(l._storageTestKey));return this._storage().removeItem(l._storageTestKey),t==e}catch(e){}return!1},l._toStorageKey=function(e){return e&&l._storageKeyPrefix+e},l._isServiceCacheKey=function(e){return e&&0==e.indexOf(l._storageKeyPrefix)},l._toStorageHashTtl=function(e){return e+";TTL"},l._storageKeyPrefix="TL;",l._storageTestKey="TL-Test",e.BrowserStorageCache=l}(tl=tl||{}),!function(t){i=t.BrowserStorageCache,__extends(n,i);var i,e=n;function n(e){return i.call(this,e,t.BrowserStorageCacheName.Local)||this}t.LocalStorageCache=e}(tl=tl||{}),!function(e){function t(){this._storage=[]}t.prototype.setCache=function(e,t,i){var n=this;return void 0===i&&(i=null),t?(this._storage[e]=t).catch(function(){n.removeCache(e)}):this.removeCache(e),!0},t.prototype.getCache=function(e){return this._storage.hasOwnProperty(e)?this._storage[e]:null},t.prototype.removeCache=function(e){delete this._storage[e]},t.prototype.invalidateCache=function(){this._storage=[]},e.MemoryStorageCache=t}(tl=tl||{}),!function(t){i=t.BrowserStorageCache,__extends(n,i);var i,e=n;function n(e){return i.call(this,e,t.BrowserStorageCacheName.Session)||this}t.SessionStorageCache=e}(tl=tl||{}),!function(e){function t(e){this.$q=e,this._storage=window.preloaderApiData}t.prototype.isCacheEnabled=function(){return _.isObject(this._storage)},t.prototype.getCache=function(e){return this.isCacheEnabled()?this.toAngularPromise(e):null},t.prototype.removeCache=function(e){this.isCacheEnabled()&&delete this._storage[e]},t.prototype.setCache=function(e,t,i){return!1},t.prototype.toAngularPromise=function(e){var t=this,e=this._storage[e];return e?e.then(function(e){return t.$q.when(e)}):null},t.prototype.invalidateCache=function(){var t=this;this.isCacheEnabled()&&_.forEach(Object.keys(this._storage),function(e){delete t._storage[e]})},e.PreloaderStorageCache=t}(tl=tl||{}),!function(n){function e(e,t,i){this._serviceTransport=e,this._serviceStorage=t,this._$q=i}e.prototype.ivisa=function(e,t){var i="";return e.contactInfo&&e.contactInfo.address()&&e.contactInfo.address().country&&(i=e.contactInfo.address().country.countryCode3),this._serviceTransport.ivisaAffiliate(e.id,i,t,n.Locale.getInstance().language().language(),n.Locale.getInstance().currency().id).then(function(e){return e&&e.visa_url?e.visa_url:""})},e.prototype.checkin=function(e,t){return this._serviceTransport.checkinAffiliate(e,t)},n.AffiliateService=e}(tl=tl||{}),!function(a){function s(e,t){this._serviceTransport=e,this._serviceStorage=t}s.prototype.getRoomTypeAvailabilityGroup=function(t,i){var n=this,e=s.prepareWeeklyCriterion(t);return this.getRoomTypeAvailabilityPromise(e).then(function(e){return a.DtoRoomTypeAvailabilityBuilder.buildRoomTypeAvailabilityGroup(e,t,i,n._serviceStorage)})},s.prototype.getRoomTypesAvailability=function(e,t,i){var n=this;return this.getRoomTypeAvailabilityPromise(e,t,i).then(function(e){return a.DtoRoomTypeAvailabilityBuilder.build(e,n._serviceStorage)})},s.getAvailabilityCalendarSettings=function(){var e=a.BookingFormSettings.getInstance(),t=e.stayStoreAvailabilityCalendarSettings,e=e.availabilityCalendarSettings;return t.isAvailable?t:e},s.prototype.getRoomTypeAvailabilityPromise=function(e,t,i){var n=a.BookingFormSettings.getInstance(),o=s.getAvailabilityCalendarSettings(),r=n.isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan),e=a.ApiRoomTypeAvailabilityBuilder.build(e,o.maxNights,i,r,n.bookingSource,t);return n.stayStoreAvailabilityCalendarSettings.isAvailable?this._serviceTransport.roomTypeAvailability2(e):this._serviceTransport.roomTypeAvailability(e)},s.prepareWeeklyCriterion=function(e){var t=e.clone();return t.startDate=e.startDate.moment().day(0).toDate(),t.endDate=e.startDate.moment().day(6).toDate(),t},a.AvailabilityCalendarService=s}(tl=tl||{}),!function(o){function e(e,t,i,n){var a=this;this.serviceFactory=t,this.serviceTransport=i,this.serviceStorage=n,e.invoke(["$q","locale","layout","tl.messages","errorHandler","translator",function(e,t,i,n,o,r){a.$q=e,a.locale=t,a.layout=i,a.messgaes=n,a.errorHandler=o,a.translator=r}]),this.bookingFormSettings=o.BookingFormSettings.getInstance()}e.prototype.bootstrap=function(e){return this.bookingReadyPromise=new o.BookingBootstrap(this.serviceFactory,this.$q,this.layout,this.messgaes,this.errorHandler).ready(e),this.bookingReadyPromise},e.prototype.initSearchCriteria=function(e){var t=this;return e.then(function(e){t.setSearchCriteria(e),o.SearchCriteriaInformer.getInstance().notify(o.SearchCriteriaInformerMessageType.CreateSearchCriteria,{searchCriteria:e})})},e.prototype.setBookingStrategy=function(e){this._bookingStrategy=e},e.prototype.getBookingStrategy=function(){return this._bookingStrategy},e.prototype.setSearchCriteria=function(e){this._criteria=e.clone(),this._bookingStrategy&&this._bookingStrategy.setSearchCriteria(e)},e.prototype.getSearchCriteria=function(){return this._criteria},e.prototype.invalidateCache=function(){this.serviceTransport.invalidateCache(),this.getBookingStrategy()&&this.getBookingStrategy().invalidateCache()},e.prototype.getBookingFormInfo=function(){return this.bookingFormInfoResponse(this.getSearchCriteria().providerId,o.Locale.getInstance().language()).then(function(e){return o.DtoBookingFormInfoBuilder.build(e)})},e.prototype.hotelInfoResponse=function(e){return this.serviceTransport.hotelInfo(this._getHotelInfoRequest(e))},e.prototype.bookingFormInfoResponse=function(e,t){e=this._getBookingFormInfoRequest(e,t);return this.serviceTransport.bookingFormInfo(e)},e.prototype.bookingFormSettingsResponse=function(e){e=o.ApiBookingFormSettingsBuilder.build(e);return this.serviceTransport.bookingFormSettings(e)},e.prototype.commonInfoResponse=function(e,t){return this.serviceTransport.commonInfo(this._getCommonInfoRequest(e,t))},e.prototype.hotelAvailabilityResponse=function(e,t){if(this._bookingStrategy)return this._bookingStrategy.hotelAvailabilityResponse(e,t);throw new Error("empty booking strategy")},e.prototype.hotelOfferAvailabilityResponse=function(e){if(this._bookingStrategy)return this._bookingStrategy.hotelOfferAvailabilityResponse(e);throw new Error("empty booking strategy")},e.prototype.convertCurrency=function(e){if(this._bookingStrategy)return this._bookingStrategy.convertCurrency(e);throw new Error("empty booking strategy")},e.prototype.translate=function(e){if(this._bookingStrategy)return this._bookingStrategy.translate(e);throw new Error("empty booking strategy")},e.prototype.setTranslationMode=function(e){this.translator.setTranslationMode(e)},e.prototype.emptyAvailabilityResponse=function(){return{room_stays:[],transfers:[]}},e.prototype.getRoomTypes=function(){return this.serviceStorage.rooms},e.prototype.getRoomType=function(e){return this.serviceStorage.getRoom(e)},e.prototype.getRatePlanCategories=function(){return this.serviceStorage.ratePlanCategories},e.prototype.getRatePlanCategory=function(e){return this.serviceStorage.getRatePlanCategory(e)},e.prototype.getRatePlans=function(){return this.serviceStorage.ratePlans},e.prototype.getRatePlan=function(e){return this.serviceStorage.getRatePlan(e)},e.prototype.getProvider=function(){return this.serviceStorage.getProvider()},e.prototype.getCountries=function(){return this.serviceStorage.countries},e.prototype._getBookingFormInfoRequest=function(e,t){return o.ApiBookingFormInfoBuilder.build(e,t)},e.prototype._getCommonInfoRequest=function(e,t){return o.ApiCommonInfoBuilder.build(e,t)},e.prototype._getHotelInfoRequest=function(e){return o.ApiHotelInfoBuilder.build(e.providerId,e.language,e.source,e.promoCode)},e.prototype.getHotelAvailabilityRequest=function(e,t,i){e=e.clone();return this.bookingFormSettings.defaultCurrency&&e.currency&&e.currency.id==this.bookingFormSettings.defaultCurrency.id&&(e.currency=null),o.ApiHotelAvailabilityBuilder.build(e,t,i)},e.prototype.getHotelOfferAvailabilityRequest=function(e){e=e.clone();return this.bookingFormSettings.defaultCurrency&&e.currency&&e.currency.id==this.bookingFormSettings.defaultCurrency.id&&(e.currency=null),o.ApiHotelOfferAvailabilityBuilder.build(e)},e.prototype._updateCancellationText=function(e){this._getOrder().cancellationText(e.room_stays[0].rate_plans[0].cancel_penalty_group.description)},e.prototype._initCaptchaChallenge=function(e){this._getOrder().captchaChallengePublicKey=null==(e=null==e?void 0:e.captcha_challenge)?void 0:e.public_key},e.prototype.getHotelAvailabilityInfo=function(e){if(this._bookingStrategy)return this._bookingStrategy.getHotelAvailabilityInfo(e);throw new Error("empty booking strategy")},e.prototype.getReservation=function(){if(this._reservation)return this._reservation;var e=this.serviceTransport.getLastReservation();return e?this.saveReservation(e):null},e.prototype.saveReservation=function(e){e=e.hotel_reservations[0],e=o.DtoHotelReservationBuilder.buildBooking(e,this.serviceStorage);return this._reservation=new o.Reservation,this._reservation.bookings.push(e),this._reservation},e.prototype.readUnfinishedBooking=function(e,t){var i=new o.BookingReference,e=(i.bookingNumber=e,i.unfinishedBookingSign=t,o.ApiReadReservationBuilder.build(i,this.locale.locale(),this.locale.currency().id));return this.serviceTransport.readHotelBooking(e).then(function(e){return e})},e.prototype.readHotelBooking=function(e){var t=new o.BookingReference,e=(t.bookingNumber=e,o.ApiReadReservationBuilder.build(t,this.locale.locale()));return this.serviceTransport.readHotelBooking(e).then(function(e){return e})},e.prototype.buildOrder=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var i=this._getOrder();return o.ApiHotelReservationBuilder.build(i,i.paymentSystem,e,t)},e.prototype.payOrder=function(e){return this.serviceTransport.payOrder(e)},e.prototype.saveReservationRequest=function(e){return this.serviceTransport.savePayOrderRequest(e=void 0===e?void 0:e)},e.prototype.getReservationRequest=function(){return this.serviceTransport.savePayOrderRequest()},e.prototype.saveOrder=function(){var e=o.ApiHotelReservationBuilder.buildIncompleteReservation(this._getOrder(),!0,!0);return this.serviceTransport.hotelReservation(e,!1)},e.prototype.verifyOrder=function(e){var t=o.ApiHotelReservationBuilder.buildIncompleteReservation(this._getOrder(),!0,!0);return this.serviceTransport.verifyReservation(t,e)},e.prototype.saveIncompleteOrder=function(e){var t=this,i=(void 0===e&&(e=null),o.ApiHotelReservationBuilder.buildIncompleteReservation(this._getOrder(),!1,!1));return this.serviceTransport.hotelReservationBeacon(i,e).then(function(e){return t._updateBookingNumber(_.head(e.hotel_reservations)),e})},e.prototype.cleanAndLockBookingNumber=function(){var t=this;this.chainHotelReservation(function(){var e=t._getOrder();e&&(e.number=null,e.cancellationCode=null)})},e.prototype.unlockBookingNumber=function(){var t=this;this.chainHotelReservation(function(){var e=t._getOrder();e&&null===e.number&&(e.number="",e.cancellationCode=null)})},e.prototype.initHotelReservation=function(t,i){var n=this;void 0===t&&(t=null),void 0===i&&(i=null),this.chainHotelReservation(function(){var e=n._getOrder();return e.paymentOptions=[],e.stay().arrivalExtraStay.options=[],e.stay().departureExtraStay.options=[],n.verifyOrder(!0).then(function(e){n._initCaptchaChallenge(e);e=e.hotel_reservations[0];n._updateBookingNumber(e),n._initPaymentSystems(e),n._initExtraStay(e),n._updatePrepayment(e),n._updateCancellationText(e),i&&i(e)}).catch(function(e){t&&t(e)})})},e.prototype.updatePrepayment=function(t){var i=this;void 0===t&&(t=null),this.chainHotelReservation(function(){var e=i._getOrder();return e.paymentOptions=[],e.guestStays&&e.guestStays.length?(e=o.ApiHotelReservationBuilder.buildIncompleteReservation(e,!1,!0),i.serviceTransport.verifyReservation(e,!0).then(function(e){i._initCaptchaChallenge(e);e=e.hotel_reservations[0];i._updateBookingNumber(e),i._initPaymentSystems(e),i._updatePrepayment(e),i._updateCancellationText(e)}).catch(function(e){t&&t(e)})):i.$q.when()})},e.prototype.sendFeedback=function(e,t,i){e=o.ApiCustomerFeedbackBuilder.build(e,t,i);return this.serviceTransport.userFeedback(e)},e.prototype.chainHotelReservation=function(e){return this._hotelReservationPromise=(this._hotelReservationPromise||this.$q.when("")).then(function(){return e()}).catch(function(){return null})},e.prototype._updateBookingNumber=function(e){var t=this._getOrder();null!==t.number&&(t.number=e.number,t.cancellationCode=e.cancellation_code)},e.prototype._initExtraStay=function(e){o.DtoHotelReservationBuilder.buildExtraStay(e,this._getOrder(),this.serviceStorage)},e.prototype._initPaymentSystems=function(e){o.DtoHotelReservationBuilder.buildPaymentSystems(e,this.serviceStorage.paymentSystems)},e.prototype._updatePrepayment=function(e){var t=this._getOrder(),i=o.UnitConverter.toDate(e.room_stays[0].stay_dates.start_date),n=o.UnitConverter.toDate(e.room_stays[0].stay_dates.end_date),t=_.head(t.guestStays);!t||t.arrival().time().isEqualTime(i)&&t.departure().time().isEqualTime(n)?o.DtoHotelReservationBuilder.buildPrepayment(this._getOrder(),e,this.serviceStorage.paymentSystems,this.serviceTransport,this.$q):this.updatePrepayment()},e.prototype._getOrder=function(){return this.serviceFactory.orderService.getOrder()},e.prototype.isBookingOptionsAvailable=function(){return _.some(this.serviceStorage.getStayOptions(),function(e){return e.bookingOptions.length})},e.prototype.isTransfersAvailable=function(){return _.some(this.serviceStorage.getStayOptions(),function(e){return e.transfers.length})},e.prototype.auth=function(e){return null},e.prototype.destruct=function(){this.serviceStorage.clean(),o.CartPanelManager.getInstance().setOrder(null)},o.BookingService=e}(tl=tl||{}),!function(a){function e(e,t,i,n){this.$q=e,this.bookingService=t,this.serviceTransport=i,this.serviceStorage=n,this.bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.setRoomStayFilterCriteria=function(e){this._roomStayFilterCriteria=e},e.prototype.getRoomStayFilterCriteria=function(){return this._roomStayFilterCriteria||(this._roomStayFilterCriteria=this._initRoomStayFilterCriteria()),this._roomStayFilterCriteria},e.prototype.setSearchCriteria=function(e){this._roomStays=null},e.prototype.getRoomStays=function(){return this._roomStays||(this._roomStays=this._getStayOptions().then(function(e){return _.map(e,function(e){return e.roomStay})})),this._roomStays},e.prototype.setAccommodationMode=function(e){this.bookingFormSettings.accommodationMode=e,this._roomStays=null},e.prototype.resetAccommodationMode=function(){this.setAccommodationMode(this.bookingFormSettings.originalAccommodationMode)},e.prototype.hotelAvailabilityResponse=function(e,t){var i=this;return this.serviceTransport.hotelAvailability(this.bookingService.getHotelAvailabilityRequest(e,t)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?i.bookingService.emptyAvailabilityResponse():i.$q.reject(e)})},e.prototype.hotelOfferAvailabilityResponse=function(e){var t=this;return this.bookingFormSettings.isManualAccommodationMode()&&this.bookingFormSettings.childrenAgeGroups.length?this.serviceTransport.hotelOfferAvailability(this.bookingService.getHotelOfferAvailabilityRequest(e)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?t.bookingService.emptyAvailabilityResponse():t.$q.reject(e)}):this.$q.when(this.bookingService.emptyAvailabilityResponse())},e.prototype.guestStaysOfferAvailabilityResponses=function(e,i){var n=this,o=a.QueueManager.getInstance(a.QueueType.GuestStaysOfferAvailability);return this.$q.all(_.map(e,function(e){var t=i.clone();return t.placements=[new a.SearchCriteriaPlacement(e.placement.adults,_.map(_.flatten([e.placement.children,e.placement.childrenExtraBed,e.placement.childrenWithoutBed]),function(e){return new a.SearchCriteriaChildPlacement(e.age)}))],o.push(n.$q,t,function(e){return n.hotelAvailabilityResponse(e,!1)},4)}))},e.prototype.hotelReservationsResponse=function(e){var t=this;return this.bookingService.chainHotelReservation(function(){if(e&&e.guestStays.length)return e.number?t.bookingService.saveOrder():t.bookingService.verifyOrder(!1)})},e.prototype.convertCurrency=function(e){var o=this,r=this.bookingService._getOrder(),t=this.bookingService.getSearchCriteria(),a=[],e=(t.currency=e,this.bookingService.setSearchCriteria(t),r&&(r.currency(e),a=_.filter(r.guestStays,function(e){return e.roomStay.isRoomStayOffer})),this.hotelAvailabilityResponse(t)),i=this.hotelOfferAvailabilityResponse(t),t=this.guestStaysOfferAvailabilityResponses(a,t),n=this.hotelReservationsResponse(r);return this.$q.all([e,i,t,n]).then(function(e){var t=e[0],i=e[1],n=e[2],e=e[3];o._convertCurrencyHotelReservation(r,e),o._convertCurrencyHotelAvailability(t,i),o._convertCurrencyGuestStaysOfferAvailability(a,n)})},e.prototype.translate=function(e){var t,i=this,n=this.bookingService.getSearchCriteria(),o=(n.language=e,this.bookingService.setSearchCriteria(n),this.bookingService._getOrder()),r=(o&&(o.language=e),this.bookingFormSettings.providerId),e=this.serviceTransport.commonInfo(this.bookingService._getCommonInfoRequest(r,e)).then(function(e){i._translateCommonInfo(e)}),n=this.bookingService.hotelInfoResponse(n).then(function(e){return _.find(e.hotels,{code:r})});return o&&o.number&&o.guestStays.length&&(t=a.ApiHotelReservationBuilder.buildIncompleteReservation(o,!0,!0),t=this.serviceTransport.hotelReservation(t,!0).then(function(e){e=e.hotel_reservations[0];a.DtoHotelReservationBuilder.translate(e,o,i.serviceStorage),i.bookingService._updateCancellationText(e),i.bookingService._updatePrepayment(e)})),this.$q.all([n,e,t]).then(function(e){return a.DtoHotelInfoBuilder.translate(e[0],i.serviceStorage),a.DtoProviderBuilder.translate(e[0],i.serviceStorage),i._getStayOptions(!0)})},e.prototype.getHotelAvailabilityInfo=function(e){var t=this;return this.hotelAvailabilityResponse(e).then(function(e){return a.DtoBaseHotelAvailabilityBuilder.buildHotelAvailabilityInfo(e.availability_result,t.serviceStorage)})},e.prototype.invalidateCache=function(){},e.prototype.invalidatePrices=function(){var t=this;return this._roomStays=null,this._roomStays=this.getRoomStays(),this._roomStays.then(function(){var e=t.bookingService._getOrder();_.forEach(e.guestStays,function(e){return e.invalidatePrice()}),_.forEach(e.transfers,function(e){return e.invalidateTotalPrice()}),_.forEach(e.options,function(e){return e.invalidateTotalPrice()})})},e.prototype._getStayOptions=function(t){var i=this,e=(void 0===t&&(t=!1),this.bookingService.getSearchCriteria()),n=this.bookingService.hotelInfoResponse(e),o=this.hotelAvailabilityResponse(e),e=this.hotelOfferAvailabilityResponse(e),r=this.$q.defer();return this.$q.all([o,e,n]).then(function(e){t?i._translateHotelAvailability(e[0],e[1]):(a.DtoHotelInfoBuilder.build(e[2],i.serviceStorage,i.bookingFormSettings),a.DtoHotelInfoBuilder.buildPromotions(e[2],i.bookingFormSettings),i._initHotelAvailability(e[0],e[1])),r.resolve(i.serviceStorage.getStayOptions())}).catch(function(){i._roomStays=null}),r.promise},e.prototype._translateCommonInfo=function(e){a.DtoCommonInfoBuilder.translate(e,this.serviceStorage)},e.prototype._initHotelAvailability=function(e,t){(new a.DtoHotelAvailabilityBuilder).build(e,this.serviceStorage,this.serviceTransport,this.$q),(new a.DtoHotelOfferAvailabilityBuilder).build(t,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._translateHotelAvailability=function(e,t){(new a.DtoHotelAvailabilityBuilder).translate(e,this.serviceStorage,this.serviceTransport,this.$q),(new a.DtoHotelOfferAvailabilityBuilder).translate(t,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._convertCurrencyHotelReservation=function(e,t){t=t&&_.head(t.hotel_reservations);t&&(a.DtoHotelReservationBuilder.convertCurrency(t,e,this.serviceStorage),this.bookingService._updatePrepayment(t))},e.prototype._convertCurrencyHotelAvailability=function(e,t){(new a.DtoHotelAvailabilityBuilder).convertCurrency(e,this.serviceStorage),(new a.DtoHotelOfferAvailabilityBuilder).convertCurrency(t,this.serviceStorage)},e.prototype._convertCurrencyGuestStaysOfferAvailability=function(e,n){var o=this;_.forEach(e,function(t,e){var i=n[e],e=_.find(_.map(i.room_stays,function(e){return a.DtoBaseHotelAvailabilityBuilder.buildRoomStay(e,i.room_type_quotas,i.services,o.serviceStorage,new a.DtoHotelAvailabilityPlacementBuilder,new a.DtoHotelAvailabilityRoomStayFilter,o.bookingFormSettings,o.serviceTransport,o.$q)}),function(e){return e.id==t.validatedRoomStayId});e&&t.addGuestPlacements(e)})},e.prototype._initRoomStayFilterCriteria=function(){var e=new a.RoomStayFilterCriteria;return e.isEnabled=this.bookingFormSettings.isModeTurnedOn(a.BookingFormMode.RoomsFilterView)||this.bookingFormSettings.isModeTurnedOn(a.BookingFormMode.RoomsSearchCriteriaView),e},a.CommonBookingStrategy=e}(tl=tl||{}),!function(a){function e(e,t,i,n){this.$q=e,this.bookingService=t,this.serviceTransport=i,this.serviceStorage=n,this.bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.setSearchCriteria=function(e){this._roomStayGroups=null,this._roomStays=null},e.prototype.getRoomStays=function(){return this._roomStays||(this._roomStays=this._getStayInfoOptions().then(function(e){return _.map(e,function(e){return e.roomStay})})),this._roomStays},e.prototype.getRoomStayGroups=function(){return this._roomStayGroups||(this._roomStayGroups=this._getStayGroupOptions().then(function(e){return _.map(_.values(_.groupBy(e,function(e){return e.groupRef})),function(e){return _.map(e,function(e){return e.roomStay})})})),this._roomStayGroups},e.prototype.hotelAvailabilityResponse=function(e,t){var i=this;return e.guestRatePlans.length?this.serviceTransport.hotelAvailability2(this.bookingService.getHotelAvailabilityRequest(e,t)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?i.bookingService.emptyAvailabilityResponse():i.$q.reject(e)}):this.$q.when(this.bookingService.emptyAvailabilityResponse())},e.prototype.hotelOfferAvailabilityResponse=function(e){var t=this;return this.serviceTransport.hotelOfferAvailability(this.bookingService.getHotelOfferAvailabilityRequest(e)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?t.bookingService.emptyAvailabilityResponse():t.$q.reject(e)})},e.prototype.convertCurrency=function(e){var n=this,t=this.bookingService.getSearchCriteria(),i=(t.currency=e,this.bookingService.setSearchCriteria(t),this.hotelAvailabilityResponse(t)),t=this.hotelOfferAvailabilityResponse(t),o=this.bookingService._getOrder(),e=(o&&o.currency(e),this.bookingService.chainHotelReservation(function(){if(o&&o.guestStays.length)return n.bookingService.verifyOrder(!1)}));return this.$q.all([i,e,t]).then(function(e){var t=e[0],i=e[1],e=e[2];i&&(i=_.head(i.hotel_reservations))&&(a.DtoHotelReservationBuilder.convertCurrency(i,o,n.serviceStorage),n.bookingService._updatePrepayment(i)),n._convertCurrencyHotelAvailability(t),n._convertCurrencyHotelOfferAvailability(e)})},e.prototype.translate=function(e){var t,i=this,n=this.bookingService.getSearchCriteria(),o=(n.language=e,this.bookingService.setSearchCriteria(n),this.bookingService._getOrder()),r=(o&&(o.language=e),this.bookingFormSettings.providerId),e=this.serviceTransport.commonInfo(this.bookingService._getCommonInfoRequest(r,e)).then(function(e){i._translateCommonInfo(e)}),n=this.bookingService.hotelInfoResponse(n).then(function(e){return _.find(e.hotels,{code:r})});return o&&o.number&&o.guestStays.length&&(t=a.ApiHotelReservationBuilder.buildIncompleteReservation(o,!0,!0),t=this.serviceTransport.hotelReservation(t,!0).then(function(e){e=e.hotel_reservations[0];a.DtoHotelReservationBuilder.translate(e,o,i.serviceStorage),i.bookingService._updateCancellationText(e),i.bookingService._updatePrepayment(e)})),this.$q.all([n,e,t]).then(function(e){return a.DtoHotelInfoBuilder.translate(e[0],i.serviceStorage),a.DtoProviderBuilder.translate(e[0],i.serviceStorage),i._getStayInfoOptions(!0).then(function(){return i._getStayGroupOptions(!0)})})},e.prototype.getHotelAvailabilityInfo=function(e){var t=this;return this.hotelOfferAvailabilityResponse(e).then(function(e){return a.DtoBaseHotelAvailabilityBuilder.buildHotelAvailabilityInfo(e.availability_result,t.serviceStorage)})},e.prototype.invalidateCache=function(){},e.prototype.invalidatePrices=function(){var t=this;return this._roomStayGroups=this._roomStays=null,this._roomStayGroups=this.getRoomStayGroups(),this._roomStays=null,this._roomStays=this.getRoomStays(),this.$q.all([this._roomStayGroups,this._roomStays]).then(function(){var e=t.bookingService._getOrder();_.forEach(e.guestStays,function(e){return e.invalidatePrice()}),_.forEach(e.transfers,function(e){return e.invalidateTotalPrice()}),_.forEach(e.options,function(e){return e.invalidateTotalPrice()})})},e.prototype._translateCommonInfo=function(e){a.DtoCommonInfoBuilder.translate(e,this.serviceStorage)},e.prototype._getStayInfoOptions=function(t){var i=this,e=(void 0===t&&(t=!1),this.bookingService.getSearchCriteria()),n=this.bookingService.hotelInfoResponse(e),e=this.hotelOfferAvailabilityResponse(e),o=this.$q.defer();return this.$q.all([e,n]).then(function(e){t?i._translateHotelOfferAvailability(e[0]):(a.DtoHotelInfoBuilder.build(e[1],i.serviceStorage,i.bookingFormSettings),a.DtoHotelInfoBuilder.buildPromotions(e[1],i.bookingFormSettings),i._initHotelOfferAvailability(e[0])),o.resolve(i.serviceStorage.stayOfferOptions)}).catch(function(){i._roomStays=null}),o.promise},e.prototype._getStayGroupOptions=function(t){var i=this,e=(void 0===t&&(t=!1),this.bookingService.getSearchCriteria()),n=this.bookingService.hotelInfoResponse(e),e=this.hotelAvailabilityResponse(e),o=this.$q.defer();return this.$q.all([e,n]).then(function(e){t?i._translateHotelAvailability(e[0]):(a.DtoHotelInfoBuilder.build(e[1],i.serviceStorage,i.bookingFormSettings),i._initHotelAvailability(e[0])),o.resolve(i.serviceStorage.stayOptions)}).catch(function(){i._roomStayGroups=null}),o.promise},e.prototype._initHotelAvailability=function(e){(new a.DtoHotelAvailability2Builder).build(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._initHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).build(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._translateHotelAvailability=function(e){(new a.DtoHotelAvailability2Builder).translate(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._translateHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).translate(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._convertCurrencyHotelAvailability=function(e){(new a.DtoHotelAvailability2Builder).convertCurrency(e,this.serviceStorage)},e.prototype._convertCurrencyHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).convertCurrency(e,this.serviceStorage)},a.SharedRatePlanBookingStrategy=e}(tl=tl||{}),!function(a){function e(e,t,i,n){this._sharedRooms=[],this.$q=e,this.bookingService=t,this.serviceTransport=i,this.serviceStorage=n,this.bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.cleanStayOptions=function(){this.serviceStorage.setStayOptions([])},e.prototype.setSharedRooms=function(e){this._sharedRooms=e},e.prototype.getSharedRooms=function(){return this._sharedRooms},e.prototype.setSearchCriteria=function(e){this._roomStays=null},e.prototype.getRoomStays=function(){return this._roomStays||(this._roomStays=this._getStayInfoOptions().then(function(e){return _.map(e,function(e){return e.roomStay})})),this._roomStays},e.prototype.validateSharedRoomStay=function(t){var i=this,e=new a.SearchCriteriaSharedRoomStaysBuilder(this.bookingService.getSearchCriteria());return this.serviceTransport.hotelAvailability2(this.bookingService.getHotelAvailabilityRequest(e.build([t]),!1,!0)).then(function(e){e=i._initHotelAvailability(e,!0),e=_.find(e,function(e){return e.roomStay.roomType.id===t.roomTypeId});return void 0===e?null:e.roomStay})},e.prototype.hotelAvailabilityResponse=function(e,t){var i=this,e=new a.SearchCriteriaSharedRoomStaysBuilder(e),n=[];return _.forEach(this._sharedRooms,function(e){_.forEach(e.roomStays,function(e){e.roomStay&&n.push(e)})}),n.length?this.serviceTransport.hotelAvailability2(this.bookingService.getHotelAvailabilityRequest(e.build(n),t,!0)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?i.bookingService.emptyAvailabilityResponse():i.$q.reject(e)}):this.$q.when(this.bookingService.emptyAvailabilityResponse())},e.prototype.hotelOfferAvailabilityResponse=function(e){var t=this;return this.serviceTransport.hotelOfferAvailability(this.bookingService.getHotelOfferAvailabilityRequest(e)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?t.bookingService.emptyAvailabilityResponse():t.$q.reject(e)})},e.prototype.convertCurrency=function(e){var n=this,t=this.bookingService.getSearchCriteria(),i=(t.currency=e,this.bookingService.setSearchCriteria(t),this.hotelAvailabilityResponse(t)),t=this.hotelOfferAvailabilityResponse(t),o=this.bookingService._getOrder(),e=(o&&o.currency(e),this.bookingService.chainHotelReservation(function(){if(o&&o.guestStays.length)return n.bookingService.verifyOrder(!1)}));return this.$q.all([i,e,t]).then(function(e){var t=e[0],i=e[1],e=e[2];i&&(i=_.head(i.hotel_reservations))&&(a.DtoHotelReservationBuilder.convertCurrency(i,o,n.serviceStorage),n.bookingService._updatePrepayment(i)),n._convertCurrencyHotelAvailability(t),n._convertCurrencyHotelOfferAvailability(e)})},e.prototype.translate=function(e){var t,i=this,n=this.bookingService.getSearchCriteria(),o=(n.language=e,this.bookingService.setSearchCriteria(n),this.bookingService._getOrder()),r=(o&&(o.language=e),this.bookingFormSettings.providerId),e=this.serviceTransport.commonInfo(this.bookingService._getCommonInfoRequest(r,e)).then(function(e){i._translateCommonInfo(e)}),n=this.bookingService.hotelInfoResponse(n).then(function(e){return _.find(e.hotels,{code:r})});return o&&o.number&&o.guestStays.length&&(t=a.ApiHotelReservationBuilder.buildIncompleteReservation(o,!0,!0),t=this.serviceTransport.hotelReservation(t,!0).then(function(e){e=e.hotel_reservations[0];a.DtoHotelReservationBuilder.translate(e,o,i.serviceStorage),i.bookingService._updateCancellationText(e),i.bookingService._updatePrepayment(e)})),this.$q.all([n,e,t]).then(function(e){return a.DtoHotelInfoBuilder.translate(e[0],i.serviceStorage),a.DtoProviderBuilder.translate(e[0],i.serviceStorage),i._getStayInfoOptions(!0).then(function(){return i._getStayOptions(!0)})})},e.prototype.getHotelAvailabilityInfo=function(e){var t=this;return this.hotelOfferAvailabilityResponse(e).then(function(e){return a.DtoBaseHotelAvailabilityBuilder.buildHotelAvailabilityInfo(e.availability_result,t.serviceStorage)})},e.prototype.invalidateCache=function(){this._roomStays=null},e.prototype.invalidatePrices=function(){var t=this,e=(this._roomStays=null,this._roomStays=this.getRoomStays(),_.chain(this._sharedRooms).map(function(e){return e.roomStays}).flatten().filter(function(e){return!!e.roomStay}).value()),i=new a.SearchCriteriaSharedRoomStaysBuilder(this.bookingService.getSearchCriteria());return this.$q.all([this._roomStays,this.serviceTransport.hotelAvailability2(this.bookingService.getHotelAvailabilityRequest(i.build(e),!1,!0)).then(function(e){return t._initHotelAvailability(e,!1)})]).then(function(){var e=t.bookingService._getOrder();_.forEach(e.guestStays,function(e){return e.invalidatePrice()}),_.forEach(e.transfers,function(e){return e.invalidateTotalPrice()}),_.forEach(e.options,function(e){return e.invalidateTotalPrice()})})},e.prototype._getStayInfoOptions=function(t){var i=this,e=(void 0===t&&(t=!1),this.bookingService.getSearchCriteria()),n=this.bookingService.hotelInfoResponse(e),e=this.hotelOfferAvailabilityResponse(e),o=this.$q.defer();return this.$q.all([e,n]).then(function(e){t?i._translateHotelOfferAvailability(e[0]):(a.DtoHotelInfoBuilder.build(e[1],i.serviceStorage,i.bookingFormSettings),a.DtoHotelInfoBuilder.buildPromotions(e[1],i.bookingFormSettings),i._initHotelOfferAvailability(e[0])),o.resolve(i.serviceStorage.stayOfferOptions)}).catch(function(){i._roomStays=null}),o.promise},e.prototype._getStayOptions=function(t){var i=this,e=(void 0===t&&(t=!1),this.bookingService.getSearchCriteria()),n=this.bookingService.hotelInfoResponse(e),e=this.hotelAvailabilityResponse(e),o=this.$q.defer();return this.$q.all([e,n]).then(function(e){t?i._translateHotelAvailability(e[0]):(a.DtoHotelInfoBuilder.build(e[1],i.serviceStorage,i.bookingFormSettings),a.DtoHotelInfoBuilder.buildPromotions(e[1],i.bookingFormSettings),i._initHotelAvailability(e[0],!0)),o.resolve(i.serviceStorage.stayOptions)}).catch(function(){}),o.promise},e.prototype._translateCommonInfo=function(e){a.DtoCommonInfoBuilder.translate(e,this.serviceStorage)},e.prototype._initHotelAvailability=function(e,t){return(new a.DtoHotelAvailability2Builder).build(e,this.serviceStorage,this.serviceTransport,this.$q,t)},e.prototype._initHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).build(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._translateHotelAvailability=function(e){(new a.DtoHotelAvailability2Builder).translate(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._translateHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).translate(e,this.serviceStorage,this.serviceTransport,this.$q)},e.prototype._convertCurrencyHotelAvailability=function(e){(new a.DtoHotelAvailability2Builder).convertCurrency(e,this.serviceStorage)},e.prototype._convertCurrencyHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).convertCurrency(e,this.serviceStorage)},a.SharedRoomBookingStrategy=e}(tl=tl||{}),!function(a){function e(e,t,i){var n=this;this.serviceFactory=t,this.serviceTransport=i,this._hotelBookingRulesCache={},this._ratePlansChunkCache={},this._ratePlanRequestCache={},this._ratePlanBookingRuleCache={},e.invoke(["$q",function(e){n.$q=e}])}e.prototype._getHotelBookingRulesRequest=function(e,t){var i=a.BookingFormSettings.getInstance().isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan);return a.ApiHotelBookingRulesBuilder.build(t.providerId,e,i,t.source)},e.prototype._getRatePlanBookingRulesRequest=function(e,t,i){return a.ApiRatePlanBookingRulesBuilder.build(i.providerId,t,e,i.source,i.promoCode)},e.prototype._getNearestAvailableDatesRequest=function(e,t,i,n){var o=a.BookingFormSettings.getInstance().isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan);return a.ApiNearestAvailableDatesBuilder.build(e,t,o,i,n)},e.prototype.hotelBookingRulesResponse=function(e,t){return this.serviceTransport.hotelBookingRules(this._getHotelBookingRulesRequest(e,t))},e.prototype.getHotelBookingRule=function(t){var e=a.UnitConverter.dateToString(t);return this._hotelBookingRulesCache[e]||(this._hotelBookingRulesCache[e]=this.serviceTransport.hotelBookingRules(this._getHotelBookingRulesRequest(t,this.serviceFactory.bookingService.getSearchCriteria())).then(function(e){return a.DtoHotelBookingRulesBuilder.buildRules(e)})),this._hotelBookingRulesCache[e].then(function(e){return a.DtoHotelBookingRulesBuilder.findRule(e,t)})},e.prototype.getRatePlanBookingRule=function(t,i,n,e){var o=[a.UnitConverter.dateToString(t),i.id,n&&n.id,e].join(",");if(this._ratePlanBookingRuleCache[o])return this._ratePlanBookingRuleCache[o];var r=i.id,r=(this._ratePlansChunkCache[r]||(this._ratePlansChunkCache[r]=_.find(_.chunk(_.map(this.serviceFactory.bookingService.getRatePlans(),function(e){return e.id}),50),function(e){return _.some(e,function(e){return e==i.id})})),this._ratePlansChunkCache[r]),e=__spreadArrays([a.UnitConverter.dateToString(t)],r,[e]).join(",");return this._ratePlanRequestCache[e]||(this._ratePlanRequestCache[e]=this.serviceTransport.ratePlanBookingRules(this._getRatePlanBookingRulesRequest(t,r,this.serviceFactory.bookingService.getSearchCriteria())).then(function(e){return a.DtoRatePlanBookingRulesBuilder.buildRulesByDate(e,t)})),this._ratePlanBookingRuleCache[o]=this._ratePlanRequestCache[e].then(function(e){return a.DtoRatePlanBookingRulesBuilder.findRule(e,t,i.id,n&&n.id)}),this._ratePlanBookingRuleCache[o]},e.prototype.getHotelBookingRuleByDateRange=function(e,t){var i=this.$q.defer(),n=e.checkOutDate;return t==a.StayUnitKind.Night&&(n=n.addDays(-1)),this._resolveHotelBookingRule(e.checkInDate,n,i),i.promise},e.prototype.getRatePlanBookingRuleByDateRange=function(e,t,i,n){var o=this.$q.defer(),r=e.checkOutDate;return t==a.StayUnitKind.Night&&(r=r.addDays(-1)),this._resolveRatePlanBookingRule(e.checkInDate,r,i,n,e.promoCode,o),o.promise},e.prototype.getHotelBookingRuleByDate=function(e){var t=this.$q.defer();return this._resolveHotelBookingRule(e,e,t),t.promise},e.prototype.getRatePlanBookingRuleByDate=function(e,t,i,n){var o=this.$q.defer();return this._resolveRatePlanBookingRule(e,e,t,i,n,o),o.promise},e.prototype._resolveHotelBookingRule=function(e,t,i){var n=this;this._resolveBookingRule(e,t,e,i,function(e){return n.getHotelBookingRule(e)})},e.prototype._resolveRatePlanBookingRule=function(e,t,i,n,o,r){var a=this;this._resolveBookingRule(e,t,e,r,function(e){return a.getRatePlanBookingRule(e,i,n,o)})},e.prototype._resolveBookingRule=function(s,l,c,u,d,p){var m=this;p=p||{minLos:null,minAdvBooking:null,maxLos:null,maxAdvBooking:null,forbidden:null},c.diffInDays(l)<=0||c.diffInDays(s)<p.minLos?d(c).then(function(e){var t=e.minLos,i=e.minAdvBooking,n=e.maxLos,o=e.maxAdvBooking,r=e.forbidden,a=e.roomTypes;s.isEqualDate(c)&&(t=Math.max(e.minLos,e.minLosArrival),n=Math.min(e.maxLos,e.maxLosArrival),r=r||e.closeArrival),p.minLos=Math.max(p.minLos,t),p.minAdvBooking=Math.max(p.minAdvBooking,i),p.maxLos=Math.min(p.maxLos||Number.MAX_VALUE,n||Number.MAX_VALUE),p.maxAdvBooking=Math.min(p.maxAdvBooking||Number.MAX_VALUE,o||Number.MAX_VALUE),p.forbidden=p.forbidden||r,p.roomTypes=p.roomTypes?_.intersection(a,p.roomTypes):a,m._resolveBookingRule(s,l,c.addDays(1),u,d,p)}).catch(function(){u.reject()}):u.resolve(p)},e.prototype.getNearestAvailableDates=function(e,t,i,n){return this.serviceTransport.nearestAvailableDates(this._getNearestAvailableDatesRequest(e,t,i,n)).then(function(e){return a.DtoNearestAvailableDatesBuilder.build(e)})},a.BookingRuleService=e}(tl=tl||{}),!function(u){function e(e){var t=this;this._selectedRooms=[],this._selectedRoomPreferences=[],this.serviceStorage=e,this.filterStorage=new u.directive.helper.UiFilterStorage,this.roomStayAccommodationFilter=new u.directive.helper.UiAccommodationFilterStorage,this._orderInformer=u.OrderInformer.getInstance(),AppIntegration.subscribeEvent(u.AppIntegrationEvent.PushArtifact,function(e){t._order&&e&&t._order.pushArtifact(e.key,e.value)})}e.prototype.createOrderFromHotelBooking=function(e,t,i){return this._order=new u.OrderImpl(e.provider,t,i,this.serviceStorage),this.populateFromHotelBooking(e),this._orderInformer.notify(u.OrderInformerMessageType.CreateOrder),this._order},e.prototype.createOrderFromSearchCriteria=function(e,t){return this._order=new u.OrderImpl(t,e.language,e.currency,this.serviceStorage),this._order.promoCode=e.promoCode,this._orderInformer.notify(u.OrderInformerMessageType.CreateOrder),this._order},e.prototype.addRoomStays=function(t,e,i,n){var o=this,r=(void 0===e&&(e=1),this._order.number="",[]),a=this.serviceStorage.getStayOptions(),s=_.find(a,function(e){return e.roomStay.id==t.id});null!=s&&0==this._order.guestStays.length&&(_.forEach(s.bookingOptions,function(e){o._order.options.push(new u.EnumerableBookingOption(s.roomStay,e,o.serviceStorage))}),_.forEach(s.transfers,function(e){e.vehicleOff(),o._order.transfers.push(e)}));for(var l=0;l<e;l++){var c=this._order.addRoomStay(t,i,n);_.forEach(this._selectedRoomPreferences,function(e){e.roomTypeId==c.roomStay.roomType.id&&e.placementRef==i&&c.addRoomPreference(e.preferenceCategoryCode,e.preferenceCode)}),r.push(c)}return this._orderInformer.notify(u.OrderInformerMessageType.AddGuestStays,{guestStays:r}),r},e.prototype.getGuestStayIndex=function(t,i){return _.findIndex(this._order.guestStays,function(e){return e.roomStay.id==t&&e.placementRef==i})},e.prototype.removeGuestStay=function(e,t){var i=this._order.guestStays,e=this.getGuestStayIndex(e.id,t);return-1!=e&&(i.splice(e,1),this._orderInformer.notify(u.OrderInformerMessageType.RemoveGuestStays,{guestStays:i})),i},e.prototype.hasGuestStay=function(e,t){return-1!=this.getGuestStayIndex(e.id,t)},e.prototype.resolvePlacements=function(e){_.some(this._selectedRooms,function(t){return _.some(e,function(e){return t.placementRef==e.ref})})||(this._selectedRooms=[])},e.prototype.addRoom=function(e,t,i){e=new u.EnumerableRoom(e,t,i);this._selectedRooms[i]?this._selectedRooms[i]=e:this._selectedRooms.push(e)},e.prototype.getSelectedRoom=function(t){return _.find(this._selectedRooms,function(e){return e.placementRef==t})},e.prototype.getSelectedRooms=function(){return this._selectedRooms},e.prototype.hasSelectedRoom=function(e){return!!this.getSelectedRoom(e)},e.prototype.removeGuestStays=function(e){this.removeFromOrder(e)},e.prototype.cleanOrder=function(){this._order&&this.removeFromOrder(_.map(this._order.guestStays,function(e){return e}))},e.prototype.removeFromOrder=function(e){var t=this;this._order.number="",_.forEach(e,function(e){t._order.removeGuestStay(e)}),this._order.guestStays.length||(this._order.transfers=[],this._order.options=[]),this._orderInformer.notify(u.OrderInformerMessageType.RemoveGuestStays,{guestStays:e})},e.prototype.getOrder=function(){return this._order},e.prototype.setOrder=function(e){this._order=e},e.prototype.populateFromHotelBooking=function(e){this.cleanOrder(),this._order=u.HotelBookingOrderBuilder.build(e,this._order,this.serviceStorage)},e.prototype.roomUpgrade=function(e){var t=_.head(this._order.guestStays),i=(this._order=u.ModificationOrderBuilder.build(this._order,t,e),_.find(this._selectedRooms,function(e){return e.roomType==t.roomStay.roomType}));i&&(i.roomType=e.roomType)},e.prototype.findRoomUpgradeOffer=function(){if(!u.BookingFormSettings.getInstance().motivators.isRoomUpgradeEnabled)return null;var e=u.util.OrderUtil.findRoomUpgradeOffer(this._order,this.serviceStorage.stayOptions);return e?e.roomStay:null},e.prototype.getRoomPreferences=function(t,e){var i=_.filter(this.getOrder().guestStays,function(e){return e.roomStay.roomType.id==t.id});return i.length?u.PreferenceBuilder.buildWithGuestStays(t,i,this.serviceStorage,e):u.PreferenceBuilder.buildWithSelectedPreferences(t,this._selectedRoomPreferences,this.serviceStorage,e)},e.prototype.removeRoomPreference=function(e,t,i){u.util.PreferenceUtil.removePreference(this._selectedRoomPreferences,this.getOrder().guestStays,e,t,i)},e.prototype.addRoomPreference=function(e,t,i,n){this.removeRoomPreference(e,t,n),u.util.PreferenceUtil.addPreference(this._selectedRoomPreferences,this.getOrder().guestStays,e,t,i,n)},e.prototype.changeRoomPreference=function(e,t,i,n){(i=void 0===i?null:i)?this.addRoomPreference(e,t,i,n):this.removeRoomPreference(e,t,n)},e.prototype.extendOrderOptions=function(){u.OptionUtil.extendOrderOptions(this._order,this.serviceStorage)},e.prototype.setAuthData=function(e){this._order.number=e.number,this._order.cancellationCode=e.cancellationCode,this._order.paymentCode=e.paymentCode},u.OrderService=e}(tl=tl||{}),!function(e){function t(e){this._resolvePromise=null,this._serviceTransport=e}t.prototype.decodePromoCodeResponse=function(e){return this._resolvePromise||(this._resolvePromise=this._serviceTransport.resolvePromoCode(e)),this._resolvePromise},e.PromoCodeService=t}(tl=tl||{}),!function(i){function e(e,t,i){this.serviceFactory=e,this.serviceTransport=t,this.serviceStorage=i}e.prototype.buildHotelBooking=function(e){return i.DtoHotelReservationBuilder.buildBooking(_.head(e.hotel_reservations),this.serviceStorage)},e.prototype.buildBookingSettings=function(e,t){return i.DtoBookingSettingsBuilder.build(e,t,this.getOrder().number)},e.prototype.hotelReservationRules=function(){var e=i.ApiHotelReservationRulesBuilder.build(this.getOrder());return this.serviceTransport.hotelReservationRules(e)},e.prototype.getProvider=function(){return this.serviceStorage.getProvider()},e.prototype.delete=function(){var e=i.ApiDeletePersonalDataBuilder.build(this.getOrder());return this.serviceTransport.deletePersonalData(e)},e.prototype.setOrder=function(e){this.serviceFactory.orderService.setOrder(e)},e.prototype.getOrder=function(){return this.serviceFactory.orderService.getOrder()},i.PersonalDataService=e}(tl=tl||{}),!function(a){function e(e,t,i,n){var r=this;this.serviceFactory=t,this.serviceTransport=i,this.serviceStorage=n,e.invoke(["$q","locale","translator","layout","errorHandler",function(e,t,i,n,o){r.$q=e,r.locale=t,r.translator=i,r.layout=n,r.errorHandler=o}]),this._bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.cancelHotelBooking=function(e,t,i){e=a.ApiCancelReservationBuilder.build(e,t,i,this.locale.locale());return this.serviceTransport.cancelHotelBooking(e).then(function(e){return a.HotelBookingStatus.convert(e.hotel_reservations[0].status)})},e.prototype.getBookingFormInfo=function(e){e=a.ApiBookingFormInfoBuilder.build(e.id,this.locale.language());return this.serviceTransport.bookingFormInfo(e).then(function(e){return a.DtoBookingFormInfoBuilder.build(e)})},e.prototype.bootstrap=function(e){return new a.CancellationBootstrap(this.serviceFactory,this.$q,this.errorHandler).ready(e)},e.prototype.auth=function(e){var r=this;return this._readHotelBooking(e).then(function(e){var t=e&&e.hotel_ref&&e.hotel_ref.code?e.hotel_ref.code:null,i=e&&e.promo_code?e.promo_code:null,n=e&&e.point_of_sale&&e.point_of_sale.source?e.point_of_sale.source:null,o=r.locale.language();return r.$q.all(t?[r.$q.all([r._commonInfoResponse(t,o),r._bookingFormSettingsResponse(t),r._hotelInfoResponse(t,o,n,i)]).then(function(e){r._buildCommonInfo(e[0]),r._buildBookingFormSettings(e[1]),r._buildHotelInfo(t,e[2])})]:[]).then(function(){return r._setTranslationMode(r._bookingFormSettings.getTranslationMode()),r.layout.updateExperiment(r._bookingFormSettings.experiments),a.TrackerService.store({_provider:t,_mode:a.util.TrackerEvent.getBookingFormMode()}),e&&t?a.DtoReadReservationBuilder.buildBooking(e,r.serviceStorage):null})})},e.prototype.convertCurrency=function(e){},e.prototype.translate=function(e){},e.prototype.destruct=function(){this.serviceStorage.clean()},e.prototype._setTranslationMode=function(e){this.translator.setTranslationMode(e)},e.prototype._readHotelBooking=function(e){e=a.ApiReadReservationBuilder.build(e,this.locale.locale());return this.serviceTransport.readHotelBooking(e).then(function(e){return e.hotel_reservations&&e.hotel_reservations[0]&&e.hotel_reservations[0].number?e.hotel_reservations[0]:null})},e.prototype._bookingFormSettingsResponse=function(e){e=a.ApiBookingFormSettingsBuilder.build(e);return this.serviceTransport.bookingFormSettings(e)},e.prototype._hotelInfoResponse=function(e,t,i,n){return this.serviceTransport.hotelInfo(a.ApiHotelInfoBuilder.build(e,t,i,n))},e.prototype._buildHotelInfo=function(e,t){a.DtoHotelInfoBuilder.build(t,this.serviceStorage,this._bookingFormSettings),a.DtoHotelInfoBuilder.buildBookingSettings(t,this._bookingFormSettings);t=_.find(t.hotels,{code:e});a.BookingFormSettingsBuilder.buildBookingRules(t,this._bookingFormSettings),a.BookingFormSettingsBuilder.buildDefaultCurrency(t,this._bookingFormSettings),a.DtoProviderBuilder.build(t,this.serviceStorage)},e.prototype._commonInfoResponse=function(e,t){return this.serviceTransport.commonInfo(a.ApiCommonInfoBuilder.build(e,t))},e.prototype._buildCommonInfo=function(e){a.DtoCommonInfoBuilder.build(e,this.serviceStorage)},e.prototype._buildBookingFormSettings=function(e){a.DtoBookingFormSettingsBuilder.build(this._bookingFormSettings,e)},a.CancellationService=e}(tl=tl||{}),!function(s){function e(e,t,i,n){var a=this;this.serviceFactory=t,this.serviceTransport=i,this.serviceStorage=n,e.invoke(["$q","locale","translator","auth","layout","errorHandler",function(e,t,i,n,o,r){a.$q=e,a.locale=t,a.translator=i,a.authService=n,a.layout=o,a.errorHandler=r}]),this.bookingFormSettings=s.BookingFormSettings.getInstance()}e.prototype.bootstrap=function(e){return new s.EditBookingBootstrap(this.serviceFactory,this.$q,this.errorHandler).ready(e)},e.prototype.setEditBookingStrategy=function(e){this._editBookingStrategy=e},e.prototype.getEditBookingStrategy=function(){return this._editBookingStrategy},e.prototype.setSearchCriteria=function(e){this._criteria=e.clone(),this._editBookingStrategy&&this._editBookingStrategy.setSearchCriteria(e)},e.prototype.getSearchCriteria=function(){return this._criteria},e.prototype.invalidateCache=function(){this.serviceTransport.invalidateCache(),this.getEditBookingStrategy()&&this.getEditBookingStrategy().invalidateCache()},e.prototype.initOrderExtraStay=function(e){s.DtoHotelReservationBuilder.buildExtraStay(e,this._getOrder(),this.serviceStorage)},e.prototype.setBooking=function(e){this._booking=e,this.authService.updateAuthData(e)},e.prototype.getProvider=function(){return this.serviceStorage.getProvider()},e.prototype.getCountries=function(){return this.serviceStorage.countries},e.prototype.getBooking=function(){return this._booking},e.prototype.getBookingReference=function(){var e=this._getOrder(),t=new s.BookingReference;return t.bookingNumber=e.number,t.cancellationCode=e.cancellationCode,t},e.prototype.hotelAvailabilityResponse=function(e,t){if(this._editBookingStrategy)return this._editBookingStrategy.hotelAvailabilityResponse(e,t);throw new Error("empty edit booking strategy")},e.prototype.getHotelAvailabilityRequest=function(e,t){e=e.clone();return this.bookingFormSettings.defaultCurrency&&e.currency&&e.currency.id==this.bookingFormSettings.defaultCurrency.id&&(e.currency=null),s.ApiHotelAvailabilityBuilder.build(e,t,null,this.getBookingReference())},e.prototype.getHotelOfferAvailabilityRequest=function(e){e=e.clone();return this.bookingFormSettings.defaultCurrency&&e.currency&&e.currency.id==this.bookingFormSettings.defaultCurrency.id&&(e.currency=null),s.ApiHotelOfferAvailabilityBuilder.build(e,this.getBookingReference())},e.prototype.convertCurrency=function(e){if(this._editBookingStrategy)return this._editBookingStrategy.convertCurrency(e)},e.prototype.translate=function(e){if(this._editBookingStrategy)return this._editBookingStrategy.translate(e)},e.prototype.setOrder=function(e){this.serviceFactory.orderService.setOrder(e)},e.prototype.verifyOrder=function(e){return this.serviceTransport.verifyReservation(e)},e.prototype.buildOrder=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=!1);var n=this._getOrder();return s.ApiHotelReservationBuilder.build(n,n.paymentSystem,e,t,i)},e.prototype.restoreBooking=function(e){return this.serviceTransport.restoreReservation(e)},e.prototype.buildRestoreBookingRequest=function(){var e=this._getOrder();return s.ApiRestoreReservationBuilder.build(this.getBookingReference(),e.language.locale())},e.prototype.buildHotelBooking=function(e){return s.DtoHotelReservationBuilder.buildBooking(_.head(e.hotel_reservations),this.serviceStorage)},e.prototype.confirmBooking=function(e){return this.serviceTransport.modifyReservation(e)},e.prototype.saveReservationRequest=function(e){return this.serviceTransport.savePayOrderRequest(e=void 0===e?void 0:e)},e.prototype.getReservationRequest=function(){return this.serviceTransport.savePayOrderRequest()},e.prototype.getBookingFormInfo=function(){return this.bookingFormInfoResponse(this._booking.provider.id,this.locale.language()).then(function(e){return s.DtoBookingFormInfoBuilder.build(e)})},e.prototype.hotelInfoResponse=function(e,t,i,n){return this.serviceTransport.hotelInfo(s.ApiHotelInfoBuilder.build(e,t,i,n))},e.prototype._getCommonInfoRequest=function(e,t){return s.ApiCommonInfoBuilder.build(e,t)},e.prototype.bookingFormSettingsResponse=function(e){e=s.ApiBookingFormSettingsBuilder.build(e);return this.serviceTransport.bookingFormSettings(e)},e.prototype.bookingFormInfoResponse=function(e,t){e=s.ApiBookingFormInfoBuilder.build(e,t);return this.serviceTransport.bookingFormInfo(e)},e.prototype.commonInfoResponse=function(e,t){return this.serviceTransport.commonInfo(this._getCommonInfoRequest(e,t))},e.prototype.emptyAvailabilityResponse=function(){return{room_stays:[],transfers:[]}},e.prototype._readHotelBooking=function(e){e=s.ApiReadReservationBuilder.build(e,this.locale.locale());return this.serviceTransport.readHotelBooking(e).then(function(e){e=null==(e=e.hotel_reservations)?void 0:e[0];return null!=e&&e.number?e:null})},e.prototype._buildCommonInfo=function(e){s.DtoCommonInfoBuilder.build(e,this.serviceStorage)},e.prototype._buildBookingFormSettings=function(e){s.DtoBookingFormSettingsBuilder.build(this.bookingFormSettings,e)},e.prototype._getOrder=function(){return this.serviceFactory.orderService.getOrder()},e.prototype._buildHotelInfo=function(e,t){s.DtoHotelInfoBuilder.build(t,this.serviceStorage,this.bookingFormSettings),s.DtoHotelInfoBuilder.buildBookingSettings(t,this.bookingFormSettings);t=_.find(t.hotels,{code:e});s.BookingFormSettingsBuilder.buildBookingRules(t,this.bookingFormSettings),s.BookingFormSettingsBuilder.buildDefaultCurrency(t,this.bookingFormSettings),s.DtoProviderBuilder.build(t,this.serviceStorage)},e.prototype._setTranslationMode=function(e){this.translator.setTranslationMode(e)},e.prototype._selectBookingStrategy=function(){this.bookingFormSettings.isSanatoriumMode()||this.bookingFormSettings.isResortMode()?this.setEditBookingStrategy(new s.SharedRoomEditBookingStrategy(this.$q,this,this.serviceFactory.serviceTransport,this.serviceFactory.serviceStorage)):this.setEditBookingStrategy(new s.CommonEditBookingStrategy(this.$q,this,this.serviceFactory.serviceTransport,this.serviceFactory.serviceStorage))},e.prototype.auth=function(e){var r=this,t=this.$q.defer();return this.bookingFormSettings.providerId?t.resolve():this.serviceTransport.updateBaseUrlByBookingNumber(e.bookingNumber).then(t.resolve),t.promise.then(function(){return r._readHotelBooking(e).then(function(i){var n=i&&i.hotel_ref&&i.hotel_ref.code?i.hotel_ref.code:null,e=i&&i.promo_code?i.promo_code:null,t=i&&i.point_of_sale&&i.point_of_sale.source?i.point_of_sale.source:null,o=r.locale.language();return r.$q.all(n?[r.$q.all([r.commonInfoResponse(n,o),r.bookingFormSettingsResponse(n),r.hotelInfoResponse(n,o,t,e)]).then(function(e){r._buildCommonInfo(e[0]),r._buildBookingFormSettings(e[1]),r._buildHotelInfo(n,e[2])})]:[]).then(function(){r._selectBookingStrategy(),r._setTranslationMode(r.bookingFormSettings.getTranslationMode()),r._booking=i&&n?s.DtoReadReservationBuilder.buildBooking(i,r.serviceStorage):null,r.layout.updateExperiment(r.bookingFormSettings.experiments),s.TrackerService.store({_provider:n,_mode:s.util.TrackerEvent.getBookingFormMode()});var e,t=r.$q.when();return r._booking&&r._booking.language&&((e=_.find(r.locale.languages(),function(e){return e.language.locale()==r._booking.language.locale()}))&&(t=t.then(function(){return r.translator.translate(e.id,!1,!0)}))),(t=r._booking&&r._booking.total&&r._booking.total.currency.id!=r.locale.currencyId()?t.then(function(){return r.translator.convert(r._booking.total.currency.id,!1)}):t).then(function(){return r._booking})})})})},e.prototype.destruct=function(){},s.EditBookingService=e}(tl=tl||{}),!function(a){function e(e,t,i,n){this.$q=e,this.editBookingService=t,this.serviceTransport=i,this.serviceStorage=n,this.bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.setSearchCriteria=function(e){this._roomStays=null},e.prototype.getRoomStays=function(){var t=this,e=this.editBookingService.getSearchCriteria(),i=this.$q.defer();return this.hotelAvailabilityResponse(e).then(function(e){t._initHotelAvailability(e),i.resolve(t.serviceStorage.getStayOptions().map(function(e){return e.roomStay}))}).catch(function(){t._roomStays=null}),i.promise},e.prototype.hotelAvailabilityResponse=function(e){var t=this;return this.serviceTransport.hotelAvailability(this.editBookingService.getHotelAvailabilityRequest(e)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?t.editBookingService.emptyAvailabilityResponse():t.$q.reject(e)})},e.prototype.hotelOfferAvailabilityResponse=function(e){return null},e.prototype.translate=function(e){var t,i,n,o,r=this;if(this.editBookingService.getBooking())return t=this.editBookingService.getBooking(),i=t.pointOfSale&&t.pointOfSale.source?t.pointOfSale.source:null,n=t.provider.id,o=this.serviceTransport.commonInfo(this.editBookingService._getCommonInfoRequest(n,e)),e=this.editBookingService.hotelInfoResponse(n,e,i,t.promoCode).then(function(e){return _.find(e.hotels,{code:n})}),this.$q.all([e,o]).then(function(e){a.DtoHotelInfoBuilder.translate(e[0],r.serviceStorage),a.DtoProviderBuilder.translate(e[0],r.serviceStorage),a.DtoCommonInfoBuilder.translate(e[1],r.serviceStorage)})},e.prototype.convertCurrency=function(e){},e.prototype.invalidateCache=function(){},e.prototype._initHotelAvailability=function(e){(new a.DtoHotelAvailabilityBuilder).build(e,this.serviceStorage,this.serviceTransport,this.$q)},a.CommonEditBookingStrategy=e}(tl=tl||{}),!function(a){function e(e,t,i,n){this._sharedRooms=[],this.$q=e,this.editBookingService=t,this.serviceTransport=i,this.serviceStorage=n,this.bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.setSearchCriteria=function(e){this._roomStays=null},e.prototype.getRoomStays=function(){return this._roomStays||(this._roomStays=this._getStayOptions().then(function(e){return _.map(e,function(e){return e.roomStay})})),this._roomStays},e.prototype.validateSharedRoomStay=function(e){var t=this,i=new a.SearchCriteriaSharedRoomStaysBuilder(this.editBookingService.getSearchCriteria());return this.serviceTransport.hotelAvailability2(this.editBookingService.getHotelAvailabilityRequest(i.build([e]))).then(function(e){e=t._initHotelAvailability(e,!0);return e.length?e[0].roomStay:null})},e.prototype.hotelAvailabilityResponse=function(e,t){var i=this,e=new a.SearchCriteriaSharedRoomStaysBuilder(e),n=[];return _.forEach(this._sharedRooms,function(e){_.forEach(e.roomStays,function(e){e.roomStay&&n.push(e)})}),n.length?this.serviceTransport.hotelAvailability2(this.editBookingService.getHotelAvailabilityRequest(e.build(n),t)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?i.editBookingService.emptyAvailabilityResponse():i.$q.reject(e)}):this.$q.when(this.editBookingService.emptyAvailabilityResponse())},e.prototype.hotelOfferAvailabilityResponse=function(e){var t=this;return this.serviceTransport.hotelOfferAvailability(this.editBookingService.getHotelOfferAvailabilityRequest(e)).catch(function(e){return _.some(e,function(e){return e.error_code==a.ServiceErrorCode.StartDateIsInvalid||e.error_code==a.ServiceErrorCode.EndDateIsInvalid})?t.editBookingService.emptyAvailabilityResponse():t.$q.reject(e)})},e.prototype.translate=function(e){var t,i,n,o,r=this;if(this.editBookingService.getBooking())return t=this.editBookingService.getBooking(),i=t.pointOfSale&&t.pointOfSale.source?t.pointOfSale.source:null,n=t.provider.id,o=this.serviceTransport.commonInfo(this.editBookingService._getCommonInfoRequest(n,e)),e=this.editBookingService.hotelInfoResponse(n,e,i,t.promoCode).then(function(e){return _.find(e.hotels,{code:n})}),this.$q.all([e,o]).then(function(e){a.DtoHotelInfoBuilder.translate(e[0],r.serviceStorage),a.DtoProviderBuilder.translate(e[0],r.serviceStorage),a.DtoCommonInfoBuilder.translate(e[1],r.serviceStorage)})},e.prototype.convertCurrency=function(e){},e.prototype.invalidateCache=function(){this._roomStays=null},e.prototype._getStayOptions=function(){var t=this,e=this.editBookingService.getSearchCriteria(),e=this.hotelOfferAvailabilityResponse(e),i=this.$q.defer();return this.$q.all([e]).then(function(e){t._initHotelOfferAvailability(e[0]),i.resolve(t.serviceStorage.stayOfferOptions)}).catch(function(){t._roomStays=null}),i.promise},e.prototype._initHotelAvailability=function(e,t){return(new a.DtoHotelAvailability2Builder).build(e,this.serviceStorage,this.serviceTransport,this.$q,t)},e.prototype._initHotelOfferAvailability=function(e){(new a.DtoHotelOfferAvailabilityBuilder).build(e,this.serviceStorage,this.serviceTransport,this.$q)},a.SharedRoomEditBookingStrategy=e}(tl=tl||{}),!function(a){function e(e){var i=this;this.fallbackCurrency="RUB",e.invoke(["$q","translator",function(e,t){i.$q=e,i.translator=t}]),this.bookingFormSettings=a.BookingFormSettings.getInstance()}e.prototype.prepare=function(e){this.preparePromise=this.prepareLocaleContext(e),this.bookingFormSettings.init(e),this.appParams=e},e.prototype.init=function(e){return this.currentApp&&this.currentApp.destruct(),this.currentApp=e,a.SessionLogger.getInstance().performanceLogger.push("bootstrapServiceInitStart"),this.$q.all([e.bootstrap(this.appParams),this.localeContextPromise]).then(function(e){return a.SessionLogger.getInstance().performanceLogger.push("bootstrapServiceInitEnd"),e[0]})},e.prototype.prepareLocaleContext=function(e){var i,n=a.Locale.getInstance(),t=e.language.toLowerCase(),o=e.languageRegion?e.languageRegion.toLowerCase():"",r=(!o&&0<=_.indexOf(t,"-")&&(o=(r=t.split("-"))[1],t=r[0]),[{lng:t,region:o},{lng:t},{lng:"en",region:"us"},{lng:"ru",region:"ru"}]),o=(_.each(r,function(t){i=i||_.find(n.languages(),function(e){return e.language.language()==t.lng&&(!t.region||e.language.region()==t.region)})}),i=i||_.head(n.languages()),e.currency&&n.findCurrency(String(e.currency).toUpperCase())?String(e.currency).toUpperCase():this.fallbackCurrency);return this.localeContextPromise=this.translator.init(i.id,o),this.localeContextPromise},a.BootstrapService=e}(tl=tl||{}),!function(s){function a(e,t,i,n,o){this._serviceFactory=e,this._bookingService=e.bookingService,this._bookingRuleService=e.bookingRuleService,this._bookingFormSettings=s.BookingFormSettings.getInstance(),this._hotelInfoDefer=t.defer(),this._lastPromoCode=null,this.$q=t,this.layout=i,this.messages=n,this._errorHandler=o}Object.defineProperty(a.prototype,"hotelInfoPromise",{get:function(){return this._hotelInfoDefer.promise},enumerable:!0,configurable:!0}),a.prototype.untrustedSearchCriteria=function(e){var t,i,n,o,r=this;return null!==(o=(o=r._bookingService.getSearchCriteria())?o.clone():null)&&void 0!==o?o:(0===(o=s.PlacementManager.getPlacementsFromAppParams(e)).length&&o.push(new s.SearchCriteriaPlacement(1)),t=Math.min(Math.max(_.parseInt((e.nights||"").toString())||1,1),1e3),i=new Date,(e.date&&_.isString(e.date)||e.arrivalDateOffset||e.arrivalDayOfWeek)&&((n=(e.date||"").toString().replace(/-(\d)-/,"-0$1-").replace(/-(\d)$/,"-0$1")).match(/^\d{4}-\d{2}-\d{2}$/)&&moment(n).isValid()?i=s.UnitConverter.toDate(n):e.arrivalDateOffset?i=i.addDays(e.arrivalDateOffset):e.arrivalDayOfWeek&&i.setNextDayOfWeek(e.arrivalDayOfWeek)),n=i.addDays(t),t=new s.SearchCriteria(r._bookingFormSettings.providerId,o,i,n,s.Locale.getInstance().language(),null,r._bookingFormSettings.bookingSource),r._bookingFormSettings.selectedRoomTypes&&r._bookingFormSettings.selectedRoomTypes.length&&(t.roomTypeIds=r._bookingFormSettings.selectedRoomTypes),r._bookingFormSettings.selectedRatePlans&&r._bookingFormSettings.selectedRatePlans.length&&(t.ratePlansIds=r._bookingFormSettings.selectedRatePlans),t)},a.prototype.ready=function(e){var t=this,i=(this.handleBookingAvailabilityStatus(),this._errorHandler.setRule(new s.ErrorHandlerRule),this.prepareServices(e));return this.hotelInfoPromise.then(function(){var e;return t._bookingFormSettings.bookingStatus==s.BookingStatus.Disabled?((e=t.$q.defer()).reject(),e.promise):{promise:i}})},a.prototype.prepareServices=function(t){var i=this,e=this.$q.when(this.untrustedSearchCriteria(t)).then(function(e){return i._bookingService.setSearchCriteria(e),e}).then(function(e){return t.unfinishedBookingNumber&&t.unfinishedBookingSign?i.buildSearchCriteriaFromUnfinishedBooking(e,t):e}).then(function(e){return i.subscribePromoCodeEvents(),i.subscribePromoCodeSnackbarEvents(),i.subscribeAuthorizationEvents(),i.buildSearchCriteriaPromoCode(e,t)}).then(function(e){return i._bookingService.setSearchCriteria(e),s.SearchCriteriaInformer.getInstance().notify(s.SearchCriteriaInformerMessageType.CreateSearchCriteria,{searchCriteria:e}),e}),n=this.prepareBookingFormSettings().then(function(){i.selectBookingStrategy(),i._bookingService.setTranslationMode(i._bookingFormSettings.getTranslationMode())}),o=this.prepareCommonInfo(),r=(this.resolveHotelInfo(o,n,e,this._serviceFactory.guestProfileTokenService.initializeCrmCampaignKey()),this.prepareHotelAvailability(n,e).catch(function(){})),a=this.prepareHotelOfferAvailability(n,e).catch(function(){}),e=this.correctSearchCriteria(e,this.hotelInfoPromise,n,t).then(function(e){return i.layout.updateExperiment(i._bookingFormSettings.experiments),t.unfinishedBookingNumber&&t.unfinishedBookingSign?i.buildOrderFromUnfinishedBooking(e,t):i.buildOrderFromSearchCriteria(e,t)});this.prepareHotelBookingRules(e);return this._ready=this.$q.all([this._bookingService.initSearchCriteria(e),o,r,a,this._serviceFactory.bootstrapService.preparePromise]),this._ready},a.prototype.resolveHotelInfo=function(e,t,i,n){var o=this;this.$q.all([e,t,n]).then(function(){return o.prepareHotelInfo(i)}).then(function(e){o._hotelInfoDefer.resolve(e)}).catch(function(e){o._hotelInfoDefer.reject(e)})},a.prototype.correctSearchCriteria=function(e,t,i,o){var r=this;return this.$q.all([e,t,i]).then(function(e){var t=e[0],e=e[1],i=r.$q.defer(),n=(t.promoCode?r.isCorrectPromoCode(t.promoCode,r._bookingService.getSearchCriteria()).then(function(e){return t.isValidPromoCode=e,i.resolve(t),t}):i.resolve(t),t=a.correctChildren(t,r._bookingFormSettings),o.unfinishedBookingNumber||o.unfinishedBookingSign||(r._bookingFormSettings.isServicesBookingForm()&&!r._bookingFormSettings.isServicesWithPeriod()&&(t.checkOutDate=t.checkInDate.addDays(1)),o.date||o.arrivalDateOffset||o.arrivalDayOfWeek||!r._bookingFormSettings.bookingRule||(n=t.nights(),t.checkInDate=r._bookingFormSettings.bookingRule.minAvailDate.getDate(),t.checkOutDate=t.checkInDate.addDays(n)),e.stay_unit_kind==s.StayUnitKind.Day&&(t.checkOutDate=t.checkOutDate.addDays(-1))),o.currency?String(o.currency).toUpperCase():""),n=(n&&_.find(r._bookingFormSettings.availableCurrencies,{id:n})||(n=e.currency),s.Locale.getInstance().findCurrency(n));return n&&(s.Locale.getInstance().setCurrency(n),t.currency=n),r._bookingFormSettings.isModeTurnedOn(s.BookingFormMode.CertificateBookingForm)&&(t.placements=[new s.SearchCriteriaPlacement(1,[])],t.checkInDate=s.DateUtil.getHotelDate(e.timezone.offset).addDays(1).resetTime(),t.checkOutDate=t.checkInDate.addDays(r._bookingFormSettings.stayUnitKind==s.StayUnitKind.Night?1:0)),r._bookingFormSettings.isModeTurnedOn(s.BookingFormMode.CampBookingForm)&&r.correctSearchCriteriaByCampSchedule(t,e),i.promise})},a.prototype.correctSearchCriteriaByCampSchedule=function(t,i){var e,n;this._bookingFormSettings.campSchedule&&(e=_.clone(this._bookingFormSettings.campSchedule),(n=(n=(n=(n=(n=_.find(e,function(e){return e.stayPeriod.startDate.isEqualDate(t.checkOutDate)&&e.stayPeriod.endDate.isEqualDate(t.checkOutDate)}))||_.find(e,function(e){return e.stayPeriod.startDate.isEqualDate(t.checkInDate)}))||_.find(e,function(e){return moment(t.checkInDate).isBefore(e.stayPeriod.startDate)}))||_.find(e.reverse(),function(e){return moment(t.checkInDate).isBefore(e.stayPeriod.startDate)}))||_.find(e,function(e){return moment(s.DateUtil.getHotelDate(i.timezone.offset)).isBefore(e.stayPeriod.startDate)}))&&(t.checkInDate=n.stayPeriod.startDate,t.checkOutDate=n.stayPeriod.endDate))},a.correctChildren=function(e,i){return _.forEach(e.placements,function(e){var t=_.filter(e.children,function(e){return!!i.childrenAgeGroupByAge(e.age)});e.adults+=e.children.length-t.length,e.children=t}),e},a.prototype.prepareHotelAvailability=function(e,t){var i=this;return e.then(function(){return t.then(function(e){return i._bookingService.hotelAvailabilityResponse(e)})})},a.prototype.prepareHotelOfferAvailability=function(e,t){var i=this;return e.then(function(){return t.then(function(e){return i._bookingService.hotelOfferAvailabilityResponse(e)})})},a.prototype.prepareHotelInfo=function(e){var t=this;return e.then(function(e){return t._bookingService.hotelInfoResponse(e).then(function(e){s.DtoHotelInfoBuilder.buildBookingSettings(e,t._bookingFormSettings),s.DtoHotelInfoBuilder.build(e,t._serviceFactory.serviceStorage,t._bookingFormSettings);e=_.find(e.hotels,{code:t._bookingFormSettings.providerId});return s.BookingFormSettingsBuilder.buildBookingRules(e,t._bookingFormSettings),s.BookingFormSettingsBuilder.buildDefaultCurrency(e,t._bookingFormSettings),s.DtoProviderBuilder.build(e,t._serviceFactory.serviceStorage),e})})},a.prototype.prepareHotelBookingRules=function(e){var t=this;return e.then(function(e){return t._bookingRuleService.hotelBookingRulesResponse(e.checkInDate,e)})},a.prototype.prepareBookingFormSettings=function(){var t=this;return this._bookingService.bookingFormSettingsResponse(this._bookingFormSettings.providerId).then(function(e){s.DtoBookingFormSettingsBuilder.build(t._bookingFormSettings,e)})},a.prototype.selectBookingStrategy=function(){this._bookingFormSettings.isModeTurnedOn(s.BookingFormMode.SharedAccommodationRatePlan)&&this._bookingFormSettings.isModeTurnedOn(s.BookingFormMode.SharedRoomView)?this._bookingService.setBookingStrategy(new s.SharedRoomBookingStrategy(this.$q,this._bookingService,this._serviceFactory.serviceTransport,this._serviceFactory.serviceStorage)):this._bookingFormSettings.isModeTurnedOn(s.BookingFormMode.SharedAccommodationRatePlan)?this._bookingService.setBookingStrategy(new s.SharedRatePlanBookingStrategy(this.$q,this._bookingService,this._serviceFactory.serviceTransport,this._serviceFactory.serviceStorage)):this._bookingService.setBookingStrategy(new s.CommonBookingStrategy(this.$q,this._bookingService,this._serviceFactory.serviceTransport,this._serviceFactory.serviceStorage))},a.prototype.prepareCommonInfo=function(){var t=this,e=s.Locale.getInstance().language(),i=this._bookingFormSettings.providerId;return this._bookingService.commonInfoResponse(i,e).then(function(e){s.DtoCommonInfoBuilder.build(e,t._serviceFactory.serviceStorage)})},a.prototype.prepareUnfinishedBooking=function(t){var i=this;return this._unfinishedBookingPromise=this._unfinishedBookingPromise||this._bookingService.readUnfinishedBooking(t.unfinishedBookingNumber,t.unfinishedBookingSign).then(function(e){return e&&!e.warnings&&e.hotel_reservations&&e.hotel_reservations[0]&&e.hotel_reservations[0].hotel_ref.code==String(t.providerId)&&!s.util.OrderUtil.isHotelReservationStatusSuccess(e.hotel_reservations[0].status)?e.hotel_reservations[0]:i.$q.reject()})},a.prototype.buildSearchCriteriaFromUnfinishedBooking=function(t,e){var i=this;return this.prepareUnfinishedBooking(e).then(function(e){e=s.DtoHotelReservationBuilder.buildBooking(e,i._serviceFactory.serviceStorage);return t.checkInDate=e.roomStay().stayDates.startDate,t.checkOutDate=e.roomStay().stayDates.endDate,t.promoCode=e.promoCode,t}).catch(function(){return t})},a.prototype.buildOrderFromUnfinishedBooking=function(n,e){var o=this;return this._serviceFactory.orderService.createOrderFromSearchCriteria(n,this._serviceFactory.serviceStorage.getProvider()),this.prepareUnfinishedBooking(e).then(function(e){var i=s.DtoHotelReservationBuilder.buildBooking(e,o._serviceFactory.serviceStorage);return o._serviceFactory.orderService.populateFromHotelBooking(i),o._serviceFactory.orderService.getOrder().number=null,o._bookingService.verifyOrder(!1).then(function(e){var t;return e&&!e.warnings&&!e.errors&&e.hotel_reservations&&e.hotel_reservations[0]&&(t=function(e){return[Math.round(e.total.priceAfterDiscount.priceAfterTax.amount),e.total.currency,e.promoCode,_.sortBy(_.map(e.options,function(e){return e.code()})).join("-"),_.sortBy(_.map(e.transfers,function(e){return e.transfer.id+"="+_.sortBy(_.map(e.vehicles,function(e){return e.vehicle.id})).join("!")})).join("-"),[e.customer.firstName,e.customer.lastName,e.customer.middleName].join(" "),_.sortBy(_.map(e.roomStays,function(e){return e.getHashCode()})).join("-")].join(",")})(s.DtoHotelReservationBuilder.buildBooking(e.hotel_reservations[0],o._serviceFactory.serviceStorage))==t(i)?(e=o._serviceFactory.orderService.getOrder()).customer.termsAgree=e.stay()&&e.stay().guests&&0<e.stay().guests.length:o._serviceFactory.orderService.cleanOrder(),n}).catch(function(){return o._serviceFactory.orderService.cleanOrder(),n})}).catch(function(){return n})},a.prototype.buildOrderFromSearchCriteria=function(e,t){return this._serviceFactory.orderService.createOrderFromSearchCriteria(e,this._serviceFactory.serviceStorage.getProvider()),this.$q.when(e)},a.prototype.handleBookingAvailabilityStatus=function(){var e=this;s.ServiceErrorInformer.getInstance().subscribe({callback:function(){e._bookingFormSettings.bookingStatus=s.BookingStatus.Disabled}},s.ServiceErrorInformerMessageType.Error,s.ServiceErrorCode.BookingTemporarilyUnavailable)},a.prototype.buildSearchCriteriaPromoCode=function(t,e){var i=this,n=this.$q.defer();return t.promoCode?n.resolve(t.promoCode):e.promoCode?this._serviceFactory.promoCodeService.decodePromoCodeResponse(e.promoCode).then(function(e){n.resolve(e.accessCode)},function(){n.resolve("")}):e.promoCodePlain?n.resolve(e.promoCodePlain):n.resolve(""),n.promise.then(function(e){return t.promoCode=e,i._lastPromoCode=e,t})},a.prototype.subscribeAuthorizationEvents=function(){var i=this;s.SearchCriteriaInformer.getInstance().subscribe({callback:function(){i._bookingService.getBookingStrategy().invalidatePrices().then(function(){i._bookingService.updatePrepayment()})}},s.SearchCriteriaInformerMessageType.AuthorizationChanged),s.SearchCriteriaInformer.getInstance().subscribe({callback:function(){i.hotelInfoPromise.then(function(){var e=i._bookingService.getSearchCriteria(),e=new s.DatePeriod(e.checkInDate,e.checkOutDate),t=s.PromotionUtil.getPromotions(s.DiscountType.Tourist,s.DiscountType.Registration,s.DiscountType.Loyalty),t=s.PromotionUtil.getMostValuablePromotionForPeriod(t,e),e="T:guest_log_in.motivator_applied_empty";t&&(e=t.discountType==s.DiscountType.Loyalty?"T:guest_log_in.motivator_common_applied":"T:guest_log_in.motivator_applied"),s.util.IntegrationEvent.fireShowSnackbarEvent({message:i.messages.getMessage(e),icon:s.SnackbarIcon.Medal,closeTimeoutMs:s.SnackbarCloseTimeout.Default})})}},s.SearchCriteriaInformerMessageType.GuestLogIn)},a.prototype.subscribePromoCodeSnackbarEvents=function(){var i=this,n="";s.SearchCriteriaInformer.getInstance().subscribe({callback:function(e){var t;n!=e.promoCode&&(n=e.promoCode,e.promoCode&&(e=i._bookingService.getSearchCriteria(),e=new s.DatePeriod(e.checkInDate,e.checkOutDate),t=i._bookingFormSettings.displayPromoCodeBlock,e=s.PromotionUtil.getMostValuablePromotionForPeriod(s.PromotionUtil.getPromotions(s.DiscountType.PromotionCode),e),t=t,e=!_.isUndefined(e),s.util.IntegrationEvent.fireShowSnackbarEvent({message:i.messages.getMessage(t?"T:promo.rate_applied":e?"T:promo.discount_applied":"T:promo.invalid_stay_periods_short"),icon:s.SnackbarIcon.Lock,closeTimeoutMs:s.SnackbarCloseTimeout.Default})))}},s.SearchCriteriaInformerMessageType.PromoCodeApplied)},a.prototype.subscribePromoCodeEvents=function(){var e=this,t={callback:function(t){e._lastPromoCode=t.promoCode,e.applyPromoCode(t.promoCode).then(function(e){e&&s.SearchCriteriaInformer.getInstance().notify(s.SearchCriteriaInformerMessageType.PromoCodeApplied,{promoCode:t.promoCode})})}};s.SearchCriteriaInformer.getInstance().subscribe(t,s.SearchCriteriaInformerMessageType.ApplyPromoCode),s.ServiceErrorInformer.getInstance().subscribe({callback:function(){s.SearchCriteriaInformer.getInstance().notify(s.SearchCriteriaInformerMessageType.InvalidPromoCode,{promoCode:e._lastPromoCode})}},s.ServiceErrorInformerMessageType.Warning,s.ServiceWarningCode.InvalidPromoCode),s.ServiceErrorInformer.getInstance().subscribe({callback:function(){s.SearchCriteriaInformer.getInstance().notify(s.SearchCriteriaInformerMessageType.ApplyPromoCode,{promoCode:""})}},s.ServiceErrorInformerMessageType.Error,s.ServiceWarningCode.InvalidPromoCode)},a.prototype.isCorrectPromoCode=function(e,t){return(t=t.clone()).promoCode=e,this._bookingService.hotelInfoResponse(t).then(function(e){return!_.some(e.warnings,function(e){return e.error_code===s.ServiceWarningCode.InvalidPromoCode})})},a.prototype.applyPromoCode=function(n){var o=this;return this.isCorrectPromoCode(n,this._bookingService.getSearchCriteria()).then(function(i){var e=o._bookingService.getSearchCriteria();return e.promoCode=n,e.isValidPromoCode=i&&!!n,o._bookingService.setSearchCriteria(e),o._bookingService.hotelInfoResponse(e).then(function(e){var t=o._serviceFactory.orderService.getOrder();return t&&(t.promoCode=i?n:null),s.DtoHotelInfoBuilder.buildPromotions(e,o._bookingFormSettings),s.DtoHotelInfoBuilder.build(e,o._serviceFactory.serviceStorage,o._bookingFormSettings),i})})},s.BookingBootstrap=a}(tl=tl||{}),!function(i){function e(e,t,i){this._serviceFactory=e,this._cancellationService=e.cancellationService,this._errorHandler=i,this.$q=t}e.prototype.ready=function(e){i.ServiceErrorInformer.getInstance().subscribe({callback:function(){i.BookingFormSettings.getInstance().bookingStatus=i.BookingStatus.Disabled}},i.ServiceErrorInformerMessageType.Error,i.ServiceErrorCode.BookingTemporarilyUnavailable),i.ServiceErrorInformer.getInstance().subscribe({callback:function(){i.BookingFormSettings.getInstance().bookingStatus=i.BookingStatus.Disabled}},i.ServiceErrorInformerMessageType.Warning,i.ServiceErrorCode.BookingTemporarilyUnavailable);var t=new i.ErrorHandlerRule;return t.handleBookingTemporarilyUnavailable=!1,this._errorHandler.setRule(t),this._serviceFactory.bootstrapService.preparePromise},i.CancellationBootstrap=e}(tl=tl||{}),!function(i){function e(e,t,i){this._serviceFactory=e,this._editBookingService=e.editBookingService,this._errorHandler=i,this.$q=t}e.prototype.ready=function(e){i.ServiceErrorInformer.getInstance().subscribe({callback:function(){i.BookingFormSettings.getInstance().bookingStatus=i.BookingStatus.Disabled}},i.ServiceErrorInformerMessageType.Error,i.ServiceErrorCode.BookingTemporarilyUnavailable),i.ServiceErrorInformer.getInstance().subscribe({callback:function(){i.BookingFormSettings.getInstance().bookingStatus=i.BookingStatus.Disabled}},i.ServiceErrorInformerMessageType.Warning,i.ServiceErrorCode.BookingTemporarilyUnavailable);var t=new i.ErrorHandlerRule;return t.handleBookingTemporarilyUnavailable=!1,this._errorHandler.setRule(t),this._serviceFactory.bootstrapService.preparePromise},i.EditBookingBootstrap=e}(tl=tl||{}),!function(n){function e(e){this._foreverTtl=moment.duration(500,"minutes"),this._longTtl=moment.duration(30,"minutes"),this._shortTtl=moment.duration(10,"minutes"),this.$q=e,this._preloaderCacheStorage=new n.PreloaderStorageCache(e),this._sessionCacheStorage=new n.SessionStorageCache(e),this._localCacheStorage=new n.LocalStorageCache(e),this._memoryCacheStorage=new n.MemoryStorageCache}e.prototype.invalidateCache=function(){this._sessionCacheStorage.invalidateCache(),this._localCacheStorage.invalidateCache(),this._preloaderCacheStorage.invalidateCache(),this._memoryCacheStorage.invalidateCache()},e.prototype.commonInfo=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.CommonInfo,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.customMessages=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.CustomMessages,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.roomTypeAvailability=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.RoomTypeAvailability,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.hotelInfo=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.HotelInfo,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.bookingFormSettings=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.BookingFormSettings,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.hotelAvailability=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.HotelAvailability,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.hotelOfferAvailability=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.HotelOfferAvailability,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.hotelReservation=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.HotelReservation,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.resolvePromoCode=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.ResolvePromoCode,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.ivisaAffiliate=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.IvisaAffiliate,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.hotelBookingRules=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.HotelBookingRules,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.ratePlanBookingRules=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.RatePlanBookingRules,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.nearestAvailableDates=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.NearestAvailableDates,e),i=this._shortTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.bookingFormInfo=function(e,t){void 0===t&&(t=void 0);var e=this.toKey(n.ServiceCacheStorageKey.BookingFormInfo,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.payOrder=function(e){void 0===e&&(e=void 0);var t=this.toKey(n.ServiceCacheStorageKey.PayOrder),i=this._foreverTtl;return void 0!==e&&(this._localCacheStorage.removeCache(t),this._localCacheStorage.setCacheSync(t,e,i)),this._localCacheStorage.getCacheSync(t)},e.prototype.payOrderRequest=function(e){void 0===e&&(e=void 0);var t=this.toKey(n.ServiceCacheStorageKey.PayOrderRequest),i=this._foreverTtl;return void 0!==e&&(this._localCacheStorage.removeCache(t),this._localCacheStorage.setCacheSync(t,e,i)),this._localCacheStorage.getCacheSync(t)},e.prototype.getWishListSettings=function(e,t,i){void 0===i&&(i=void 0);t=this.toKey(n.ServiceCacheStorageKey.WishListSettings+t,e),e=this._longTtl;return void 0!==i&&this.setCache(t,i,e),this.getCache(t,e)},e.prototype.getWishListLegalDocuments=function(e,t,i){void 0===i&&(i=void 0);t=this.toKey(n.ServiceCacheStorageKey.WishListLegalDocuments+t,e),e=this._longTtl;return void 0!==i&&this.setCache(t,i,e),this.getCache(t,e)},e.prototype.getYandexCreditSchedule=function(e,t){var e=this.toKey(n.ServiceCacheStorageKey.YandexCreditSchedule,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.getBestPriceGuaranteeAdvantages=function(e,t){var e=this.toKey(n.ServiceCacheStorageKey.BestPriceGuarantee,e),i=this._longTtl;return void 0!==t&&this.setCache(e,t,i),this.getCache(e,i)},e.prototype.setCache=function(e,t,i){var n=this;this._memoryCacheStorage.setCache(e,t),t&&t.catch(function(){n._memoryCacheStorage.removeCache(e)}),this._sessionCacheStorage.setCache(e,t,i)},e.prototype.getCache=function(e,t){var i=this._memoryCacheStorage.getCache(e);if(i)return this._sessionCacheStorage.setCache(e,i,t),i;i=this._sessionCacheStorage.getCache(e);if(i)return i;i=this._preloaderCacheStorage.getCache(e);return i?(this._sessionCacheStorage.setCache(e,i,t)&&this._preloaderCacheStorage.removeCache(e),i):null},e.prototype.toKey=function(e,t){return e+(void 0!==(t=void 0===t?void 0:t)?";"+JSON.stringify(t):"")},n.ServiceCache=e}(tl=tl||{}),!function(l){function c(e,t,i){c.serviceBaseUrl=e,this._serviceCache=new l.ServiceCache(i),this._serviceErrorHandler=new l.ServiceErrorHandler(i),this.$http=t,this.$q=i}Object.defineProperty(c,"serviceBaseUrl",{get:function(){return this._serviceBaseUrl},set:function(e){this._serviceBaseUrl=e},enumerable:!0,configurable:!0}),c.prototype.baseUrl=function(){return c.serviceBaseUrl+"/ApiWebDistribution/BookingForm/"},c.prototype.ibeBaseUrl=function(){return c.serviceBaseUrl+"/ibe/BookingForm/"},c.prototype.bestPriceGuaranteeBaseUrl=function(){return c.serviceBaseUrl+"/ibe/BestPriceGuarantee/"},c.prototype.regionMapBaseUrl=function(){return c.serviceBaseUrl+"/ibe/RegionMap/"},c.prototype.wishListBaseUrl=function(){return c.serviceBaseUrl+"/wishlist/api/client/"},c.prototype.yandexKassaUrl=function(){return c.serviceBaseUrl+"/ApiWebDistribution/InstallmentsPayment/"},c.prototype.surveyUrl=function(){return c.serviceBaseUrl+"/ApiWebDistribution/SurveyForm/"},c.prototype.gpRequestUrl=function(e,t){return c.serviceBaseUrl+"/guest-profile/"+e+t},c.prototype.gpAuthRequestConfig=function(){return{headers:{"X-Audience-App":c._audienceApp}}},c.prototype.gpRequestConfig=function(e){return{headers:{Authorization:"Bearer "+l.GuestProfileUtil.getGpToken(e)},timeout:1e4}},c.prototype.guestAuthBaseUrl=function(e){return c.serviceBaseUrl+"/guest-auth/"+e},c.prototype.requestWithRetry=function(i){var n=this;return i().catch(function(e){var t=n.$q.defer();return setTimeout(function(){t.resolve(i())},1e3),t.promise})},c.prototype.invalidateCache=function(){this._serviceCache.invalidateCache()},c.prototype.updateBaseUrlByBookingNumber=function(e){return!1===AppIntegration.getProperties().regionMap?this.$q.when():this.$http.get(this.regionMapBaseUrl()+"host?booking_number="+encodeURIComponent(e)).then(function(e){e=e.data;e.host&&(c.serviceBaseUrl="//"+e.host)}).catch(function(){})},c.prototype.roomTypeAvailability=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("roomTypeAvailabilityRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.roomTypeAvailability(t);return e||(e=i.$http.get(c.serviceBaseUrl+"/ApiWebDistribution/AvailabilityCalendar/room_type_availability?"+l.UrlUtil.serialize(t)),i._serviceCache.roomTypeAvailability(t,e)),e}));return this._serviceErrorHandler.handle(e,!1).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("roomTypeAvailabilityRequestEnd"),e.data}).catch(function(e){return i._serviceCache.roomTypeAvailability(t,null),null})},c.prototype.roomTypeAvailability2=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("roomTypeAvailabilityRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.roomTypeAvailability(t);return e||(e=i.$http.get(c.serviceBaseUrl+"/ApiWebDistribution/AvailabilityCalendar/room_type_availability_2?"+l.UrlUtil.serialize(t)),i._serviceCache.roomTypeAvailability(t,e)),e}));return this._serviceErrorHandler.handle(e,!1).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("roomTypeAvailabilityRequestEnd"),e.data}).catch(function(e){return i._serviceCache.roomTypeAvailability(t,null),null})},c.prototype.commonInfo=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("commonInfoRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.commonInfo(t);return e||(e=i.$http.get(i.baseUrl()+"common_info?"+l.UrlUtil.serialize(t)),i._serviceCache.commonInfo(t,e)),e}));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("commonInfoRequestEnd"),e.data}).catch(function(e){return i._serviceCache.commonInfo(t,null),i.$q.reject(e)})},c.prototype.hotelInfo=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("hotelInfoRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.hotelInfo(t);return e||(e=i.$http.get(i.baseUrl()+"hotel_info?"+l.UrlUtil.serialize(t)),i._serviceCache.hotelInfo(t,e)),e}));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelInfoRequestEnd"),e.data}).catch(function(e){return i._serviceCache.hotelInfo(t,null),i.$q.reject(e)})},c.prototype.bookingFormSettings=function(t){var i=this;if(!t.hotel.code||_.isUndefined(t.hotel.code))return(e=this.$q.defer()).resolve({}),e.promise;l.SessionLogger.getInstance().performanceLogger.push("bookingFormSettingsRequestStart");var e=this.requestWithRetry(function(){var e=i._serviceCache.bookingFormSettings(t);return e||(e=i.$http.get(i.ibeBaseUrl()+"booking_form_settings?"+l.UrlUtil.serialize(t)),i._serviceCache.bookingFormSettings(t,e)),e});return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("bookingFormSettingsRequestEnd"),e.data}).catch(function(e){return i._serviceCache.bookingFormSettings(t,null),i.$q.reject(e)})},c.prototype.hotelAvailability=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("hotelAvailabilityRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.hotelAvailability(t);return e||(e=i.$http.get(i.baseUrl()+"hotel_availability?"+l.UrlUtil.serialize(l.api.HotelAvailabilitySurrogatedHelper.fromRequest(t))),i._serviceCache.hotelAvailability(t,e)),e}));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelAvailabilityRequestEnd"),e.data}).catch(function(e){return i._serviceCache.hotelAvailability(t,null),i.$q.reject(e)})},c.prototype.hotelAvailability2=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("hotelAvailability2RequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.hotelAvailability(t);return e||(e=i.$http.get(i.baseUrl()+"hotel_availability_2?"+l.UrlUtil.serialize(l.api.HotelAvailabilitySurrogatedHelper.fromRequest(t))),i._serviceCache.hotelAvailability(t,e)),e}));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelAvailability2RequestEnd"),e.data}).catch(function(e){return i._serviceCache.hotelAvailability(t,null),i.$q.reject(e)})},c.prototype.hotelOfferAvailability=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("hotelOfferAvailabilityRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.hotelOfferAvailability(t);return e||(e=i.$http.get(i.baseUrl()+"hotel_offer_availability?"+l.UrlUtil.serialize(l.api.HotelAvailabilitySurrogatedHelper.fromRequest(t))),i._serviceCache.hotelOfferAvailability(t,e)),e}));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelOfferAvailabilityRequestEnd"),e.data}).catch(function(e){return i._serviceCache.hotelOfferAvailability(t,null),i.$q.reject(e)})},c.prototype.savePayOrderRequest=function(e){return this._serviceCache.payOrderRequest(e=void 0===e?void 0:e)},c.prototype.payOrder=function(e){var t=this,i=(l.SessionLogger.getInstance().performanceLogger.push("payOrderRequestStart"),this.baseUrl()+"hotel_reservation_2"),i=this.$http.post(i,e);return this._serviceErrorHandler.handle(i).then(function(e){if(l.SessionLogger.getInstance().performanceLogger.push("payOrderRequestEnd"),!e.data.hotel_reservations&&e.data.warnings&&e.data.warnings.length)throw e.data.warnings;return t._serviceCache.payOrder(e.data),e.data}).catch(function(e){return t._serviceCache.payOrder(null),t.$q.reject(e)})},c.prototype.modifyReservation=function(e){l.SessionLogger.getInstance().performanceLogger.push("modifyReservationRequestStart");e=this.$http.post(this.baseUrl()+"hotel_reservation_2",e);return this._serviceErrorHandler.handle(e,!1).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("modifyReservationRequestEnd"),e.data})},c.prototype.deletePersonalData=function(e){l.SessionLogger.getInstance().performanceLogger.push("deletePersoanlDataRequestStart");e=this.$http.post(this.baseUrl()+"delete_personal_data",e);return this._serviceErrorHandler.handle(e,!1).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("deletePersoanlDataRequestEnd"),e.data})},c.prototype.hotelReservationRules=function(e){var t=this,i=(l.SessionLogger.getInstance().performanceLogger.push("hotelReservationsRulesRequestStart"),this.requestWithRetry(function(){return t.$http.get(t.baseUrl()+"hotel_reservation_rules?"+l.UrlUtil.serialize(e))}));return this._serviceErrorHandler.handle(i,!0).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelReservationsRulesRequestEnd"),e.data})},c.prototype.verifyReservation=function(e,t){void 0===t&&(t=!1),l.SessionLogger.getInstance().performanceLogger.push("verifyReservationRequestStart");e=this.$http.post(this.baseUrl()+"verify_reservation",e);return this._serviceErrorHandler.handle(e,t).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("verifyReservationRequestEnd"),e.data})},c.prototype.restoreReservation=function(e){l.SessionLogger.getInstance().performanceLogger.push("restoreReservationRequestStart");e=this.$http.post(this.baseUrl()+"restore_reservation",e);return this._serviceErrorHandler.handle(e,!1).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("restoreReservationRequestEnd"),e.data})},c.prototype.getLastReservation=function(){return this._serviceCache.payOrder()},c.prototype.hotelReservation=function(e,t){return(t=void 0===t?!1:t)?this._hotelReservationCached(e):this._hotelReservation(e)},c.prototype.userFeedback=function(e){e=this.$http.post(c.serviceBaseUrl+"/ibe/BookingCustomerFeedback",e);return this._serviceErrorHandler.handle(e,!1).then(function(e){return e.data})},c.prototype.getWishListSettings=function(e,t){var i,n=this._serviceCache.getWishListSettings(t,e);return n||(i=[this.wishListBaseUrl(),"hotelSettings/getWidgetSettings/",e,"?",l.UrlUtil.serialize(t)].join(""),n=this.$http.get(i),this._serviceCache.getWishListSettings(t,e,n)),n.then(function(e){return e.data})},c.prototype.wishListLegalDocuments=function(e,t){var i,n=this._serviceCache.getWishListLegalDocuments(t,e);return n||(i=[this.wishListBaseUrl(),"providerInfo/getPolicyInfo/",e,"?",l.UrlUtil.serialize(t)].join(""),n=this.$http.get(i),this._serviceCache.getWishListLegalDocuments(t,e,n)),n.then(function(e){return e.data})},c.prototype.sendWishListTicket=function(e){var t=this.wishListBaseUrl()+"tickets/add";return this.$http.post(t,e).then(function(e){return e.data})},c.prototype.updateTicketStatus=function(e){var t=this.wishListBaseUrl()+"tickets/updateStatus";return this.$http.post(t,e).then(function(e){return e.data})},c.prototype.getBestPriceGuaranteeAdvantages=function(e){var t,i=this._serviceCache.getBestPriceGuaranteeAdvantages(e);return i||(t=[this.bestPriceGuaranteeBaseUrl(),"advantages","?",l.UrlUtil.serialize(e)].join(""),i=this.$http.get(t),this._serviceCache.getBestPriceGuaranteeAdvantages(e,i)),i.then(function(e){return e.data})},c.prototype.visitorsOnline=function(e){return this.$http.get(c.serviceBaseUrl+"/visitors-online-widget/v1/online?hotel="+e).then(function(e){return e&&e.data&&e.data.online})},c.prototype.hotelReservationBeacon=function(e,t){void 0===t&&(t=null),l.SessionLogger.getInstance().performanceLogger.push("hotelReservationRequestStart");var i=this.baseUrl()+"hotel_reservation_2",i=this.$http.post(i,e,t?{timeout:t}:void 0);return this._serviceErrorHandler.handle(i,!1).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelReservationRequestEnd"),e.data})},c.prototype.cleanNonAffectData=function(e){e=_.merge({},e);return e.include_extra_stay_options=!1,e.hotel_reservations[0].number="",_.each(e.hotel_reservations,function(e){delete e.customer,_.each(e.room_stays,function(e){e.guests=[]})}),e},c.prototype._hotelReservation=function(e){l.SessionLogger.getInstance().performanceLogger.push("hotelReservationRequestStart");var t=this.baseUrl()+"hotel_reservation_2",t=this.$http.post(t,e);return this._serviceErrorHandler.handle(t).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelReservationRequestEnd"),e.data})},c.prototype._hotelReservationCached=function(e){var t,i=this,n=(l.SessionLogger.getInstance().performanceLogger.push("hotelReservationRequestStart"),this.cleanNonAffectData(e)),o=this._serviceCache.hotelReservation(n);return o||(t=this.baseUrl()+"hotel_reservation_2",o=this.$http.post(t,e),this._serviceCache.hotelReservation(n,o)),this._serviceErrorHandler.handle(o).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("hotelReservationRequestEnd"),e.data}).catch(function(e){return i._serviceCache.hotelReservation(n,null),i.$q.reject(e)})},c.prototype.resolvePromoCode=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("resolvePromoCodeRequestStart"),{encrypted:!0,"access-code":t,format:"json"}),e=l.UrlUtil.expandUrlWithQueryParams(c.serviceBaseUrl+"/integration/search-form/check-access-code",e),n=this._serviceCache.resolvePromoCode(t);return n||(n=this.$http.get(e),this._serviceCache.resolvePromoCode(t,n)),n.then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("resolvePromoCodeRequestEnd"),e.data&&"success"==e.data.result?e.data:(i._serviceCache.resolvePromoCode(t,null),i.$q.reject())})},c.prototype.readHotelBooking=function(e){l.SessionLogger.getInstance().performanceLogger.push("readHotelBookingRequestStart");e=this.$http.get(this.baseUrl()+"read_reservation_2?"+l.UrlUtil.serialize(e));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("readHotelBookingRequestEnd"),e.data})},c.prototype.bookingFormInfo=function(t){var i=this,e=(l.SessionLogger.getInstance().performanceLogger.push("bookingFormInfoRequestStart"),this.requestWithRetry(function(){var e=i._serviceCache.bookingFormInfo(t);return e||(e=i.$http.get(i.baseUrl()+"booking_form_info?"+l.UrlUtil.serialize(t)),i._serviceCache.bookingFormInfo(t,e)),e}));return this._serviceErrorHandler.handle(e).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("bookingFormInfoRequestEnd"),e.data}).catch(function(e){return i._serviceCache.bookingFormInfo(t,null),i.$q.reject(e)})},c.prototype.cancelHotelBooking=function(e){l.SessionLogger.getInstance().performanceLogger.push("cancelHotelBookingRequestStart");var t=this.baseUrl()+"cancel_reservation_2",t=this.$http.post(t,e);return this._serviceErrorHandler.handle(t).then(function(e){return l.SessionLogger.getInstance().performanceLogger.push("cancelHotelBookingRequestEnd"),e.data})},c.prototype.hotelBookingRules=function(e){var t=this._serviceCache.hotelBookingRules(e),i=!0;return t||(l.SessionLogger.getInstance().performanceLogger.push("hotelBookingRulesRequestStart"),i=!1,t=this.$http.get(c.serviceBaseUrl+"/ApiWebDistribution/AvailabilityCalendar/hotel_booking_rules?"+l.UrlUtil.serialize(e),{timeout:c._requestTimeoutMs}),this._serviceCache.hotelBookingRules(e,t)),t.then(function(e){return i||l.SessionLogger.getInstance().performanceLogger.push("hotelBookingRulesRequestEnd"),e.data})},c.prototype.ratePlanBookingRules=function(e){var t=this._serviceCache.ratePlanBookingRules(e),i=!0;return t||(l.SessionLogger.getInstance().performanceLogger.push("ratePlanBookingRulesRequestStart"),i=!1,t=this.$http.get(c.serviceBaseUrl+"/ApiWebDistribution/AvailabilityCalendar/rate_plan_booking_rules?"+l.UrlUtil.serialize(e),{timeout:c._requestTimeoutMs}),this._serviceCache.ratePlanBookingRules(e,t)),t.then(function(e){return i||l.SessionLogger.getInstance().performanceLogger.push("ratePlanBookingRulesRequestEnd"),e.data})},c.prototype.nearestAvailableDates=function(e){var t=this._serviceCache.nearestAvailableDates(e),i=!0;return t||(l.SessionLogger.getInstance().performanceLogger.push("nearestAvailableDatesRequestStart"),i=!1,t=this.$http.get(c.serviceBaseUrl+"/ApiWebDistribution/AvailabilityCalendar/nearest_available_dates?"+l.UrlUtil.serialize(e),{timeout:c._requestTimeoutMs}),this._serviceCache.nearestAvailableDates(e,t)),t.then(function(e){return i||l.SessionLogger.getInstance().performanceLogger.push("nearestAvailableDatesRequestEnd"),e.data})},c.prototype.ivisaAffiliate=function(e,t,i,n,o){var r=this,a=l.UrlUtil.expandUrlWithQueryParams(c.serviceBaseUrl+"/affiliateprogram/ivisa",{tlid:e,ctzsh:i,lng:n,cur:o,cntry:t}),s=this._serviceCache.ivisaAffiliate(a);return(s=s||this.$http.get(a,{timeout:c._affiliateRequestTimeoutMs})).then(function(e){return r._serviceCache.ivisaAffiliate(a,s),e.data})},c.prototype.checkinAffiliate=function(e,t){e=l.UrlUtil.expandUrlWithQueryParams(c.serviceBaseUrl+"/checkin-form-api/booking-form/get-checkin-url",{bookingNumber:e,cancellationCode:t});return this.$http.get(e,{timeout:c._affiliateRequestTimeoutMs}).then(function(e){return e.data})},c.prototype.customMessages=function(t){var i=this,e=this.requestWithRetry(function(){var e=i._serviceCache.customMessages(t);return e||(e=i.$http.get(i.ibeBaseUrl()+"custom_messages?"+l.UrlUtil.serialize(t)),i._serviceCache.customMessages(t,e)),e});return this._serviceErrorHandler.handle(e,!1).then(function(e){return e.data}).catch(function(e){return i._serviceCache.customMessages(t,null),{}})},c.prototype.configSurvey=function(e){return this.$http.get(this.surveyUrl()+"config?"+l.UrlUtil.serialize(e)).then(function(e){return e.data}).catch(function(){return null})},c.prototype.sendSurvey=function(e){return this.$http.post(this.surveyUrl()+"send",e).then(function(e){return e.data}).catch(function(){return null})},c.prototype.authenticationConfirm=function(e,t,i){t={audience:c._audienceApp,code:t,authServiceKind:i.toLowerCase()};return this.$http.get(l.UrlUtil.expandUrlWithQueryParams(this.guestAuthBaseUrl(e)+"/auth/confirm",t))},c.prototype.getProfile=function(e){var t=this;return this.$http.get(this.gpRequestUrl(e,"/profile"),this.gpRequestConfig(e)).then(function(e){return e.data}).catch(function(e){return t.$q.reject(e)})},c.prototype.getGuestAccountIntegration=function(e,t){var i=this,t=l.UrlUtil.expandUrlWithQueryParams(this.gpRequestUrl(e,"/integration"),t);return this.$http.get(t,this.gpRequestConfig(e)).then(function(e){return e.data}).catch(function(e){return i.$q.reject(e)})},c.prototype.setProfileSettings=function(e,t){return this.$http.post(this.gpRequestUrl(e,"/profile/settings"),t,this.gpRequestConfig(e))},c.prototype.getYandexCreditSchedule=function(e){var i=this,t=this._serviceCache.getYandexCreditSchedule(e);return(t=t||l.QueueManager.getInstance(l.QueueType.YandexSchedule).push(this.$q,e,function(e){var t=[i.yandexKassaUrl(),"credit-schedule","?",l.UrlUtil.serialize(e)].join(""),t=i.$http.get(t);return i._serviceCache.getYandexCreditSchedule(e,t),t},6)).then(function(e){return e.data})},c.prototype.linkBookingToGuest=function(e,t,i){var n=l.GuestProfileUtil.isUserAuthenticated(e);return this.$http.post(this.gpRequestUrl(e,"/profile/booking"),{BookingId:t,Sign:i},this.gpRequestConfig(e)).then(function(e){return!0}).catch(function(e){return!n})},c.prototype.saveAdditionGuestInfo=function(e,t,i){var n=l.GuestProfileUtil.isUserAuthenticated(e);return this.$http.post(this.gpRequestUrl(e,"/profile/contacts"),{email:i,phoneNumber:t},this.gpRequestConfig(e)).then(function(e){return!0}).catch(function(e){return!n})},c.prototype.registerGuestAccount=function(e,t){return this.$http.post(this.guestAuthBaseUrl(e)+"/account/register",t,this.gpAuthRequestConfig()).then(function(e){return e.data}).catch(function(e){return null})},c.prototype.logIn=function(e,t){return this.$http.post(this.guestAuthBaseUrl(e)+"/auth/login",t,this.gpAuthRequestConfig()).then(function(e){return e.data}).catch(function(e){return null})},c.prototype.logOut=function(e){e=this.guestAuthBaseUrl(e)+"/auth/logout";return this.$http.post(e,null)},c.prototype.resetPassword=function(e,t){return this.$http.post(this.guestAuthBaseUrl(e)+"/account/reset-password",t,this.gpAuthRequestConfig()).then(function(e){return e.data}).catch(function(e){return null})},c.prototype.checkResetCode=function(e,t){return this.$http.post(this.guestAuthBaseUrl(e)+"/account/check-reset-code",t,this.gpAuthRequestConfig()).then(function(e){return e.data}).catch(function(e){return null})},c.prototype.setNewPassword=function(e,t){return this.$http.post(this.guestAuthBaseUrl(e)+"/account/set-new-password",t,this.gpAuthRequestConfig()).then(function(e){return e.data}).catch(function(e){return null})},c.prototype.linkLoyaltyCard=function(e,t){return this.$http.post(this.gpRequestUrl(e,"/loyalty/link-card"),t,this.gpRequestConfig(e)).then(function(e){return e.data})},c.prototype.getLoyaltyCardInfo=function(e){return this.$http.get(this.gpRequestUrl(e,"/loyalty/card"),this.gpRequestConfig(e)).then(function(e){return e.data})},c.prototype.getProviderAuthParameters=function(e){return this.$http.get(this.guestAuthBaseUrl(e)+"/auth/parameters").then(function(e){return e.data}).catch(function(){})},c._requestTimeoutMs=15e3,c._affiliateRequestTimeoutMs=4e3,c._audienceApp="BookingForm",l.ServiceTransport=c}(tl=tl||{}),!function(e){n=e.Informer,__extends(i,n),i.getInstance=function(){return i._instance=null===i._instance?new i:i._instance},i.prototype.subscribe=function(e,t,i){return n.prototype.subscribe.call(this,e,this.toHash(t,i))},i.prototype.notify=function(e,t){n.prototype.notify.call(this,this.toHash(e),t),n.prototype.notify.call(this,this.toHash(e,t.error_code),t)},i.prototype.unsubscribe=function(e,t,i){n.prototype.unsubscribe.call(this,e,this.toHash(t,i))},i.prototype.toHash=function(e,t){return t?[e,t].join("-"):e.toString()},i._instance=null;var n,t=i;function i(){var e;if(i._instance)throw new Error("Error: Instantiation failed: Use ServiceErrorInformer.getInstance() instead of new.");return e=n.call(this)||this,i._instance=e}function o(){}e.ServiceErrorInformer=t,o.Error="Error",o.Warning="Warning",e.ServiceErrorInformerMessageType=o}(tl=tl||{}),!function(o){function e(e){this.$q=e,this._serviceErrorInformer=o.ServiceErrorInformer.getInstance()}e.prototype.handle=function(e,i){var n=this;return void 0===i&&(i=!0),e.catch(function(e){return{data:{errors:[{error_code:500<=e.status&&e.status<600?o.ServiceErrorCode.InternalServerError:o.ServiceErrorCode.TransportError,lang:"en",message:"Unable to load resource "+(e.config?e.config.url:JSON.stringify(e))}]},config:e.config}}).then(function(t){return t&&t.data?(t.data.warnings&&t.data.warnings.length&&i&&_.forEach(t.data.warnings,function(e){var t=e.error_code==o.ServiceErrorCode.BookingTemporarilyUnavailable?o.ServiceErrorInformerMessageType.Error:o.ServiceErrorInformerMessageType.Warning;n._serviceErrorInformer.notify(t,e)}),t.data.errors&&t.data.errors.length?(i&&_.forEach(t.data.errors,function(e){e.info=JSON.stringify(t.config?{url:t.config.url,data:n.cleanPersonalInfo(t.config.data),artifacts:o.SessionLogger.getInstance().artifactLogger.artifacts}:t,null,2),n._serviceErrorInformer.notify(o.ServiceErrorInformerMessageType.Error,e)}),n.$q.reject(t.data.errors)):t):n.$q.reject([])})},e.prototype.cleanPersonalInfo=function(i,n){var o,r=this,a=(void 0===n&&(n=""),[".phone_number",".email_address",".last_name",".first_name",".middle_name",".postal_code",".region",".city",".birthday","guarantee.name",".gp_token","verification.cancellation_code","verification.payment_code"]);return _.isArray(i)?_.map(i,function(e,t){return r.cleanPersonalInfo(e,n+"."+t)}):_.isObject(i)?(o={},_.each(_.keys(i),function(e){var t=n+"."+e;_.some(a,function(e){return t.substr(t.length-e.length)==e})?o[e]="REMOVED":o[e]=r.cleanPersonalInfo(i[e],t)}),o):i},o.ServiceErrorHandler=e}(tl=tl||{}),!function(i){function e(e){var t=this;e.invoke(["$exceptionHandler",function(e){t._exceptionHandler=e}])}e.prototype.expandUrlWithLocationRequest=function(e){return this.tryToGetValue(function(){return i.urlBookingStorage.tryExpandWithLocationRequest(e)},e,"Expanding url with encoded 'HotelReservationsRequest' object from window.location is failed.")},e.prototype.expandUrlWithRequest=function(e,t){return this.tryToGetValue(function(){return i.urlBookingStorage.tryExpand(e,t)},e,"Passing 'HotelReservationsRequest' object via url is failed.")},e.prototype.getRequestFromUrl=function(){return this.tryToGetValue(function(){return i.urlBookingStorage.getReservationRequest()},void 0,"Getting 'HotelReservationsRequest' object from url is failed.")},e.prototype.tryToGetValue=function(e,t,i){var n;try{n=e()}catch(e){n=t,e.message=i+" "+e.message,this._exceptionHandler(e)}return n},i.HotelReservationsRequestService=e}(tl=tl||{}),!function(t){function e(e){this._scope=e}e.prototype.buildOrder=function(e,t){return this._scope.bookingService.buildOrder(e,t)},e.prototype.fireFailureEvent=function(e){AppIntegration.fireEvent(t.AppIntegrationEvent.BookingFailure,{bookingNumber:e.number,providerId:e.provider.id,providerName:e.provider.name})},e.prototype.getBooking=function(){var e=this._scope.bookingService.getReservation();return e&&e.booking()},e.prototype.getNavigationPanelStateLabel=function(){return null},e.prototype.getPaymentAwaitState=function(){return t.AppState.PaymentAwait},e.prototype.getPaymentFailedState=function(){return t.AppState.PaymentFailed},e.prototype.getPaymentInternalState=function(){return t.AppState.PaymentInternal},e.prototype.getPaymentPopupState=function(){return t.AppState.PaymentPopup},e.prototype.getPaymentResultState=function(){return t.AppState.PaymentResult},e.prototype.getPaymentSucceedState=function(){return t.AppState.Complete},e.prototype.getPaymentType=function(){return t.PaymentType.Booking},e.prototype.getReservationRequest=function(){return this._scope.bookingService.getReservationRequest()},e.prototype.getScope=function(){return this._scope},e.prototype.handleErrors=function(e){paymentPopup.failure(_.some(e,function(e){return e.error_code==t.ServiceErrorCode.StartDateIsInvalid||e.error_code==t.ServiceErrorCode.EndDateIsInvalid})?t.AppState.SearchFilter:t.PaymentUtil.resolvePaymentState(),this.getPaymentType())},e.prototype.isPaymentNeeded=function(e){return this._scope.bookingService.readHotelBooking(e).then(function(e){e=_.head(e.hotel_reservations);return!(e.status&&t.util.OrderUtil.isHotelReservationStatusSuccess(e.status))})},e.prototype.pay=function(e){return this._scope.bookingService.payOrder(e)},e.prototype.saveReservation=function(e){this._scope.bookingService.saveReservation(e)},e.prototype.saveReservationRequest=function(e){return this._scope.bookingService.saveReservationRequest(e)},t.BookingPaymentStrategy=e}(tl=tl||{}),!function(i){function e(e,t){this._scope=e,this._paymentType=t}e.prototype.buildOrder=function(e,t){return this._scope.editBookingService.buildOrder(e,t)},e.prototype.fireFailureEvent=function(){},e.prototype.getBooking=function(){return this._scope.editBookingService.getBooking()},e.prototype.getNavigationPanelStateLabel=function(){return this._paymentType==i.PaymentType.DeferredPayment?"T:edit_booking_payment.deferred_payment.title":"T:edit_booking_payment.change_card.title"},e.prototype.getPaymentAwaitState=function(){return i.AppState.EditBookingPaymentAwait},e.prototype.getPaymentFailedState=function(){return i.AppState.EditBookingPaymentFailed},e.prototype.getPaymentInternalState=function(){return i.AppState.EditBookingPaymentInternal},e.prototype.getPaymentPopupState=function(){return i.AppState.EditBookingPaymentPopup},e.prototype.getPaymentResultState=function(){return i.AppState.EditBookingPaymentResult},e.prototype.getPaymentSucceedState=function(){return i.AppState.EditBookingPaymentSucceed},e.prototype.getPaymentType=function(){return this._paymentType},e.prototype.getReservationRequest=function(){return this._scope.editBookingService.getReservationRequest()},e.prototype.getScope=function(){return this._scope},e.prototype.handleErrors=function(){paymentPopup.failure(this.getPaymentFailedState(),this.getPaymentType())},e.prototype.isPaymentNeeded=function(){var t=this,e=this._scope.orderService.getOrder()?this._scope.editBookingService.buildOrder():this.getReservationRequest();return e?this._scope.editBookingService.verifyOrder(e).then(function(e){e=t._scope.editBookingService.buildHotelBooking(e);return t.getPaymentType()==i.PaymentType.DeferredPayment?e.paymentGuaranteeStatus===i.PaymentGuaranteeStatus.Pending:e.paymentGuaranteeStatus===i.PaymentGuaranteeStatus.Failed}):this._scope.$q.reject()},e.prototype.pay=function(e){return this._scope.editBookingService.confirmBooking(e)},e.prototype.saveReservation=function(e){e=this._scope.editBookingService.buildHotelBooking(e);return this._scope.editBookingService.setBooking(e)},e.prototype.saveReservationRequest=function(e){return this._scope.editBookingService.saveReservationRequest(e)},i.EditBookingPaymentStrategy=e}(tl=tl||{}),!function(a){function e(e){this._hotelReservationsRequestService=e}e.prototype.firePopup=function(e,t,i){var n=i.getScope(),o=!e||e.type==a.PaymentSystemType.Cash||e.paymentSystemCode==a.PaymentSystemCode.ManualIndividualCashless||e.paymentSystemCode==a.PaymentSystemCode.IndividualCashless||e.paymentSystemCode==a.PaymentSystemCode.SberbankOnline||e.paymentSystemCode==a.PaymentSystemCode.StripeBankcard||e.isDeferredPayment&&i.getPaymentType()==a.PaymentType.Booking,r=e&&e.layout||new a.PaymentSystemLayout(850,600);!o||e&&e.paymentSystemCode==a.PaymentSystemCode.StripeBankcard||(r=new a.PaymentSystemLayout(0,0)),o?r.width&&r.height?(n.overlayOn(),n.$state.go(i.getPaymentInternalState(),{paymentType:i.getPaymentType()})):n.overlayOn():(n.overlayOff(),n.$state.go(i.getPaymentAwaitState(),{paymentType:i.getPaymentType()}));n.orderService.getOrder().paymentSystem=e,globalPaymentStrategy=i;n=a.PaymentUtil.getUrls(i),n=i.buildOrder(n.successUrl,n.failureUrl);i.saveReservationRequest(n),e&&e.paymentSystemCode==a.PaymentSystemCode.FUIB?AppIntegration.redirect(t.popupUrl):paymentPopup.open(this._hotelReservationsRequestService.expandUrlWithRequest(t.popupUrl,n),o,r.width,r.height)},a.PaymentPopupService=e}(tl=tl||{}),!function(n){function e(e,t){this._serviceTransport=e,this.$q=t,this._bookingFormSettings=n.BookingFormSettings.getInstance()}e.prototype.isAvailable=function(e,t){if(_.isUndefined(this._wishListSettings))return!1;var i=new Date,t=t.diffInDays(e)<=this._wishListSettings.maxStayDurationFromToday.getDate().diffInDays(i),i=e.diffInDays(this._wishListSettings.maxArrivalDate.getDate())<=0;return this._wishListSettings.enabled&&t&&i},e.prototype.getSettings=function(e){var t=this,i=this.$q.defer();return _.isUndefined(this._wishListSettings)?(e=n.ApiWishListBuilder.buildSettings(e),this._serviceTransport.getWishListSettings(this._bookingFormSettings.providerId,e).then(function(e){i.resolve(n.DtoWishListBuilder.buildSettings(e))})):i.resolve(this._wishListSettings),i.promise.then(function(e){return t._wishListSettings=e,t._wishListSettings})},e.prototype.getLegalDocuments=function(e){e=n.ApiWishListBuilder.buildSettings(e);return this._serviceTransport.wishListLegalDocuments(this._bookingFormSettings.providerId,e).then(function(e){return n.DtoWishListBuilder.buildLegalDocuments(e)})},e.prototype.getTicket=function(){return _.isUndefined(this._wishListTicket)&&(this._wishListTicket=new n.WishListTicket),this._wishListTicket},e.prototype.sendTicket=function(e){e=n.ApiWishListBuilder.buildTicket(this._wishListTicket,this._bookingFormSettings.providerId,AppIntegration.getSource(),e);return this._serviceTransport.sendWishListTicket(e)},e.prototype.updateTicketStatus=function(e,t,i){e=n.ApiWishListBuilder.buildTicketStatus(e,t,i=void 0===i?"":i);return this._serviceTransport.updateTicketStatus(e)},n.WishListService=e}(tl=tl||{}),!function(o){e.NotLoaded="not-loaded",e.Loading="loading",e.Loaded="loaded";var r=e;function e(){}function t(e,t,i){var n=this;this._checkPeriodInMilliseconds=1e3,this._confirmationInProgress=!1,this._tokenService=i,this._bookingFormSettings=o.BookingFormSettings.getInstance(),this._serviceTransport=e,this._$q=t,this._orderInformer=o.OrderInformer.getInstance(),this._guestProfile=new o.GuestProfile,this._profileLoadingStatus=r.NotLoaded,this._loginServiceChanged=!1,this._providerId=this._bookingFormSettings.providerId,this._orderInformer.subscribe({callback:function(){n._providerId=n._bookingFormSettings.providerId,n.loadProfileInfo()}},o.OrderInformerMessageType.CreateOrder),o.LanguageInformer.getInstance().subscribe({callback:function(){return n.isAuthenticatedUser()?n._$q.all([n.loadGuestAccountIntegration(),n.setProfileSettings()]):n._$q.when(null)}}),AppIntegration.subscribeEvent(o.AppIntegrationEvent.UpdateGuestToken,function(e){e&&(e.token?n._tokenService.setToken(e.token).then(function(){return n.loadProfileInfo(!1,n._profileLoadingStatus===r.NotLoaded)}):n._tokenService.removeToken().then(function(){return n.logOut(n._profileLoadingStatus===r.Loaded)}))})}o.GuestProfileLoadingStatus=r,t.prototype.getUiGuestAccount=function(){return this._uiGuestAccount||(this._uiGuestAccount=new o.directive.helper.UiGuestAccount),this._uiGuestAccount},Object.defineProperty(t.prototype,"guestProfile",{get:function(){return this._guestProfile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingStatus",{get:function(){return this._profileLoadingStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastAuthService",{get:function(){return this._lastAuthService},enumerable:!0,configurable:!0}),t.prototype.getGuestAccountUrl=function(){var e,t="";return this._bookingFormSettings.hasExperiment(o.Experiment.ShowGuestAccountLink)&&!(t=this._guestAccountIntegration&&this._guestAccountIntegration.url)&&(e={destination:"account",theme:encodeURIComponent(AppIntegration.getProperties().theme),locale:o.Locale.getInstance().locale()},t=o.UrlUtil.expandUrlWithQueryParams("/guest-auth/"+this._providerId+"/auth/redirect",e)),t},t.prototype.getLoyaltyCard=function(){return this.guestProfile&&this.guestProfile.loyaltyCard},t.prototype.isAuthenticatedUser=function(e){return o.GuestProfileUtil.isUserAuthenticated(e||this._providerId)},t.prototype.isProfileLoaded=function(){return this._profileLoadingStatus==r.Loaded},t.prototype.getLogInWindowInstance=function(){return this._socialLogInWindow},t.prototype.openSocialLogInWindow=function(e,t,i){switch(this.disposeCurrentLogInFlow(),this.setLoadingStatus(),this._lastAuthService=e){case o.AuthServiceKind.Vk:this._socialLogInWindow=this._openLogInVkWindow();break;case o.AuthServiceKind.Facebook:this._socialLogInWindow=this._openLogInFacebookWindow();break;case o.AuthServiceKind.Google:this._socialLogInWindow=this._openLogInGoogleWindow();break;default:return null}return o.TrackerService.trackExperiment(o.GuestProfileEventSource.Integration,{providerId:this._bookingFormSettings.providerId,action:"click",buttonName:"social-buttons",source:t,networkName:this.lastAuthService},!0),this.createCheckInterval(i),this._socialLogInWindow},t.prototype.createCheckInterval=function(t){var i=this;this._socialLogInWindowCheckInterval||(this._socialLogInWindowCheckInterval=setInterval(function(){i.tryAuthenticationConfirm().then(function(e){if(e)return i.disposeCurrentLogInFlow(),o.TrackerService.trackExperiment(o.GuestProfileEventSource.Integration,{providerId:i._bookingFormSettings.providerId,action:"auth",source:"social-buttons",networkName:i.lastAuthService},!0),t();!o.GuestProfileUtil.gpAuthCode&&i._socialLogInWindow&&i._socialLogInWindow.closed&&(i.disposeCurrentLogInFlow(),i.setNotLoadedStatus())})},this._checkPeriodInMilliseconds))},t.prototype.disposeCurrentLogInFlow=function(){if(this._socialLogInWindow)try{this._socialLogInWindow.close()}finally{this._socialLogInWindow=null}this._socialLogInWindowCheckInterval&&(clearInterval(this._socialLogInWindowCheckInterval),this._socialLogInWindowCheckInterval=null)},t.prototype._openLogInVkWindow=function(){var e="/guest-auth/"+this._providerId+"/auth?authApp=vk";return window.open(e,"","toolbar=0,status=0,resizable=1,width=660,height=383")},t.prototype._openLogInFacebookWindow=function(){var e="/guest-auth/"+this._providerId+"/auth?authApp=facebook";return window.open(e,"","toolbar=0,status=0,resizable=1,width=560,height=353")},t.prototype._openLogInGoogleWindow=function(){var e="/guest-auth/"+this._providerId+"/auth?authApp=google";return window.open(e,"","toolbar=0,status=0,resizable=1,width=800,height=603")},t.prototype.setLoadingStatus=function(){this._profileLoadingStatus=r.Loading},t.prototype.setNotLoadedStatus=function(){this._profileLoadingStatus=r.NotLoaded},t.prototype.setLoadedStatus=function(){this._profileLoadingStatus=r.Loaded},t.prototype.tryAuthenticationConfirm=function(){var t=this;if(this._confirmationInProgress)return this._$q.reject();var e=o.GuestProfileUtil.gpAuthCode,i=o.GuestProfileUtil.authServiceKind,n=o.GuestProfileUtil.isUserAuthenticated(this._providerId);return!n&&e&&i&&!o.GuestProfileUtil.isAuthCodeExpired()?(this._confirmationInProgress=!0,this._serviceTransport.authenticationConfirm(this._providerId,e,i).then(function(e){return o.GuestProfileUtil.setGpToken(t._providerId,e.data),e.data}).finally(function(){o.GuestProfileUtil.clearConfirmationStageValues(),t._confirmationInProgress=!1})):n?this._$q.when(o.GuestProfileUtil.getGpToken(this._providerId)):(o.GuestProfileUtil.isAuthCodeExpired()&&console.log("Authentication Code expired"),this._$q.when(null))},t.prototype.ensureUserAuthenticated=function(){return this.isAuthenticatedUser()?this._$q.when(o.GuestProfileUtil.getGpToken(this._providerId)):this._$q.when(null)},t.prototype.loadProfileInfo=function(e,t){var i=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),!this.guestProfile.isProfileLoaded()||e?this.ensureUserAuthenticated().then(function(e){if(e)return i.setLoadingStatus(),i._$q.all([i.getProfile(t),i.loadGuestAccountIntegration(),i.setProfileSettings()])}):this._$q.reject()},t.prototype.setProfileSettings=function(){var e=this._$q.defer(),t=AppIntegration.getProperties();return this._serviceTransport.setProfileSettings(this._providerId,{locale:o.Locale.getInstance().locale(),bookingFormUrl:this._bookingFormSettings.sourceUrl,theme:t.theme}).finally(function(){e.resolve()}),e.promise},t.prototype.loadGuestAccountIntegration=function(){var t=this;return this._bookingFormSettings.hasExperiment(o.Experiment.ShowGuestAccountLink)?this._serviceTransport.getGuestAccountIntegration(this._providerId,{locale:o.Locale.getInstance().locale()}).then(function(e){e&&(t._guestAccountIntegration=new o.GuestAccountIntegration(e.id,e.providerId,e.url))}):this._$q.when()},t.prototype.linkBookingToGuest=function(e,t,i){return t&&this.isAuthenticatedUser(e)?this._serviceTransport.linkBookingToGuest(e,t,i):this._$q.when(!1)},t.prototype.saveAdditionGuestInfo=function(t){var i=this;return this._serviceTransport.saveAdditionGuestInfo(this._providerId,t.phone).then(function(e){return i.guestProfile.phoneNumber=t.number(),e})},t.prototype.registerGuestAccount=function(e){return this._lastAuthService=o.AuthServiceKind.Tl,this._serviceTransport.registerGuestAccount(this._providerId,o.ApiGuestProfileBuilder.buildAccount(e))},t.prototype.logIn=function(e){return this._lastAuthService=o.AuthServiceKind.Tl,this._serviceTransport.logIn(this._providerId,e)},t.prototype.resetPassword=function(e){return this._serviceTransport.resetPassword(this._providerId,{email:e})},t.prototype.checkResetCode=function(e,t){return this._serviceTransport.checkResetCode(this._providerId,{email:e,code:t})},t.prototype.setNewPassword=function(e,t,i){return this._lastAuthService=o.AuthServiceKind.Tl,this._serviceTransport.setNewPassword(this._providerId,{email:e,code:t,newPassword:i})},t.prototype.logOut=function(e){var t=this;return void 0===e&&(e=!1),this._serviceTransport.logOut(this._providerId).then(function(){t._previousAuthService=t._guestProfile.authService,t._guestProfile&&t._guestProfile.clear(),t._uiGuestAccount&&t._uiGuestAccount.clear(),t.setNotLoadedStatus(),o.GuestProfileUtil.clearStorage(t._providerId),t.authorizationNotify(o.SearchCriteriaInformerMessageType.GuestLogOut,e)})},t.prototype.fillOrderFromProfile=function(e){var t,i;this.isProfileLoaded()&&(i=e.customer.customerIsSamePersonAsGuest&&0<e.guestStays.length,this.fillEmail(t=[],e),this.fillPhone(t,e),this.fillFirstName(t,e,i),this.fillLastName(t,e,i),this.fillMiddleName(t,e,i),i&&(i=e.guestStays[0].guests[0],e=this._bookingFormSettings.guestDetailing,this.fillBirthDay(t,i,e),this.fillCityName(t,i,e),this.fillSex(t,i,e),this.fillCountryCode(t,i,e)),o.TrackerService.trackExperiment(o.GuestProfileEventSource.Integration,{providerId:this._bookingFormSettings.providerId,action:"autofill",fields:t},!0))},t.prototype.getProfile=function(i){var n=this;return void 0===i&&(i=!1),this._guestProfile.refreshProfile(this._providerId),this.isAuthenticatedUser()?this._serviceTransport.getProfile(this._providerId).then(function(e){var t;{if(e)return n._guestProfile.addExtendedInfo(e),n._loginServiceChanged=n.guestProfile.authService!=n._previousAuthService,n._uiGuestAccount||n.authorizationNotify(null,i),t=n._$q.defer(),n.getLoyaltyCardInfo().then(function(){return t.resolve()}).catch(function(){return t.resolve()}).finally(function(){n.setLoadedStatus()});n._profileLoadingStatus=r.NotLoaded}}).catch(function(e){return o.GuestProfileUtil.removeGpToken(n._providerId),n._$q.reject(e)}):this._$q.reject()},t.prototype.authorizationNotify=function(e,t){void 0===t&&(t=!1),o.SearchCriteriaInformer.getInstance().notify(o.SearchCriteriaInformerMessageType.AuthorizationChanged,t),e&&o.SearchCriteriaInformer.getInstance().notify(e)},t.prototype.linkLoyaltyCard=function(e){var t=this,i=this._$q.defer();return this._bookingFormSettings.hasLoyaltyProgram()||i.reject(),this.setLoadingStatus(),this._serviceTransport.linkLoyaltyCard(this._providerId,{phoneNumber:e}).then(function(e){t.setLoadedStatus();e=e.result;e&&e.number?(t.guestProfile.loyaltyCard=new o.LoyaltyCard(e.number),t._serviceTransport.invalidateCache(),i.resolve(t.guestProfile.loyaltyCard)):i.reject()}).catch(function(){t.setNotLoadedStatus(),i.reject()}),i.promise},t.prototype.getLoyaltyCardInfo=function(){var t=this,i=this._$q.defer();return this._bookingFormSettings.hasLoyaltyProgram()||i.reject(),this.setLoadingStatus(),this._serviceTransport.getLoyaltyCardInfo(this._providerId).then(function(e){t.setLoadedStatus();e=e.result;e&&e.number?(t.guestProfile.loyaltyCard=new o.LoyaltyCard(e.number,e.bonusAmount,e.statusLevel),i.resolve(t.guestProfile.loyaltyCard)):i.reject()}).catch(function(){t.setNotLoadedStatus(),i.reject()}),i.promise},t.prototype.fillEmail=function(e,t){!this._guestProfile.email||t.customer.email&&!this._loginServiceChanged||(t.customer.email=this._guestProfile.email,e.push("email"))},t.prototype.fillPhone=function(e,t){!this._guestProfile.phoneNumber||t.customer.phone&&!this._loginServiceChanged||(t.customer.phone=new o.CustomerPhoneNumber(this._guestProfile.phoneNumber),e.push("phone"))},t.prototype.fillFirstName=function(e,t,i){!this._guestProfile.firstName||t.customer.firstName&&!this._loginServiceChanged||(t.customer.firstName=this._guestProfile.firstName,i&&(t.guestStays[0].guests[0].firstName=this._guestProfile.firstName),e.push("firstName"))},t.prototype.fillLastName=function(e,t,i){!this._guestProfile.lastName||t.customer.lastName&&!this._loginServiceChanged||(t.customer.lastName=this._guestProfile.lastName,i&&(t.guestStays[0].guests[0].lastName=this._guestProfile.lastName),e.push("lastName"))},t.prototype.fillMiddleName=function(e,t,i){!this._guestProfile.middleName||t.customer.middleName&&!this._loginServiceChanged||(t.customer.middleName=this._guestProfile.middleName,i&&(t.guestStays[0].guests[0].middleName=this._guestProfile.middleName),e.push("middleName"))},t.prototype.fillBirthDay=function(e,t,i){this._guestProfile.birthDay&&i.birthday&&(!t.birthday||this._loginServiceChanged)&&(t.birthday=this._guestProfile.getBirthDateInfo(),e.push("birthDay"))},t.prototype.fillCityName=function(e,t,i){this._guestProfile.cityName&&i.city&&(!t.city||this._loginServiceChanged)&&(t.city=this._guestProfile.cityName,e.push("cityName"))},t.prototype.fillSex=function(e,t,i){this._guestProfile.sex&&i.sex&&(!t.sex||this._loginServiceChanged)&&(t.sex=o.GuestInfoSex.convertFromGuestProfile(this._guestProfile.sex),e.push("sex"))},t.prototype.fillCountryCode=function(e,t,i){this._guestProfile.countryCode&&i.citizenship&&(!t.citizenship||this._loginServiceChanged)&&(t.citizenship=this._guestProfile.countryCode,e.push("countryCode"))},o.GuestProfileService=t}(tl=tl||{}),!function(n){e.prototype.load=function(){return this._promise||(this._promise=this._serviceTransport.getProviderAuthParameters(this._providerId).then(function(e){return null==e?void 0:e.crmCampaignKey})),this._promise};var o=e;function e(e,t){this._serviceTransport=e,this._providerId=t}function t(e,t){var i=n.BookingFormSettings.getInstance();this._providerId=i.providerId,this._$q=t,this._crmCampaignKeyLoader=new o(e,this._providerId)}t.prototype.initializeCrmCampaignKey=function(){var t=this,i=n.GuestProfileUtil.getCrmCampaignKey(this._providerId),e=this._crmCampaignKeyLoader.load().then(function(e){return e===i?e:t.updateCrmCampaignKey(e||t._providerId,i)});return i?this._$q.when(i):e},t.prototype.getToken=function(){var t=this;return this.getCrmCampaignKey().then(function(e){return t._$q.when(n.GuestProfileUtil.getGpTokenByCrmCampaignKey(e,t._providerId))})},t.prototype.setToken=function(t){var i=this;return this.getCrmCampaignKey().then(function(e){return n.GuestProfileUtil.setGpTokenByCrmCampaignKey(e,t),i._$q.when()})},t.prototype.removeToken=function(){var t=this;return this.getCrmCampaignKey().then(function(e){return n.GuestProfileUtil.removeGpTokenByCrmCampaignKey(e),t._$q.when()})},t.prototype.getCrmCampaignKey=function(){var e=n.GuestProfileUtil.getCrmCampaignKey(this._providerId);return e?this._$q.when(e):this.initializeCrmCampaignKey()},t.prototype.updateCrmCampaignKey=function(e,t){var i=n.GuestProfileUtil.getGpTokenByCrmCampaignKey(t,this._providerId);return i?(n.GuestProfileUtil.removeGpTokenByCrmCampaignKey(t),n.GuestProfileUtil.setGpTokenByCrmCampaignKey(e,i)):t&&n.GuestProfileUtil.removeGpTokenByCrmCampaignKey(e),n.GuestProfileUtil.setCrmCampaignKey(this._providerId,e),e},n.GuestProfileTokenService=t}(tl=tl||{}),!function(t){function e(e){this._serviceTransport=e,this._bookingFormSettings=t.BookingFormSettings.getInstance()}e.prototype.getAdvantages=function(){var e=t.ApiBestPriceGuaranteeBuilder.buildAdvatagesRequest(this._bookingFormSettings.providerId,t.Locale.getInstance().language());return this._serviceTransport.getBestPriceGuaranteeAdvantages(e).then(function(e){return t.DtoBestPriceGuaranteeBuilder.buildAdvantages(e)})},t.BestPriceGuaranteeService=e}(tl=tl||{}),!function(i){function e(e,t,i,n){var o=this;this.serviceFactory=t,this.serviceTransport=i,this.serviceStorage=n,e.invoke(["$q","translator",function(e,t){o.$q=e,o.translator=t}])}Object.defineProperty(e.prototype,"config",{get:function(){return this.serviceStorage.getSurveyConfig()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"provider",{get:function(){return this.serviceStorage.getProvider()},enumerable:!0,configurable:!0}),e.prototype.bootstrap=function(e){var t=this;return this.appParams=e,this.providerId=String(this.appParams.providerId||""),this.serviceFactory.bootstrapService.preparePromise.then(function(){return t.language=t.translator.locale.language(),t.loadConfig().then(function(e){return e&&(i.DtoSurveyBuilder.build(e,t.serviceStorage,t.appParams.bookingNumber,t.appParams.sign,t.appParams.preview),t.providerId=null!=(e=t.serviceStorage.surveyConfig.providerId)?e:t.providerId,t.applyTheme()),t.providerId?t.loadHotelInfo().then(function(e){i.DtoProviderBuilder.build(e.hotels[0],t.serviceStorage)}):t.$q.defer().resolve()})})},e.prototype.destruct=function(){this.serviceStorage.clean()},e.prototype.translate=function(e){var t=this;return this.language=e,this.$q.all([this.loadConfig(),this.loadHotelInfo()]).then(function(e){i.DtoSurveyBuilder.translate(e[0],t.serviceStorage),i.DtoProviderBuilder.translate(e[1].hotels[0],t.serviceStorage)})},e.prototype.applyTheme=function(){var e=this.serviceStorage.surveyConfig.theme;e&&document.body.classList.add("survey-theme-"+e)},e.prototype.loadConfig=function(){var e;return this.providerId?this.serviceTransport.configSurvey(i.ApiSurveyBuilder.buildConfigRequest(this.providerId,this.language.language(),this.appParams.bookingNumber,this.appParams.sign,this.appParams.preview)):((e=this.$q.defer()).resolve(null),e.promise)},e.prototype.loadHotelInfo=function(){return this.serviceTransport.hotelInfo(i.ApiHotelInfoBuilder.build(this.providerId,this.language))},i.SurveyService=e}(tl=tl||{}),!function(e){(function(e){var t;function i(){this._localizations=void 0,this._experiments={}}e=e.localization||(e.localization={}),t={kk:"ru-ru","ru-ru":"ru-ru","uk-ua":"ru-ru","en-us":"en-gb","en-gb":"en-gb","fr-fr":"en-gb","cs-cz":"en-gb","zh-cn":"en-gb","de-de":"en-gb","pl-pl":"en-gb","it-it":"en-gb","es-es":"en-gb","ja-jp":"en-gb","ko-kr":"en-gb","lv-lv":"en-gb","bg-bg":"en-gb","fi-fi":"en-gb","sv-se":"en-gb","ka-ge":"en-gb","id-id":"en-gb","et-ee":"en-gb","ro-ro":"en-gb","sr-latn":"en-gb","hy-am":"ru-ru","az-latn":"ru-ru","el-gr":"en-gb","tr-tr":"en-gb","pt-pt":"en-gb"},i.prototype.getMessages=function(){return this._localizations},i.prototype.getFallbackLocale=function(e){return t[e]},i.prototype.injectExperimentLocalizations=function(e,t){var i=this;this._experiments.hasOwnProperty(e)||(this._experiments[e]=!0,this._localizations?Object.keys(this._localizations).forEach(function(e){_.merge(i._localizations[e],t[e])}):(this._localizations={},_.merge(this._localizations,t)))},e.growthI18n=new i})((e=(e=e.growth||(e.growth={})).common||(e.common={})).utils||(e.utils={}))}(tl=tl||{}),{"ru-ru":(_a={},_a["hyponline48.motivator_text"]="Войдите и ускорьте бронирование",_a["hyponline48.main_survey_link"]="Каких способов входа не хватает?",_a["hyponline48.survey_popup_subtitle"]="Выберите один или несколько способов",_a["hyponline48.close_button"]="Закрыть",_a["hyponline48.submit_button"]="Отправить",_a["hyponline48.thanks_text"]="Спасибо за ваш ответ!<br/>Вы помогаете нам становиться лучше.",_a),"en-gb":(_b={},_b["hyponline48.motivator_text"]="Log in and speed up your booking process",_b["hyponline48.main_survey_link"]="No social network to log in?",_b["hyponline48.survey_popup_subtitle"]="Select one or more options",_b["hyponline48.close_button"]="Close",_b["hyponline48.submit_button"]="Submit",_b["hyponline48.thanks_text"]="Thank you for your reply!<br/>You are helping us to become better.",_b)}),tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,BookingFormSettings=(tl.registerDirective("tlGrowthMessage",["$q","$filter","$parse",function(r,e,a){var s=tl.LanguageInformer.getInstance(),l=tl.CurrencyInformer.getInstance(),c=e("growth.message");return tl.growth.common.utils.localization.growthI18n.injectExperimentLocalizations("hyponline48",l10nHyponline48),{restrict:"EA",scope:!1,replace:!1,template:"",link:function(i,n,o){function t(){var e,t;o.tlGrowthMessage?(t=2<o.tlGrowthMessage.length&&"'"==o.tlGrowthMessage[0]&&"'"==o.tlGrowthMessage[o.tlGrowthMessage.length-1]?o.tlGrowthMessage.substr(1,o.tlGrowthMessage.length-2):a(o.tlGrowthMessage)(i),e=o.messageParams?a(o.messageParams)(i):null,t=c(t,e),"true"===o.messageHtml?n[0].innerHTML=t:n[0].textContent=t):n[0].innerHTML=""}var e={callback:function(){var e=r.defer();return setTimeout(function(){t(),e.resolve()},0),e.promise}};s.subscribe(e),"true"==o.messageCurrency&&l.subscribe(e),i.$on("$destroy",function(){s.unsubscribe(e),"true"==o.messageCurrency&&l.unsubscribe(e)}),t()}}}]),app.filter("growth.message",["tl.growth.messages",function(i){function e(e,t){return i.formatMessage(e,t)}return e.$stateful=!0,e}]),!function(a){var e=a.growth||(a.growth={});(e=e.common||(e.common={})).services||(e.services={}),app.provider("tl.growth.messages",[function(){var r={};return{$get:["locale","tl.format",function(i,n){var o={getMessage:function(e){if(e&&"T"==e[0]&&":"==e[1]){e=e.substr(2);var t=a.growth.common.utils.localization.growthI18n.getMessages()[a.growth.common.utils.localization.growthI18n.getFallbackLocale(i.language().locale())];if(t&&t[e])return-1!=t[e].indexOf("{T:")&&(t[e]=t[e].replace(/\{(T:\w+[-_:\.\w\d]*)\}/g,function(e,t){return o.getMessage(t)})),t[e];t&&console.error("Unknown message: "+e)}return e},formatMessage:function(e,t){return n.format(o.getMessage(e),t)},define:function(e,t){r[e]=t},getLocaleMessages:function(e){return r[e]},setTranslationMode:function(e){var n;e!=a.TranslationMode.Default&&(n=["__",e.toString()].join(""),_.forIn(r,function(i,e){_.forIn(i,function(e,t){_.includes(t,n)&&(i[t.replace(n,"")]=e)})}))}};return o}]}}])}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.EditBookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.editBookingService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.EditBooking_ApproveBooking)})},t.registerController("StartApproveBookingPageCtrl",e)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.CancellationController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.cancellationService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.CancelBooking}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.CancelBooking}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.Cancellation,{},{location:"replace",reload:!0})})},t.registerController("StartCancellationPageCtrl",e)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.EditBookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.editBookingService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.EditBooking_ChangeCard)})},t.registerController("StartChangeCardPageCtrl",e)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.BookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.bookingService).then(function(){e.$state.go(t.AppState.Components,{},{location:"replace",reload:!0})})},t.registerController("StartComponentsCtrl",e)}(tl=tl||{}),!function(o){var e;function t(){return null!==e&&e.apply(this,arguments)||this}o.pages||(o.pages={}),e=o.BookingController,__extends(t,e),t.prototype.init=function(){var i=this,n=(e.prototype.init.call(this),o.BookingFormSettings.getInstance());this.bootstrapService.init(this.bookingService).then(function(e){var t=o.util.TrackerEvent.getBookingFormMode();o.TrackerService.store({_mode:t}),o.TrackerService.track("mode",{mode:n.isModeTurnedOn(o.BookingFormMode.SharedAccommodationRatePlan)?n.isModeTurnedOn(o.BookingFormMode.SharedRoomView)?"resort":"sanatorium":"hotel",servicesBookingForm:n.isServicesBookingForm(),roomsSearchCriteriaView:n.isModeTurnedOn(o.BookingFormMode.RoomsSearchCriteriaView),roomsGridView:n.isModeTurnedOn(o.BookingFormMode.RoomsGridView),continueBooking:!0}),o.TrackerService.track("session-inited"),e.promise.then(function(){i.$state.go(o.PaymentUtil.resolvePaymentState(),{},{location:"replace",reload:!0})})})},o.registerController("StartContinueBookingPageCtrl",t)}(tl=tl||{}),!function(a){var e;function t(){return null!==e&&e.apply(this,arguments)||this}a.pages||(a.pages={}),e=a.BookingController,__extends(t,e),t.prototype.init=function(){var o=this,r=(e.prototype.init.call(this),a.BookingFormSettings.getInstance());this.bootstrapService.init(this.serviceFactory.bookingService).then(function(e){var t,i=AppIntegration.getProperties(),n=a.util.TrackerEvent.getBookingFormMode();a.TrackerService.store({_mode:n}),a.TrackerService.track("mode",{mode:r.isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan)?r.isModeTurnedOn(a.BookingFormMode.SharedRoomView)?"resort":"sanatorium":"hotel",servicesBookingForm:r.isServicesBookingForm(),campBookingForm:r.isCampBookingForm(),roomsSearchCriteriaView:r.isModeTurnedOn(a.BookingFormMode.RoomsSearchCriteriaView),roomsGridView:r.isModeTurnedOn(a.BookingFormMode.RoomsGridView)}),a.TrackerService.track("session-inited"),a.TrackerService.track("experiments",{enabled:r.experiments},!0),i.wishListTicketId&&(o.wishListService.updateTicketStatus(i.wishListTicketId,a.WishListTicketStatus.LinkOpened),a.TrackerService.trackExperiment(a.Experiment.WishList,{providerId:a.BookingFormSettings.getInstance().providerId,status:a.WishListTicketStatus.LinkOpened},!0)),r.isModeTurnedOn(a.BookingFormMode.CertificateBookingForm)?o.$state.go(a.AppState.CertificateList,{},{location:"replace",reload:!0}):r.isModeTurnedOn(a.BookingFormMode.SharedAccommodationRatePlan)&&!r.isModeTurnedOn(a.BookingFormMode.SharedRoomView)?o.$state.go(a.AppState.SharedRatePlans,{},{location:"replace",reload:!0}):(n=r.isModeTurnedOn(a.BookingFormMode.RoomsSearchCriteriaView)||r.isModeTurnedOn(a.BookingFormMode.CampBookingForm),(i.date||i.arrivalDateOffset||i.arrivalDayOfWeek)&&i.nights&&(i.adults||r.isManualAccommodationMode())?(t=i.step==a.AppIntegrationStep.Search?a.AppState.SearchFilter:r.isModeTurnedOn(a.BookingFormMode.SharedRoomView)?a.AppState.RoomsGuestAccommodation:n?a.AppState.RoomsSearchCriteria:a.AppState.Rooms,r.isMirCashbackPromoPageAvailable()&&!r.isCampBookingForm()&&(t=a.AppState.SearchFilter),e.promise.then(function(){o.$state.go(t,{},{location:"replace",reload:!0})})):(t=n&&!r.isModeTurnedOn(a.BookingFormMode.SharedRoomView)?a.AppState.RoomsSearchCriteria:a.AppState.SearchFilter,o.$state.go(t,{},{location:"replace",reload:!0})))})},a.registerController("StartBookingPageCtrl",t)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.EditBookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.editBookingService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.EditBooking_DeferredPayment)})},t.registerController("StartDeferredPaymentPageCtrl",e)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.EditBookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.editBookingService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.EditBooking)})},t.registerController("StartEditBookingPageCtrl",e)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.BookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.bookingService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.PriceList}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.PriceList}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.PriceList,{},{location:"replace",reload:!0})})},t.registerController("StartPriceListCtrl",e)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.EditBookingController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.editBookingService).then(function(){t.TrackerService.store({_mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("mode",{mode:t.tracker.BookingFormMode.EditBooking}),t.TrackerService.track("session-inited"),e.$state.go(t.AppState.EditBooking_RestoreBooking)})},t.registerController("StartRestoreBookingPageCtrl",e)}(tl=tl||{}),!function(i){var e;function t(){return null!==e&&e.apply(this,arguments)||this}i.pages||(i.pages={}),e=i.BookingController,__extends(t,e),t.prototype.init=function(){var t=this;e.prototype.init.call(this),this.bootstrapService.init(this.bookingService).then(function(e){i.TrackerService.store({_mode:i.tracker.BookingFormMode.RoomsList}),i.TrackerService.track("mode",{mode:i.tracker.BookingFormMode.RoomsList}),i.TrackerService.track("session-inited"),t.$state.go(i.AppState.RoomList,{},{location:"replace",reload:!0})})},i.registerController("StartRoomsPageCtrl",t)}(tl=tl||{}),!function(t){var i;function e(){return null!==i&&i.apply(this,arguments)||this}t.pages||(t.pages={}),i=t.SurveyController,__extends(e,i),e.prototype.init=function(){var e=this;i.prototype.init.call(this),this.bootstrapService.init(this.surveyService).then(function(){e.$state.go(t.AppState.Survey,{},{location:"replace",reload:!0})})},t.registerController("StartSurveyCtrl",e)}(tl=tl||{}),!function(e){var t;function i(){return null!==t&&t.apply(this,arguments)||this}e.pages||(e.pages={}),t=e.BookingController,__extends(i,t),i.prototype.init=function(){t.prototype.init.call(this);e.BookingFormSettings.getInstance();this.bootstrapService.init(this.bookingService).then(function(e){e.promise.then(function(){})})},e.registerController("PrefetchPageCtrl",i)}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("pages/error/error.html",'<div tl-page name="p-error"><div class="p-error" ng-if="isPageLoaded"><div class="p-error__image-wrap"><div class="p-error__image"></div></div><h3 class="p-error__message" tl-message="\'T:error.server_error\'"></h3></div></div>')}),!function(e){var t;function i(){return null!==t&&t.apply(this,arguments)||this}e.pages||(e.pages={}),t=e.BookingController,__extends(i,t),i.prototype.init=function(){var e=this;t.prototype.init.call(this),this.bootstrapService.preparePromise.finally(function(){e.$timeout(function(){e.errorCode=e.$stateParams.errorCode,e.isPageLoaded=!0})})},i.prototype.initHeader=function(){e.HeaderManager.getInstance().hide()},i.prototype.initCartPanel=function(){e.CartPanelManager.getInstance().hide()},e.registerController("ErrorPageCtrl",i)}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/error-modal/error-modal.html",'<div class="x-error-modal"><div class="x-modal__header" rel="heading"><h1 class="x-modal__title" ng-bind="isAlreadyPaid ? \'T:error.error_title_already_paid\' : \'T:error.error_title\' | message"></h1></div><div class="x-modal__content" rel="content"><span ng-if="::isOverbooking && !isServiceUnavailable && !isAlreadyPaid" ng-bind="\'T:error.overbooking\' | message"></span> <span ng-if="::isOverbooking && isServiceUnavailable && !isAlreadyPaid" ng-bind="\'T:error.service_unavailable\' | message"></span> <span ng-if="::isOverbooking && isAlreadyPaid" ng-bind-html="\'T:error.already_paid\' | message: {email: email} | tlUnsafe"></span> <span ng-if="::!isOverbooking" ng-bind="\'T:error.unknown_error\' | message"></span></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn tl-btn_on_popup" ng-if="::!isOverbooking" ng-click="retry()" ng-bind="\'T:error.retry\' | message"></span> <span class="button-group__item tl-btn tl-btn_on_popup" ng-if="::!isOverbooking && isShowGoToStart" ng-click="goToStart()" ng-bind="\'T:error.reset\' | message"></span> <span class="button-group__item tl-btn tl-btn_on_popup" ng-if="::isOverbooking && !isAlreadyPaid" ng-click="goToRooms()" ng-bind="\'T:error.back_to_rooms\' | message"></span> <span class="button-group__item tl-btn tl-btn_on_popup" ng-if="::isOverbooking && isAlreadyPaid" ng-click="goToAuth()" ng-bind="\'T:modal.close\' | message"></span></div></div></div>')}),tl.registerDirective("tlErrorModal",["$state","serviceFactory","layout",function(i,n,o){return{restrict:"EA",templateUrl:"directives/error-modal/error-modal.html",scope:{error:"=",email:"=?",afterShowAction:"&?"},controller:["$scope",function(t){t.isOverbooking=tl.directive.helper.ErrorHelper.isOverbookingCode(t.error.error_code),t.isAlreadyPaid=tl.directive.helper.ErrorHelper.isAlreadyPaidCode(t.error.error_code),t.isServiceUnavailable=tl.directive.helper.ErrorHelper.isServiceUnavailableCode(t.error.error_code),t.isShowGoToStart=o.isVisible,t.goToRooms=function(){var e=tl.StateUtil.getRoomStartState(BookingFormSettings.getInstance().accommodationMode,n.bookingService.getSearchCriteria(),o.phone?tl.Layout.Phone:tl.Layout.Desktop).name;_.isFunction(t.afterShowAction)&&t.afterShowAction(),tl.ModalManager.getInstance().close(),i.go(e,{},{reload:!0})},t.goToStart=function(){_.isFunction(t.afterShowAction)&&t.afterShowAction(),tl.ModalManager.getInstance().close(),i.go(tl.AppState.Start,{},{reload:!0})},t.goToAuth=function(){_.isFunction(t.afterShowAction)&&t.afterShowAction(),tl.ModalManager.getInstance().close(),i.go(tl.AppState.Auth,{},{reload:!0})},t.retry=function(){_.isFunction(t.afterShowAction)&&t.afterShowAction(),tl.ModalManager.getInstance().close(),i.reload()}}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/status-modal/status-modal.html",'<div><div class="x-modal__close" ng-click="close()" ng-if="::!hideCloseButton"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" rel="heading"><h1 class="x-modal__title" tl-message="header"></h1></div><div class="x-modal__content" rel="content"><div class="tl-message -type-{{::status}}"><div class="tl-message__header"><svg class="tl-message__icon"><use ng-if="::(status == \'success\')" xlink:href="#done"></use><use ng-if="::(status == \'error\' || status == \'warning\')" xlink:href="#warning"></use></svg><div tl-message="subheader"></div></div><div class="pretty-text" tl-message="text" message-html="true" ng-if="::text"></div></div></div><div class="x-modal__controls" ng-if="::buttonText" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn tl-btn_on_popup" ng-click="close()" tl-message="buttonText"></span></div></div></div>')}),tl.registerDirective("tlStatusModal",[function(){return{restrict:"EA",templateUrl:"directives/status-modal/status-modal.html",scope:{status:"=",header:"=",subheader:"=",text:"=?",buttonText:"=",hideCloseButton:"="},controller:["$scope",function(e){e.close=function(){tl.ModalManager.getInstance().close()}}]}}]),tl.registerDirective("tlMessage",["$q","$filter","$parse",function(r,e,a){var s=tl.LanguageInformer.getInstance(),l=tl.CurrencyInformer.getInstance(),c=e("message");return{restrict:"EA",scope:!1,replace:!1,template:"",link:function(i,n,o){function t(){var e,t;o.tlMessage?(t=2<o.tlMessage.length&&"'"==o.tlMessage[0]&&"'"==o.tlMessage[o.tlMessage.length-1]?o.tlMessage.substr(1,o.tlMessage.length-2):a(o.tlMessage)(i),e=o.messageParams?a(o.messageParams)(i):null,t=c(t,e),"true"===o.messageHtml?n[0].innerHTML=t:n[0].textContent=t):n[0].innerHTML=""}var e={callback:function(){var e=r.defer();return setTimeout(function(){t(),e.resolve()},0),e.promise}};s.subscribe(e),"true"==o.messageCurrency&&l.subscribe(e),i.$on("$destroy",function(){s.unsubscribe(e),"true"==o.messageCurrency&&l.unsubscribe(e)}),t()}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/mir-cashback/mir-cashback-modal.html",'<div><div class="x-modal__close" ng-click="::close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__content" rel="content"><div tl-mir-cashback></div></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl button-group_nowrap"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="::close()"></span></div></div></div>'),e.put("directives/mir-cashback/mir-cashback.html",'<div class="x-mc"><div class="x-mc__image" ng-style="::imageStyles"></div><div class="x-mc__banner" tl-message="::bannerMessage" message-html="true"></div><div class="pretty-text"><div tl-message="\'T:mir-cashback.message\'" message-params="mirMessageParams" message-html="true" ng-click="registrationClickHandler($event)"></div></div></div>')}),!function(l){l.directive||(l.directive={});l.registerDirective("tlMirCashback",["$q","$compile","$state","tl.messages",function(o,r,a,s){return{restrict:"EA",templateUrl:"directives/mir-cashback/mir-cashback.html",scope:{source:"=?"},controller:["$scope",function(i){var e=l.BookingFormSettings.getInstance();if(e.promoMirSettings){i.canOpenRegisterModal=l.MirCashbackUtil.canOpenRegisterModal(),i.mirMessageParams=l.MirCashbackUtil.getMessageParams(),i.isMirCashbackAvailable=e.isMirCashbackAvailable();var t="",n="";switch(l.MirCashbackUtil.getCurrentShowPeriod()){case l.MirShowPeriod.NotStarted:t="T:mir-cashback.image_styles_coming_soon",n="T:mir-cashback.message_coming_soon";break;case l.MirShowPeriod.Running:t="T:mir-cashback.image_styles",n="T:mir-cashback.message_terms";break;case l.MirShowPeriod.Over:t="T:mir-cashback.image_styles_over",n="T:mir-cashback.message_over"}try{i.imageStyles=JSON.parse("{"+s.formatMessage(t,{})+"}")}catch(e){}i.bannerMessage=s.formatMessage(n,i.mirMessageParams);i.registrationClickHandler=function(e){var t=e.target;"a"!==t.nodeName.toLowerCase()||t.getAttribute("href")||(e.preventDefault(),t="register",l.MirCashbackUtil.canOpenNewPage()?a.go(l.AppState.MirRegister):l.ModalManager.getInstance().open(o.when(function(){return r("<tl-mir-promo-register-modal></tl-mir-promo-register-modal>")(i)[0]}),{stacked:!0,fitContent:!0}),l.TrackerService.trackExperiment(l.PromoOffer.MirCashback,{action:"go-to-mir-registration",page:a.current&&a.current.name,source:i.source||"action-info",target:t,newPage:l.MirCashbackUtil.canOpenNewPage()},!1))}}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/mir-promo-register-modal/mir-promo-register-modal.html",'<div class="x-mprm"><div class="x-modal__close" ng-click="::close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" ng-if="::!canOpenRegisterModal" rel="heading"><h1 class="x-modal__title" tl-message="\'T:mir-cashback.fallback_title\'"></h1></div><div class="x-modal__content" rel="content"><div class="x-mprm__fallback" ng-if="::!canOpenRegisterModal" tl-message="\'T:mir-cashback.fallback_message\'"></div><div class="x-mprm__registration-form" ng-if="::canOpenRegisterModal"><div class="x-mprm__loader" ng-show="!isDataLoaded"><div class="loader loader_on_popup"><svg><use xlink:href="#loader"></use></svg></div></div><div tl-mir-promo-register ng-show="isDataLoaded" success-action="registerSuccess()" loaded-action="registerLoaded()"></div></div></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl button-group_nowrap"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="::close()"></span></div></div></div>')}),!function(t){t.directive||(t.directive={});t.registerDirective("tlMirPromoRegisterModal",["$timeout",function(e){return{restrict:"EA",templateUrl:"directives/mir-promo-register-modal/mir-promo-register-modal.html",scope:{mirRegistrationModalOpened:"=?"},controller:["$scope",function(e){e.canOpenRegisterModal=t.MirCashbackUtil.canOpenRegisterModal(),e.isDataLoaded=!1,e.close=function(){t.ModalManager.getInstance().close(t.MirCashbackUtil.isRegistered()),e.mirRegistrationModalOpened=!1,e.$applyAsync()},e.registerSuccess=function(){e.close()},e.registerLoaded=function(){e.isDataLoaded=!0,e.$applyAsync()},e.canOpenRegisterModal||t.TrackerService.trackExperiment(t.PromoOffer.MirCashback,{action:"can-not-register",agent:navigator.userAgent,platform:t.DeviceUtil.getPlatform(),os:t.DeviceUtil.getOS(),browser:t.DeviceUtil.getBrowser()},!0)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/mir-promo-register/mir-promo-register.html",'<div class="x-mpr"></div>')}),!function(n){n.directive||(n.directive={});n.registerDirective("tlMirPromoRegister",["$timeout",function(e){return{restrict:"EA",replace:!0,templateUrl:"directives/mir-promo-register/mir-promo-register.html",scope:{successAction:"&",loadedAction:"&"},controller:["$scope",function(e){function i(){n.MirCashbackUtil.setIsRegistered(!0),e.successAction(),AppIntegration.fireEvent(n.AppIntegrationEvent.TrackUserAction,{action:n.AppIntegration__TrackUserAction__UserAction.MirRegister})}function t(e){if("iframe_process_complete"===e.data)i();else try{var t=JSON.parse(e.data);(t.redirectUrl||t.isSuccess)&&i()}catch(e){}}window.addEventListener("message",t),e.$on("$destroy",function(){window.removeEventListener("message",t)})}],link:function(t,i){e(function(){var e=document.createElement("iframe");e.setAttribute("class","x-mpr__iframe"),e.setAttribute("src","https://privetmir.ru/rostourism/register/travelline/"),e.onload=function(){t.loadedAction()},i[0].appendChild(e)},0)}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/dummy-modal/dummy-modal.html",'<div class="x-dm"><div class="x-modal__close" ng-click="close()" ng-if="::showCloseButton"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" rel="heading"><h1 class="x-modal__title" ng-bind="header | message"></h1></div><div class="x-modal__content" rel="content"><div ng-bind-html="content | tlSafeLinks | tlUnsafe"></div></div><div class="x-modal__controls" rel="controls" ng-if="::showControls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" ng-if="::showCloseButton" tl-message="\'T:modal.close\'" ng-click="close()"></span> <span ng-repeat="action in actions track by $index" class="button-group__item tl-btn tl-btn_on_popup" ng-click="action.action()" ng-bind="action.displayName | message"></span></div></div></div>')}),!function(i){i.directive||(i.directive={});i.registerDirective("tlDummyModal",[function(){return{restrict:"EA",templateUrl:"directives/dummy-modal/dummy-modal.html",scope:{header:"=",content:"=",showCloseButton:"=?",actions:"=?"},controller:["$scope",function(e){var t;e.showCloseButton=null==(t=e.showCloseButton)||t,e.close=function(){i.ModalManager.getInstance().close()},e.showControls=e.showCloseButton||_.some(e.actions)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/dummy-popover/dummy-popover.html",'<div class="x-dp"><div class="x-popover__title" ng-if="::header" ng-bind="header | message"></div><div ng-bind-html="content | tlSafeLinks | tlUnsafe"></div><div class="x-popover__controls" ng-if="::showControls"><div class="button-group button-group_rtl"><span ng-repeat="action in actions track by $index" class="button-group__item tl-btn-light tl-btn-light_on_popup tl-btn-light_transparent" ng-click="action.action()" ng-bind="action.displayName | message"></span></div></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlDummyPopover",[function(){return{restrict:"EA",templateUrl:"directives/dummy-popover/dummy-popover.html",scope:{header:"=?",content:"=",actions:"=?"},controller:["$scope",function(e){e.showControls=_.some(e.actions)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/modal/modal.html",'<div class="x-modal" ng-show="shown" ng-class="{ \'x-modal_full-screen\': params.fullScreen, \'x-modal_fit-content\': params.fitContent, \'x-modal_without-side-paddings\': params.withoutSidePaddings, \'x-modal_without-paddings\': params.withoutPaddings }"><div class="x-modal__window"><div class="x-modal__container" ng-hide="loading" modal-content></div><div class="x-modal__loader" ng-show="loading"><div class="loader loader_on_popup"><svg><use xlink:href="#loader"></use></svg></div></div></div></div>')}),!function(d){d.directive||(d.directive={});d.registerDirective("tlModal",["overlay","$timeout","layout",function(l,c,e){var u=null;return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/modal/modal.html",link:function(i,r){function n(){var e,t=r[0],i=t.querySelector('[rel="heading"]'),n=t.querySelector('[rel="content"]'),o=t.querySelector('[rel="controls"]');_.isNull(n)||(568<(e=AppIntegration.getPosition().screenHeight)&&(e*=.8),t=window.getComputedStyle(t),e=(e-=_.parseInt(t.getPropertyValue("padding-top"))||0)-(_.parseInt(t.getPropertyValue("padding-bottom"))||0),t=window.getComputedStyle(a),e=(e-=_.parseInt(t.getPropertyValue("padding-top"))||0)-(_.parseInt(t.getPropertyValue("padding-bottom"))||0),_.isNull(i)||(e=(e-=i.clientHeight)-(_.parseInt(window.getComputedStyle(i).getPropertyValue("margin-bottom"))||0)),_.isNull(o)||(e-=o.clientHeight),t=document.querySelector(".tl-container"),_.isNull(t)||(e-=_.parseInt(window.getComputedStyle(t).getPropertyValue("padding-bottom"))||0),n.style.maxHeight=e+"px")}d.ModalManager.getInstance().initScope(i);var o,a=r[0].querySelector("[modal-content]"),s=[],e=(i.$on(d.BroadcastEvent.WindowSizeChanged,function(e,t){t.from==d.LayoutSizeCode.XS&&t.to!=d.LayoutSizeCode.XS&&i.close()}),i.shown=!1,i.loading=!1,i.params={},i.close=function(e){void 0===e&&(e=!1),s.length&&a.removeChild(_.last(s).content),e?s=[]:s.splice(-1,1),s.length?(e=_.last(s),a.appendChild(e.content),i.params=e.modalOpenParams):(i.shown=!1,l.off(),clearInterval(o),document.body.style.minHeight="initial")},i.opened=function(){return i.shown},i.open=function(e,t){!u||t&&t.stacked||u.close(!1),u=i,o=setInterval(function(){var e=_.parseInt(window.getComputedStyle(document.querySelector(".tl-container"),null).getPropertyValue("padding-bottom"))||0,t=r[0].clientHeight,i=(document.body.style.minHeight=t+e+"px",AppIntegration.getPosition()),n=document.body.clientHeight,o=Math.min(i.screenHeight,n),n=Math.round(Math.min(n-t-e,Math.max(0,i.scrollTop+(o-t-e)/2)));d.HtmlUtil.transform(r[0],"translate(0px, "+n+"px)")},200),l.on(!1),i.loading=!0,i.shown=!0,i.params=t,e.then(function(e){s.length&&a.removeChild(_.last(s).content),s.push({content:e(),modalOpenParams:t}),i.loading=!1,a.appendChild(_.last(s).content),c(n,0)})},angular.element(window)),t=_.throttle(function(){n()},50);e.on(d.EventType.Resize,t),i.$on("$destroy",function(){e.off(d.EventType.Resize,t)}),i.$on("$stateChangeStart",function(e){e.defaultPrevented||u&&u.opened()&&u.close(!0)})}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/dev-panel/dev-panel.html",'<section class="x-dev-panel" ng-if="::isDev"><div><span ng-click="clearCache()" class="tl-btn">Очистить кэш</span> <span ng-click="fillContactInfoForm()" class="tl-btn">Заполнить</span> <span ng-click="openWithParams()" class="tl-btn">Ссылка</span></div><div><select ng-model="layout.current" ng-change="updateLayout()" disabled="disabled"><option value="xs">XS</option><option value="sm">S</option><option value="md">M</option><option value="lg">L</option></select></div><div tl-language-selector></div><div tl-currency-selector></div><span ng-click="playScenario()" ng-show="scenario.length && !scenarioRecording" class="tl-btn">Воспроизвести сценарий</span> <span ng-click="startScenario()" ng-show="!scenarioRecording" class="tl-btn">Записать сценарий</span> <span ng-click="endScenario()" ng-show="scenarioRecording" class="tl-btn">Остановить запись</span> <span class="tl-btn" ng-click="openComponentsPage()">Компоненты</span></section>')}),tl.BookingFormSettings),Locale=tl.Locale,tl,tl,tl,IndicatorType=(tl.registerDirective("tlDevPanel",["$q","$timeout","layout","serviceFactory","$state",function(l,a,o,u,r){return{restrict:"EA",scope:!0,templateUrl:"directives/dev-panel/dev-panel.html",controller:["$scope",function(i){var e=AppIntegration.getEnv();i.isDev=""!=e&&"prod"!=e&&"russoft"!=e,i.layout=o,i.updateLayout=function(){a(function(){o.update(o.current)},0)},i.openWithParams=function(){var t,i,n,o,r,a,s,e=u.bookingService.getSearchCriteria(),l=u.orderService.getOrder(),c=tl.BookingFormSettings.getInstance();e&&(t="",i=[],n={},n=AppIntegration.isAvailable()?(t=AppIntegration.getSource().split("?")[0],{hotel:"hotel",date:"date",nights:"nights",adults:"adults",childrenAge:"children-age",language:"language",region:"region",currency:"currency","promo-code-plain":"promo-code-plain",accommodation:"accommodation","room-type":"room-type","special-offer":"special-offer",experiment:"experiment"}):(t=document.location.href.split("?")[0],{hotel:"providerId",date:"date",nights:"nights",adults:"adults",childrenAge:"childrenAge",language:"language",region:"languageRegion",currency:"currency","promo-code-plain":"promoCodePlain",accommodation:"accommodationMode","room-type":"roomTypes","special-offer":"ratePlans",experiment:"experiment"}),i[n.hotel]=e.providerId,i[n.date]=e.checkInDate.format("YYYY-MM-DD"),i[n.nights]=e.nights(),o=[],r=[],_.forEach(e.placements,function(e){o.push(e.adults),r.push(_.map(e.children,function(e){return e.age}).join(";"))}),i[n.adults]=o.join(","),_.some(r,function(e){return!!e})&&(i[n.childrenAge]=r.join(",")),i[n.language]=e.language.language(),e.language.region()&&e.language.region().toLocaleLowerCase()!=e.language.language().toLocaleLowerCase()&&(i[n.region]=e.language.region()),i[n.currency]=e.currency.id,e.promoCode&&(i[n["promo-code-plain"]]=e.promoCode),c.accommodationMode!=tl.AccommodationMode.Manual&&(i[n.accommodation]=c.accommodationMode),a=[],s=[],l&&l.guestStays&&l.guestStays.length&&_.forEach(l.guestStays,function(e){a.push(e.roomStay.roomType.id),s.push(e.roomStay.ratePlan.id)}),a.length&&(i[n["room-type"]]=a.join(","),i[n["special-offer"]]=s.join(",")),t=t+"?"+_.map(Object.keys(i),function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&"),c.experiments&&c.experiments.length&&_.forEach(c.experiments,function(e){t+="&"+n.experiment+"[]="+encodeURIComponent(e)}),window.open(t))},i.fillContactInfoForm=function(){function t(e,i){_.each(document.querySelectorAll(e),function(e,t){e.value=i(t),tl.HtmlUtil.fireEvent(e,"change"),tl.HtmlUtil.fireEvent(e,"setvalue")})}function i(e){_.each(document.querySelectorAll(e),function(e){tl.HtmlUtil.fireClick(angular.element(e.parentNode))})}function n(e){return _.map(Array(e),function(){return Math.floor(10*Math.random())}).join("")}function o(e){return _.map(Array(e),function(){return r(Math.floor(100*Math.random())%25)}).join("")}function r(e){for(var t=[0];0<e;)t[t.length-1]++,25<=t[t.length-1]&&t.push(0),e--;return _.map(t,function(e){return String.fromCharCode(65+e)}).join("")}a(function(){var e;t('[name^="phone"]',function(){return window.localStorage.getItem("phone")||"+7 555"+n(7)}),t('[name="email"]',function(){return window.localStorage.getItem("email")||"guest"+n(6)+"@qa.travelline.ru"}),t('[name^="firstname"]',function(e){return o(4)+"-Иван"+r(e)}),t('[name^="middlename"]',function(e){return o(4)+"-Иванович"+r(e)}),t('[name^="lastname"]',function(e){return o(4)+"-Иванов"+r(e)}),e='[name^="sex"][value="male"]',_.each(document.querySelectorAll(e),function(e){tl.HtmlUtil.fireClick(angular.element(e.parentNode))}),t('[name^="birthday"]',function(){return Locale.getInstance().language().dateFormat().replace("DD","01").replace("MM","01").replace("YYY","198").replace("Y",n(1))}),t('[name^="postalcode"]',function(){return n(6)}),t('[name^="region"]',function(e){return o(4)+"-Регион"+r(e)}),t('[name^="city"]',function(e){return o(4)+"-Город"+r(e)}),i('[name="termsAgree"]'),i('[name="sanatoriumCardFormAgree"]'),i('[name="certificateOfCovidVaccinationAgree"]')},0)},i.clearCache=function(){window.sessionStorage.clear()},i.openComponentsPage=function(){r.go(tl.AppState.Components)};i.scenarioRecording=!1,i.scenario=[];try{i.scenario=JSON.parse(localStorage.getItem("scenario")||"[]")}catch(e){}function t(e){try{var t=function(t,e){for(var i=0;;i++)try{return{selector:n(t,e),target:t}}catch(e){if(3<i||!t.parentElement)throw e;t=t.parentElement}}(e.target,document);i.scenario.push(t.selector)}catch(e){console.log(e)}}function s(e){var t,i,n,o,r,a=e[0];if(a)return t=a,i=document,n=l.defer(),o=setInterval(function(){var e=i.querySelector(t);e&&(clearTimeout(r),clearInterval(o),n.resolve(e))},50),r=setTimeout(function(){clearInterval(o),n.reject(t)},5e3),n.promise.then(function(e){e.click()}).then(function(){return s(e.slice(1))}).catch(function(e){throw console.log(e),e})}var n=function(e,t){function i(e){return e.parentElement?[e].concat(i(e.parentElement)):[e]}function n(e,t,i){return(i=i.querySelectorAll(t))&&1===i.length&&i[0]===e}function o(e){return e.reduce(function(e,t){var i,n,o;n="",(i=t).hasAttribute&&i.hasAttribute("id")&&0!==i.getAttribute("id").indexOf("gs-")&&(n="#"+i.getAttribute("id")),o=i.hasAttributes()?Array.from(i.attributes):[],n||[{attr:/^tl-id$/},{class:/^x-tl-id-\w+/},{attr:/^tl-/},{class:/^x-\w+/},{class:/^p-\w+/},{attr:/^ng-click$/},{attr:/^ng-bind$/},{attr:/^ng-model$/}].forEach(function(t){!n&&t.attr&&o.forEach(function(e){if(e.name.match(t.attr))return n+="["+e.name+(e.value?'="'+CSS.escape(e.value)+'"':"")+"]",!1}),!n&&t.class&&i.classList&&i.classList.forEach(function(e){if(!n&&e.match(t.class))return n="."+e,!1})}),n=n||i.tagName&&i.tagName.toLowerCase();return n?(e?e+" ":"")+n:e},"")}var r=0,a=i(e).reverse(),s=o(a);if(!n(e,s,t))throw{error:"Invalid selector",selector:s,target:e};for(var l=0;l<=a.length-1;){var c=a.filter(function(e,t){return t!==l}),u=o(c);if(u&&n(e,u,t)?(a=c,s=u):l++,100<r++)throw{error:"Max recursion reached",selector:s,target:e}}return s||!1};i.startScenario=function(){i.scenario.length=0,document.body.addEventListener(tl.EventType.Click,t,!0),i.scenarioRecording=!0},i.endScenario=function(){i.scenarioRecording=!1,document.body.removeEventListener(tl.EventType.Click,t,!0),i.scenario.splice(-1,1),localStorage.setItem("scenario",JSON.stringify(i.scenario))};i.playScenario=function(){s(i.scenario)}}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/language-selector/language-selector-select-choice-image.html",'<div class="x-language-selector__choice" title="<%= $item.language.name() %>"><div class="flag flag-<%= $item.id %> x-language-selector__flag"></div><span class="language"><%= $item.language.name() %></span></div>'),e.put("directives/language-selector/language-selector-select-choice-text.html",'<div title="<%= $item.language.name() %>"><div class="language"><%= languageTextChoice($item.language) %></div></div>'),e.put("directives/language-selector/language-selector-select-match-image.html",'<div class="flag flag-<%= $selected.id %>"></div>'),e.put("directives/language-selector/language-selector-select-match-text.html","<div><%= languageTextMatch($selected.language) %></div>"),e.put("directives/language-selector/language-selector.html",'<div class="x-language-selector" ng-if="layout.isVisible"><div tl-select select-model="language.selected" select-items="supported" select-match-template="selectMatchTemplate" select-choice-template="selectChoiceTemplate" select-update="selectNotifier.notifier" select-change="update()"></div></div>')}),tl.registerDirective("tlLanguageSelector",["locale","translator","$q",function(i,n,o){var r=tl.BookingFormSettings.getInstance();return{restrict:"EA",scope:!0,replace:!0,templateUrl:"directives/language-selector/language-selector.html",controller:["$scope",function(t){var e=r.languageControlType==tl.LanguageControlType.Image&&"UKR"!=r.citizenship;t.selectMatchTemplate=tl.directiveTemplateUrl("language-selector",e?"language-selector-select-match-image":"language-selector-select-match-text"),t.selectChoiceTemplate=tl.directiveTemplateUrl("language-selector",e?"language-selector-select-choice-image":"language-selector-select-choice-text"),t.selectNotifier=tl.NotifierHelper.subscribe(t,o,!0,!1),t.selectNotifier.onLanguageChanged(function(e){t.language.selected=_.find(t.languages,{id:i.id()}),t.selectNotifier.update()}),t.languages=i.languages(),t.language={selected:_.find(t.languages,{id:i.id()})},t.update=function(){AppIntegration.fireEvent(tl.AppIntegrationEvent.LanguageChanged,{language:t.language.selected.id,code:t.language.selected.language.language(),region:t.language.selected.language.region()}),tl.TrackerService&&tl.TrackerService.track("language",{id:t.language.selected.language.locale()}),n.translate(t.language.selected.id)},t.languageTextMatch=function(e){return e.language().toLocaleUpperCase()},t.languageTextChoice=function(e){switch(e.locale()){case"en-us":case"en-gb":return e.name()+" "+e.region().toLocaleUpperCase();default:return e.name()}},t.$watch(function(){return r.availableLanguages.length},function(e){t.supported=e?r.availableLanguages:i.languages(),t.selectNotifier.update()})}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/select/select-choice.html","<span> <%= $item %> </span>"),e.put("directives/select/select-inline.html",'<div class="x-select-inline"><div class="x-select-inline__label" tl-select-match-transclude></div><div class="x-select-inline__items" tl-select-choices tl-select-choices-transclude><div class="x-select-inline__item" tl-select-choice-transclude></div></div></div>'),e.put("directives/select/select-match.html",'<% if ($selected) { %> <span><%= $selected %></span> <% } else { %> <span class="x-select__match-placeholder"><%= $message($placeholder) %></span> <% } %>'),e.put("directives/select/select.html",'<div class="x-select" tl-select><div tl-select-match class="x-select__match"><div tl-select-match-transclude class="x-select__match-content"></div><div class="x-select__match-icon"><svg><use xlink:href="#arrow-drop-down"></use></svg></div></div><div tl-select-choices class="x-select__choices"><div class="x-select__filter"><input tl-select-filter type="text"></input></div><div tl-select-choices-transclude class="x-select__scroll"><div tl-select-choice-transclude class="x-select__choice"></div></div></div></div>')}),!function(s){var c;function e(e,t,i,n,o,r,a){this.scope=e,this.$parse=t,this.$templateCache=i,this.messageFilter=n,this.currencyFilter=o,this.taxFilter=r,this.inline=a,this.itemVar="$item",this.selectedVar="$selected",this.placeholderVar="$placeholder",this.opened=!1,this.compiled=!1,this.valid=null,this.popupManager=s.PopupManager.instance,e.$message=n,e.$currency=o,e.$tax=r,e.$inline=a}function t(l){return["$q","$parse","$filter","$templateCache",function(e,i,t,n){var o=n.get("directives/select/"+l+".html"),r=t("message"),a=t("tlCurrency"),s=t("tlTax");return{restrict:"EA",scope:!1,replace:!0,transclude:!0,template:"<span ng-transclude></span>",link:function(e,t){new c(e,i,n,r,a,s,"select-inline"===l).compile(t[0],angular.element(o)[0])}}}]}s.directive||(s.directive={}),e.prototype.traverseModel=function(e){var i=this,e=e.replace(/\[([^\]]+)\]/g,function(e,t){return"."+i.traverseModel(t)}).split("."),t=this.scope;return _.each(e,function(e){t=t[e]}),t},e.prototype.updateModel=function(e){var t=this.modelString.split("."),i=t.pop();this.traverseModel(t.join("."))[i]=e},e.prototype.selectItem=function(e,t){this.selectedItem=t,this.updateModel(t),this.compileMatch();for(var i=this.element.querySelectorAll("._selected"),n=0;n<i.length;n++)s.HtmlUtil.toggleClass(i[n],"_selected",!1);s.HtmlUtil.toggleClass(e,"_selected",!0),this.scope[this.selectedVar]=this.getItemText(this.selectedItem),this.onChangeActionString&&this.$parse(this.onChangeActionString)(this.scope)},e.prototype.attachEventListeners=function(){var t=this;angular.element(window).on(s.EventType.Click,function(e){e=e.target;t.opened&&!(t.attachElement||t.element).contains(e)&&t.toggle()}),angular.element(this.attachElement||this.element.querySelector("[tl-select-match]")).on(s.EventType.Click,function(e){e=e.target;t.attachElement&&t.attachElement.querySelector("[tl-select-choices]").contains(e)||t.disabled||t.toggle()}),this.withFilter&&angular.element(this.element.querySelector("[tl-select-filter]")).on(s.EventType.KeyUp,function(e){e=e.target.value;t.filterItems(e)})},e.prototype.attachItemEventListeners=function(e,t,i){var n=this;angular.element(t).on(s.EventType.Click,function(){n.selectItem(t,i),n.close()}),angular.element(t).on(s.EventType.Hover,function(){s.HtmlUtil.toggleClass(e.querySelector("._active"),"_active",!1),s.HtmlUtil.toggleClass(t,"_active",!0)})},e.prototype.getItems=function(){return this.items||(this.items=this.$parse(this.itemsString)(this.scope)),this.items},e.prototype.filterItems=function(i){var n=this,o=this.element.querySelectorAll("[tl-select-choices-transclude] > *");_.each(this.getItems(),function(e,t){s.HtmlUtil.toggleClass(o.item(t),"_filtered",!n.filterAction(e,i))})},e.prototype.compileItems=function(){var n=this,o=this.element.querySelector("[tl-select-choices-transclude]"),r=(o.innerHTML="",this.getChoiceTemplate());_.each(this.getItems(),function(e,t){n.scope[n.itemVar]=n.getItemText(e);var i=n.choiceTranscludeTpl.cloneNode(!0);i.innerHTML=r(n.scope),i.setAttribute("tl-id","si-"+t),_.isEqual(e,n.selectedItem)&&s.HtmlUtil.toggleClass(i,"_selected",!0),!n.isItemAvailableAction||n.isItemAvailableAction(e)?n.attachItemEventListeners(o,i,e):s.HtmlUtil.toggleClass(i,"_disabled",!0),o.appendChild(i)}),this.filterPlaceholderString&&this.element.querySelector("[tl-select-filter]").setAttribute("placeholder",this.$parse(this.filterPlaceholderString)(this.scope))},e.prototype.compileMatch=function(){var e=this.element.querySelector("[tl-select-match]"),t=this.element.querySelector("[tl-select-match-transclude]"),i=(t.innerHTML="",this.getMatchTemplate());this.valid=this.validString?this.$parse(this.validString)(this.scope):null,s.HtmlUtil.toggleClass(this.element,"_valid",!0===this.valid),s.HtmlUtil.toggleClass(this.element,"_invalid",!1===this.valid),this.disabled=!!this.disabledString&&this.$parse(this.disabledString)(this.scope),s.HtmlUtil.toggleClass(this.element,"_disabled",!!this.disabled),this.selected=!!this.selectedString&&this.$parse(this.selectedString)(this.scope),s.HtmlUtil.toggleClass(this.element,"_selected",!!this.selected),s.HtmlUtil.toggleClass(e,"_important",this.isImportant),this.scope[this.selectedVar]=this.getItemText(this.selectedItem),t.innerHTML=i(this.scope)},e.prototype.update=function(){this.selectedItem=this.$parse(this.modelString)(this.scope),this.items=null,this.compiled=!1,this.attachElement?s.HtmlUtil.toggleClass(this.element,"-attached"):this.compileMatch(),this.inline&&this.compileItems()},e.prototype.getMatchTemplate=function(){return this.matchTpl||(this.matchTpl=_.template(this.$templateCache.get(this.matchTemplateUrl))),this.matchTpl},e.prototype.getChoiceTemplate=function(){return this.choiceTpl||(this.choiceTpl=_.template(this.$templateCache.get(this.choiceTemplateUrl))),this.choiceTpl},e.prototype.compile=function(e,t){var i=this,n=(this.element=t,this.onChangeActionString=e.getAttribute("select-change"),this.onUpdateAction=this.$parse(e.getAttribute("select-update"))(this.scope),this.onToggleAction=this.$parse(e.getAttribute("select-toggle"))(this.scope),this.filterAction=this.$parse(e.getAttribute("select-filter"))(this.scope),this.isItemAvailableAction=this.$parse(e.getAttribute("select-is-item-available"))(this.scope),this.itemGetTextAction=this.$parse(e.getAttribute("select-item-text"))(this.scope),this.withFilter=!!this.filterAction,this.modelString=e.getAttribute("select-model"),this.itemsString=e.getAttribute("select-items"),this.disabledString=e.getAttribute("select-disabled"),this.selectedString=e.getAttribute("select-selected"),this.validString=e.getAttribute("select-valid"),this.placeholderString=e.getAttribute("select-placeholder"),this.filterPlaceholderString=e.getAttribute("select-filter-placeholder"),this.scrollKind=e.getAttribute("select-scroll"),this.isImportant=!!e.getAttribute("select-important"),this.matchTemplateUrl=null!=(n=this.$parse(e.getAttribute("select-match-template"))(this.scope))?n:s.directiveTemplateUrl("select","select-match"),this.choiceTemplateUrl=null!=(n=this.$parse(e.getAttribute("select-choice-template"))(this.scope))?n:s.directiveTemplateUrl("select","select-choice"),t.querySelector("[tl-select-choice-transclude]")),n=(this.choiceTranscludeTpl=n.parentNode.removeChild(n),this.cssClass=this.$parse(e.getAttribute("select-class"))(this.scope),this.cssClass&&s.HtmlUtil.toggleClass(t,this.cssClass,!0),this.attachElement=this.$parse(e.getAttribute("attach-element"))(this.scope),s.HtmlUtil.toggleClass(t,"_with_filter",this.withFilter),s.HtmlUtil.toggleClass(t,"_without_filter",!this.withFilter),s.HtmlUtil.toggleClass(t,e.getAttribute("class"),!0),e.parentNode),o=e.nextSibling;n.removeChild(e),this.attachElement?this.attachElement.querySelector("[tl-select]")||this.attachElement.insertBefore(t,this.attachElement.firstChild):n.insertBefore(t,o),this.scope[this.placeholderVar]=this.placeholderString,this.update(),this.inline||this.attachEventListeners(),this.inline&&this.open(),this.onUpdateAction&&this.onUpdateAction(function(){i.update()})},e.prototype.toggle=function(){this.opened||this.disabled?this.close():this.open()},e.prototype.open=function(){var e,t,i,n,o;this.attachElement&&this.disabledString&&this.$parse(this.disabledString)(this.scope)||(this.compiled||(this.compileItems(),this.compiled=!0),this.inline||(e=this.element.querySelector("[tl-select-choices]"),t=this.element.querySelector("[tl-select-choices-transclude]"),e.style.width="auto",e.style.opacity="0",e.style.whiteSpace="nowrap",s.HtmlUtil.transform(e,"translate(-5000px, -5000px)"),s.HtmlUtil.toggleClass(e.querySelector("._active"),"_active",!1),i=e.querySelector("._selected"),s.HtmlUtil.toggleClass(i,"_active",!0),s.HtmlUtil.toggleClass(this.element,"_opened",!0),this.opened=!0,null!=(n=this.onToggleAction)&&n.call(this,!0),t.scrollHeight>t.clientHeight&&(t.style.overflowY="scroll"),n=e.offsetWidth+1,this.attachElement&&(n=this.attachElement.offsetWidth,(o=this.attachElement.querySelector("[select-wasteland]"))&&(n-=o.offsetWidth)),e.style.width=n+"px",e.style.opacity="1",e.style.whiteSpace="normal",t.style.overflowY="auto",this.fitOnScreen(),this.withFilter&&this.scope.$root.layout.desktop&&this.element.querySelector("[tl-select-filter]").focus(),this.scrollToSelected(i),this.popupManager.countUpOpenedPopup()))},e.prototype.close=function(){var e;if(s.HtmlUtil.toggleClass(this.element,"_opened",!1),this.opened=!1,null!=(e=this.onToggleAction)&&e.call(this,!1),this.withFilter){for(var t=this.element.querySelectorAll("[tl-select-choices-transclude] > *"),i=0;i<t.length;i++)s.HtmlUtil.toggleClass(t[i],"_filtered",!1);this.element.querySelector("[tl-select-filter]").value=""}this.popupManager.countDownOpenedPopup()},e.prototype.scrollToSelected=function(e){var t=this.element.querySelector("[tl-select-choices-transclude]");s.SelectHelper.scrollToSelected(t,e,this.scrollKind)},e.prototype.fitOnScreen=function(){var e=this.element.querySelector("[tl-select-match]"),t=this.element.querySelector("[tl-select-choices]");s.SelectHelper.fitOnScreen(e,t)},e.prototype.getItemText=function(e){return void 0===e||void 0===this.itemGetTextAction?e:this.itemGetTextAction(e)},c=e,s.registerDirective("tlSelect",t("select")),s.registerDirective("tlSelectInline",t("select-inline"))}(tl=tl||{}),tl.registerDirective("tlId",["$parse",function(n){var e=AppIntegration.getEnv();return""!=e&&"prod"!=e?{restrict:"A",scope:!1,replace:!1,template:"",link:function(i,e,t){t=t.tlId.replace(/\$\{([^\}]+)\}/g,function(e,t){return n(t)(i)});e.attr("tl-id",t)}}:{}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/currency-selector/currency-selector-select-choice.html","<div title=\"<%= $message('T:currency_selector_result.' + $item) %>\"> <%= $message('T:currency_selector_result.' + $item) %> </div>"),e.put("directives/currency-selector/currency-selector-select-match.html","<span class=\"x-currency-selector__currency\"><%= $message('T:currency_selector_selection.' + $selected) %></span>"),e.put("directives/currency-selector/currency-selector.html",'<div class="x-currency-selector" ng-if="layout.isVisible"><div tl-select select-model="currency.selected" select-items="supported" select-match-template="selectMatchTemplate" select-choice-template="selectChoiceTemplate" select-update="selectNotifier.notifier" select-change="update()"></div></div>')}),tl.registerDirective("tlCurrencySelector",["locale","translator","$q",function(t,i,n){var o=tl.BookingFormSettings.getInstance();return{restrict:"EA",scope:!0,replace:!0,templateUrl:"directives/currency-selector/currency-selector.html",controller:["$scope",function(e){e.selectMatchTemplate=tl.directiveTemplateUrl("currency-selector","currency-selector-select-match"),e.selectChoiceTemplate=tl.directiveTemplateUrl("currency-selector","currency-selector-select-choice"),e.selectNotifier=tl.NotifierHelper.subscribe(e,n,!0,!0),e.currency={selected:t.currencyId()},e.update=function(){AppIntegration.fireEvent(tl.AppIntegrationEvent.CurrencyChanged,{currency:e.currency.selected}),tl.TrackerService&&tl.TrackerService.track("currency",{id:e.currency.selected}),i.convert(e.currency.selected)},e.$watch(function(){return t.currencyId()},function(){e.currency.selected=t.currencyId(),e.selectNotifier.update()}),e.$watch(function(){return o.availableCurrencies.length},function(){e.supported=o.availableCurrencies.map(function(e){return e.id}),e.selectNotifier.update()})}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/header/header.html",'<header class="x-header" ng-show="showHeader" ng-class="{\'-without-gutter\': params.withoutGutter, \'-search-page\': params.searchFilterPageMode, \'-additional-gutter\': params.withAdditionalGutter}"><div tl-header-controls-panel params="params.controlsParams"></div><div tl-header-navigation-panel params="params.navigationParams"></div></header>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlHeader",[function(){return{scope:!0,transclude:!0,templateUrl:"directives/header/header.html",controller:["$scope",function(t){e.HeaderManager.getInstance().initScope(t),t.showHeader=!1,t.params={},t.show=function(e){t.showHeader=!0,t.params=e},t.hide=function(){t.showHeader=!1,t.params={}}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/header-controls-panel/header-controls-panel.html",'<div class="x-hcp" ng-show="showPanel"><div tl-promo-code-header tl-id="pch-p" class="x-hcp__control -promo-code-phone" ng-hide="hidePromoCodeInput" open-popover-on-invalid="verticalViewMode" light-view-mode="verticalViewMode"></div><div class="x-hcp__criteria-container"><div tl-select ng-if="params.updateAction && scheduleMode" select-model="schedule.selected" select-items="params.schedule" select-choice-template="selectChoiceTemplate" select-change="onScheduleChange($selected)" attach-element="getCriteriaInputElement()" select-disabled="!scheduleMode" select-toggle="onSelectToggle"></div><div tl-datepicker ng-if="params.updateAction && !scheduleMode" opened="calendar.opened" on-change="onDateChange" selected-start-date="params.checkInDate" selected-end-date="params.checkOutDate" disable-period="!criteriaWithPeriod()" is-start-date="true" hide-control="true" on-close="onClose" attach-element="getCriteriaInputElement()"></div><div class="x-hcp__criteria" rel="criteria-input" ng-click="changeDate()" ng-hide="hideCriteriaInput" ng-class="{\'-disabled\': disableCriteriaInput}"><div class="x-hcp__field"><div class="x-hcp__group" ng-class="{\'-dropdown\': params.updateAction && scheduleMode}"><svg ng-if="!(params.updateAction && scheduleMode)" class="x-hcp__icon"><use xlink:href="#calendar"></use></svg><div class="x-hcp__label" ng-if="!scheduleMode"><span class="nobr"><span ng-bind="criteriaWithPeriod() ? \'T:common.date_format_long\' : \'T:common.date_format_full\' | message: { date: params.checkInDate }"></span> <span ng-if="criteriaWithPeriod()">&nbsp;&mdash;&nbsp;</span> </span><span class="nobr" ng-if="criteriaWithPeriod()" ng-bind="\'T:common.date_format_long\' | message: { date: params.checkOutDate }"></span></div><div class="x-hcp__label" ng-if="scheduleMode"><span><span class="x-hcp__limited-name" ng-bind="schedule.selected.title + \'&nbsp;\'"></span> </span><span class="nobr"><span>(</span> <span class="nobr" ng-bind-html="\'T:common.date_period_short\' | message: {startDate: schedule.selected.stayPeriod.startDate, endDate: schedule.selected.stayPeriod.endDate} | tlUnsafe"></span> <span>)</span></span></div><svg ng-if="params.updateAction && scheduleMode" class="x-hcp__icon -dropdown" ng-class="{\'-opened\': selectOpened}"><use xlink:href="#arrow-drop-down"></use></svg></div><div class="x-hcp__group" ng-if="!isManualAccommodationMode()"><svg class="x-hcp__icon"><use xlink:href="#adult"></use></svg><div class="x-hcp__label"><span class="nobr"><span ng-bind="\'T:filter.rooms\' | message: { rooms: params.totalPlacements }"></span>,&nbsp;</span> <span class="nobr" ng-bind="\'T:rooms.guests\' | message: { guests: params.totalGuests }"></span></div></div></div><span ng-if="!disableCriteriaInput" class="tl-btn tl-btn_secondary x-hcp__button" ng-bind="scheduleMode ? \'T:common.change_schedule\' : criteriaWithPeriod() ? \'T:common.change_dates\' : \'T:common.change_date\' | message" select-wasteland></span></div></div><div class="x-hcp__controls" ng-hide="hidePageControls()" ng-class="{\'-without-gutter\': hideCriteriaInput, \'-without-guest\': hideGuestProfile}"><div tl-promo-code-header tl-id="pch-d" class="x-hcp__control -promo-code-desktop" ng-hide="hidePromoCodeInput" open-popover-on-invalid="!verticalViewMode" light-view-mode="verticalViewMode"></div><div tl-language-selector class="x-hcp__control" ng-hide="hideLanguageSelector" ng-class="{\'-disabled\': disableLanguageSelector}" title="{{\'T:tooltip.select_language\' | message}}"></div><div tl-currency-selector class="x-hcp__control" ng-hide="hideCurrencySelector" ng-class="{\'-disabled\': disableCurrencySelector}" title="{{\'T:tooltip.select_currency\' | message}}"></div><div class="x-hcp__control -guest" ng-hide="hideGuestProfile"><div tl-guest-log-in></div></div></div></div>'),e.put("directives/header-controls-panel/template/schedule-selector-select-choice.html","<div title=\"<%= $item.name %>\"> <%= $item.title %> &nbsp;(<%= $message('T:common.date_period_short', {startDate: $item.stayPeriod.startDate, endDate:\n  $item.stayPeriod.endDate}) %>)</div>")}),!function(d){d.directive||(d.directive={});d.registerDirective("tlHeaderControlsPanel",["$state","layout",function(n,o){return{restrict:"EA",scope:{params:"="},replace:!0,templateUrl:"directives/header-controls-panel/header-controls-panel.html",link:function(e,t){e.getCriteriaInputElement=function(){return t[0].querySelector('[rel="criteria-input"]')}},controller:["$scope","serviceFactory",function(l,e){function i(t){function e(e,t){void 0===t&&(t=!1),l.hideLanguageSelector=!e||!1===c.showLanguageControl,l.disableLanguageSelector=t}function i(e,t){void 0===t&&(t=!1),l.hideCurrencySelector=!e||!1===c.showCurrencyControl,l.disableCurrencySelector=t}function n(e){l.hidePromoCodeInput=!e||!0!==c.displayPromoCodeBlock}function o(e){l.hideGuestProfile=!e||!c.hasPersonalDiscounts()}function r(e){l.showPanel=e}function a(e){l.disableCriteriaInput=!e,l.hideCriteriaInput=t==d.AppState.SearchFilter||!l.params||!l.params.checkInDate,l.calendar.opened=u=!1}var s;r(!0),e(!1),i(!1),n(!1),o(!1),a(!1),l.schedule=null,l.scheduleMode=!1,l.params&&l.params.schedule&&l.params.schedule.length&&((s=_.find(l.params.schedule,function(e){return e.stayPeriod.startDate.isEqualDate(l.params.checkInDate)&&e.stayPeriod.endDate.isEqualDate(l.params.checkOutDate)}))&&(l.schedule={selected:s},l.scheduleMode=!0)),_.includes([d.AppState.RoomList,d.AppState.Complete,d.AppState.EditBooking,d.AppState.EditBooking_RestoreBooking,d.AppState.EditBooking_ApproveBooking,d.AppState.EditBooking_RestoreBookingSuccess,d.AppState.EditBooking_ApproveBookingSuccess,d.AppState.EditBooking_ChangeCard,d.AppState.EditBooking_DeferredPayment,d.AppState.EditBookingDates_Confirm,d.AppState.EditBookingDates_Calendar,d.AppState.EditBookingDates_Result,d.AppState.EditBookingRoomType_Result,d.AppState.EditBookingRoomType_RoomsCommon,d.AppState.EditBookingRoomType_RoomsSharedRoom,d.AppState.EditBookingRoomType_Confirm,d.AppState.EditBookingRoomType_NoRooms,d.AppState.EditBookingDates_Result,d.AppState.EditBookingRatePlan_Result,d.AppState.EditBookingRatePlan_RatesCommon,d.AppState.EditBookingRatePlan_RatesSharedRoom,d.AppState.EditBookingRatePlan_Confirm,d.AppState.EditBookingRatePlan_NoRates,d.AppState.EditBookingOptions_Result,d.AppState.EditBookingOptions_Options,d.AppState.EditBookingOptions_Confirm,d.AppState.EditBookingOptions_NoOptions,d.AppState.EditBookingDeleteRoom,d.AppState.EditBookingDeleteRoom_Result,d.AppState.EditBookingDeleteRoom_Confirm,d.AppState.EditBookingPaymentAwait,d.AppState.EditBookingPaymentFailed,d.AppState.EditBookingPaymentInternal,d.AppState.EditBookingPaymentPopup,d.AppState.EditBookingPaymentResult,d.AppState.EditBookingPaymentSucceed,d.AppState.PaymentResult,d.AppState.PaymentPopup,d.AppState.PaymentFailed,d.AppState.PaymentAwait,d.AppState.PaymentInternal,d.AppState.Error,d.AppState.MirRegister],t)&&r(!1),_.includes([d.AppState.Rooms,d.AppState.Rooms_Grid,d.AppState.Rooms_List,d.AppState.Rooms_FilteredList,d.AppState.NoRooms,d.AppState.RoomsGuestAccommodation,d.AppState.RatePlansGuestAccommodation,d.AppState.SharedRatePlans,d.AppState.SharedRatePlans_FilteredList,d.AppState.SharedRatePlans_List,d.AppState.RoomsSearchCriteria,d.AppState.RoomsSearchCriteria_All,d.AppState.RoomsSearchCriteria_Filtered,d.AppState.RoomsSearchCriteria_NoRooms],t)&&(i(!0),e(!0),n(!0),a(!0),o(!0)),_.includes([d.AppState.RoomInfo],t)&&n(!0),_.includes([d.AppState.SearchFilter,d.AppState.SharedRooms,d.AppState.SharedRooms_List,d.AppState.SharedRooms_FilteredList,d.AppState.RoomInfo,d.AppState.Preview,d.AppState.PriceList,d.AppState.Payment],t)&&(e(!0,_.includes([d.AppState.Preview,d.AppState.Payment],t)),i(!0,_.includes([d.AppState.Payment],t))),_.includes([d.AppState.Auth,d.AppState.Survey],t)&&e(!0),_.includes([d.AppState.RoomInfo,d.AppState.Preview,d.AppState.Payment,d.AppState.SharedRooms,d.AppState.SharedRooms_List,d.AppState.SharedRooms_FilteredList],t)&&o(!0),l.hideCriteriaInput&&l.hideLanguageSelector&&l.hideCurrencySelector&&l.hidePromoCodeInput&&l.hideGuestProfile&&r(!1)}var c=d.BookingFormSettings.getInstance(),u=!1,t=(l.layout=o,l.guestProfileService=e.guestProfileService,l.calendar={opened:u},l.selectOpened=!1,l.onScheduleChange=function(e){var t,i;null!=(i=(t=l.params).updateAction)&&i.call(t,e.stayPeriod.startDate,e.stayPeriod.endDate)},l.onDateChange=function(e,t){var i,n;l.calendar.opened=u=!1,null!=(n=(i=l.params).updateAction)&&n.call(i,e,t)},l.onSelectToggle=function(e){l.$applyAsync(function(){l.selectOpened=e})},l.changeDate=function(){l.disableCriteriaInput||(l.params.updateAction?l.calendar.opened=u=!u:(n.go(d.AppState.SearchFilter),d.util.IntegrationEvent.trackClick(d.AppIntegrationEvent__TrackUserAction__ClickTarget.RoomsChangeSearchButton)))},l.onClose=function(){l.calendar.opened=u=!1},l.isManualAccommodationMode=function(){return c.originalAccommodationMode==d.AccommodationMode.Manual||c.isModeTurnedOn(d.BookingFormMode.SharedAccommodationRatePlan)&&!c.isModeTurnedOn(d.BookingFormMode.SharedRoomView)||c.isCampBookingForm()},l.criteriaWithPeriod=function(){return!c.isServicesBookingForm()||c.isServicesWithPeriod()},l.selectChoiceTemplate=d.directiveTemplateUrl("header-controls-panel/template","schedule-selector-select-choice"),l.hidePageControls=function(){return l.hideCurrencySelector&&l.hideLanguageSelector&&l.hidePromoCodeInput&&l.hideGuestProfile},l.$on("$stateChangeSuccess",function(e,t){i(t.name)}),l.$on(d.BroadcastEvent.WindowSizeChanged,function(){i(n.current.name)}),l.$watch(function(){return c.displayPromoCodeBlock},function(){i(n.current.name)}),l.$watchCollection(function(){return l.params},function(){_.isNull(l.params)||i(n.current.name)}),_.throttle(function(){var e=window.innerWidth||document.documentElement.clientWidth;l.verticalViewMode=e<720},50));t(),angular.element(window).bind(d.EventType.Resize,t),l.$on("$destroy",function(){angular.element(window).unbind(d.EventType.Resize,t)})}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/promo-code/promo-code-button.html",'<div><div class="tl-btn-light" tl-popover content-generator-action="getPromoCodeNode()" event="click" force-redraw="true" popover-opened="::(promoCodePopover.shown && !applied)" element-position="center top" popover-position="right+25% bottom"><span tl-message="\'T:promo.introduce_inline\'"></span></div></div>'),e.put("directives/promo-code/promo-code-header.html",'<div class="x-pch" ng-form="promoCodeForm"><div ng-if="showSberbankInput" class="x-pch__link -sberbank" ng-class="{\'-applied\': applied}" tl-popover attach-element="getIconElement(true)" content-generator-action="getPromoCodeNode(true)" event="click" force-redraw="true" popover-opened="promoCodePopover.shown" element-position="center top" popover-position="right+25% bottom"><div class="x-pch__icon" ng-class="{\'-light\': lightViewMode}" rel="icon-sberbank"><svg><use xlink:href="#sberbank"></use></svg></div><div class="x-pch__label"><span ng-if="!applied" ng-bind-html="\'T:promo.sberbank_open\' | message | tlUnsafe"></span> <span ng-if="applied" ng-bind-html="\'T:promo.sberbank_reset\' | message | tlUnsafe"></span></div></div><div class="x-pch__link link -without-underline" ng-class="{\'-applied\': applied}" tl-popover attach-element="getIconElement()" content-generator-action="getPromoCodeNode()" event="click" force-redraw="true" popover-opened="promoCodePopover.shown" element-position="center top" popover-position="right+25% bottom"><div class="x-pch__icon" ng-class="{\'-light\': lightViewMode, \'-with-discount -applied\': discountValue && !lightViewMode}" rel="icon"><svg ng-if="!applied"><use xlink:href="#lock"></use></svg> <svg ng-if="applied"><use xlink:href="#unlock"></use></svg><div class="x-pch__spinner spinner -type-completed -animate" ng-if="discountValue && !lightViewMode"></div><div class="x-pch__pin pin -light" ng-if="discountValue && !lightViewMode && !validStayPeriods.length" ng-bind-html="\'T:promo.badge_discount\' | message:{value: discountValue} | tlUnsafe"></div><svg class="x-pch__indicator -error" ng-class="{\'-error\': indicatorType === IndicatorType.error, \'-warning\': indicatorType === IndicatorType.warning}" ng-if="indicatorType && !lightViewMode"><use xlink:href="#warning"></use></svg></div><div class="x-pch__label" ng-class="{\'-page-control\': isPageControl}"><span ng-if="!applied" ng-bind-html="\'T:promo.introduce\' | message | tlUnsafe"></span> <span ng-if="applied" ng-bind-html="\'T:promo.reset\' | message | tlUnsafe"></span></div></div></div>')}),function(){function e(){}return e.error="error",e.warning="warning",e}()),scInformer=tl.SearchCriteriaInformer.getInstance(),scPromoCode=null,scInvalidPromoCode=null,popoverOpened=!1,scCreatedMainCallable={callback:function(e){scPromoCode=e.searchCriteria.promoCode}},scAppliedMainCallable=(scInformer.subscribe(scCreatedMainCallable,tl.SearchCriteriaInformerMessageType.CreateSearchCriteria),{callback:function(e){scPromoCode=e.promoCode}}),scInvalidMainCallable=(scInformer.subscribe(scAppliedMainCallable,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),{callback:function(e){scInvalidPromoCode=e.promoCode}}),tlPromoCodeDirective=(scInformer.subscribe(scInvalidMainCallable,tl.SearchCriteriaInformerMessageType.InvalidPromoCode),function(e){return["$q","$compile","$state","overlay","serviceFactory",function(s,l,c,u,d){return{scope:{showSberbankInput:"=?",openPopoverOnInvalid:"=?",lightViewMode:"=?",isPageControl:"=?"},replace:!0,templateUrl:e,controller:["$scope",function(i){function t(){var t={callback:function(e){u.off(),scInformer.unsubscribe(t,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.unsubscribe(t,tl.SearchCriteriaInformerMessageType.InvalidPromoCode)}};u.on(),scInformer.subscribe(t,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.subscribe(t,tl.SearchCriteriaInformerMessageType.InvalidPromoCode)}function n(){var e,t;i.discountValue=null,i.indicatorType=null,i.applied?(e=a())&&(t=r(),tl.PromotionUtil.isPromotionApplicableForPeriod(e,t.stayPeriod())&&!tl.PromotionUtil.isPromotionAppliedForPartialPeriod(e,t.stayPeriod())&&tl.PromotionUtil.isPromotionApplicableForRoomTypes(e,t.roomTypeIds)&&tl.PromotionUtil.isPromotionApplicableForRatePlans(e,t.ratePlansIds)?(i.validStayPeriods=[],i.discountValue=e.discountValue):(i.indicatorType=IndicatorType.warning,i.openPopoverOnInvalid&&!popoverOpened&&(i.promoCodePopover.shown=!0))):i.showError&&(i.indicatorType=IndicatorType.error)}var o=d.bootstrapService.preparePromise,r=(i.IndicatorType=IndicatorType,i.applied=!1,i.showError=!1,i.indicatorType=null,i.promoCodePopover={shown:null},i.validStayPeriods=[],function(){return d.bookingService.getSearchCriteria()}),a=function(){var e=tl.PromotionUtil.getPromotions(tl.DiscountType.PromotionCode);return tl.PromotionUtil.getMostValuablePromotionForPeriod(e,r().stayPeriod())||tl.PromotionUtil.getMostValuablePromotion(e)};i.applyPromoCode=function(){i.promoCode&&(t(),scInformer.notify(tl.SearchCriteriaInformerMessageType.ApplyPromoCode,{promoCode:i.promoCode}))},i.resetPromoCode=function(e){void 0!==e&&e.stopPropagation(),i.promoCodePopover.shown=!1,t(),scInformer.notify(tl.SearchCriteriaInformerMessageType.ApplyPromoCode,{promoCode:""})},i.onPromoCodeApplied=function(e){i.applied=!!e,i.promoCodePopover.shown=!1,n(),i.$applyAsync()},i.onInvalidPromoCodeApplied=function(e){i.applied=!1,e&&(i.promoCode=e,i.showError=!0,i.openPopoverOnInvalid&&!popoverOpened&&(i.promoCodePopover.shown=!0)),n(),i.$applyAsync()},i.getPromoCodeNode=function(e){i.validStayPeriods=[],i.preselectedRoomsWithoutPromotion=[],i.preselectedRatesWithoutPromotion=[],i.isSberbankCode=e,popoverOpened=!0;var t,e=a();return e&&(t=r(),tl.PromotionUtil.isPromotionApplicableForPeriod(e,t.stayPeriod())||(i.validStayPeriods=tl.PromotionUtil.getNearestValidStayPeriods(e.stayPeriods,t.stayPeriod(),4)),tl.PromotionUtil.isPromotionAppliedForPartialPeriod(e,t.stayPeriod())&&(i.validStayPeriods=tl.PromotionUtil.getNearestValidStayPeriods(e.stayPeriods,t.stayPeriod(),4)),tl.PromotionUtil.isPromotionApplicableForRoomTypes(e,t.roomTypeIds)||(i.preselectedRoomsWithoutPromotion=tl.directive.helper.PromoCodeHelper.getRoomTypesNames(t.roomTypeIds,d.serviceStorage)),tl.PromotionUtil.isPromotionApplicableForRatePlans(e,t.ratePlansIds)||(i.preselectedRatesWithoutPromotion=tl.directive.helper.PromoCodeHelper.getRatePlansNames(t.ratePlansIds,d.serviceStorage))),o.then(function(){return s.when(function(){return l('<tl-promo-code-popover promo-code="promoCode" applied="applied" apply-action="applyPromoCode()" reset-action="resetPromoCode()" show-error="showError" is-sberbank-code="isSberbankCode" valid-stay-periods="validStayPeriods" preselected-rooms-without-promotion="preselectedRoomsWithoutPromotion" preselected-rates-without-promotion="preselectedRatesWithoutPromotion"  />')(i)[0]})})}}],link:function(t,i,e){t.getIconElement=function(e){return i[0].querySelector('[rel="'+(e?"icon-sberbank":"icon")+'"]')};var n={callback:function(e){t.showError=!1,scInvalidPromoCode=null,scPromoCode=e.searchCriteria.promoCode,t.promoCode=e.searchCriteria.promoCode,t.promoCode&&t.onPromoCodeApplied(t.promoCode)}},o=(scInformer.subscribe(n,tl.SearchCriteriaInformerMessageType.CreateSearchCriteria),scInformer.unsubscribe(scCreatedMainCallable,tl.SearchCriteriaInformerMessageType.CreateSearchCriteria),{callback:function(e){t.showError=!1,scInvalidPromoCode=null,scPromoCode=e.promoCode,t.promoCode=e.promoCode,tl.directive.helper.StateHelper.reloadPage(c),d.orderService.cleanOrder(),t.onPromoCodeApplied(e.promoCode)}}),r=(scInformer.subscribe(o,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.unsubscribe(scAppliedMainCallable,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),{callback:function(e){t.showError=!1,scInvalidPromoCode=e.promoCode,(scPromoCode=null)&&(tl.directive.helper.StateHelper.reloadPage(c),d.orderService.cleanOrder()),t.onInvalidPromoCodeApplied(e.promoCode)}}),a=(scInformer.subscribe(r,tl.SearchCriteriaInformerMessageType.InvalidPromoCode),scInformer.unsubscribe(scInvalidMainCallable,tl.SearchCriteriaInformerMessageType.InvalidPromoCode),{callback:function(e){t.showError=!1,t.promoCode=e.promoCode,t.indicatorType=null,t.promoCode||(t.applied=!1)}});scInformer.subscribe(a,tl.SearchCriteriaInformerMessageType.SynchronizePromoCode),scPromoCode&&(t.promoCode=scPromoCode,t.onPromoCodeApplied(scPromoCode)),scInvalidPromoCode&&t.onInvalidPromoCodeApplied(scInvalidPromoCode);t.$on("$destroy",function(){scInformer.unsubscribe(n,tl.SearchCriteriaInformerMessageType.CreateSearchCriteria),scInformer.unsubscribe(scCreatedMainCallable,tl.SearchCriteriaInformerMessageType.CreateSearchCriteria),scInformer.unsubscribe(o,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.unsubscribe(scAppliedMainCallable,tl.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.unsubscribe(r,tl.SearchCriteriaInformerMessageType.InvalidPromoCode),scInformer.unsubscribe(scInvalidMainCallable,tl.SearchCriteriaInformerMessageType.InvalidPromoCode),scInformer.unsubscribe(a,tl.SearchCriteriaInformerMessageType.SynchronizePromoCode)})}}}]}),tl,tl,tl,tl,tl,tl,tl,tl,_this=(tl.registerDirective("tlPromoCodeHeader",tlPromoCodeDirective(tl.directiveTemplateUrl("promo-code","promo-code-header"))),tl.registerDirective("tlPromoCodeButton",tlPromoCodeDirective(tl.directiveTemplateUrl("promo-code","promo-code-button"))),tl.registerTemplate(function(e){"use strict";e.put("directives/popover/popover.html",'<div class="x-popover -type-{{type}} -position-{{position}}" ng-class="{\'-active\': loaded}"><div class="x-popover__pointer"></div><div class="x-popover__wrapper" ng-class="{\'-with-button\': showCloseButton}"><div class="x-popover__close" ng-if="showCloseButton" ng-click="toggle(false)" rel="popover-close"><svg><use xlink:href="#cancel"></use></svg></div><div class="x-popover__content" ng-class="{\'-overflow\': popoverOverflow}" rel="content"></div></div></div>')}),!function(h){var e,f,v;function t(){}e=h.directive||(h.directive={}),(e=f=e.PopoverEventType||(e.PopoverEventType={})).Click="click",e.Hover="hover",e.None="none",t.Default="default",t.Calendar="calendar",t.Onboarding="onboarding",t.Motivator="motivator",v=t,h.registerDirective("tlPopover",["$templateCache","$compile","$timeout",function(d,p,m){var g=null;return{restrict:"A",scope:{contentGeneratorAction:"&",attachElement:"=?",event:"@",elementPosition:"@",popoverPosition:"@",type:"@",popoverDisabled:"=",popoverOpened:"=",showCloseButton:"=?",forceRedraw:"=?",popoverChanged:"&?",popoverOverflow:"=?",popoverPropagation:"=?"},replace:!1,link:function(n,t){function o(){return n.attachElement||t[0]}function e(){n.setPosition(),a||angular.element(window).off(h.EventType.Resize,e)}function i(e){s=e.target}function r(e){e.target!=s||!n.isShown||t[0].contains(e.target)||a.contains(e.target)||n.react(e)}var a,s,l=document.querySelector(".tl-container"),c=h.PopupManager.instance,u=(n.isShown=!1,n.loaded=!1,n.popoverOverflow=!!_.isUndefined(n.popoverOverflow)||n.popoverOverflow,n.showCloseButton=_.isUndefined(n.showCloseButton)?n.event==f.Click:n.showCloseButton,n.type=_.isUndefined(n.type)||!_.includes([v.Calendar,v.Onboarding,v.Motivator],n.type)?v.Default:n.type,_.forEach(["right","left","top","bottom"],function(e){0<=n.elementPosition.indexOf(e)&&(n.position=e)}),n.setPosition=function(){var e,t,i;a?n.isShown&&!function(e){e=e.getBoundingClientRect();return 0===e.left&&0===e.top&&0===e.width&&0===e.height}(o())?(e=a.querySelector(".x-popover__pointer"),t=h.PositionHelper.position(a,o(),n.popoverPosition,n.elementPosition,n.event!==f.None),a.style.left=t.left+"px",a.style.top=t.top+"px",t=a.getBoundingClientRect(),i=o().getBoundingClientRect(),e.style.left=Math.min(t.width-20,i.left-t.left+i.width/2)+"px",n.position=t.top>i.top?"top":"bottom"):(a.style.top="-10000px",a.style.left="-10000px"):n.isShown=!1},n.watchResize=function(){angular.element(window).on(h.EventType.Resize,e)},n.watchSize=function(){var e=n.$watchCollection(function(){var e;return a?(e=a.getBoundingClientRect(),[n.isShown,Math.round(e.width),Math.round(e.height)]):[!1,0,0]},function(){m(function(){n.setPosition()},50),a||e()})},n.toggle=function(e,t){a||n.compile(),n.event==f.Click?g?g===n?e=!n.isShown:g!==n&&g.event==f.Hover&&(g.isShown=!1,g=n,e=!0):(g=n,e=!0):n.event==f.Hover&&(g&&g.event==n.event?g===n?(g.isShown=!g.isShown,t==f.Click&&(e=g.isShown)):g!==n&&(g.event==f.Hover?(g.isShown=!1,g=n,e=!0):0==g.isShown?g=n:e=!1):(g=n,e=!0)),n.isShown=(!n.isShown||e)&&!1!==e&&!n.popoverDisabled,!n.isShown&&n.forceRedraw&&(n.loaded=!1,a.parentNode.removeChild(a),a=null),null!=(t=n.popoverChanged)&&t.call(n,{opened:n.isShown})},n.react=function(e){e.target.closest('[rel="popover-close"]')||(e.type==h.EventType.MouseOver||e.type==h.EventType.MouseOut?n.toggle(e.type==h.EventType.MouseOver,e.type):n.toggle(void 0,e.type),n.$digest())},angular.element(document.body).on([h.EventType.MouseDown,h.EventType.TouchStart].join(" "),i),angular.element(document.body).on([h.EventType.MouseUp,h.EventType.TouchEnd].join(" "),r),"static"==t[0].style.position&&(t[0].style.position="relative"),_.debounce(n.react,300));n.bindEvents=function(){n.event!=f.None&&(n.event==f.Hover?t.on(h.EventType.MouseOver,u).on(h.EventType.MouseOut,u).on(h.EventType.Click,u):t.on(h.EventType.Click,n.react))},n.bindEvents(),n.compile=function(){var e=d.get("directives/popover/popover.html"),t=(a=angular.element(p(e)(n))[0],l.appendChild(a),n.event==f.Hover&&angular.element(a).on(h.EventType.MouseOver,u).on(h.EventType.MouseOut,u),n.popoverPropagation||angular.element(a).on(h.EventType.Click,function(e){e.stopPropagation()}),a.querySelector('[rel="content"]'));n.type!==v.Calendar&&(t.style.maxHeight=AppIntegration.getPosition().screenHeight/1.5+"px"),n.contentGeneratorAction().then(function(e){m(function(){t.appendChild(e()),n.loaded=!0,n.watchSize(),n.watchResize()},0)})},n.$watch("popoverOpened",function(){n.popoverDisabled||null!=n.popoverOpened&&m(function(){n.isShown!=n.popoverOpened&&n.toggle(n.popoverOpened),n.popoverOpened=null},0)}),n.$watch("isShown",function(e,t){null!==n.isShown&&e!==t&&(n.isShown?c.countUpOpenedPopup():c.countDownOpenedPopup())}),n.$watch("popoverDisabled",function(e,t){e&&!1===t&&n.toggle(n.popoverOpened)}),n.$on("$destroy",function(){angular.element(window).off(h.EventType.Resize,e),angular.element(document.body).off([h.EventType.MouseUp,h.EventType.TouchEnd].join(" "),r),angular.element(document.body).off([h.EventType.MouseDown,h.EventType.TouchStart].join(" "),i),a&&(a.parentNode.removeChild(a),a=null)})}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/promo-code-popover/promo-code-popover.html",'<div class="x-pcp -new" ng-form="promoCodeForm"><label class="x-popover__title" for="promoCodeField" tl-message="isSberbankCode ? \'T:promo.popover_sberbank_title\' : \'T:promo.popover_title\'"></label><div class="x-pcp__form"><div class="x-pcp__field"><div class="x-pcp__field-icon"><svg><use xlink:href="#lock"></use></svg></div><input tl-pattern="noEmoji" class="x-pcp__input form-control" id="promoCodeField" autocomplete="off" ng-model="promoCode" name="{{promoCodeInputName}}" ng-keyup="$event.keyCode == 13 && submit()" ng-change="onValueChanged()" ng-attr-placeholder="{{\'T:promo.placeholder\' | message}}" ng-disabled="applied" maxlength="100"></input></div><div class="tl-message -type-error x-pcp__message" ng-if="showError" tl-message="\'T:promo.invalid\'" message-html="true"></div><div class="tl-message -type-alert x-pcp__message" ng-if="getNearestValidStayPeriods().length || preselectedRoomsWithoutPromotion.length || preselectedRatesWithoutPromotion.length"><div class="bold" tl-message="\'T:promo.applied_with_restrictions\'"></div><div class="x-pcp__restriction" ng-if="preselectedRoomsWithoutPromotion.length" tl-message="\'T:promo.invalid_room_types\'" message-params="{roomTypes: preselectedRoomsWithoutPromotion, roomTypesAmount: preselectedRoomsWithoutPromotion.length}"></div><div class="x-pcp__restriction" ng-if="preselectedRatesWithoutPromotion.length" tl-message="\'T:promo.invalid_rate_plans\'" message-params="{ratePlans: preselectedRatesWithoutPromotion, ratePlansAmount: preselectedRatesWithoutPromotion.length}"></div><div ng-if="getNearestValidStayPeriods().length"><div tl-message="\'T:promo.invalid_stay_periods\'" message-html="true"></div><div ng-repeat="nearestValidStayPeriod in getNearestValidStayPeriods()"><span ng-if="nearestValidStayPeriod.endDate" tl-message="\'T:common.date_period\'" message-params="{startDate: nearestValidStayPeriod.startDate, endDate: nearestValidStayPeriod.endDate}" message-html="true"></span><span ng-if="!nearestValidStayPeriod.endDate" tl-message="\'T:common.date_period_endless\'" message-params="{startDate: nearestValidStayPeriod.startDate}"> </span><span ng-if="$last && getAdditionalValidStayPeriods().length && !periodsOpened">...</span><span ng-if="!$last">&#32;</span></div><div tl-accordion class="x-pcp__accordion" ng-if="getAdditionalValidStayPeriods().length" is-collapsed="!periodsOpened"><div ng-repeat="additionalValidStayPeriod in getAdditionalValidStayPeriods()"><span ng-if="additionalValidStayPeriod.endDate" tl-message="\'T:common.date_period\'" message-params="{startDate: additionalValidStayPeriod.startDate, endDate: additionalValidStayPeriod.endDate}" message-html="true"></span><span ng-if="!additionalValidStayPeriod.endDate" tl-message="\'T:common.date_period_endless\'" message-params="{startDate: additionalValidStayPeriod.startDate}"> </span><span>&#32;</span></div></div><div class="x-pcp__message-actions"><a class="link c1 -normal" ng-click="togglePeriods()" ng-if="getAdditionalValidStayPeriods().length"><span ng-if="!periodsOpened" tl-message="\'T:common.show\'"></span> <span ng-if="periodsOpened" tl-message="\'T:common.hide\'"></span></a></div></div></div><span class="x-pcp__btn tl-btn tl-btn_size_small tl-btn_on_popup" ng-class="{\'tl-btn_state_disabled\': !promoCode}" ng-if="!applied" ng-click="submit()"><span class="x-pcp__apply" tl-message="\'T:promo.apply\'"></span> </span><span class="x-pcp__btn tl-btn-light tl-btn_size_small tl-btn-light_on_popup" ng-if="applied" ng-click="reset()"><span class="x-pcp__apply" tl-message="\'T:promo.reset_short\'"></span></span></div><div class="x-pcp__tooltip" ng-init="initContactInfo()" ng-if="isSberbankCode" tl-message="\'T:promo.sberbank_info\' | message:  {email: email, phone: phone} | tlUnsafe" message-html="true"></div></div>')}),!function(n){var e;n.directive||(n.directive={});n.registerDirective("tlPromoCodePopover",(e=n.directiveTemplateUrl("promo-code-popover"),["serviceFactory",function(i){return{restrict:"AE",templateUrl:e,scope:{promoCode:"=?",applied:"=",applyAction:"&",resetAction:"&",showError:"=?",isSberbankCode:"=?",validStayPeriods:"=",preselectedRoomsWithoutPromotion:"=",preselectedRatesWithoutPromotion:"="},controller:["$scope",function(t){t.promoCodeInputName=_.uniqueId("promoCodeField"),t.periodsOpened=!1,t.getNearestValidStayPeriods=function(){return _.slice(t.validStayPeriods,0,2)},t.getAdditionalValidStayPeriods=function(){return _.slice(t.validStayPeriods,2)},t.submit=function(){t.promoCode&&t.applyAction()},t.reset=function(){t.resetAction()},t.onInvalidPromoCodeApplied=function(){t.setValidity(!1)},t.onValueChanged=function(e){void 0===e&&(e=!0),t.setValidity(!0),e&&scInformer.notify(n.SearchCriteriaInformerMessageType.SynchronizePromoCode,{promoCode:t.promoCode})},t.initContactInfo=function(){t.email="",t.phone="";function e(){i.serviceStorage.provider&&i.serviceStorage.provider.contactInfo&&(t.email=i.serviceStorage.provider.contactInfo.email(),t.phone=i.serviceStorage.provider.contactInfo.phone())}e(),t.email&&t.phone||t.$watch(function(){return i.serviceStorage.provider&&i.serviceStorage.provider.contactInfo?i.serviceStorage.provider.contactInfo.email()+i.serviceStorage.provider.contactInfo.phone():null},function(){e()})},t.togglePeriods=function(){return t.periodsOpened=!t.periodsOpened}}],link:function(t){t.setValidity=function(e){t.promoCodeForm&&t.promoCodeForm[t.promoCodeInputName]&&(t.promoCodeForm.$setSubmitted(),t.promoCodeForm[t.promoCodeInputName].$setValidity("invalid-code",e))};var e={callback:function(e){t.onInvalidPromoCodeApplied(e.promoCode)}},i=(scInformer.subscribe(e,n.SearchCriteriaInformerMessageType.InvalidPromoCode),{callback:function(e){t.promoCode=e.promoCode,t.onValueChanged(!1)}});scInformer.subscribe(i,n.SearchCriteriaInformerMessageType.SynchronizePromoCode),scInformer.unsubscribe(i,n.SearchCriteriaInformerMessageType.SynchronizePromoCode),t.$on("$destroy",function(){scInformer.unsubscribe(e,n.SearchCriteriaInformerMessageType.InvalidPromoCode),scInformer.unsubscribe(i,n.SearchCriteriaInformerMessageType.SynchronizePromoCode)})}}}]))}(tl=tl||{}),!function(e){e.directive||(e.directive={});e.registerDirective("tlPattern",[function(){return{restrict:"EA",require:"ngModel",link:function(e,t,i,n){var o,r=/[!?@#$%^&*()/_+\\\[\]{}><]/g;try{o=new RegExp("(\\p{Emoji_Presentation}|\\p{Extended_Pictographic}|️)","gu")}catch(e){}function a(e){if(_.isUndefined(e)||null===e)return"";var t=e.toString();return _.forEach(s,function(e){t=t.replace(e,"")}),t!=e&&(n.$setViewValue(t),n.$render()),t}var s={name:[r,/[0-9]/g,/[,.:;]/g,o],address:[o,r],noEmoji:[o],number:[/[^0-9]/g]}[i.tlPattern]||[new RegExp("")];n.$parsers.push(a),n.$formatters.push(a)}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/accordion/accordion.html",'<div class="x-accordion"><div class="x-accordion__content"><div ng-if="isForceRender" ng-transclude></div></div></div>')}),tl.registerDirective("tlAccordion",[function(){return{restrict:"EA",templateUrl:"directives/accordion/accordion.html",scope:{isCollapsed:"=?"},replace:!0,transclude:!0,controller:["$scope",function(e){e.isForceRender=!1}],link:function(o,e){var r,a=e[0],s=e[0].querySelector(".x-accordion__content");a.style.height=o.isCollapsed?"0":"auto",o.toggle=function(){var i,n;window.requestAnimationFrame&&window.cancelAnimationFrame?(n=function(e){var t=i?e-i:5,e=(i=e,a.offsetHeight+(o.isCollapsed?-t:t));a.style.overflow=e>s.offsetHeight?"visible":"hidden",e<0?a.style.height="0px":e>s.offsetHeight?a.style.height="auto":(a.style.height=e+"px",r=requestAnimationFrame(n))},cancelAnimationFrame(r),r=requestAnimationFrame(n)):o.isCollapsed?(a.style.height="0px",a.style.overflow="hidden"):(a.style.height="auto",a.style.overflow="visible")},o.$watch(function(){return o.isCollapsed},function(e,t){o.isForceRender||(o.isForceRender=!o.isCollapsed),e!=t&&o.toggle()},!0)}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/datepicker/calendar-base/calendar-base.html",'<div class="x-dcb"><div class="x-dcb__month-name"><span month-name><%= monthName %></span></div> <% if (!verticalMode) { %> <div class="x-dcb__week-day-names"> <% _.each(weekDayNames, function (weekDay) { %> <div class="x-dcb__week-day-name <%= weekDay.modifier %>"><span><%= weekDay.name %></span></div> <% }) %> </div> <% } %> <div class="x-dcb__weeks"> <% _.each(weeks, function (week, weekIdx) { %> <div class="x-dcb__week"> <% _.each(week, function (day, dayIdx) { %> <% if (day) { %> <div class="x-dcb__day<%= getCustomClass(dayIdx, weekIdx, weeks) %>" tl-id="d-<%=formatDate(day)%>" data-date="<%=formatDate(day)%>"><div class="x-dcb__day-date"><span><%= day.getDate() %></span></div><div class="x-dcb__day-info"><div class="x-dcb__day-text" date-text></div><svg class="x-dcb__day-disabled-icon"><use icon-with-price xlink:href="#delete"></use><use icon-without-price xlink:href="#delete-thin"></use></svg></div> <% if (!verticalMode) { %> <div class="tooltip tooltip_position_bottom tooltip_position_center x-dcb__tooltip" date-tooltip><div class="tooltip__content x-dcb__tooltip-content"></div></div> <% } %> </div> <% } else { %> <span class="x-dcb__day<%= getCustomClass(dayIdx, weekIdx, weeks) %>"></span> <% } %> <% }) %> </div> <% }) %> </div></div>'),e.put("directives/datepicker/datepicker-manager/datepicker-manager.html",'<div class="x-dtm"> <% if (caption) { %> <div class="x-dtm__caption -horizontal"><div class="x-dtm__caption-icon"><svg><use xlink:href="#info-invert"></use></svg></div><div class="x-dtm__caption-text"><%= caption %></div></div> <% } %> <div class="x-dtm__content"><div class="tl-btn-light tl-btn-light_on_popup tl-btn-light_transparent tl-btn-light_icon-only x-dtm__prev" prev-month-btn><svg class="tl-btn-light__icon"><use xlink:href="#arrow-back"></use></svg></div><div class="tl-btn-light tl-btn-light_on_popup tl-btn-light_transparent tl-btn-light_icon-only x-dtm__next" next-month-btn><svg class="tl-btn-light__icon"><use xlink:href="#arrow-forward"></use></svg></div><div class="x-dtm__header" header rel="heading"><div class="x-dtm__header-label<% if (caption) { %> -with-caption<% } %>" header-month-name></div> <% if (caption) { %> <div class="x-dtm__caption -vertical"><div class="x-dtm__caption-icon"><svg><use xlink:href="#info-invert"></use></svg></div><div class="x-dtm__caption-text"><%= caption %></div></div> <% } %> <div class="x-dtm__week-day-names"> <% _.each(weekDayNames, function (weekDay) { %> <div class="x-dtm__week-day-name <%= weekDay.modifier %>"><span><%= weekDay.name %></span></div> <% }) %> </div><div class="x-dtm__close" title="<%= $message(\'T:modal.close\') %>" close-btn><svg class="x-dtm__close-icon"><use xlink:href="#remove"></use></svg></div></div><div class="x-dtm__calendars" calendars-container rel="content"></div><div class="x-dtm__footer" rel="controls"><div class="x-dtm__footer-hints"><div class="x-dtm__footer-message" hint-msg></div><div class="x-dtm__footer-info" info-msg></div></div><div class="x-dtm__footer-controls"><div class="x-dtm__btn tl-btn tl-btn_size_small" done-btn><span class="tl-btn__message tl-btn__message_clear"><%= $message(\'T:datepicker.done\') %></span></div></div></div></div></div>'),e.put("directives/datepicker/datepicker.html",'<div class="x-datepicker"><div class="x-datepicker__field" role="button" tabindex="0" ng-click="toggleDatepicker()" popover-disabled="currentViewMode == viewMode.Vertical" tl-popover content-generator-action="render()" element-position="left bottom" popover-position="left top" popover-opened="opened" popover-changed="popoverChanged(opened)" force-redraw="true" type="calendar" attach-element="attachElement"><div ng-if="!hideControl" type="text" class="x-datepicker__control" ng-bind-html="(layout.phone ? \'T:datepicker.date_format_short\' : \'T:datepicker.date_format_long\') | message:{ date: selectedDate} | tlUnsafe"></div><div class="x-datepicker__icon-holder" ng-if="::!hideControl"><svg class="x-datepicker__icon" ng-switch="::isStartDate"><use ng-switch-when="true" xlink:href="#check-in-date"></use><use ng-switch-when="false" xlink:href="#check-out-date"></use><use ng-switch-default xlink:href="#calendar"></use></svg></div></div></div>'),e.put("directives/datepicker/templates/price-info-popover.html",'<div class="x-dtm__info-button tl-svg-button" tl-popover content-generator-action="getPriceDescription()" event="\'click\'" element-position="center top" popover-position="center bottom" show-close-button="true"><svg class="tl-svg-button__icon"><use xlink:href="#info"></use></svg></div>'),e.put("directives/datepicker/templates/price-info.html",'<div class="x-dtm__info-text"><div ng-if="::stayUnitKind == stayUnitKinds.Day" class="x-dtm__footer-label" tl-message="\'T:datepicker.best_price_by_day\'"></div><div ng-if="::stayUnitKind == stayUnitKinds.Night" class="x-dtm__footer-label" tl-message="\'T:datepicker.best_price_by_night\'"></div><div class="x-dtm__footer-note" tl-message="\'T:datepicker.best_price_note\'"></div></div>')}),!function(s){!function(i){t.prototype.getDate=function(){return this.date.clone()},t.prototype.addEventListener=function(e,t){this.htmlElement.addEventListener(e,t)},Object.defineProperty(t.prototype,"calendar",{get:function(){return this.calendarBase},enumerable:!0,configurable:!0});var e=t;function t(e,t,i){this.date=e,this.htmlElement=t,this.calendarBase=i,this.isOutOfRange=!1,this.isDisabled=!1,this.isMuted=!1,this.isForbidden=!1,this.isSelectable=!0,this.isHovered=!1,this.isLowPrice=!1,this.isStartDate=!1,this.isInRange=!1,this.isEndDate=!1}i.CalendarDateState=e;__extends(r,n=e),Object.defineProperty(r.prototype,"element",{get:function(){return this.htmlElement},enumerable:!0,configurable:!0});var n,o=r;function r(){return null!==n&&n.apply(this,arguments)||this}function a(e,t,i,n,o){this.datepickerManager=e,this.addEventListenersAction=t,this.isOutOfRange=i,this.messageFilter=n,this.$templateCache=o,this.initialized=!1,this.template=_.template(this.$templateCache.get("directives/datepicker/calendar-base/calendar-base.html"))}a.prototype.getMonthWeeks=function(t){var e=_.range(1,s.DateUtil.daysInMonth(t)+1).map(function(e){return new Date(t.getFullYear(),t.getMonth(),e)}),e=s.DateUtil.makeFullWeeks(e,_.head(e),_.last(e),function(){return null},function(){return null});return s.DateUtil.sliceDaysArrayByWeeks(e)},a.prototype.getWeekDayNames=function(){return s.DateUtil.getWeekInfoDays(this.messageFilter)},a.prototype.parseDate=function(e){e=e.getAttribute("data-date")||"",e=moment(e,a.DateFormat);return e.isValid()?e.toDate():null},a.prototype.formatDate=function(e){return e&&e.format(a.DateFormat)},a.prototype.getCustomClass=function(e,t,i){var n,o=i[t][e],r=[];return o||r.push("-empty"),0<t&&(!o||this.isOutOfRange(o))&&(n=i[t-1][e])&&!this.isOutOfRange(n)&&r.push("-top-border"),0<e&&(!o||this.isOutOfRange(o))&&(n=i[t][e-1])&&!this.isOutOfRange(n)&&r.push("-left-border"),r.length?" "+r.join(" "):""},a.prototype.initEventListeners=function(){var t=this;_.forEach(this.calendarDates,function(e){t.addEventListenersAction&&t.addEventListenersAction(e,e.element)})},a.prototype.initCalendarDates=function(){var i=this;this.calendarDates=[],_.forEach(this.rootElement.querySelectorAll("[data-date]"),function(e){var t=i.parseDate(e);t&&i.calendarDates.push(new o(t,e,i))})},a.prototype.toggleAttribute=function(e,t,i){if(i)return e.setAttribute(t,t);e.removeAttribute(t)},a.prototype.updateDateAttributes=function(e){this.toggleAttribute(e.element,"outofrange",e.isOutOfRange),this.toggleAttribute(e.element,"is-disabled",e.isDisabled&&!e.isOutOfRange),this.toggleAttribute(e.element,"muted",e.isMuted&&!e.isOutOfRange),this.toggleAttribute(e.element,"forbidden",e.isForbidden&&!e.isOutOfRange),this.toggleAttribute(e.element,"selectable",e.isSelectable&&!e.isOutOfRange),this.toggleAttribute(e.element,"hovered",e.isHovered&&!e.isOutOfRange),this.toggleAttribute(e.element,"low-price",e.isLowPrice&&!e.isOutOfRange),this.toggleAttribute(e.element,"inrange",e.isInRange&&!e.isOutOfRange),this.toggleAttribute(e.element,"rangestart",e.isStartDate&&!e.isOutOfRange),this.toggleAttribute(e.element,"rangeend",e.isEndDate&&!e.isOutOfRange)},a.prototype.updateDateText=function(e,t){e=e.element.querySelector("[date-text]");e.innerHTML!=t&&(e.innerHTML=t)},a.prototype.updateDateTooltip=function(e,t){e=e.element.querySelector("[date-tooltip]");e&&(e.firstChild.innerHTML=t,this.toggleAttribute(e,"visible",!!t))},a.prototype.updateAttributes=function(e){var t=this;if(void 0===e&&(e=void 0),!_.isUndefined(e))return this.updateDateAttributes(e);_.forEach(this.calendarDates,function(e){return t.updateDateAttributes(e)})},a.prototype.getElement=function(){return this.rootElement},a.prototype.getLastDate=function(){return _.last(this.calendarDates).getDate()},a.prototype.getMonth=function(){return this.currentMonth},a.prototype.compile=function(e,t){this.currentMonth=new Date(e.getFullYear(),e.getMonth());e=a.Month[this.currentMonth.getMonth()],e=s.StringUtil.capitalize(this.messageFilter("T:datepicker."+e,{date:this.currentMonth}));this.rootElement=angular.element(this.template({monthName:e,weekDayNames:this.getWeekDayNames(),weeks:this.getMonthWeeks(this.currentMonth),getCustomClass:this.getCustomClass.bind(this),formatDate:this.formatDate.bind(this),verticalMode:this.datepickerManager.viewMode==i.DatepickerViewMode.Vertical}))[0],t.parentElement.replaceChild(this.rootElement,t),this.initCalendarDates(),this.initEventListeners(),this.updateAttributes()},Object.defineProperty(a.prototype,"dateStates",{get:function(){return this.calendarDates},enumerable:!0,configurable:!0}),a.Month=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],a.DateFormat="YYYY-MM-DD",i.CalendarBase=a}(s.directive||(s.directive={}))}(tl=tl||{}),!function(u){!function(e){t.Vertical="vertical",t.Horizontal="horizontal";var l=t;function t(){}function c(e,t,i,n,o,r,a,s){this.createCalendarAction=e,this.updateCalendarAction=t,this.getHintHtmlAction=i,this.doneAction=n,this.cancelAction=o,this.$templateCache=r,this.messageFilter=a,this.priceInfoElement=s,this.lazyHandleScrollBind=!1,this.CALENDARS_COUNT=2,this.MOBILE_CALENDARS_COUNT=12,this.HEADER_OFFSET=5,this.RENDER_TIMEOUT=300,this.template=_.template(r.get("directives/datepicker/datepicker-manager/datepicker-manager.html")),this.viewMode=c.getViewMode()}e.DatepickerViewMode=l,c.prototype.updateDatepickerHints=function(e){var t=this.rootContainer.querySelector("[hint-msg]");this.getHintHtmlAction&&this.getHintHtmlAction(e).then(function(e){e&&(t.innerHTML=e)})},c.getViewMode=function(){return(window.innerWidth||document.documentElement.clientWidth)<this.MOBILE_LAYOUT_SIZE?l.Vertical:l.Horizontal},c.prototype.compile=function(e,t,i,n){var o,r,a=this,s=(this.rootContainer=angular.element(this.template({caption:n,weekDayNames:u.DateUtil.getWeekInfoDays(this.messageFilter),$message:this.messageFilter}))[0],this.calendarsContainer=this.rootContainer.querySelector("[calendars-container]"),this.calendars=[],this.viewMode==l.Vertical?(o=new Date,0<(r=e.diffInMonths(o)||0)&&this.buildMonths(o,r,!1),this.buildMonths(o.addMonths(r),this.CALENDARS_COUNT,!0),setTimeout(function(){a.buildMonths(o.addMonths(r+a.CALENDARS_COUNT),a.MOBILE_CALENDARS_COUNT-a.CALENDARS_COUNT-r,!1),a.bindLazyLoadScroll()},this.RENDER_TIMEOUT),i.classList.add("-vertical")):(this.buildMonths(e,this.CALENDARS_COUNT),this.onMonthChange(),i.classList.add("-horizontal")),i.innerHTML="",i.appendChild(this.rootContainer),i.querySelector("[info-msg]"));if(this.priceInfoElement)for(;this.priceInfoElement.firstChild;)s.appendChild(this.priceInfoElement.firstChild);else i.classList.add("-without-price"),u.HtmlUtil.remove(s);this.addEventListeners(),this.viewMode==l.Vertical&&this.updateDoneButton({start:e,end:t})},c.prototype.update=function(e){var t;this.viewMode==l.Horizontal&&e&&e.start&&!e.end&&(t=_.last(this.calendars).getLastDate(),e.start.isEqualDate(t)&&this.toNextMonth()),this.viewMode==l.Vertical?this.updateDoneButton(e):this.viewMode==l.Horizontal&&e&&e.start&&e.end&&this.doneAction(),this.updateDatepickerHints()},c.prototype.visibleCalendars=function(){return this.calendars},c.prototype.toPrevMonth=function(){this.calendars=__spreadArrays([_.head(this.calendars)],this.calendars.slice(0,-1));var e=this.createCalendarAction(),t=document.createElement("div"),i=_.head(this.calendars).getMonth().addMonths(-1);this.calendarsContainer.removeChild(this.calendarsContainer.lastChild),this.calendarsContainer.insertBefore(t,this.calendarsContainer.firstChild),(this.calendars[0]=e).compile(i,t),e.initialized=!0,this.updateCalendarAction(e),this.onMonthChange()},c.prototype.toNextMonth=function(){this.calendars=__spreadArrays(this.calendars.slice(1),[_.last(this.calendars)]);var e=document.createElement("div"),t=_.last(this.calendars).getMonth().addMonths(1),i=this.createCalendarAction();this.calendarsContainer.removeChild(this.calendarsContainer.firstChild),this.calendarsContainer.appendChild(e),(this.calendars[this.calendars.length-1]=i).compile(t,e),i.initialized=!0,this.updateCalendarAction(i),this.onMonthChange()},c.prototype.onMonthChange=function(){var e=this.rootContainer.querySelector("[prev-month-btn]"),t=_.head(this.calendars).getMonth(),i=new Date;t.resetDate()<=i.resetDate()?e.classList.add("-disabled"):e.classList.remove("-disabled")},c.prototype.addEventListeners=function(){var t=this,e=this.rootContainer.querySelector("[prev-month-btn]"),e=(angular.element(e).on(u.EventType.Click,this.toPrevMonth.bind(this)),this.rootContainer.querySelector("[next-month-btn]")),e=(angular.element(e).on(u.EventType.Click,this.toNextMonth.bind(this)),this.rootContainer.querySelectorAll("[close-btn]")),e=(angular.element(e).on(u.EventType.Click,this.cancelAction),this.rootContainer.querySelector("[done-btn]"));angular.element(e).on(u.EventType.Click,this.doneAction),this.viewMode==l.Vertical&&angular.element(this.calendarsContainer).bind("scroll",function(e){t.updateHeader(e),t.calendarEndingHandler()})},c.prototype.updateHeader=function(e,t){var i,n,o=this,r=(void 0===t&&(t=!0),this.rootContainer.querySelector("[header]")),a=this.calendarsContainer.querySelector("[inrange]"),s=r.getBoundingClientRect().top+r.clientHeight,l=r.querySelector("[header-month-name]"),c=this.rootContainer.querySelectorAll(".x-dcb__month-name"),u=!1;if(a)i=a.offsetTop,n=a.parentElement.parentElement.offsetTop;else if(!e)return void setTimeout(function(){return o.updateHeader(!1)},10);a=this.calendarsContainer.scrollTop+r.clientHeight+this.HEADER_OFFSET;!(-2<a-i&&a-i<2&&i==n)&&this.calendarsContainer.scrollTop>this.HEADER_OFFSET?r.classList.add("-fixed"):r.classList.remove("-fixed"),!e&&i&&t&&(this.calendarsContainer.scrollTop=i-this.HEADER_OFFSET),_.each(c,function(e){var t=e.getBoundingClientRect().top,i=e.querySelector("[month-name]");t<s-i.parentElement.clientHeight?(l.innerHTML=e.querySelector("[month-name]").innerHTML,u=!0):u||(l.innerHTML=c[0].querySelector("[month-name]").innerHTML)})},c.prototype.buildMonths=function(e,t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0);for(var o=0;o<t;o++){var r=this.createCalendarAction(),a=document.createElement("div");this.calendarsContainer.appendChild(a),r.compile(new Date(e.getFullYear(),e.getMonth()+o),a),r.initialized=i,this.calendars.push(r)}this.viewMode==l.Vertical&&this.updateHeader(!1,n)},c.prototype.bindLazyLoadScroll=function(){var o=this;this.lazyHandleScrollBind||(angular.element(this.calendarsContainer).bind("scroll",_.throttle(function(){var n=o.calendarsContainer.scrollTop;_.chain(o.calendars).filter(function(e){return!e.initialized}).forEach(function(e){var t=e.getElement().offsetTop,i=t+e.getElement().clientHeight;n+o.calendarsContainer.clientHeight>t&&n<i&&(e.initialized=!0,o.updateCalendarAction(e))}).value()},c.THROTTLE_TIME)),this.lazyHandleScrollBind=!0)},c.prototype.calendarEndingHandler=function(){var e=this.calendarsContainer.scrollTop;this.calendarsContainer.scrollHeight-this.calendarsContainer.clientHeight-e<c.MOBILE_RENDER_OFFSET&&this.calendars.length>=this.MOBILE_CALENDARS_COUNT&&(e=_.last(this.calendars).getMonth(),this.buildMonths(e.addMonths(1),this.MOBILE_CALENDARS_COUNT,!1,!1))},c.prototype.updateDoneButton=function(e){var t=this.rootContainer.querySelector("[done-btn]");e&&!e.end?t.classList.add("tl-btn_state_disabled"):t.classList.remove("tl-btn_state_disabled")},c.MOBILE_LAYOUT_SIZE=680,c.MOBILE_RENDER_OFFSET=200,c.THROTTLE_TIME=150,e.DatepickerManager=c}(u.directive||(u.directive={}))}(tl=tl||{}),!function(k){var P,C;function e(e,t,i,n,o,r,a,s,l,c){var u=this,t=(this.$scope=e,this.$q=t,this.serviceFactory=i,this.messages=n,this.messageFilter=o,this.$templateCache=r,this.datepickerSettings=a,this.doneAction=s,this.cancelAction=l,this.generatePriceInfoElement=c,this.ratePlansCandidates=[],this.searchCriteria=null,this.provider=this.serviceFactory.bookingService.getProvider(),this.bookingFormSettings=k.BookingFormSettings.getInstance(),this.calendarAvailablePeriod=P.helper.CalendarHelper.availablePeriod(this.bookingFormSettings,this.provider),this.datepickerSettings.disableInfo||(this.searchCriteria=this.serviceFactory.bookingService.getSearchCriteria().clone(),this.ratePlansCandidates=this.getRatePlanCandidates(),e=this.datepickerSettings.roomTypeIds.length?this.datepickerSettings.roomTypeIds:this.serviceFactory.bookingService?this.searchCriteria.roomTypeIds:[],this.roomTypeIds=_.filter(e,function(e){return!!u.serviceFactory.bookingService.getRoomType(e)})),this.calendarDateInfoProvider=new k.directive.helper.CalendarDateInfoProvider(this.getBookingRule.bind(this),this.getMinPriceDate.bind(this),this.$q,o,this.datepickerSettings),this.calendarPriceProvider=new k.directive.helper.CalendarPriceProvider(this.$scope,this.$q,this.serviceFactory.availabilityCalendarService),this.availabilityCalendarSettings=k.AvailabilityCalendarService.getAvailabilityCalendarSettings(),!this.datepickerSettings.disableInfo&&this.availabilityCalendarSettings.isAvailable&&this.bookingFormSettings.showPriceInCalendar?this.generatePriceInfoElement():null);this.datepickerManager=new P.DatepickerManager(this.createCalendar.bind(this),this.updateCalendar.bind(this),this.getHintHtml.bind(this),this.done.bind(this),this.cancelAction,r,o,t),this.datepicker=new P.PeriodDatepicker(this.onSelectionChange.bind(this),this.calendarDateInfoProvider,this.datepickerManager,o,r,this.datepickerSettings)}P=k.directive||(k.directive={}),e.prototype.getBookingRule=function(e){var t,i,n,o=this;return this.datepickerSettings.disableInfo?this.$q.when(null):(1==(null==(t=this.ratePlansCandidates)?void 0:t.length)?this.serviceFactory.bookingRuleService.getRatePlanBookingRule(e,_.head(this.ratePlansCandidates)):1==(null==(t=this.roomTypeIds)?void 0:t.length)&&!this.searchCriteria.promoCode&&this.bookingFormSettings.mixUnsuitableByLosRatePlans?(i=this.searchCriteria.clone(),n=[],i.checkInDate=e,i.checkOutDate=e.addDays(this.bookingFormSettings.stayUnitKind==k.StayUnitKind.Night?1:0),_.map(this.serviceFactory.bookingService.getRatePlans(),function(e){n.push(o.serviceFactory.bookingRuleService.getRatePlanBookingRuleByDateRange(i,o.bookingFormSettings.stayUnitKind,e,o.serviceFactory.bookingService.getRoomType(_.head(o.roomTypeIds))))}),this.$q.all(n).then(function(e){return o.calendarDateInfoProvider.mixRatePlansRules(e)})):this.serviceFactory.bookingRuleService.getHotelBookingRule(e)).catch(function(){return null})},e.prototype.getRatePlanCandidates=function(){var t=this;return this.serviceFactory.bookingService?_.chain(this.searchCriteria.ratePlansIds).map(function(e){return t.serviceFactory.bookingService.getRatePlan(e)}).filter(function(e){return null!=e}).value():null},e.prototype.getRoomTypeCandidatesNames=function(){var t=this;return this.serviceFactory.bookingService?_.chain(this.roomTypeIds).map(function(e){return t.serviceFactory.bookingService.getRoomType(e)}).filter(function(e){return null!=e}).map(function(e){return e.name}).value():null},e.prototype.getCaptionHtml=function(){var e=!this.datepickerSettings.disableInfo&&this.getRoomTypeCandidatesNames().join(", ");return e&&this.availabilityCalendarSettings.isAvailable&&this.messages.formatMessage("T:datepicker.select_dates_for",{names:e})},e.prototype.getHintHtml=function(e){var t=(e=e||this.datepicker.getCurrentSelection()).info||{isStartDate:this.datepickerSettings.isStartDate};return this.calendarDateInfoProvider.getHintHtml(e.start,e.end,t)},e.prototype.getMinPriceDate=function(e){if(!this.bookingFormSettings.showPriceInCalendar||this.datepickerSettings.disableInfo||!this.availabilityCalendarSettings.isAvailable||e<this.availabilityCalendarSettings.startDate||e>this.availabilityCalendarSettings.endDate)return this.$q.when(null);e={date:e,roomTypeIds:this.roomTypeIds};return this.calendarPriceProvider.getMinPriceDate(e)},e.prototype.createCalendar=function(){return this.datepicker.createCalendar()},e.prototype.updateCalendar=function(e){this.datepicker.update(e)},e.prototype.done=function(){var e=this.datepicker.getCurrentSelection();e.start&&e.end&&this.doneAction(e.start,e.end)},e.prototype.onSelectionChange=function(e){this.datepickerManager.update(e)},e.prototype.compile=function(e,t,i){this.datepickerManager.compile(e,t,i,this.getCaptionHtml()),this.datepicker.initialize(e,t,this.datepickerSettings.lightMode?k.DateUtil.getHotelDate(this.provider.timeZone.offset).resetTime():this.calendarAvailablePeriod.checkIn.startDate,this.datepickerSettings.disableInfo?null:this.calendarAvailablePeriod.checkIn.endDate,this.datepickerSettings.isStartDate)},C=e,P.Datepicker=C,k.registerDirective("tlDatepicker",["$q","$parse","$filter","$templateCache","$compile","serviceFactory","tl.messages","layout",function(m,g,h,f,v,y,b,S){return{restrict:"EA",scope:{selectedStartDate:"=",selectedEndDate:"=",opened:"=?",hideControl:"=?",isStartDate:"=?",disablePeriod:"=?",disableInfo:"=?",lightMode:"=?",attachElement:"=?",roomTypeId:"=?"},replace:!0,templateUrl:"directives/datepicker/datepicker.html",link:function(o,e,t){o.container=null,o.layout=S,o.currentViewMode=P.DatepickerManager.getViewMode(),o.viewMode=P.DatepickerViewMode,o.isStartDate=!!_.isUndefined(o.isStartDate)||o.isStartDate,o.stayUnitKind=k.BookingFormSettings.getInstance().stayUnitKind,o.stayUnitKinds=k.StayUnitKind;function i(e,t){if(e!==t&&(o.maxBookingPeriod=new k.StayDuration(o.stayUnitKind,k.BookingFormSettings.getInstance().maxBookingPeriod),o.currentPeriod=new k.StayDuration(o.stayUnitKind,t.diffInDays(e)+(o.stayUnitKind==k.StayUnitKind.Day?1:0)),o.currentPeriod.value>o.maxBookingPeriod.value))return o.currentViewMode===P.DatepickerViewMode.Horizontal&&o.closeDatepicker(),p.open(m.when(function(){return v('<tl-max-booking-period-modal current-period="currentPeriod" max-booking-period="maxBookingPeriod"></tl-max-booking-period-modal>')(o)[0]}));o.closeDatepicker(),o.$applyAsync(function(){e&&(o.selectedStartDate=e),t&&(o.selectedEndDate=t),s&&s(e,t),l&&!s&&l(e)})}function n(){o.closeDatepicker()}function r(){P.DatepickerManager.getViewMode()!=o.currentViewMode&&o.closeDatepicker(),o.currentViewMode=P.DatepickerManager.getViewMode()}function a(){function e(e){return v(f.get("directives/datepicker/templates/"+e))(o)[0]}var t=document.createElement("div"),i=e("price-info.html"),n=e("price-info-popover.html");return t.appendChild(i),t.appendChild(n),o.getPriceDescription=function(){return m.when(function(){return i})},t}var s=g(t.onChange)(o.$parent),l=g(t.onChangeStartDate)(o.$parent),c=g(t.onBeforeShow)(o.$parent),u=g(t.onClose)(o.$parent),d=angular.element(window),p=k.ModalManager.getInstance();o.render=function(){var e={isStartDate:o.isStartDate,disablePeriod:!_.isUndefined(o.disablePeriod)&&o.disablePeriod,disableInfo:!_.isUndefined(o.disableInfo)&&(o.disableInfo||!y.bookingService.getSearchCriteria()),lightMode:!_.isUndefined(o.lightMode)&&o.lightMode,roomTypeIds:_.isUndefined(o.roomTypeId)?[]:[o.roomTypeId]},t=new C(o,m,y,b,h("message"),f,e,i,n,a);return m.when(function(){return o.container=document.createElement("div"),t.compile(o.selectedStartDate,o.selectedEndDate,o.container),c&&c(),o.container})},o.toggleDatepicker=function(){o.currentViewMode===P.DatepickerViewMode.Vertical&&(o.opened?o.closeDatepicker():o.openDatepicker())},o.openDatepicker=function(){o.$applyAsync(function(){o.opened=!0})},o.closeDatepicker=function(){o.currentViewMode===P.DatepickerViewMode.Vertical&&p.opened()&&p.close(),o.$applyAsync(function(){o.opened=!1})},o.$watch(function(){return o.opened},function(){(_.isUndefined(o.opened)||!1===o.opened)&&u&&u(),o.$applyAsync(function(){o.currentViewMode===P.DatepickerViewMode.Vertical&&(o.opened?p.open(o.render(),{withoutPaddings:!0,fitContent:!0}):p.close())})}),o.popoverChanged=function(e){o.opened=e},o.$applyAsync(function(){o.opened&&o.openDatepicker()}),d.on("resize",_.throttle(r,P.DatepickerManager.THROTTLE_TIME)),o.$on("$destroy",function(){d.off("resize",r)}),o.$watchCollection(function(){return[o.selectedStartDate,o.selectedEndDate]},function(){o.selectedDate=o.isStartDate?o.selectedStartDate:o.selectedEndDate})}}}])}(tl=tl||{}),!function(r){!function(o){function e(e,t,i,n,o,r){this.selectionChangeAction=e,this.calendarDateInfoProvider=t,this.datepickerManager=i,this.messageFilter=n,this.$templateCache=o,this.datepickerSettings=r}e.prototype.initialize=function(e,t,i,n,o){void 0===o&&(o=!0),this.startDate=e,this.endDate=t,this.minDate=i,this.maxDate=n,this.isStartSelected=!o,this.isEndSelected=o,this.isStartDate=o,this.updateCalendar(this.datepickerManager.visibleCalendars())},e.prototype.getCurrentSelection=function(){return{start:this.startDate,end:this.endDate}},e.prototype.createCalendar=function(){return new o.CalendarBase(this.datepickerManager,this.addEventListeners.bind(this),this.isOutOfRange.bind(this),this.messageFilter,this.$templateCache)},e.prototype.update=function(e){this.updateCalendar([e])},e.prototype.updateAttributes=function(t){var i=this,n=(void 0===t&&(t=void 0),!_.isUndefined(t)),o=this.isStartDate?this.isStartSelected&&!this.isEndSelected?this.startDate.addDays(1):t:this.isEndSelected?t:this.startDate,e={start:n?this.isStartSelected&&!this.isEndSelected?this.startDate:t:this.isStartSelected?this.startDate:null,end:n?this.isStartSelected&&!this.isEndSelected?t:null:this.isStartSelected&&this.isEndSelected?this.endDate:null,info:{isStartDate:this.isStartDate,startSelected:this.isStartSelected,endSelected:this.isEndSelected}};this.datepickerManager.updateDatepickerHints(e),_.forEach(this.datepickerManager.visibleCalendars(),function(e){_.forEach(e.dateStates,function(e){e.isHovered=n&&(i.isInRange(e.getDate(),o,t)||e.getDate().isEqualDate(t))}),e.updateAttributes()})},e.prototype.isInRange=function(e,t,i){return 0<=e.diffInDays(t)&&e.diffInDays(i)<=0},e.prototype.isOutOfRange=function(e){return!e||!!this.minDate&&e<this.minDate||!!this.maxDate&&e>this.maxDate},e.prototype.addEventListeners=function(e){this.addDateEventListeners(e),"ontouchstart"in window||this.addDateTooltipEventListeners(e)},e.prototype.addDateTooltipEventListeners=function(t){function e(){t.isOutOfRange||(i=!0,n.getTooltipHtml(t).then(function(e){i&&t.calendar.updateDateTooltip(t,e)}))}var i,n=this;t.addEventListener(r.EventType.Click,e),t.addEventListener(r.EventType.MouseEnter,e),t.addEventListener(r.EventType.MouseLeave,function(){i=!1,t.calendar.updateDateTooltip(t,null)})},e.prototype.addDateEventListeners=function(e){var t=this,i=e.getDate();e.addEventListener(r.EventType.Click,function(){!e.isOutOfRange&&e.isSelectable&&(t.onDateChanged(i,e),t.updateAttributes())}),"ontouchstart"in window||(e.addEventListener(r.EventType.MouseEnter,function(){!e.isOutOfRange&&e.isSelectable&&t.updateAttributes(i)}),e.addEventListener(r.EventType.MouseLeave,function(){t.updateAttributes()}))},e.prototype.onDateChanged=function(e,t){!this.isStartSelected||this.isStartSelected&&this.isEndSelected?(this.isStartSelected=!0,this.isEndSelected=!1,this.startDate=e,this.endDate=null,this.datepickerSettings.disablePeriod&&(this.isEndSelected=!0,this.endDate=e)):this.isStartSelected&&!this.isEndSelected&&(this.startDate>e?(this.startDate=e,this.endDate=null,this.isEndSelected=!1):(this.isEndSelected=!0,this.isStartDate=!0,this.endDate=e)),this.selectionChangeAction&&this.selectionChangeAction({start:this.isStartSelected?this.startDate:null,end:this.isEndSelected?this.endDate:null}),this.updateCalendar(this.datepickerManager.visibleCalendars())},e.prototype.updateCalendar=function(e){var n=this;this.updateAttributes(),_.forEach(e,function(i){i.initialized&&(_.forEach(i.dateStates,function(e){var t;e.isOutOfRange=n.isOutOfRange(e.getDate()),e.isOutOfRange?i.updateAttributes(e):(e.isStartDate=!n.datepickerSettings.disablePeriod&&!!n.startDate&&e.getDate().isEqualDate(n.startDate),e.isEndDate=!n.datepickerSettings.disablePeriod&&!!n.endDate&&e.getDate().isEqualDate(n.endDate),e.isInRange=!!n.endDate&&n.isInRange(e.getDate(),n.startDate,n.endDate)||n.isStartSelected&&e.getDate().isEqualDate(n.startDate),t=e.getDate().diffInDays(n.isStartSelected?n.startDate:n.minDate.addDays(-1)),e.isSelectable=!0,e.isMuted=n.calendarDateInfoProvider.isDayStayMode()?t<0:t<1,!n.datepickerSettings.disablePeriod&&n.startDate&&e.getDate().isEqualDate(n.startDate)&&(e.isMuted=!n.calendarDateInfoProvider.isDayStayMode(),e.isSelectable=n.calendarDateInfoProvider.isDayStayMode()),i.updateAttributes(e),setTimeout(function(){return n.updateDateCalendar(i,e)},o.DatepickerManager.THROTTLE_TIME))}),i.getElement().classList.add("-initialized"))})},e.prototype.updateDateCalendar=function(i,n){this.getDateInfo(n).then(function(e){n.isSelectable=e.isSelectable,n.isLowPrice=e.isLowPrice,n.isDisabled=!1,n.isMuted=!1,n.isForbidden=!1;function t(e){switch(e){case r.CalendarDateDisabledKind.Disabled:n.isDisabled=!0;break;case r.CalendarDateDisabledKind.Muted:n.isMuted=!0;break;case r.CalendarDateDisabledKind.Forbidden:n.isForbidden=!0}}_.isArray(e.disabledKind)?_.each(e.disabledKind,t):t(e.disabledKind),i.updateAttributes(n),i.updateDateText(n,!n.isOutOfRange&&e.textHtml||"")})},e.prototype.getDateInfo=function(e){var t=this.isStartSelected?this.startDate:this.minDate.clone().addDays(-1),i=this.isEndSelected?this.endDate:null;return this.calendarDateInfoProvider.getDateInfo(t,i,e.getDate(),this.endDate)},e.prototype.getTooltipHtml=function(e){var t=this.isStartSelected?this.startDate:null,i=this.isEndSelected?this.endDate:null;return this.calendarDateInfoProvider.getDateTooltipHtml(t,i,e.getDate())},o.PeriodDatepicker=e}(r.directive||(r.directive={}))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/max-booking-period-modal/max-booking-period-modal.html",'<div><div class="x-modal__close" ng-click="::close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" rel="heading"><h1 class="x-modal__title" tl-message="\'T:error.max_booking_period_header\'"></h1></div><div class="x-modal__content" rel="content"><span tl-message="\'T:error.max_booking_period_description\'" message-params="{currentPeriod: currentPeriod, maxBookingPeriod: maxBookingPeriod}" message-html="true"></span></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="::close()"></span></div></div></div>')}),!function(t){t.directive||(t.directive={});t.registerDirective("tlMaxBookingPeriodModal",["serviceFactory",function(){return{restrict:"EA",scope:{currentPeriod:"=",maxBookingPeriod:"="},templateUrl:"directives/max-booking-period-modal/max-booking-period-modal.html",controller:["$scope",function(e){e.close=function(){t.ModalManager.getInstance().close()}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/guest-log-in/guest-log-in.html",'<div class="x-gl"><div class="x-gl__wrapper" ng-if="isGuestProfileAuthTokenLoaded && !isUserAuthenticated()" ng-click="showLoginDialog()" ng-mouseenter="onMouseEnter()"><div class="x-gl__avatar" ng-class="{\'-with-popover\': isPreLogInPopoverOpened}" tl-popover event="none" content-generator-action="getPreLogInMessage()" popover-opened="preLogInPopover.opened" popover-changed="onPopoverChanged(opened)" show-close-button="true" element-position="bottom" popover-position="center top" type="motivator" popover-overflow="false"><div class="spinner -type-motivational" ng-class="{\'-animate\': antsAnimation.isRunning}"></div><div tl-guest-avatar></div></div><div class="x-gl__content"><div class="c1"><span class="x-gl__label" ng-bind-html="\'T:common.log_in\' | message | tlUnsafe"></span></div></div></div><div class="x-gl__wrapper" ng-if="isUserAuthenticated()" tl-popover event="click" popover-disabled="!isUserAuthenticated()" element-position="bottom" popover-position="center top" popover-overflow="false" attach-element="getAvatarElement()" content-generator-action="generateProfile()" popover-opened="guestProfilePopover.opened" force-redraw="true"><div class="x-gl__avatar" rel="avatar"><div tl-guest-avatar></div></div><div class="x-gl__content"><div class="c1"><span class="x-gl__label" ng-bind-html="\'T:guest_log_in.profile\' | message | tlUnsafe"></span></div><div class="x-gl__pin pin" ng-if="discountValue || getBonusPoints() !== null"><svg class="pin__icon" ng-if="getBonusPoints() === null"><use ng-attr-xlink:href="{{\'#\' + discountIcon}}" xlink:href=""></use></svg> <svg class="pin__icon" ng-if="getBonusPoints() !== null"><use xlink:href="#payment"></use></svg> <span ng-if="getBonusPoints() === null" ng-bind-html="\'T:guest_log_in.discount\' | message:{value: discountValue} | tlUnsafe"></span> <span ng-if="getBonusPoints() !== null" ng-bind="getBonusPoints() | number"></span></div></div></div></div>'),e.put("directives/guest-log-in/guest-profile-context-menu/guest-profile-context-menu.html",'<div class="x-gpcm"><div class="x-gpcm__content"><div class="x-popover__title" tl-message="\'T:guest_log_in_popover.title\'"></div><div class="x-gpcm__profile" ng-class="{\'-hoverable\': guestAccountUrl}"><div class="x-gpcm__avatar"><div tl-guest-avatar></div></div><div><div class="h6 x-gpcm__initials" tl-message="getFullName()"></div><div class="x-gpcm__contact h6" ng-if="getContactInfo()" tl-message="getContactInfo()" x-ms-format-detection="none"></div><span ng-if="::guestAccountUrl" ng-click="openGuestAccount()" class="x-gpcm__link link -normal c1" tl-message="\'T:guest_log_in_popover.open_account\'"></span> <span ng-if="::isLinkCardAllowed" ng-click="::goToLinkLoyaltyCard()" class="x-gpcm__link link -normal c1" tl-message="\'T:guest_log_in_popover.link_loyalty_card\'"></span></div></div><div class="x-gpcm__discount"><div class="x-gpcm__discount-icon" ng-if="::discountIcon"><svg><use xlink:href="{{getIconHref(discountIcon)}}" xlink:href=""></use></svg></div><div class="x-gpcm__discount-message" ng-if="discountType || getBonusPoints() !== null"><div tl-message="getDiscountTypeLabel()"></div><div ng-if="discountType" class="motivator -light -small x-gpcm__motivator" tl-message="getDiscountValueLabel()" message-params="{value: discountValue}"></div><div ng-if="getBonusPoints() !== null" class="motivator -light -small x-gpcm__motivator" tl-tooltip tooltip-text="\'T:bonus.note\' | message" tooltip-event="hover" tooltip-class="\'-on-popup\'"><span class="motivator__text" tl-message="\'T:bonus.accumulated\'" message-params="{count: getBonusPoints()}" message-html="true"></span></div></div></div></div><div class="x-popover__controls button-group button-group_rtl"><span class="tl-btn-light tl-btn-light_on_popup tl-btn-light_transparent" tl-message="\'T:common.log_out\'" ng-click="::logOutAction()"></span></div></div>')}),tl.registerDirective("tlGuestLogIn",["$q","$compile","$state","$rootScope","$timeout","tl.messages","layout",function(y,b,S,k,P,C,T){return{restrict:"EA",scope:!0,replace:!0,templateUrl:"directives/guest-log-in/guest-log-in.html",link:function(e,t){e.isVisible=function(){return!_.isNull(t[0].offsetParent)},e.getAvatarElement=function(){return t[0].querySelector('[rel="avatar"]')}},controller:["$scope","serviceFactory",function(r,a){function t(){return tl.directive.helper.GuestLoginHelper.getPreLogInMotivationText(s,C)}function i(){P.cancel(r.antsAnimation.startDelayPromise),P.cancel(r.antsAnimation.durationPromise),clearInterval(r.antsAnimation.reminderInterval),r.antsAnimation.isRunning=!1}function n(){r.antsAnimation.reminderInterval=setInterval(p,u)}var s=tl.BookingFormSettings.getInstance(),o=a.guestProfileService,e=a.guestProfileTokenService,l=tl.ModalManager.getInstance(),c=15e3,u=2e4,d=(r.isGuestProfileAuthTokenLoaded=!1,r.isUserAuthenticated=function(){return r.isGuestProfileAuthTokenLoaded&&!!tl.GuestProfileUtil.getGpToken(s.providerId)},e.getToken().then(function(e){r.isGuestProfileAuthTokenLoaded=!0}),r.antsAnimation={isRunning:null,reminderInterval:null,startDelayPromise:null,durationPromise:null},r.preLogInPopover={opened:null},r.guestProfilePopover={opened:null},function(e){P(function(){r.preLogInPopover.opened=!1},e=void 0===e?0:e)}),p=function(e){return void 0===e&&(e=0),i(),r.antsAnimation.startDelayPromise=P(function(){r.antsAnimation.isRunning=!0},e),r.antsAnimation.durationPromise=P(function(){},e+1700),y.all([r.antsAnimation.startDelayPromise,r.antsAnimation.durationPromise]).then(function(){r.antsAnimation.isRunning=!1,n(),0==m&&r.isVisible()&&!s.isMirCashbackAvailable()&&0==tl.PopupManager.instance.openedPopupsCount&&(r.preLogInPopover.opened=!0,m++,d(c))})},m=0,g=(r.$on("$stateChangeSuccess",function(e,t){P(function(){r.isUserAuthenticated()||p(3e3)})}),r.onPopoverChanged=function(e){r.isPreLogInPopoverOpened=e,i(),e||l.opened()||n()},r.$watch(function(){return l.opened()},function(e,t){r.isUserAuthenticated()||!1!==e||!0!==t||n()}),r.onMouseEnter=function(){T.phone||(i(),r.preLogInPopover.opened=!0)},tl.SearchCriteriaInformer.getInstance()),h={callback:function(){var o=r.$watch(function(){return s.promotions.length},function(e,t){var i,n;_.isUndefined(a.bookingService.getBookingStrategy())||(i=a.bookingService.getSearchCriteria(),i=new tl.DatePeriod(i.checkInDate,i.checkOutDate),n=tl.PromotionUtil.getPromotions(tl.DiscountType.Tourist,tl.DiscountType.Registration,tl.DiscountType.Loyalty),n=tl.PromotionUtil.getMostValuablePromotionForPeriod(n,i),r.discountValue=n&&n.discountValue,r.discountIcon=n&&tl.directive.helper.DiscountHelper.getIcon(n.discountType),r.discountType=n&&n.discountType,r.isUserAuthenticated()&&tl.TrackerService.track("discount-applied",{discountTypes:_.map(s.promotions,function(e){return e.discountType})}),e!=t&&o())})}},f=(g.subscribe(h,tl.SearchCriteriaInformerMessageType.AuthorizationChanged),tl.LanguageInformer.getInstance()),v={callback:function(){var e=y.defer();return setTimeout(function(){r.preLogInMessage=t(),e.resolve()},0),e.promise}};f.subscribe(v),r.$on("$destroy",function(){g.unsubscribe(h,tl.SearchCriteriaInformerMessageType.AuthorizationChanged),f.unsubscribe(v),i()}),r.getPreLogInMessage=function(){return r.preLogInMessage=t(),y.when(function(){return b('<div class="x-gl__text-motivator -active" ng-click="showLoginDialog()" ng-bind-html="preLogInMessage | tlUnsafe"></div>')(r)[0]})},r.getBonusPoints=function(){var e;return null!=(e=null==(e=o.getLoyaltyCard())?void 0:e.bonusPoints)?e:null},r.generateProfile=function(){return y.when(function(){return b('<tl-guest-profile-context-menu discount-icon="discountIcon" discount-value="discountValue" discount-type="discountType" guest-profile-popover="guestProfilePopover" log-out-action="logOut()"></tl-guest-profile-context-menu>')(r)[0]})},r.logOut=function(){o.logOut().then(function(){r.guestProfilePopover.opened=!1,tl.directive.helper.StateHelper.reloadPage(S)})},r.showLoginDialog=function(){i(),d();var e=k.$new(!0);l.open(y.when(function(){return b("<tl-guest-log-in-modal></tl-guest-log-in-modal>")(e)[0]}),{fitContent:!0,fullScreen:!1,withoutSidePaddings:!0}),tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"click",source:"authorization-button",page:S.current&&S.current.name},!0)}}]}}]),tl.registerDirective("tlGuestProfileContextMenu",["$q","$compile","$rootScope",function(o,r,a){return{restrict:"EA",scope:{discountValue:"=?",discountIcon:"=?",guestProfilePopover:"=?",discountType:"=?",logOutAction:"&"},replace:!0,templateUrl:"directives/guest-log-in/guest-profile-context-menu/guest-profile-context-menu.html",controller:["$scope","serviceFactory",function(t,e){var i=e.guestProfileService,e=tl.BookingFormSettings.getInstance(),n=i.guestProfile;t.getBonusPoints=function(){var e;return null!=(e=null==(e=t.loyaltyCard)?void 0:e.bonusPoints)?e:null},t.guestAccountUrl=i.getGuestAccountUrl(),t.loyaltyCard=i.getLoyaltyCard(),t.isLinkCardAllowed=!t.guestAccountUrl&&!t.loyaltyCard&&e.hasLoyaltyProgram(),t.discountIcon=t.discountIcon||(null!==t.getBonusPoints()?tl.directive.helper.DiscountHelper.getIcon(tl.DiscountType.Loyalty):null),t.openGuestAccount=function(){window.open(i.getGuestAccountUrl(),"_blank")},t.goToLinkLoyaltyCard=function(){t.guestProfilePopover.opened=!1;var e=a.$new(!0);e.currentModalView=tl.directive.helper.GuestLogInModalView.AddLoyaltyCard,tl.ModalManager.getInstance().open(o.when(function(){return r("<tl-guest-log-in-modal></tl-guest-log-in-modal>")(e)[0]}),{fitContent:!0,fullScreen:!1,withoutSidePaddings:!0})},t.getFullName=function(){return n.fullName},t.getContactInfo=function(){return n.phoneNumber||n.email},t.getIconHref=function(e){return"#"+e},t.getDiscountValueLabel=function(){return t.discountValue?"T:guest_log_in_popover.discount_label":"T:guest_log_in_popover.no_discount_label"},t.getDiscountTypeLabel=function(){return t.discountType==tl.DiscountType.Loyalty||!t.discountType&&null!==t.getBonusPoints()?"T:guest_log_in_popover.loyalty_card":"T:guest_log_in_popover.registration_discount"}}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/guest-avatar/guest-avatar.html",'<div class="x-guest-avatar"><div class="x-guest-avatar__avatar -empty" ng-if="!guestProfileService.isProfileLoaded()"><svg class="x-guest-avatar__icon"><use xlink:href="#guest-login"></use></svg></div><div tl-fit-image ng-if="guestProfileService.isProfileLoaded() && hasAvatarImage()" class="x-guest-avatar__avatar" image="getAvatarImage()" on-image-error="onImageError"></div><div ng-if="guestProfileService.isProfileLoaded() && !hasAvatarImage()" ng-init="buildInitialsAvatar()" ng-style="{\'background-color\': initialsBackgroundColor}" class="x-guest-avatar__avatar -initials">{{profileInitials}}</div></div>')}),tl.registerDirective("tlGuestAvatar",[function(){return{restrict:"EA",scope:!0,replace:!0,templateUrl:"directives/guest-avatar/guest-avatar.html",controller:["$scope","serviceFactory",function(t,e){t.guestProfileService=e.guestProfileService,t.profileInitials="",t.initialsBackgroundColor="";var i=["#075bba","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#eb41d1","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7","#7f8c8d"],n=(t.hasAvatarImage=function(){return e.guestProfileService.guestProfile.photoUrl&&!t.imageLoadingFailed},t.getAvatarImage=function(){return new tl.Image(e.guestProfileService.guestProfile.photoUrl||"")},t.onImageError=function(){t.imageLoadingFailed=!0},t.buildInitialsAvatar=function(){t.profileInitials=n();var e=(("?"==t.profileInitials?72:t.profileInitials.charCodeAt(0))-64)%20-1;e<0?e=0:i.length<=e&&(e=i.length-1),t.initialsBackgroundColor=i[e]},function(){var e=t.guestProfileService.guestProfile.fullName||"",e=String(e).toUpperCase().split(" "),e=1==e.length?e[0]?e[0].charAt(0):"?":e[0].charAt(0)+e[1].charAt(0);return e})}]}}]),tl.registerDirective("tlFitImage",["$parse",function(c){return{scope:!1,template:'<div class="x-fit-image"></div>',replace:!0,link:function(a,s,l){setTimeout(function(){var e=c(l.image)(a),t=c(l.onImageError)(a),i=s[0].clientWidth,n=s[0].clientHeight,o=100*Math.ceil(2*i/100),n=100*Math.ceil(n*(o/i)/100),r=e?e.getThumbnailUrl(o||n?o:400,o||n?n:null):"",i=new Image;i.onload=function(){s[0].style.backgroundImage="url('"+r+"')",tl.HtmlUtil.toggleClass(s[0],"_loaded",!0)},t&&(i.onerror=function(){t(),a.$applyAsync()}),i.src=r},0)}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/guest-log-in-modal/add-loyalty-card/add-loyalty-card.html",'<div><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="\'T:gp.link_card.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><form name="linkCardForm"><div class="tl-message" ng-class="getErrorTypeClassName()" ng-if="lastResponseCode && lastResponseCode != responseCodes.Success" ng-bind-html="getErrorLocalizationString() | message | tlUnsafe"></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:common.telephone\'"></span><div class="x-glim__control x-glim__full-width"><div tl-phone-control parent-form="linkCardForm" input-name="\'phoneInputName\'" required="true" ng-model="phoneNumber" on-keyup-action="catchAddInfoEnterKey()"></div></div><div tl-error-tooltip input-name="\'phoneInputName\'" hide="hideLinkCardValidation()" custom-content-class="\'x-glim__validation-phone-arrow\'" error-message="{{\'T:validation.phone_nonformed\' | message}}" required-error-message="{{\'T:validation.phone_req\' | message}}"></div></label></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" ng-click="save()" ng-disabled="pending"><svg ng-show="pending" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!pending" tl-message="\'T:gp.link_card.submit\'"></span></div><div class="x-galcmv__reject"><span class="link -normal" tl-message="\'T:guest_confirm_loyalty_card.reject\'" ng-click="cancel()"></span></div></form></div></div>'),e.put("directives/guest-log-in-modal/failed-loyalty-card-linking-modal-view/failed-loyalty-card-linking-modal-view.html",'<div tl-loyalty-card-linking-common-modal-view title-text="\'T:gp.link_card.failed_title\'" image-kind="\'failed\'" on-close-button-click="closeLogInDialog()" on-ok-button-click="closeLogInDialog()"><div ng-click="inTextLinkClickHandler($event)" tl-message="\'T:gp.link_card.failed_message\'" message-html="true"></div></div>'),e.put("directives/guest-log-in-modal/guest-adding-info-modal-view/guest-adding-info-modal-view.html",'<div class="x-gaimv"><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="\'T:guest_adding_info_modal_view.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><div ng-form name="addingInfoForm"><div class="x-glim__form-hint" tl-message="\'T:guest_adding_info_modal_view.add_info_hint\'"></div><div class="x-glim__label-container x-glim__phone-number-container"><label><span class="x-glim__label" tl-message="\'T:common.telephone\'"></span><div class="x-glim__control x-glim__full-width"><div tl-phone-control parent-form="addingInfoForm" input-name="phoneName" ng-model="socialPhone" on-keyup-action="catchAddInfoEnterKey()"></div></div><div tl-error-tooltip input-name="phoneName" hide="!showPhoneValidation()" custom-content-class="\'x-glim__validation-phone-arrow\'" error-message="{{\'T:validation.phone_nonformed\' | message}}" required-error-message="{{\'T:validation.phone_req\' | message}}"></div></label></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" ng-click="saveAddedInfo()" ng-disabled="loginationInProgress()"><svg ng-show="loginationInProgress()" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!loginationInProgress()" tl-message="\'T:guest_adding_info_modal_view.adding_info_submit\'"></span></div></div></div></div>'),e.put("directives/guest-log-in-modal/guest-common-log-in-modal-view/guest-common-log-in-modal-view.html",'<div class="x-gclimv"><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="\'T:guest_common_log_in_modal_view.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><div><div class="x-glim__social-header uppercase" tl-message="\'T:guest_common_log_in_modal_view.login_with_socials\'"></div><div tl-social-button-pack class="x-gclimv__social-button-container" source="\'log-in\'" guest-log-in-action="postSocialLogInHandler()"></div><div ng-if="enabledNewSocialsSurvey" class="hyponline-48__login"><div tl-hyponline48 source="\'guest-common-log-in-modal-view\'"></div></div></div><div class="x-glim__divider"><div class="x-glim__divider-line"></div><div class="x-glim__divider-or uppercase" tl-message="\'T:guest_log_in_modal.or\'"></div><div class="x-glim__divider-line"></div></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn" ng-click="goFromCommonToLogInView()" tl-message="\'T:guest_common_log_in_modal_view.login_with_email\'"></div><div class="x-glim__no-account"><span tl-message="\'T:guest_log_in_modal.no_account\'"></span> <b class="link -normal" ng-click="goFromCommonToCreateAccountView()" tl-message="\'T:guest_log_in_modal.register_new_account\'"></b></div><div class="x-glim__policies" tl-message="\'T:guest_log_in_modal.agreement\'" message-html="true" ng-click="inTextLinkClickHandler($event)"></div></div></div>'),e.put("directives/guest-log-in-modal/guest-log-in-modal-view/guest-log-in-modal-view.html",'<div class="x-glimv"><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="\'T:guest_log_in_modal_view.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><form name="loginForm"><div class="tl-message" ng-class="getErrorTypeClassName()" ng-if="lastResponseCode && lastResponseCode != responseCodes.Success" ng-click="inTextLinkClickHandler($event)" ng-bind-html="getErrorLocalizationString() | message | tlUnsafe"></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:guest_log_in_modal_view.login\'"></span><div class="x-glim__field-container x-glim__control"><input class="form-control" name="login" type="text" autocomplete="username email" maxlength="200" tl-pattern="noEmoji" tl-login-input ng-model="loginData.login" ng-required="true" ng-keyup="catchLogInEnterKey()"></input> <span class="form-control-icon" ng-hide="hideValidation()" ng-class="{\'_state_valid\': loginForm.login.$valid, \'_state_invalid\': !loginForm.login.$valid}"><svg ng-if="loginForm.login.$valid"><use xlink:href="#valid"></use></svg> <svg ng-if="!loginForm.login.$valid"><use xlink:href="#warning"></use></svg></span></div><div tl-error-tooltip input-name="\'login\'" hide="hideValidation()" custom-content-class="\'x-glim__validation-common-arrow\'" required-error-message="{{\'T:validation.login_req\' | message}}" error-message="{{\'T:validation.login_nonformed\' | message}}"></div></label></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:guest_log_in_modal_view.password\'"></span><div class="x-grmv__password-field"><input class="form-control x-grmv__password-field" name="password" type="{{passwordVisibility ? \'text\' : \'password\'}}" autocomplete="current-password" maxlength="200" tl-pattern="noEmoji" ng-trim="false" ng-model="loginData.password" ng-required="true" ng-keyup="catchLogInEnterKey()"></input> <span class="form-control-icon x-grmv__show-password-btn" ng-click="togglePasswordVisibility()"><svg class="x-grmv__password-hidden-state" ng-if="!passwordVisibility"><use xlink:href="#eye"></use></svg> <svg class="x-grmv__password-visible-state" ng-if="passwordVisibility"><use xlink:href="#eye-filled"></use></svg></span></div><div tl-error-tooltip input-name="\'password\'" hide="hideValidation()" custom-content-class="\'x-glim__validation-common-arrow\'" required-error-message="{{\'T:validation.password_req\' | message}}"></div></label></div><div class="x-glimv__forgot-password-container"><span class="link -normal" ng-click="goToResetPasswordView()" tl-message="\'T:guest_log_in_modal_view.forgot_password\'"></span></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__registration-btn" ng-click="logIn()" ng-disabled="loginationInProgress()"><svg ng-show="loginationInProgress()" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!loginationInProgress()" tl-message="\'T:common.log_in\'"></span></div></form><div class="x-glim__divider"><div class="x-glim__divider-line"></div><div class="x-glim__divider-or uppercase" tl-message="\'T:guest_log_in_modal.or\'"></div><div class="x-glim__divider-line"></div></div><div><div tl-social-button-pack source="\'log-in-tl\'" guest-log-in-action="postSocialLogInHandler()"></div><div ng-if="enabledNewSocialsSurvey" class="hyponline-48__login"><div tl-hyponline48 source="\'guest-log-in-modal-view\'"></div></div><div class="x-glim__no-account"><span tl-message="\'T:guest_log_in_modal.no_account\'"></span> <b class="link -normal" ng-click="goFromLogInToCreateAccountView()" tl-message="\'T:guest_log_in_modal.register_new_account\'"></b></div></div><div class="x-glim__policies" tl-message="\'T:guest_log_in_modal.agreement\'" message-html="true" ng-click="inTextLinkClickHandler($event)"></div></div></div>'),e.put("directives/guest-log-in-modal/guest-log-in-modal.html",'<div id="guestLogInModal" class="x-glim" rel="content"><div tl-guest-common-log-in-modal-view ng-show="currentModalView == modalViews.CommonLogIn"></div><div tl-guest-register-modal-view ng-show="currentModalView == modalViews.Register"></div><div tl-guest-log-in-modal-view ng-show="currentModalView == modalViews.LogIn"></div><div tl-guest-adding-info-modal-view ng-show="currentModalView == modalViews.AddingInfo"></div><div tl-guest-add-loyalty-card-modal-view ng-show="currentModalView == modalViews.AddLoyaltyCard"></div><div tl-successfully-loyalty-card-linking-modal-view ng-show="currentModalView == modalViews.SuccessfullyLoyaltyCardLinking"></div><div tl-failed-loyalty-card-linking-modal-view ng-show="currentModalView == modalViews.FailedLoyaltyCardLinking"></div><div tl-successfully-loyalty-card-issuing-modal-view ng-show="currentModalView == modalViews.SuccessfullyLoyaltyCardIssuing"></div><div tl-guest-reset-password-modal-view ng-show="currentModalView == modalViews.ResetPassword"></div><div tl-guest-profile-not-loaded-error-modal-view ng-show="currentModalView == modalViews.ProfileNotLoadedError"></div></div>'),e.put("directives/guest-log-in-modal/guest-profile-not-loaded-error-modal-view/guest-profile-not-loaded-error-modal-view.html",'<div class="x-gpnlemv"><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="\'T:error.auto_login_failed.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><span tl-message="\'T:error.auto_login_failed.description\'"></span> <span class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" ng-click="goToLogInView()" tl-message="\'T:error.auto_login_failed.go_to_login\'"></span></div></div>'),e.put("directives/guest-log-in-modal/guest-register-modal-view/guest-register-modal-view.html",'<div class="x-grmv"><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="\'T:guest_register_modal_view.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><form name="registerAccountForm"><div class="tl-message" ng-class="getErrorTypeClassName()" ng-if="lastResponseCode && lastResponseCode != responseCodes.Success" ng-click="inTextLinkClickHandler($event)" ng-bind-html="getErrorLocalizationString() | message | tlUnsafe"></div><div class="x-glim__label-container x-grmv__full-name-container"><div class="x-grmv__half-width-container"><label><span class="x-glim__label" tl-message="\'T:guest_register_modal_view.first_name\'"></span><div class="x-glim__control"><input class="form-control" name="firstName" type="text" autocomplete="given-name" maxlength="200" tl-pattern="name" ng-required="true" ng-model="newAccount.firstName" ng-keyup="catchRegisterEnterKey()"></input> <span class="form-control-icon" ng-hide="hideRegisterValidation()" ng-class="{\'_state_valid\': registerAccountForm.firstName.$valid, \'_state_invalid\': !registerAccountForm.firstName.$valid}"><svg ng-if="registerAccountForm.firstName.$valid"><use xlink:href="#valid"></use></svg> <svg ng-if="!registerAccountForm.firstName.$valid"><use xlink:href="#warning"></use></svg></span></div></label><div tl-error-tooltip input-name="\'firstName\'" hide="hideRegisterValidation()" custom-content-class="\'x-glim__validation-common-arrow\'" required-error-message="{{\'T:validation.firstname_req\' | message}}"></div></div><div class="x-grmv__half-width-container"><label><span class="x-glim__label" tl-message="\'T:guest_register_modal_view.last_name\'"></span><div class="x-glim__control"><input class="form-control" name="lastName" type="text" autocomplete="family-name" maxlength="200" tl-pattern="name" ng-required="true" ng-model="newAccount.lastName" ng-keyup="catchRegisterEnterKey()"></input> <span class="form-control-icon" ng-hide="hideRegisterValidation()" ng-class="{\'_state_valid\': registerAccountForm.lastName.$valid, \'_state_invalid\': !registerAccountForm.lastName.$valid}"><svg ng-if="registerAccountForm.lastName.$valid"><use xlink:href="#valid"></use></svg> <svg ng-if="!registerAccountForm.lastName.$valid"><use xlink:href="#warning"></use></svg></span></div></label><div tl-error-tooltip input-name="\'lastName\'" hide="hideRegisterValidation()" custom-content-class="\'x-glim__validation-common-arrow\'" required-error-message="{{\'T:validation.lastname_req\' | message}}"></div></div></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:guest_register_modal_view.phone_number\'"></span><div class="x-glim__control x-glim__full-width"><div tl-phone-control parent-form="registerAccountForm" input-name="phoneFieldName" ng-model="registerPhone"></div></div></label><div tl-error-tooltip input-name="phoneFieldName" hide="hideRegisterValidation()" custom-content-class="\'x-glim__validation-phone-arrow\'" error-message="{{\'T:validation.phone_nonformed\' | message}}" required-error-message="{{\'T:validation.phone_req\' | message}}"></div></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:guest_register_modal_view.email\'"></span><div class="x-glim__control x-glim__full-width"><span class="x-glim__background-icon"><svg><use xlink:href="#email"></use></svg> </span><input class="x-glim__email form-control" name="email" type="email" autocomplete="username email" maxlength="200" tl-pattern="noEmoji" tl-email-pattern ng-required="true" ng-model="newAccount.email" ng-keyup="catchRegisterEnterKey()"></input> <span class="form-control-icon" ng-hide="hideRegisterValidation()" ng-class="{\'_state_valid\': registerAccountForm.email.$valid, \'_state_invalid\': !registerAccountForm.email.$valid}"><svg ng-if="registerAccountForm.email.$valid"><use xlink:href="#valid"></use></svg> <svg ng-if="!registerAccountForm.email.$valid"><use xlink:href="#warning"></use></svg></span></div></label><div tl-error-tooltip input-name="\'email\'" hide="hideRegisterValidation()" custom-content-class="\'x-glim__validation-email-arrow\'" required-error-message="{{\'T:validation.email_req\' | message}}" error-message="{{\'T:validation.email_nonformed\' | message}}"></div></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:guest_register_modal_view.password\'"></span><div class="x-grmv__password-field x-glim__control"><input class="form-control x-grmv__password-field" name="password" type="{{passwordVisibility ? \'text\' : \'password\'}}" autocomplete="new-password" minlength="8" maxlength="200" tl-pattern="noEmoji" ng-trim="false" ng-required="true" ng-model="newAccount.password" ng-keyup="catchRegisterEnterKey()"></input> <span class="form-control-icon x-grmv__show-password-btn" ng-click="togglePasswordVisibility()"><svg class="x-grmv__password-hidden-state" ng-if="!passwordVisibility"><use xlink:href="#eye"></use></svg> <svg class="x-grmv__password-visible-state" ng-if="passwordVisibility"><use xlink:href="#eye-filled"></use></svg></span></div></label><div tl-error-tooltip input-name="\'password\'" hide="hideRegisterValidation()" custom-content-class="\'x-glim__validation-common-arrow\'" required-error-message="{{\'T:validation.password_req\' | message}}" error-message="{{\'T:validation.password_length\' | message}}"></div></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__registration-btn" ng-click="registerAccount()" ng-disabled="registrationInProgress()"><svg ng-show="registrationInProgress()" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!registrationInProgress()" tl-message="\'T:guest_register_modal_view.register_submit\'"></span></div></form><div class="x-glim__divider"><div class="x-glim__divider-line"></div><div class="x-glim__divider-or uppercase" tl-message="\'T:guest_log_in_modal.or\'"></div><div class="x-glim__divider-line"></div></div><div><div tl-social-button-pack guest-log-in-action="postSocialLogInHandler()" source="\'registration\'"></div><div ng-if="enabledNewSocialsSurvey" class="hyponline-48__login"><div tl-hyponline48 source="\'guest-register-modal-view\'"></div></div><div class="x-glim__no-account"><span tl-message="\'T:guest_register_modal_view.already_registered\'"></span> <b class="link -normal" ng-click="goToLogInView()" tl-message="\'T:common.log_in\'"></b></div></div><div class="x-glim__policies" tl-message="\'T:guest_log_in_modal.agreement\'" message-html="true" ng-click="inTextLinkClickHandler($event)"></div></div></div>'),e.put("directives/guest-log-in-modal/guest-reset-password-modal-view/guest-reset-password-modal-view.html",'<div class="x-gprmv"><div class="x-glim__header-container"><div class="x-glim__header-button" ng-click="backToPreviousView()"><svg><use xlink:href="#arrow-left-long"></use></svg></div><h1 class="x-glim__header" tl-message="\'T:guest_reset_password_modal_view.title\'"></h1><div class="x-glim__header-button" ng-click="closeLogInDialog()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><form name="resetPasswordForm" ng-show="currentState == states.enterEmail"><div class="x-glim__form-hint" tl-message="\'T:guest_reset_password_modal_view.password_reset_hint\'"></div><div class="tl-message" ng-class="getErrorTypeClassName()" ng-if="lastResponseCode && lastResponseCode != responseCodes.Success" ng-click="inTextLinkClickHandler($event)" ng-bind-html="getErrorLocalizationString() | message | tlUnsafe"></div><div class="x-glim__label-container"><label><span class="x-glim__label" tl-message="\'T:guest_reset_password_modal_view.email\'"></span><div class="x-glim__control x-glim__full-width"><span class="x-glim__background-icon"><svg><use xlink:href="#email"></use></svg> </span><input class="x-glim__email form-control" name="targetEmail" type="email" autocomplete="username email" maxlength="200" tl-pattern="noEmoji" tl-email-pattern ng-required="true" ng-model="targetEmail" ng-keyup="catchResetEmailSendingEnterKey()"></input> <span class="form-control-icon" ng-hide="hideResetPasswordEmailValidation()" ng-class="{\'_state_valid\': resetPasswordForm.targetEmail.$valid, \'_state_invalid\': !resetPasswordForm.targetEmail.$valid}"><svg ng-if="resetPasswordForm.targetEmail.$valid"><use xlink:href="#valid"></use></svg> <svg ng-if="!resetPasswordForm.targetEmail.$valid"><use xlink:href="#warning"></use></svg></span></div></label><div tl-error-tooltip input-name="\'targetEmail\'" hide="hideResetPasswordEmailValidation()" custom-content-class="\'x-glim__validation-email-arrow\'" required-error-message="{{\'T:validation.email_req\' | message}}" error-message="{{\'T:validation.email_nonformed\' | message}}"></div></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" ng-click="resetPassword()" ng-disabled="resetEmailSendingInProgress"><svg ng-show="resetEmailSendingInProgress" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!resetEmailSendingInProgress" tl-message="\'T:guest_reset_password_modal_view.password_reset_submit\'"></span></div></form><form name="resetCodeForm" ng-show="currentState == states.enterCode"><div class="x-glim__form-hint" ng-bind="\'T:guest_reset_password_modal_view.enter_code_hint\' | message: {guestEmail: targetEmail}"></div><div class="x-glim__control x-glim__full-width"><div tl-secret-code-input is-showed="currentState == states.enterCode" code="code" is-wrong-code="isWrongCode" code-length="codeLength" tl-disabled="checkCodeSendingInProgress"></div></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" ng-click="onCheckCodeClick()" ng-disabled="checkCodeSendingInProgress || code.length != codeLength"><svg ng-show="checkCodeSendingInProgress" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!checkCodeSendingInProgress" tl-message="\'T:guest_reset_password_modal_view.code_submit\'"></span></div></form><form name="setNewPasswordForm" ng-show="currentState == states.enterNewPassword"><div class="x-glim__form-hint" tl-message="\'T:guest_reset_password_modal_view.enter_new_password_hint\'"></div><div class="x-glim__label-container"><div class="x-glim__control x-glim__full-width"><label><span class="x-glim__label" tl-message="\'T:guest_register_modal_view.password\'"></span><div class="x-grmv__password-field"><input type="text" autocomplete="username email" style="display: none;"></input> <input class="form-control x-grmv__password-field" name="newPassword" type="{{passwordVisibility ? \'text\' : \'password\'}}" autocomplete="new-password" minlength="8" maxlength="200" tl-pattern="noEmoji" ng-trim="false" ng-required="true" ng-model="newPassword" ng-keyup="catchSetNewPasswordEnterKey()"></input> <span class="form-control-icon x-grmv__show-password-btn" ng-click="togglePasswordVisibility()"><svg class="x-grmv__password-hidden-state" ng-if="!passwordVisibility"><use xlink:href="#eye"></use></svg> <svg class="x-grmv__password-visible-state" ng-if="passwordVisibility"><use xlink:href="#eye-filled"></use></svg></span></div></label></div><div tl-error-tooltip input-name="\'newPassword\'" hide="hideResetNewPasswordValidation()" custom-content-class="\'x-glim__validation-common-arrow\'" required-error-message="{{\'T:validation.password_req\' | message}}" error-message="{{\'T:validation.password_length\' | message}}"></div></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" ng-click="setNewPassword()" ng-disabled="setNewPasswordInProgress"><svg ng-show="setNewPasswordInProgress" class="loader"><use xlink:href="#loader"></use></svg> <span ng-show="!setNewPasswordInProgress" tl-message="\'T:guest_reset_password_modal_view.set_password_and_login_submit\'"></span></div></form></div></div>'),e.put("directives/guest-log-in-modal/loyalty-card-linking-common-modal-view/loyalty-card-linking-common-modal-view.html",'<div class="x-lclcmv"><div class="x-glim__header-container"><h1 class="x-glim__header" tl-message="titleText"></h1><div class="x-glim__header-button" ng-click="onCloseButtonClick()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-glim__widget-content"><div ng-class="[\'x-lclcmv__image\', imageKind ? \'-\' + imageKind : \'\']" ng-show="imageKind"></div><div ng-transclude></div><div class="tl-btn tl-btn_on_popup x-glim__full-width-btn x-glim__done-btn" tl-message="\'T:guest_registration_status.done\'" ng-click="onOkButtonClick()"></div></div></div>'),e.put("directives/guest-log-in-modal/successfully-loyalty-card-issuing-modal-view/successfully-loyalty-card-issuing-modal-view.html",'<div tl-loyalty-card-linking-common-modal-view title-text="\'T:gp.congratulations\'" image-kind="\'successed\'" on-close-button-click="closeLogInDialog()" on-ok-button-click="closeLogInDialog()"><div tl-message="\'T:gp.card_issuing.successed_message\'"></div></div>'),e.put("directives/guest-log-in-modal/successfully-loyalty-card-linking-modal-view/successfully-loyalty-card-linking-modal-view.html",'<div tl-loyalty-card-linking-common-modal-view title-text="\'T:gp.link_card.successed_title\'" image-kind="\'successed\'" on-close-button-click="closeLogInDialog()" on-ok-button-click="closeLogInDialog()"><div tl-message="\'T:gp.link_card.successed_message\'"></div></div>')}),tl.registerDirective("tlFailedLoyaltyCardLinkingModalView",[function(){return{restrict:"EA",scope:!1,templateUrl:"directives/guest-log-in-modal/failed-loyalty-card-linking-modal-view/failed-loyalty-card-linking-modal-view.html"}}]),tl.registerDirective("tlGuestAddLoyaltyCardModalView",["$q","serviceFactory",function(e,o){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/add-loyalty-card/add-loyalty-card.html",controller:["$scope",function(t){var i=o.guestProfileService,n=o.orderService.getOrder();t.phoneNumber=new tl.CustomerPhoneNumber(i.guestProfile.phoneNumber),t.pending=!1,t.hideLinkCardValidation=function(){return!t.linkCardForm.$submitted};t.save=function(){t.linkCardForm.$setSubmitted(),t.linkCardForm.$valid&&!t.pending&&(t.linkCardForm.$setPristine(),t.pending=!0,e.when(t.phoneNumber.number()===i.guestProfile.phoneNumber||i.saveAdditionGuestInfo(t.phoneNumber)).then(function(e){e?(e=tl.CustomerPhoneNumber.fromString(t.phoneNumber.phone),n.customer.phone=e,i.linkLoyaltyCard(e.number()).then(function(){t.goToView(tl.directive.helper.GuestLogInModalView.SuccessfullyLoyaltyCardLinking)}).catch(function(){t.goToView(tl.directive.helper.GuestLogInModalView.FailedLoyaltyCardLinking)}).finally(function(){t.pending=!1})):(t.pending=!1,t.lastResponseCode=tl.directive.helper.GuestLoginResponseCodes.UnknownError)}))},t.cancel=function(){t.closeLogInDialog()},t.catchRegisterEnterKey=function(){event&&event.which===tl.KeyCode.Enter&&t.save()}}]}}]),tl.registerDirective("tlGuestAddingInfoModalView",["serviceFactory",function(e){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/guest-adding-info-modal-view/guest-adding-info-modal-view.html",controller:["$scope",function(t){var i=e.guestProfileService,n=e.orderService.getOrder();t.socialPhone=new tl.CustomerPhoneNumber,t.phoneChangedAtLeastOnce=!1,t.phoneName=_.uniqueId("phone_"),t.showPhoneValidation=function(){return t.addingInfoForm.$submitted||t.phoneChangedAtLeastOnce},t.saveAddedInfo=function(){t.addingInfoForm.$setSubmitted(),t.addingInfoForm.$valid&&!t.addInfoInProgress()&&(t.addingInfoForm.$setPristine(),i.setLoadingStatus(),i.saveAdditionGuestInfo(t.socialPhone).then(function(e){e?(tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.Integration,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"get-number"},!0),e=tl.CustomerPhoneNumber.fromString(t.socialPhone.phone),n.customer.phone=e,i.setLoadedStatus(),i.linkLoyaltyCard(e.number()).then(function(){t.goToView(tl.directive.helper.GuestLogInModalView.SuccessfullyLoyaltyCardIssuing)}).catch(function(){t.closeLogInDialog()})):i.setNotLoadedStatus()}))},t.backToCommonLogInView=function(){t.goToView(tl.directive.helper.GuestLogInModalView.CommonLogIn)},t.addInfoInProgress=function(){return i.loadingStatus==tl.GuestProfileLoadingStatus.Loading},t.catchAddInfoEnterKey=function(){event.which===tl.KeyCode.Enter&&t.saveAddedInfo()}}]}}]),tl.registerDirective("tlGuestCommonLogInModalView",[function(){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/guest-common-log-in-modal-view/guest-common-log-in-modal-view.html",controller:["$scope",function(e){e.goFromCommonToCreateAccountView=function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"click",source:"log-in",buttonName:"go-to-registration-view"},!0),e.goToView(tl.directive.helper.GuestLogInModalView.Register)},e.goFromCommonToLogInView=function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"click",source:"log-in",buttonName:"go-to-log-in-view"},!0),e.goToView(tl.directive.helper.GuestLogInModalView.LogIn)}}]}}]),tl.registerDirective("tlGuestLogInModalView",["$timeout","serviceFactory",function(e,n){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/guest-log-in-modal-view/guest-log-in-modal-view.html",controller:["$scope",function(t){var i=n.guestProfileService;t.responseCodes=tl.directive.helper.GuestLoginResponseCodes,t.lastResponseCode=null,t.loginData=new tl.directive.helper.LoginData,t.goToResetPasswordView=function(){t.goToView(tl.directive.helper.GuestLogInModalView.ResetPassword)},t.logIn=function(){var e;t.loginForm.$setSubmitted(),t.loginForm.$valid&&!t.loginationInProgress()&&(-1===t.loginData.login.indexOf("@")&&(e=(e=t.loginData.login.replace(/(?!^)\+/g,"")).replace(/[^0-9\+]/g,""),t.loginData.login=e,"8"===t.loginData.login[0]&&11===t.loginData.login.length&&(t.loginData.login="+7"+t.loginData.login.substr(1))),i.setLoadingStatus(),t.loginForm.$setPristine(),i.logIn(t.loginData).then(function(e){e?(t.lastResponseCode=e.code,e.code===tl.directive.helper.GuestLoginResponseCodes.Success&&e.token?(tl.GuestProfileUtil.setGpToken(tl.BookingFormSettings.getInstance().providerId,e.token),t.postAccountLogInHandler()):i.setNotLoadedStatus()):(t.lastResponseCode=tl.directive.helper.GuestLoginResponseCodes.UnknownError,i.setNotLoadedStatus())}))},t.loginationInProgress=function(){return i.loadingStatus==tl.GuestProfileLoadingStatus.Loading&&i.lastAuthService==tl.AuthServiceKind.Tl},t.hideValidation=function(){return!t.loginForm.$submitted},t.catchLogInEnterKey=function(){event.which===tl.KeyCode.Enter&&t.logIn()},t.goFromLogInToCreateAccountView=function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"click",source:"log-in-tl",buttonName:"go-to-registration-view"},!0),t.goToView(tl.directive.helper.GuestLogInModalView.Register)}}]}}]),tl.registerDirective("tlLoginInput",["$parse",function(s){return{require:"ngModel",link:function(r,e,a,t){t.$validators.loginValidity=function(e,t){var i=a.ngRequired&&s(a.ngRequired)(r)||a.required&&s(a.required)(r);if(!e)return!1;var n=-1!==e.indexOf("@"),o=(o=e.replace(/(?!^)\+/g,"")).replace(/[^0-9\+]/g,""),o=!n&&0!==o.length,e=_.isUndefined(e)||n||o;return!i||e}}}}]),this),Experiment=(tl.registerDirective("tlGuestLogInModal",["$q","$compile","$state","serviceFactory",function(o,r,a,s){return{restrict:"EA",scope:!1,templateUrl:"directives/guest-log-in-modal/guest-log-in-modal.html",controller:["$scope","$element",function(i,e){i.responseCodes=tl.directive.helper.GuestLoginResponseCodes;var t=s.guestProfileService,n=(i.modalViews=tl.directive.helper.GuestLogInModalView,i.currentModalView=i.currentModalView||tl.directive.helper.GuestLogInModalView.CommonLogIn,i.closeLogInDialog=function(){t.isAuthenticatedUser()&&(t.authorizationNotify(tl.SearchCriteriaInformerMessageType.GuestLogIn),i.applyDiscount()),i.$applyAsync(),tl.ModalManager.getInstance().close()},i.postRegisterHandler=function(){return t.loadProfileInfo().then(function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"auth",source:"tl-account"},!0);var e=t.guestProfile.loyaltyCard;(e?o.when(e):t.linkLoyaltyCard(t.guestProfile.phoneNumber)).then(function(e){i.goToView(tl.directive.helper.GuestLogInModalView.SuccessfullyLoyaltyCardIssuing)}).catch(function(){i.closeLogInDialog()})}).catch(function(){t.logOut(),i.currentModalView=tl.directive.helper.GuestLogInModalView.ProfileNotLoadedError})},i.postAccountLogInHandler=function(){return t.loadProfileInfo().then(function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"auth",source:"tl-account"},!0),t.guestProfile.loyaltyCard?i.closeLogInDialog():t.linkLoyaltyCard(t.guestProfile.phoneNumber).then(function(){i.goToView(tl.directive.helper.GuestLogInModalView.SuccessfullyLoyaltyCardIssuing)}).catch(function(){i.closeLogInDialog()})}).catch(function(){t.logOut(),i.currentModalView=tl.directive.helper.GuestLogInModalView.ProfileNotLoadedError})},i.postSocialLogInHandler=function(){return t.loadProfileInfo().then(function(){!t.guestProfile.phoneNumber&&tl.ModalManager.getInstance().opened()?i.goToView(tl.directive.helper.GuestLogInModalView.AddingInfo):t.guestProfile.loyaltyCard?i.closeLogInDialog():t.linkLoyaltyCard(t.guestProfile.phoneNumber).then(function(){i.goToView(tl.directive.helper.GuestLogInModalView.SuccessfullyLoyaltyCardIssuing)}).catch(function(){i.closeLogInDialog()})}).catch(function(){t.logOut(),i.currentModalView=tl.directive.helper.GuestLogInModalView.ProfileNotLoadedError})},i.scrollToTop=function(){var e=document.getElementById("guestLogInModal");e&&(e.scrollTop=0)},i.applyDiscount=function(){a.reload()},i.inTextLinkClickHandler=function(e){var e=e.target.getAttribute("rel");"tou"==e?tl.ModalManager.getInstance().open(n(tl.PolicyPageType.UserAgreement),{stacked:!0}):"cp"==e?tl.ModalManager.getInstance().open(n(tl.PolicyPageType.PrivacyPolicy),{stacked:!0}):"to-log-in"==e?i.goToView(tl.directive.helper.GuestLogInModalView.LogIn):"to-link-loyalty-card"==e?i.goToView(tl.directive.helper.GuestLogInModalView.AddLoyaltyCard):"to-guest-account"==e&&(e=t.getGuestAccountUrl())&&window.open(e,"_blank")},i.getErrorLocalizationString=function(){switch(i.lastResponseCode){case tl.directive.helper.GuestLoginResponseCodes.InvalidLoginOrPassword:return"T:guest_log_in_error.invalid_login_or_password";case tl.directive.helper.GuestLoginResponseCodes.AccountAlreadyExists:return"T:guest_log_in_error.account_already_exists_error";case tl.directive.helper.GuestLoginResponseCodes.InvalidLoginForPasswordReset:return"T:guest_log_in_error.invalid_login_for_password_reset";case tl.directive.helper.GuestLoginResponseCodes.WrongCode:return"T:guest_log_in_error.wrong_reset_code";case tl.directive.helper.GuestLoginResponseCodes.TooManyAttempts:return"T:guest_log_in_error.too_many_attempts";default:return"T:guest_log_in_error.unknown_error"}},i.getErrorTypeClassName=function(){var e=_.includes([tl.directive.helper.GuestLoginResponseCodes.UnknownError,tl.directive.helper.GuestLoginResponseCodes.AudienceAppNotSpecified,tl.directive.helper.GuestLoginResponseCodes.UnknownAudienceApp,tl.directive.helper.GuestLoginResponseCodes.WrongDeviceTicket],i.lastResponseCode),t=(_.includes([tl.directive.helper.GuestLoginResponseCodes.AccountAlreadyExists,tl.directive.helper.GuestLoginResponseCodes.InvalidLoginOrPassword,tl.directive.helper.GuestLoginResponseCodes.InvalidLoginForPasswordReset,tl.directive.helper.GuestLoginResponseCodes.WrongCode,tl.directive.helper.GuestLoginResponseCodes.TooManyAttempts],i.lastResponseCode),_.includes([tl.directive.helper.GuestLoginResponseCodes.Success],i.lastResponseCode));return e?"-type-error":t?"-type-success":"-type-alert"},i.goToView=function(e){i.lastResponseCode=null,i.currentModalView=e,i.scrollToTop()},function(t){return o.when(function(){var e=i;return e.contentType=t,e.bookingFormInfo=(_this.bookingFormInfoPromise||(_this.bookingFormInfoPromise=s.bookingService.getBookingFormInfo()),_this.bookingFormInfoPromise),r('<tl-policy content-type="{{contentType}}" booking-form-info="bookingFormInfo" />')(e)[0]})});i.enabledNewSocialsSurvey=tl.BookingFormSettings.getInstance().hasExperiment(tl.Experiment.NewSocialsSurvey)}]}}]),tl.registerDirective("tlGuestProfileNotLoadedErrorModalView",[function(){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/guest-profile-not-loaded-error-modal-view/guest-profile-not-loaded-error-modal-view.html",controller:["$scope",function(e){e.goToLogInView=function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:tl.BookingFormSettings.getInstance().providerId,action:"click",source:"auto_login_failed",buttonName:"go-to-log-in-view"},!0),e.goToView(tl.directive.helper.GuestLogInModalView.LogIn)}}]}}]),tl.Experiment),ResetPasswordState=(tl.registerDirective("tlGuestRegisterModalView",["serviceFactory",function(e){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/guest-register-modal-view/guest-register-modal-view.html",controller:["$scope",function(t){var i=e.guestProfileService,n=tl.BookingFormSettings.getInstance();t.phoneFieldName=_.uniqueId("phone_"),t.passwordVisibility=!1,t.newAccount=i.getUiGuestAccount(),t.registerPhone=new tl.CustomerPhoneNumber,t.hasLoyaltyProgram=n.hasLoyaltyProgram(),t.goToLogInView=function(){tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:n.providerId,action:"click",source:"registration",buttonName:"go-to-log-in-view"},!0),t.goToView(tl.directive.helper.GuestLogInModalView.LogIn)},t.togglePasswordVisibility=function(){t.passwordVisibility=!t.passwordVisibility},t.registerAccount=function(){t.registerAccountForm.$setSubmitted(),t.registerAccountForm.$valid&&!t.registrationInProgress()&&(i.setLoadingStatus(),t.registerAccountForm.$setPristine(),tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:n.providerId,action:"click",source:"register-button"},!0),t.newAccount.phone=t.registerPhone,i.registerGuestAccount(t.newAccount).then(function(e){e?(t.lastResponseCode=e.code,e.code===tl.directive.helper.GuestLoginResponseCodes.Success&&e.token?(tl.TrackerService.trackExperiment(tl.GuestProfileEventSource.DiscountBanner,{providerId:n.providerId,action:"register",source:"register-button"},!0),tl.GuestProfileUtil.setGpToken(n.providerId,e.token),t.postRegisterHandler()):i.setNotLoadedStatus()):(t.lastResponseCode=tl.directive.helper.GuestLoginResponseCodes.UnknownError,i.setNotLoadedStatus())}))},t.registrationInProgress=function(){return i.loadingStatus==tl.GuestProfileLoadingStatus.Loading&&i.lastAuthService==tl.AuthServiceKind.Tl},t.hideRegisterValidation=function(){return!t.registerAccountForm.$submitted},t.catchRegisterEnterKey=function(){event&&event.which===tl.KeyCode.Enter&&t.registerAccount()}}]}}]),function(){function e(){}return e.enterEmail="enter-email",e.enterCode="enter-code",e.enterNewPassword="enter-new-password",e.done="done",e}()),tl,tl,tl,tl,tl,tl,tl,tl,tl,tlCartDetachedDirective=(tl.registerDirective("tlGuestResetPasswordModalView",["serviceFactory",function(e){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"directives/guest-log-in-modal/guest-reset-password-modal-view/guest-reset-password-modal-view.html",controller:["$scope",function(i){i.lastResponseCode=null,i.targetEmail="",i.newPassword="",i.code=null,i.codeLength=4,i.states=ResetPasswordState,i.currentState=ResetPasswordState.enterEmail,i.firstSent=!0,i.isWrongCode=!1,i.resetEmailSendingInProgress=!1,i.checkCodeSendingInProgress=!1,i.setNewPasswordInProgress=!1,i.backToPreviousView=function(){i.currentState===ResetPasswordState.enterCode?i.currentState=ResetPasswordState.enterEmail:i.goToView(tl.directive.helper.GuestLogInModalView.LogIn)},i.resetPassword=function(){i.resetPasswordForm.$setSubmitted(),i.resetPasswordForm.$valid&&!i.resetEmailSendingInProgress&&(i.resetEmailSendingInProgress=!0,i.resetPasswordForm.$setPristine(),i.resetPasswordForm.$setUntouched(),e.guestProfileService.resetPassword(i.targetEmail).then(function(e){e?(i.lastResponseCode=e.code,i.lastResponseCode===tl.directive.helper.GuestLoginResponseCodes.Success&&(i.currentState=ResetPasswordState.enterCode)):i.lastResponseCode=tl.directive.helper.GuestLoginResponseCodes.UnknownError,i.resetEmailSendingInProgress=!1}))},i.onCheckCodeClick=function(){i.checkCodeSendingInProgress||i.checkCode()},i.checkCode=function(){i.isWrongCode=!1,i.resetCodeForm.$setSubmitted(),i.resetCodeForm.$valid&&!i.checkCodeSendingInProgress&&(i.checkCodeSendingInProgress=!0,e.guestProfileService.checkResetCode(i.targetEmail,i.code).then(function(e){i.checkCodeSendingInProgress=!1,e?(i.lastResponseCode=e.code,i.lastResponseCode===tl.directive.helper.GuestLoginResponseCodes.Success?i.currentState=ResetPasswordState.enterNewPassword:i.isWrongCode=!0):i.lastResponseCode=tl.directive.helper.GuestLoginResponseCodes.UnknownError}))},i.setNewPassword=function(){i.setNewPasswordForm.$setSubmitted(),i.setNewPasswordForm.$valid&&!i.setNewPasswordInProgress&&(i.setNewPasswordInProgress=!0,e.guestProfileService.setNewPassword(i.targetEmail,i.code,i.newPassword).then(function(e){i.setNewPasswordInProgress=!1,e?(i.lastResponseCode=e.code,i.lastResponseCode===tl.directive.helper.GuestLoginResponseCodes.Success&&e.token&&(tl.GuestProfileUtil.setGpToken(tl.BookingFormSettings.getInstance().providerId,e.token),i.postAccountLogInHandler())):i.lastResponseCode=tl.directive.helper.GuestLoginResponseCodes.UnknownError}))},i.hideResetPasswordEmailValidation=function(){return!i.resetPasswordForm.$submitted},i.hideResetNewPasswordValidation=function(){return!i.setNewPasswordForm.$submitted},i.catchResetEmailSendingEnterKey=function(){event.which===tl.KeyCode.Enter&&i.resetPassword()},i.catchSetNewPasswordEnterKey=function(){event.which===tl.KeyCode.Enter&&i.setNewPassword()},i.$watch(function(){return i.code},function(e,t){e&&e.length==i.codeLength&&(i.checkCodeSendingInProgress=!1,i.firstSent&&i.checkCode(),i.firstSent=!1)})}]}}]),tl.registerDirective("tlLoyaltyCardLinkingCommonModalView",[function(){return{scope:{titleText:"=",imageKind:"=",onCloseButtonClick:"&",onOkButtonClick:"&"},restrict:"EA",transclude:!0,templateUrl:"directives/guest-log-in-modal/loyalty-card-linking-common-modal-view/loyalty-card-linking-common-modal-view.html"}}]),tl.registerDirective("tlSuccessfullyLoyaltyCardIssuingModalView",[function(){return{restrict:"EA",scope:!1,templateUrl:"directives/guest-log-in-modal/successfully-loyalty-card-issuing-modal-view/successfully-loyalty-card-issuing-modal-view.html"}}]),tl.registerDirective("tlSuccessfullyLoyaltyCardLinkingModalView",[function(){return{restrict:"EA",scope:!1,templateUrl:"directives/guest-log-in-modal/successfully-loyalty-card-linking-modal-view/successfully-loyalty-card-linking-modal-view.html"}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/phone-control/phone-control.html",'<div class="x-phone-control"><span class="x-phone-control__icon"><svg><use xlink:href="#phone"></use></svg> </span><input tl-phone-input type="tel" id="{{::inputId}}" class="x-phone-control__input {{getValidityClass()}}" name="{{::inputName}}" inputmode="tel" rel="phone-control" size="20" autocomplete="on" ng-model="ngModel.phone" ng-required="::required" ng-readonly="::readonly" ng-blur="onBlur()" ng-keyup="onKeyup()"></input><div ng-if="!showWarning() && countryCode" class="x-phone-control__flag" tl-tooltip tooltip-position="\'right\'" tooltip-text="countryHint" tooltip-disabled="!countryHint" tooltip-class="\'tooltip_state_control\'" tooltip-event="hover"><div class="flag-icon -{{countryCode}}"></div></div><div class="form-control-icon" ng-if="showWarning()" ng-class="{\'_state_invalid\': !getControl().$valid, \'_state_warning\': unknownMask && getControl().$valid}" tl-tooltip tooltip-position="\'right\'" tooltip-text="\'T:validation.unknown_mask\' | message" tooltip-event="hover" tooltip-disabled="!getControl().$valid" tooltip-class="\'tooltip_state_control\'"><svg><use xlink:href="#warning"></use></svg></div></div>')}),!function(i){!function(r){function e(e,t){this.emptyMask="+[#]{1,25}",this.listKey="mask",this.match=/[0-9]/,this.options=e,this.input=t,this.options.list=this.getSortedMasks(r.maskList,["#"],/[0-9]|#/,this.listKey);var i,n={};for(i in this.options.inputmask.definitions){var o=this.options.inputmask.definitions[i].validator;switch(typeof o){case"string":n[i]=new RegExp(o);break;case"maskect":"test"in this.options.definitions[i].validator&&(n[i]=o);break;case"function":n[i]={test:o}}}this.options.inputmask.definitions[this.options.replace]={validator:this.options.match.source,cardinality:1},this.instance={options:this.options,defs:n,oldmatch:null,placeholder:this.options.inputmask.placeholder||window.Inputmask.prototype.defaults.placeholder,insertMode:this.options.inputmask.insertMode||window.Inputmask.prototype.defaults.insertMode},this.maskInit(),this.maskBind()}e.prototype.destroy=function(){this.inputmask.remove(),this.instance=void 0,angular.element(this.input).off()},e.prototype.getSortedMasks=function(e,a,s,l){return e.sort(function(e,t){for(var i=0,n=0;i<e[l].length&&n<t[l].length;){var o=e[l].charAt(i),r=t[l].charAt(n);if(s.test(o))if(s.test(r)){if(-1!==a.indexOf(o)&&-1===a.indexOf(r))return 1;if(-1===a.indexOf(o)&&-1!==a.indexOf(r))return-1;if(-1===a.indexOf(o)&&-1===a.indexOf(r)&&o!=r)return o<r?-1:1;i++,n++}else n++;else i++}for(;i<e[l].length||n<t[l].length;)if(i<e[l].length&&!s.test(e[l].charAt(i)))i++;else if(n<t[l].length&&!s.test(t[l].charAt(n)))n++;else{if(i<e[l].length)return 1;if(n<t[l].length)return-1}return 0})},e.prototype.maskMatch=function(e){for(var t,i=this.instance.options,n="",o=0;o<e.length;o++){var r=e.charAt(o);if(r==this.instance.placeholder)break;i.match.test(r)&&(n+=r)}for(t in i.list){for(var a,s,l=i.list[t][this.listKey],c=!0,u=void 0,d=void 0,d=0,u=0;d<n.length&&u<l.length;){var p=l.charAt(u),m=n.charAt(d);if(i.match.test(p)||p in this.instance.defs){if(!(p in this.instance.defs&&this.instance.defs[p].test(m)||m==p)){c=!1;break}d++,u++}else u++}if(c&&d==n.length)return a=-1==l.substr(u).search(i.match),s=-1==l.substr(u).search(i.replace),{match:l=l.replace(new RegExp([i.match.source].concat(_.keys(this.instance.defs)).join("|"),"g"),i.replace),mask:i.list[t],determined:a,completed:s}}return{match:this.emptyMask,mask:null,determined:!1,completed:!0}},e.prototype.maskBind=function(){angular.element(this.input).bind("keydown",this.maskKeyDown.bind(this)).bind("input",this.maskKeyDown.bind(this)).bind("keypress",this.maskKeyPress.bind(this)).bind("textInput",this.maskKeyPress.bind(this)).bind("paste",this.maskPaste.bind(this)).bind("dragdrop",this.maskPaste.bind(this)).bind("drop",this.maskPaste.bind(this)).bind("cut",this.maskPaste.bind(this)).bind("setvalue",this.maskChange.bind(this)).bind("reset",this.maskChange.bind(this))},e.prototype.keyboardApply=function(e,t,i){var n=this.maskMatch(t),o=n.determined!=this.instance.oldmatch.determined,r=n.completed!=this.instance.oldmatch.completed,a=n.mask!=this.instance.oldmatch.mask,s=!n.determined&&(o||a);return a||o||r?(s?(this.maskApply(n,t),e.preventDefault()):this.maskApply(n),!1):(this.instance.options.onChange(n,this.inputmask),!0)},e.prototype.maskKeyDown=function(e){if((e=e||window.event).metaKey||!1===e.isTrusted)return!0;var t,i=this.getEventKeyInfo(e),n=this.inputmask._valueGet();return i.isRemove?(n?this.runOriginal(e):0==(t=this.getCaret()).begin&&this.setCaret(t.begin+1,t.end+1,!0),t=this.inputmask._valueGet(),this.caretShift(t,n),this.keyboardApply(e,t,!1)):(45==i.key&&(this.instance.insertMode=!this.instance.insertMode),!0)},e.prototype.maskKeyPress=function(e){if((e=e||window.event).metaKey||!1===e.isTrusted)return!0;var t=this.inputmask._valueGet(),i=this.getEventKeyInfo(e).key,i=String.fromCharCode(i),n=this.getCaret(),t=n.begin==n.end&&t.charAt(n.begin)==this.instance.placeholder?t.substring(0,n.begin)+i+t.substring(n.end+1):t.substring(0,n.begin)+i+t.substring(n.end);return this.keyboardApply(e,t,!0)},e.prototype.maskApply=function(e,t){var i,r=this,n=this.instance.options;_.isUndefined(t)&&e.match==this.instance.oldmatch.match||(i=void 0,_.isUndefined(t)?i=this.caretApply(this.instance.oldmatch.match,e.match,this.getCaret()):(this.inputmask&&this.inputmask.remove(),this.input.value=t),this.inputmask=window.Inputmask(e.match,_.assignIn(n.inputmask,{insertMode:this.instance.insertMode,onBeforeMask:function(e){var t=r.maskMatch(e),i=r.instance.oldmatch,n=i&&t.determined!=i.determined,o=i&&t.completed!=i.completed;return(i&&t.mask!=i.mask||n||o)&&(r.instance.oldmatch=t,r.maskApply(t,e),r.input!=document.activeElement&&(r.input.focus(),r.input.blur())),e}})).mask(this.input),this.inputmask.originalPlaceholder=this.inputmask.getemptymask(),this.unbindOriginal(),_.isUndefined(t)&&e.determined&&i&&this.setCaret(i.begin,i.end,i.reset)),this.instance.options.onChange(e,this.inputmask),this.instance.oldmatch=e},e.prototype.maskInit=function(e){_.isUndefined(e)&&(e=this.inputmask&&this.inputmask._valueGet?this.inputmask._valueGet():this.input.value);var t=this.maskMatch(e);this.maskApply(t,e)},e.prototype.maskChange=function(){this.maskInit()},e.prototype.maskPaste=function(e){var t=this;this.runOriginal(e),setTimeout(function(){t.maskInit()})},e.prototype.getEventKeyInfo=function(e){var t=e.data?e.data.charCodeAt(0):e.which||e.charCode||e.keyCode;return{isRemove:8==t||46==t||i.DeviceUtil.isMobile()&&127==t||"deleteContentBackward"==e.inputType||"deleteContentForward"==e.inputType,key:t}},e.prototype.unbindOriginal=function(){var i=this;_.each(["keydown","keypress","textInput","keyup","paste","dragdrop","drop","setvalue","reset","cut"],function(t){_.each(i.inputmask.events[t],function(e){i.input.removeEventListener(t,e)})})},e.prototype.runOriginal=function(t){var i=this;_.each(this.inputmask.events[t.type],function(e){e.call(i.input,t)})},e.prototype.caretApply=function(e,t,i){var n=this.instance.options;if(!e)return null;if(e==this.emptyMask)return{begin:t.length,end:t.length,reset:!0};for(var o=0,r=0,a=0;o<i.begin;o++)e.charAt(o)==n.replace&&r++;for(;o<i.end;o++)e.charAt(o)==n.replace&&a++;for(o=0;o<t.length&&(0<r||t.charAt(o)!=n.replace);o++)t.charAt(o)==n.replace&&r--;for(r=o;o<t.length&&0<a;o++)t.charAt(o)==n.replace&&a--;return{begin:r,end:a=o}},e.prototype.caretShift=function(e,i){var n=this;_.each(e.split(""),function(e,t){if(i[t]!=e&&isNaN(e)&&"_"!=e)return t=n.getCaret(),n.setCaret(t.begin,t.end,!0),!1})},e.prototype.setCaret=function(e,t,i){var n=this;t=_.isNumber(t)?t:e,this.input.setSelectionRange?i?setTimeout(function(){n.input.setSelectionRange(e,t)}):this.input.setSelectionRange(e,t):this.input.createTextRange&&((i=this.input.createTextRange()).collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select())},e.prototype.getCaret=function(e,t){var i;return this.input.setSelectionRange?(e=this.input.selectionStart,t=this.input.selectionEnd):document.selection&&document.selection.createRange&&(t=(e=0-(i=document.selection.createRange()).duplicate().moveStart("character",-1e5))+i.text.length),{begin:e,end:t}},r.InputmaskAdapter=e}(i.directive||(i.directive={}))}(tl=tl||{}),!function(e){(e.directive||(e.directive={})).maskList=[{mask:"+247-####",code:"AC"},{mask:"+376-###-###",code:"AD"},{mask:"+971-5#-###-####",code:"AE"},{mask:"+971-#-###-####",code:"AE"},{mask:"+93-##-###-####",code:"AF"},{mask:"+1(268)###-####",code:"AG"},{mask:"+1(264)###-####",code:"AI"},{mask:"+355(###)###-###",code:"AL"},{mask:"+374-##-###-###",code:"AM"},{mask:"+599-###-####",code:"AN"},{mask:"+599-###-####",code:"AN"},{mask:"+599-9###-####",code:"AN"},{mask:"+244(###)###-###",code:"AO"},{mask:"+672-1##-###",code:"AQ"},{mask:"+54(###)###-####",code:"AR"},{mask:"+1(684)###-####",code:"AS"},{mask:"+43(###)###-####",code:"AT"},{mask:"+61-#-####-####",code:"AU"},{mask:"+297-###-####",code:"AW"},{mask:"+994-##-###-##-##",code:"AZ"},{mask:"+387-##-#####",code:"BA"},{mask:"+387-##-####",code:"BA"},{mask:"+1(246)###-####",code:"BB"},{mask:"+880-##-###-###",code:"BD"},{mask:"+32(###)###-###",code:"BE"},{mask:"+226-##-##-####",code:"BF"},{mask:"+359(###)###-###",code:"BG"},{mask:"+973-####-####",code:"BH"},{mask:"+257-##-##-####",code:"BI"},{mask:"+229-##-##-####",code:"BJ"},{mask:"+1(441)###-####",code:"BM"},{mask:"+673-###-####",code:"BN"},{mask:"+591-#-###-####",code:"BO"},{mask:"+55(##)####-####",code:"BR"},{mask:"+55(##)7###-####",code:"BR"},{mask:"+55(##)9####-####",code:"BR"},{mask:"+1(242)###-####",code:"BS"},{mask:"+975-17-###-###",code:"BT"},{mask:"+975-#-###-###",code:"BT"},{mask:"+267-##-###-###",code:"BW"},{mask:"+375(##)###-##-##",code:"BY"},{mask:"+501-###-####",code:"BZ"},{mask:"+243(###)###-###",code:"CD"},{mask:"+236-##-##-####",code:"CF"},{mask:"+242-##-###-####",code:"CG"},{mask:"+41-##-###-####",code:"CH"},{mask:"+225-##-###-###",code:"CI"},{mask:"+682-##-###",code:"CK"},{mask:"+56-#-####-####",code:"CL"},{mask:"+237-####-####",code:"CM"},{mask:"+86(###)####-####",code:"CN"},{mask:"+86(###)####-###",code:"CN"},{mask:"+86-##-#####-#####",code:"CN"},{mask:"+57(###)###-####",code:"CO"},{mask:"+506-####-####",code:"CR"},{mask:"+53-#-###-####",code:"CU"},{mask:"+238(###)##-##",code:"CV"},{mask:"+599-###-####",code:"CW"},{mask:"+357-##-###-###",code:"CY"},{mask:"+420(###)###-###",code:"CZ"},{mask:"+49(####)###-####",code:"DE"},{mask:"+49(###)###-####",code:"DE"},{mask:"+49(###)##-####",code:"DE"},{mask:"+49(###)##-###",code:"DE"},{mask:"+49(###)##-##",code:"DE"},{mask:"+49-###-###",code:"DE"},{mask:"+253-##-##-##-##",code:"DJ"},{mask:"+45-##-##-##-##",code:"DK"},{mask:"+1(767)###-####",code:"DM"},{mask:"+1(809)###-####",code:"DO"},{mask:"+1(829)###-####",code:"DO"},{mask:"+1(849)###-####",code:"DO"},{mask:"+213-##-###-####",code:"DZ"},{mask:"+593-##-###-####",code:"EC"},{mask:"+593-#-###-####",code:"EC"},{mask:"+372-####-####",code:"EE"},{mask:"+372-###-####",code:"EE"},{mask:"+20(###)###-####",code:"EG"},{mask:"+291-#-###-###",code:"ER"},{mask:"+34(###)###-###",code:"ES"},{mask:"+251-##-###-####",code:"ET"},{mask:"+358(###)###-##-##",code:"FI"},{mask:"+358(##)###-##-##",code:"FI"},{mask:"+679-##-#####",code:"FJ"},{mask:"+500-#####",code:"FK"},{mask:"+691-###-####",code:"FM"},{mask:"+298-###-###",code:"FO"},{mask:"+262-#####-####",code:"FR"},{mask:"+33(###)###-###",code:"FR"},{mask:"+508-##-####",code:"FR"},{mask:"+590(###)###-###",code:"FR"},{mask:"+241-#-##-##-##",code:"GA"},{mask:"+1(473)###-####",code:"GD"},{mask:"+995(###)###-###",code:"GE"},{mask:"+594-#####-####",code:"GF"},{mask:"+233(###)###-###",code:"GH"},{mask:"+350-###-#####",code:"GI"},{mask:"+299-##-##-##",code:"GL"},{mask:"+220(###)##-##",code:"GM"},{mask:"+224-##-###-###",code:"GN"},{mask:"+240-##-###-####",code:"GQ"},{mask:"+30(###)###-####",code:"GR"},{mask:"+502-#-###-####",code:"GT"},{mask:"+1(671)###-####",code:"GU"},{mask:"+245-#-######",code:"GW"},{mask:"+592-###-####",code:"GY"},{mask:"+852-####-####",code:"HK"},{mask:"+504-####-####",code:"HN"},{mask:"+385-##-###-###",code:"HR"},{mask:"+509-##-##-####",code:"HT"},{mask:"+36(###)###-###",code:"HU"},{mask:"+62(8##)###-####",code:"ID"},{mask:"+62-##-###-##",code:"ID"},{mask:"+62-##-###-###",code:"ID"},{mask:"+62-##-###-####",code:"ID"},{mask:"+62(8##)###-###",code:"ID"},{mask:"+62(8##)###-##-###",code:"ID"},{mask:"+353(###)###-###",code:"IE"},{mask:"+972-5#-###-####",code:"IL"},{mask:"+972-#-###-####",code:"IL"},{mask:"+91(####)###-###",code:"IN"},{mask:"+246-###-####",code:"IO"},{mask:"+964(###)###-####",code:"IQ"},{mask:"+98(###)###-####",code:"IR"},{mask:"+354-###-####",code:"IS"},{mask:"+39(###)####-###",code:"IT"},{mask:"+39(##)####-###",code:"IT"},{mask:"+1(876)###-####",code:"JM"},{mask:"+962-#-####-####",code:"JO"},{mask:"+81-##-####-####",code:"JP"},{mask:"+81(###)###-###",code:"JP"},{mask:"+254-###-######",code:"KE"},{mask:"+996(###)###-###",code:"KG"},{mask:"+855-##-###-###",code:"KH"},{mask:"+686-##-###",code:"KI"},{mask:"+269-##-#####",code:"KM"},{mask:"+1(869)###-####",code:"KN"},{mask:"+850-191-###-####",code:"KP"},{mask:"+850-##-###-###",code:"KP"},{mask:"+850-###-####-###",code:"KP"},{mask:"+850-###-###",code:"KP"},{mask:"+850-####-####",code:"KP"},{mask:"+850-####-#############",code:"KP"},{mask:"+82-##-###-####",code:"KR"},{mask:"+965-####-####",code:"KW"},{mask:"+1(345)###-####",code:"KY"},{mask:"+7(###)###-##-##",code:"RU"},{mask:"+7(6##)###-##-##",code:"KZ"},{mask:"+7(7##)###-##-##",code:"KZ"},{mask:"+856(20##)###-###",code:"LA"},{mask:"+856-##-###-###",code:"LA"},{mask:"+961-##-###-###",code:"LB"},{mask:"+961-#-###-###",code:"LB"},{mask:"+1(758)###-####",code:"LC"},{mask:"+423(###)###-####",code:"LI"},{mask:"+94-##-###-####",code:"LK"},{mask:"+231-##-###-###",code:"LR"},{mask:"+266-#-###-####",code:"LS"},{mask:"+370(###)##-###",code:"LT"},{mask:"+352(###)###-###",code:"LU"},{mask:"+371-##-###-###",code:"LV"},{mask:"+218-##-###-###",code:"LY"},{mask:"+218-21-###-####",code:"LY"},{mask:"+212-##-####-###",code:"MA"},{mask:"+377(###)###-###",code:"MC"},{mask:"+377-##-###-###",code:"MC"},{mask:"+373-####-####",code:"MD"},{mask:"+382-##-###-###",code:"ME"},{mask:"+261-##-##-#####",code:"MG"},{mask:"+692-###-####",code:"MH"},{mask:"+389-##-###-###",code:"MK"},{mask:"+223-##-##-####",code:"ML"},{mask:"+95-##-###-###",code:"MM"},{mask:"+95-#-###-###",code:"MM"},{mask:"+95-###-###",code:"MM"},{mask:"+976-##-##-####",code:"MN"},{mask:"+853-####-####",code:"MO"},{mask:"+1(670)###-####",code:"MP"},{mask:"+596(###)##-##-##",code:"MQ"},{mask:"+222-##-##-####",code:"MR"},{mask:"+1(664)###-####",code:"MS"},{mask:"+356-####-####",code:"MT"},{mask:"+230-###-####",code:"MU"},{mask:"+960-###-####",code:"MV"},{mask:"+265-1-###-###",code:"MW"},{mask:"+265-#-####-####",code:"MW"},{mask:"+52(###)###-####",code:"MX"},{mask:"+52-##-##-####",code:"MX"},{mask:"+60-##-###-####",code:"MY"},{mask:"+60(###)###-###",code:"MY"},{mask:"+60-##-###-###",code:"MY"},{mask:"+60-#-###-###",code:"MY"},{mask:"+258-##-###-###",code:"MZ"},{mask:"+264-##-###-####",code:"NA"},{mask:"+687-##-####",code:"NC"},{mask:"+227-##-##-####",code:"NE"},{mask:"+672-3##-###",code:"NF"},{mask:"+234(###)###-####",code:"NG"},{mask:"+234-##-###-###",code:"NG"},{mask:"+234-##-###-##",code:"NG"},{mask:"+234(###)###-####",code:"NG"},{mask:"+505-####-####",code:"NI"},{mask:"+31-##-###-####",code:"NL"},{mask:"+47(###)##-###",code:"NO"},{mask:"+977-##-###-###",code:"NP"},{mask:"+674-###-####",code:"NR"},{mask:"+683-####",code:"NU"},{mask:"+64(###)###-###",code:"NZ"},{mask:"+64-##-###-###",code:"NZ"},{mask:"+64(###)###-####",code:"NZ"},{mask:"+968-##-###-###",code:"OM"},{mask:"+507-###-####",code:"PA"},{mask:"+51(###)###-###",code:"PE"},{mask:"+689-##-##-##",code:"PF"},{mask:"+675(###)##-###",code:"PG"},{mask:"+63(###)###-####",code:"PH"},{mask:"+92(###)###-####",code:"PK"},{mask:"+48(###)###-###",code:"PL"},{mask:"+970-##-###-####",code:"PS"},{mask:"+351-##-###-####",code:"PT"},{mask:"+680-###-####",code:"PW"},{mask:"+595(###)###-###",code:"PY"},{mask:"+974-####-####",code:"QA"},{mask:"+262-#####-####",code:"RE"},{mask:"+40-##-###-####",code:"RO"},{mask:"+381-##-###-####",code:"RS"},{mask:"+250(###)###-###",code:"RW"},{mask:"+966-5-####-####",code:"SA"},{mask:"+966-#-###-####",code:"SA"},{mask:"+677-###-####",code:"SB"},{mask:"+677-#####",code:"SB"},{mask:"+248-#-###-###",code:"SC"},{mask:"+249-##-###-####",code:"SD"},{mask:"+46-##-###-####",code:"SE"},{mask:"+65-####-####",code:"SG"},{mask:"+290-####",code:"SH"},{mask:"+290-####",code:"SH"},{mask:"+386-##-###-###",code:"SI"},{mask:"+421(###)###-###",code:"SK"},{mask:"+232-##-######",code:"SL"},{mask:"+378-####-######",code:"SM"},{mask:"+221-##-###-####",code:"SN"},{mask:"+252-##-###-###",code:"SO"},{mask:"+252-#-###-###",code:"SO"},{mask:"+252-#-###-###",code:"SO"},{mask:"+597-###-####",code:"SR"},{mask:"+597-###-###",code:"SR"},{mask:"+211-##-###-####",code:"SS"},{mask:"+239-##-#####",code:"ST"},{mask:"+503-##-##-####",code:"SV"},{mask:"+1(721)###-####",code:"SX"},{mask:"+963-##-####-###",code:"SY"},{mask:"+268-##-##-####",code:"SZ"},{mask:"+1(649)###-####",code:"TC"},{mask:"+235-##-##-##-##",code:"TD"},{mask:"+228-##-###-###",code:"TG"},{mask:"+66-##-###-####",code:"TH"},{mask:"+66-##-###-###",code:"TH"},{mask:"+992-##-###-####",code:"TJ"},{mask:"+690-####",code:"TK"},{mask:"+670-###-####",code:"TL"},{mask:"+670-77#-#####",code:"TL"},{mask:"+670-78#-#####",code:"TL"},{mask:"+993-#-###-####",code:"TM"},{mask:"+216-##-###-###",code:"TN"},{mask:"+676-#####",code:"TO"},{mask:"+90(###)###-####",code:"TR"},{mask:"+1(868)###-####",code:"TT"},{mask:"+688-90####",code:"TV"},{mask:"+688-2####",code:"TV"},{mask:"+886-#-####-####",code:"TW"},{mask:"+886-####-####",code:"TW"},{mask:"+255-##-###-####",code:"TZ"},{mask:"+380(##)###-##-##",code:"UA"},{mask:"+256(###)###-###",code:"UG"},{mask:"+44-##-####-####",code:"GB"},{mask:"+598-#-###-##-##",code:"UY"},{mask:"+998-##-###-####",code:"UZ"},{mask:"+39-6-698-#####",code:"VA"},{mask:"+1(784)###-####",code:"VC"},{mask:"+58(###)###-####",code:"VE"},{mask:"+1(284)###-####",code:"VG"},{mask:"+1(340)###-####",code:"VI"},{mask:"+84-##-####-###",code:"VN"},{mask:"+84(###)####-###",code:"VN"},{mask:"+678-##-#####",code:"VU"},{mask:"+678-#####",code:"VU"},{mask:"+681-##-####",code:"WF"},{mask:"+685-##-####",code:"WS"},{mask:"+967-###-###-###",code:"YE"},{mask:"+967-#-###-###",code:"YE"},{mask:"+967-##-###-###",code:"YE"},{mask:"+27-##-###-####",code:"ZA"},{mask:"+260-##-###-####",code:"ZM"},{mask:"+263-#-######",code:"ZW"},{mask:"+1(###)###-####",code:["US","CA"]}]}(tl=tl||{}),tl.registerDirective("tlPhoneControl",["$timeout","serviceFactory","tl.messages",function(c,u,d){return{replace:!0,scope:{ngModel:"=",inputName:"=",parentForm:"=",inputId:"=?",required:"=?",readonly:"=?",onBlurAction:"&?",onKeyupAction:"&?"},require:"^form",templateUrl:tl.directiveTemplateUrl("phone-control"),link:function(r,e,t,i){r.inputId=_.isUndefined(r.inputId)?_.uniqueId("phone_"):r.inputId,r.required=!!_.isUndefined(r.required)||r.required,r.readonly=!_.isUndefined(r.readonly)&&r.readonly;function n(e,t){var i,n,o=r.getControl();o.$setValidity("completed",!r.required||e.completed),s.setAttribute("placeholder",t.getemptymask()),e.determined?(t=e.mask.code,t=_.isArray(t)?t:[t],n=t,(i=_.chain(a).filter(function(e){return _.includes(n,e.code)}).sortBy(function(e){return _.indexOf(n,e.code)}).map(function(e){return e.name}).value()).length&&(r.countryHint=d.formatMessage("T:validation.country_phone",{country:i.join(d.getMessage("T:validation.country_phone_or"))}),r.countryCode=_.head(t).toLowerCase()),r.unknownMask=!1):(r.countryCode=null,r.countryHint=null,e.completed&&(r.unknownMask=!0)),o.$setViewValue(s.value||void 0),o.$commitViewValue(!0),r.$applyAsync()}var o,a=u.serviceStorage.countries,s=_.head(e).querySelector('[rel="phone-control"]'),l=!1;r.ngModel.phone||(r.ngModel.phone=void 0);c(function(){o=new tl.directive.InputmaskAdapter({inputmask:{definitions:{"#":{validator:"[0-9]"}},showMaskOnHover:!1,clearMaskOnLostFocus:!0,autoUnmask:!0},match:/[0-9]/,replace:"#",onChange:n},s)}),r.getControl=function(){return i[r.inputName]},r.showWarning=function(){return!r.getControl().$valid&&(r.parentForm.$submitted||l)||r.getControl().$valid&&r.unknownMask},r.getValidityClass=function(){var e=!!r.getControl();return(r.parentForm.$submitted||l)&&e?r.getControl().$valid?r.unknownMask?"-warning":"-valid":"-invalid":""},r.onBlur=function(){var e;r.getControl().$dirty&&(l=!0),null!=(e=r.onBlurAction)&&e.call(r)},r.onKeyup=function(){var e;null!=(e=r.onKeyupAction)&&e.call(r)},r.$on("$destroy",function(){null!=o&&o.destroy()})}}}]),tl.registerDirective("tlPhoneInput",["$parse",function(r){return{require:"ngModel",link:function(i,e,n,o){o.$parsers.push(function(e){if(null==e)return"";var t="+"+e.replace(/[^0-9]/g,"");return t!=e&&o.$setViewValue(t),t}),o.$validators.phoneNumberLength=function(e){var t=n.ngRequired&&r(n.ngRequired)(i)||n.required&&r(n.required)(i),e=_.isUndefined(e)?0:e.replace(/[^0-9]/g,"").length;return!t||7<=e&&e<=20}}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/tooltip/tooltip.html",'<div class="tooltip tooltip_position_{{pointerVerPosition}} tooltip_position_{{pointerHorPosition}} x-tooltip {{customClass}}" ng-class="{\'fade-in\': opened, \'fade-out x-tooltip_hidden\': !opened}"><div class="tooltip__content x-tooltip__content" ng-bind-html="text | tlUnsafe"></div></div>')}),!function(h){var f,e;h.directive||(h.directive={});(e=f=f||{}).Hover="hover",e.Click="click",e.Blur="blur",e.Null="null",h.registerDirective("tlTooltip",["$templateCache","$compile",function(e,p){var m=e.get("directives/tooltip/tooltip.html"),g=angular.element(window);return{restrict:"A",scope:{text:"=tooltipText",event:"@tooltipEvent",opened:"=?tooltipOpened",interactable:"=?tooltipInteractable",position:"=?tooltipPosition",fitOnScreen:"=?tooltipFitOnScreen",customClass:"=?tooltipClass",disabled:"=?tooltipDisabled",closeOnOutsideEventOnly:"=?tooltipCloseOnOutsideEventOnly"},link:function(n,o){n.opened=!!n.opened,n.interactable=!!_.isUndefined(n.interactable)||n.interactable;function t(e){i&&n.opened&&u(e)}function r(){return i||c(),i}var i=null,e=n.position||"top center",a="",s="",l=(_.includes(e,"left")||(e=e.concat(" center")),_.includes(e,"top")||_.includes(e,"bottom")||(e=e.concat(" top")),e=_.trim(e),n.pointerVerPosition=_.includes(e,"bottom")?"top":"bottom",_.includes(e,"left")?n.pointerHorPosition="left":_.includes(e,"right")?n.pointerHorPosition="right":n.pointerHorPosition="center",s=e,a=_.includes(e,"bottom")?e.replace(/bottom/g,"top"):e.replace(/top/g,"bottom"),_.throttle(function(){i&&n.opened&&d()},100)),c=function(){var e=document.querySelector(".tl-container");i=angular.element(p(m)(n))[0],e.appendChild(i),g.on([h.EventType.Click,h.EventType.TouchStart].join(" "),t),g.on(h.EventType.Resize,l)},u=_.debounce(function(e){if(n.interactable&&(!n.closeOnOutsideEventOnly||function(e){for(var t=e.target;t&&"body"!=t.nodeName;){if(t===o[0])return!1;t=t.parentNode}return!0}(e)||!n.opened||n.disabled)){switch(e.stopPropagation(),n.event){case f.Hover:n.opened=(e.type==h.EventType.MouseOver||(e.type==h.EventType.TouchEnd||e.type==h.EventType.PointerUp)&&e.target==i)&&!n.disabled;break;case f.Click:case f.Blur:case f.Null:n.opened=!n.opened&&!n.disabled}n.$apply()}},300),d=function(){var e=r(),t=h.PositionHelper.position(e,o[0],a,s,!1!==n.fitOnScreen,!1!==n.fitOnScreen),t=(e.style.left=t.left+"px",e.style.top=t.top+"px",e.getBoundingClientRect()),i=o[0].getBoundingClientRect();0==i.width&&(e.style.left="-10000px",e.style.top="-10000px"),n.pointerVerPosition=t.top>i.top?"top":"bottom"};n.event==f.Hover?window.navigator.msPointerEnabled&&window.navigator.userAgent.match(/Windows Phone/i)?o.on(h.EventType.PointerUp,u):o.on([h.EventType.MouseOver,h.EventType.MouseOut,h.EventType.TouchEnd].join(" "),u):n.event==f.Click?o.on(h.EventType.Click,u):n.event==f.Blur&&o.on([h.EventType.Focus,h.EventType.Blur].join(" "),u),n.$watch("opened",function(){var e,t;n.opened?((e=r()).style.left="-10000px",e.style.top="-10000px",t=setInterval(function(){e.clientHeight&&(clearInterval(t),d(),n.$apply())},50)):i&&(i.style.left="-10000px",i.style.top="-10000px")}),n.$on("$destroy",function(){g.off(h.EventType.Click,t),g.off(h.EventType.Resize,l),u.cancel(),l.cancel(),i&&i.parentNode.removeChild(i)})}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/error-tooltip/error-tooltip.html",'<div class="tooltip tooltip_position_top tooltip_state_invalid x-error-tooltip" ng-class="{\'x-error-tooltip_opened\': showError()}"><div class="tooltip__content x-error-tooltip__content {{ ::customContentClass }}" ng-class="::{\'x-error-tooltip__content_no-pointer\': hidePointer}"><span class="x-error-tooltip__message" ng-bind-html="getErrorMessage() | tlUnsafe"></span></div></div>')}),tl.registerDirective("tlErrorTooltip",[function(){return{require:"^form",restrict:"EA",scope:{inputName:"=",hide:"=?",hidePointer:"=?",customContentClass:"=?"},templateUrl:"directives/error-tooltip/error-tooltip.html",link:function(t,e,i,n){t.customContentClass=t.customContentClass||"";var o;t.showError=function(){return!!t.inputName&&!!n[t.inputName]&&!t.hide&&n[t.inputName].$invalid&&(n.$submitted||n[t.inputName].$dirty)},t.getErrorMessage=function(){return t.showError()?o=function(){for(var e in n[t.inputName].$error)if(i[e+"ErrorMessage"])return i[e+"ErrorMessage"];return i.errorMessage}()||o:o}}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/social-button-pack/social-button-pack.html",'<div class="x-sbp"><div class="x-sbp__button x-sbp__button_{{authMethod.code}}" ng-repeat="authMethod in availableAuthMethods" ng-click="logIn(authMethod.code)"><div class="x-sbp__icon-container"><svg class="loader" ng-if="loadingInProgress(authMethod.code)"><use xlink:href="#loader"></use></svg> <svg ng-if="!loadingInProgress(authMethod.code)"><use ng-attr-xlink:href="{{\'#\' + authMethod.code + \'-logo\'}}" xlink:href=""></use></svg></div></div></div>')}),!function(s){s.directive||(s.directive={});s.registerDirective("tlSocialButtonPack",["serviceFactory","locale",function(r,a){return{restrict:"EA",templateUrl:"directives/social-button-pack/social-button-pack.html",replace:!0,scope:{source:"=",guestLogInAction:"&"},controller:["$scope",function(t){var i=r.guestProfileService,n=i.getLogInWindowInstance(),o=a.language().language(),e=s.BookingFormSettings.getInstance().authMethods;t.availableAuthMethods=_.filter(e,function(e){return e.isLanguageAvailable(o)}),t.authServiceKind=s.AuthServiceKind,t.loadingInProgress=function(e){return i.lastAuthService==e&&i.loadingStatus==s.GuestProfileLoadingStatus.Loading},t.logIn=function(e){(i.loadingStatus==s.GuestProfileLoadingStatus.Loading||i.isAuthenticatedUser())&&n&&i.lastAuthService==e?n.focus():n=i.openSocialLogInWindow(e,t.source,t.guestLogInAction)}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/hyponline-48/hyponline-48.html",'<span class="link growth-always-default-link -normal" ng-click="showLoginDialog(false)"><span tl-growth-message="\'T:hyponline48.main_survey_link\'"></span></span>')}),!function(l){l.directive||(l.directive={});l.registerDirective("tlHyponline48",[function(){return{restrict:"EA",scope:{source:"="},templateUrl:"directives/hyponline-48/hyponline-48.html",controller:["$scope","$q","$compile","$rootScope","$state",function(n,o,r,a,s){n.showLoginDialog=function(e){var t=a.$new(!0),i=n.source;l.ModalManager.getInstance().open(o.when(function(){return r("<tl-new-social-survey-popup source=\"'"+i+"'\"></tl-new-social-survey-popup>")(t)[0]}),{fitContent:!0,fullScreen:!1,withoutSidePaddings:!1,stacked:e}),l.TrackerService.trackExperiment("growth__new-socials-survey",{providerId:l.BookingFormSettings.getInstance().providerId,action:"open",page:s.current&&s.current.name,source:n.source},!0)}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/new-social-survey-popup/new-social-survey-popup.html",'<div id="newSocialSurvey"><div class="x-modal__close" ng-click="close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div ng-show="!isSubmitted"><div class="x-modal__header new-social-survey__header"><h1 class="x-modal__title" tl-growth-message="\'T:hyponline48.main_survey_link\'"></h1><h2 class="x-modal__subtitle" tl-growth-message="\'T:hyponline48.survey_popup_subtitle\'"></h2></div><div class="x-modal__content"><div class="new-socials-grid"><div tl-checkbox class="nss-apple" checkbox-id="\'apple\'" selected="surveyModel.apple"><div class="new-socials-survey-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve"><g><path d="M500,10C229.4,10,10,229.4,10,500c0,270.7,219.4,490,490,490s490-219.3,490-490C990,229.4,770.6,10,500,10z M528.1,208.7c22.2-26.1,59.8-45.4,90.8-46.7c4,36.1-10.6,72.4-32.1,98.4c-21.6,26-56.8,46.3-91.5,43.6C490.7,268.7,508.1,231.8,528.1,208.7z M704.5,702.2c-25.7,37.6-52.4,75-94.4,75.8c-41.3,0.8-54.6-24.5-101.8-24.5c-47.2,0-62,23.7-101.1,25.3c-40.5,1.5-71.4-40.5-97.3-78c-53-76.6-93.5-216.4-39.1-310.8c26.9-46.9,75.2-76.5,127.6-77.3c39.9-0.7,77.5,26.9,101.8,26.9c24.4,0,70.1-33.2,118.1-28.3c20.1,0.8,76.5,8.1,112.8,61.1c-2.9,1.8-67.4,39.3-66.6,117.4c0.9,93.3,81.8,124.3,82.8,124.8C746.5,616.6,734.3,658.7,704.5,702.2z"></path></g></svg></div></div><div tl-checkbox class="nss-yandex" checkbox-id="\'yandex\'" selected="surveyModel.yandex"><div class="new-socials-survey-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 1080 1080" style="enable-background:new 0 0 1080 1080;" xml:space="preserve"><circle fill="#fc3f1d" cx="540" cy="540" r="538.9"></circle><path fill="#ffffff" d="M735,878.3H616.7V293.2H564c-96.6,0-147.2,48.3-147.2,120.4c0,81.8,34.9,119.7,107.1,168l59.5,40.1  l-171,256.5H285.2l153.9-229c-88.5-63.2-138.3-124.9-138.3-229c0-130.1,90.7-218.6,262.4-218.6h171v676.5H735z"></path></svg></div></div><div tl-checkbox class="nss-twitter" checkbox-id="\'twitter\'" selected="surveyModel.twitter"><div class="new-socials-survey-icon"><svg width="3333" height="3333" viewBox="0 0 3333 3333" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="1667" cy="1667" r="1667" fill="white"></circle><path fill-rule="evenodd" clip-rule="evenodd" d="M1667 0C2587 0 3334 746 3334 1667C3334 2587 2588 3334 1667 3334C747 3334 0 2588 0 1667C0 747 746 0 1667 0ZM2567 1108C2501 1138 2430 1157 2355 1166C2431 1120 2490 1048 2517 962C2446 1004 2366 1035 2283 1052C2215 980 2120 936 2013 936C1809 936 1644 1101 1644 1305C1644 1334 1647 1362 1653 1389C1346 1373 1074 1227 892 1003C859 1059 842 1123 842 1189C842 1317 907 1430 1006 1496C945 1494 889 1477 839 1450V1455C839 1634 966 1783 1135 1817C1104 1825 1071 1830 1038 1830C1014 1830 991 1828 968 1823C1015 1970 1151 2076 1313 2080C1186 2179 1028 2238 854 2238C824 2238 795 2236 766 2233C930 2338 1124 2399 1332 2399C2011 2399 2383 1836 2383 1348C2383 1332 2383 1316 2382 1300C2454 1248 2517 1183 2566 1109L2567 1108Z" fill="#2DAAE1"></path></svg></div></div><div tl-checkbox class="nss-okru" checkbox-id="\'okru\'" selected="surveyModel.okru"><div class="new-socials-survey-icon"><svg width="382" height="382" viewBox="0 0 382 382" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="191" cy="191" r="191" fill="#F7931E"></circle><path d="M215.155 251.262C243.13 245.563 259.894 232.315 260.781 231.604C268.967 225.039 270.282 213.081 263.717 204.894C257.153 196.708 245.196 195.393 237.008 201.957C236.835 202.097 218.955 215.813 189.536 215.833C160.118 215.813 141.86 202.097 141.687 201.957C133.499 195.393 121.542 196.708 114.978 204.894C108.413 213.081 109.728 225.039 117.914 231.604C118.813 232.325 136.269 245.918 165.028 251.483L124.947 293.371C117.663 300.925 117.882 312.953 125.436 320.237C129.123 323.792 133.875 325.559 138.623 325.559C143.601 325.559 148.574 323.614 152.302 319.747L189.537 280.082L230.533 320.004C237.961 327.42 249.989 327.408 257.403 319.983C264.817 312.557 264.808 300.527 257.382 293.113L215.155 251.262Z" fill="white"></path><path d="M190.485 55.901C151.892 55.901 120.607 87.187 120.607 125.779C120.607 164.372 151.892 195.66 190.485 195.66C229.078 195.66 260.363 164.372 260.363 125.779C260.363 87.187 229.078 55.901 190.485 55.901ZM190.485 154.667C174.532 154.667 161.599 141.733 161.599 125.78C161.599 109.827 174.532 96.894 190.485 96.894C206.438 96.894 219.371 109.827 219.371 125.78C219.371 141.733 206.438 154.667 190.485 154.667Z" fill="white"></path></svg></div></div><div tl-checkbox class="nss-mailru" checkbox-id="\'mailru\'" selected="surveyModel.mailru"><div class="new-socials-survey-icon"><svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 50C0 22.3858 22.3858 0 50 0C77.6142 0 100 22.3858 100 50C100 77.6142 77.6142 100 50 100C22.3858 100 0 77.6142 0 50Z" fill="#005FF9"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M20.8333 49.9173C20.8333 33.8802 33.9171 20.8333 49.9996 20.8333C66.0821 20.8333 79.166 33.8802 79.166 49.9173C79.166 52.1892 78.9765 54.0283 78.5517 55.8744L78.5454 55.905C78.5444 55.9104 78.3335 56.7615 78.2171 57.1327C77.4962 59.4317 76.1912 61.3465 74.4427 62.6698C72.7471 63.9535 70.6446 64.6606 68.5229 64.6606C68.2608 64.6606 67.9969 64.65 67.7383 64.6294C64.7254 64.3881 62.0762 62.8071 60.4517 60.286C57.6577 63.0875 53.9508 64.6287 49.9996 64.6287C41.8648 64.6287 35.2467 58.0292 35.2467 49.9173C35.2467 41.8054 41.8648 35.206 49.9996 35.206C58.1344 35.206 64.7525 41.8054 64.7525 49.9173V54.6596C64.7646 57.4267 66.6267 58.5577 68.2175 58.6856C69.8002 58.8075 71.9067 57.8881 72.6404 54.8877C73.0023 53.2421 73.1862 51.5694 73.1862 49.9173C73.1862 37.1681 62.7848 26.796 49.9996 26.796C37.2144 26.796 26.8131 37.1681 26.8131 49.9173C26.8131 62.6662 37.2144 73.0385 49.9996 73.0385C54.45 73.0385 58.7783 71.771 62.5165 69.3731L62.5835 69.33L66.5127 73.8854L66.4283 73.9429C61.5727 77.2523 55.8917 79.0015 49.9996 79.0015C33.9171 79.0015 20.8333 65.9544 20.8333 49.9173ZM49.9996 58.6658C54.8371 58.6658 58.7727 54.7412 58.7727 49.9173C58.7727 45.0933 54.8371 41.1692 49.9996 41.1692C45.1619 41.1692 41.2265 45.0933 41.2265 49.9173C41.2265 54.7412 45.1619 58.6658 49.9996 58.6658Z" fill="#FF9E00"></path></svg></div></div><div tl-checkbox ng-if="isEnglishFormLang()" class="nss-vk" checkbox-id="\'vk\'" selected="surveyModel.vk"><div class="new-socials-survey-icon"><svg width="192" height="192" viewBox="0 0 192 192" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="96" cy="96" r="96" fill="#2787F5"></circle><path fill-rule="evenodd" clip-rule="evenodd" d="M157.234 66.1462C158.124 63.1798 157.234 61 153 61H139C135.441 61 133.799 62.883 132.909 64.9594C132.909 64.9594 125.79 82.3129 115.704 93.5852C112.441 96.8482 110.958 97.8864 109.178 97.8864C108.288 97.8864 107 96.8482 107 93.882V66.1462C107 62.5865 105.967 61 103 61H81.0002C78.7757 61 77.4379 62.6522 77.4379 64.218C77.4379 67.5925 82.4805 68.3707 83.0002 77.8634V98.4799C83.0002 103 82.1839 103.82 80.4041 103.82C75.658 103.82 64.1132 86.3884 57.266 66.4427C55.9241 62.566 54.5783 61 51.0002 61H37.0002C33.0002 61 32.2002 62.883 32.2002 64.9594C32.2002 68.6675 36.9465 87.0593 54.2998 111.384C65.8686 127.995 82.1682 137 97.0002 137C105.899 137 107 135 107 131.555V119C107 115 107.843 114.202 110.661 114.202C112.738 114.202 116.297 115.24 124.604 123.249C134.096 132.742 135.661 137 141 137H155C159 137 161 135 159.846 131.053C158.584 127.119 154.052 121.412 148.038 114.647C144.775 110.79 139.88 106.638 138.397 104.561C136.321 101.891 136.914 100.704 138.397 98.3315C138.397 98.3315 155.454 74.3036 157.234 66.1462V66.1462Z" fill="white"></path></svg></div></div></div></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" ng-click="close()" tl-growth-message="\'T:hyponline48.close_button\'"></span> <span class="button-group__item tl-btn tl-btn_on_popup" ng-click="submitForm()" ng-disabled="!anySocialSelected()" tl-growth-message="\'T:hyponline48.submit_button\'"></span></div></div></div><div ng-show="isSubmitted"><div class="x-modal__header new-social-survey__header"><h1 class="x-modal__title" message-html="true" tl-growth-message="\'T:hyponline48.thanks_text\'"></h1></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" ng-click="close()" tl-growth-message="\'T:hyponline48.close_button\'"></span></div></div></div></div>')}),!function(o){o.directive||(o.directive={});o.registerDirective("tlNewSocialSurveyPopup",[function(){return{restrict:"EA",scope:{source:"="},templateUrl:"directives/new-social-survey-popup/new-social-survey-popup.html",controller:["$scope","$state","locale",function(i,n,e){i.isSubmitted=!1,i.surveyModel={apple:!1,yandex:!1,twitter:!1,okru:!1,mailru:!1,vk:!1};function t(e){var t;o.TrackerService.trackExperiment("growth__new-socials-survey",{providerId:o.BookingFormSettings.getInstance().providerId,action:"close",type:e,page:n.current&&n.current.name,source:i.source,socials:(t=[],Object.keys(i.surveyModel).forEach(function(e){i.surveyModel[e]&&t.push(e)}),t)},!0)}i.anySocialSelected=function(){var e=i.surveyModel;return e.apple||e.yandex||e.twitter||e.okru||e.mailru||e.vk},i.submitForm=function(){i.anySocialSelected()&&(t("submit"),i.isSubmitted=!0)},i.close=function(){i.isSubmitted||t("cancel"),o.ModalManager.getInstance().close()},i.isEnglishFormLang=function(){return"en"===e.language().language()}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/checkbox/checkbox.html",'<div class="x-checkbox {{::withoutBorder && \'x-checkbox_without_border\'}} {{::withoutMessage && \'x-checkbox_without_message\'}} {{::onPopup && \'x-checkbox_on_popup\'}} {{::onIframe && \'x-checkbox_on_iframe\'}} {{::className}}" tabindex="0" ng-keydown="onKeyDown($event)" ng-click="select($event)" ng-class="{\'x-checkbox_state_checked\': selected, \'x-checkbox_state_invalid\': required && !selected}"><input class="x-checkbox__field" type="checkbox" name="{{checkboxId}}" id="{{checkboxId}}" ng-required="required" ng-model="selected"></input><div class="x-checkbox__check"><svg class="x-checkbox__icon"><use xlink:href="#check"></use></svg></div><div class="x-checkbox__text" ng-transclude></div></div>'),e.put("directives/checkbox/tag.html",'<div class="x-tag" ng-click="select($event)" ng-mouseleave="onMouseLeave()" ng-class="{\'x-tag_selected\': selected, \'x-tag_disabled\': disabled, \'x-tag_line-through\': mouseleave && selected}"><input class="x-tag__input" type="checkbox" name="{{checkboxId}}" id="{{checkboxId}}" ng-required="required" ng-model="selected"></input><div class="x-tag__text" ng-transclude></div></div>')}),!function(o){function e(e){return["$timeout",function(n){return{restrict:"EA",scope:{checkboxId:"=?",selected:"=?",disabled:"=?",required:"=?",withoutBorder:"=",withoutMessage:"=",onPopup:"=",onIframe:"=",onChange:"&",classNames:"=?"},replace:!0,transclude:!0,templateUrl:e,controller:["$scope",function(t){function i(){t.selected=!t.selected,t.mouseleave=!1,n(function(){t.onChange()})}var e;t.className=_.intersection(["-right","-motivator"],null!=(e=t.classNames)?e:[]).join(" ");t.checkboxId||(t.checkboxId=_.uniqueId("cbx")),t.select=function(e){"a"==e.target.tagName.toLowerCase()||t.disabled||i()},t.onKeyDown=function(e){e.which==o.KeyCode.Space&&(e.preventDefault(),i())},t.mouseleave=!1,t.onMouseLeave=function(){t.mouseleave=!0}}]}}]}o.directive||(o.directive={}),o.registerDirective("tlCheckbox",e("directives/checkbox/checkbox.html")),o.registerDirective("tlTag",e("directives/checkbox/tag.html"))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/policy/policy.html",'<div class="x-policy"><div class="x-modal__close" ng-click="close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" rel="heading"><h1 class="x-modal__title" ng-bind="heading | message"></h1></div><div id="policy-container" class="x-modal__content" ng-if="isDataLoaded" rel="content"><div class="pretty-text" ng-bind-html="content | tlSafeLinks | tlUnsafe"></div></div><div class="x-policy__loader" ng-hide="isDataLoaded"><div class="loader loader_on_popup"><svg><use xlink:href="#loader"></use></svg></div></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="close()"></span> <span class="button-group__item tl-btn tl-btn_on_popup" ng-click="print()" tl-message="\'T:modal.print\'" ng-if="isDataLoaded"></span></div></div></div>')}),!function(i){i.directive||(i.directive={});i.registerDirective("tlPolicy",[function(){return{restrict:"EA",templateUrl:"directives/policy/policy.html",scope:{contentType:"@",bookingFormInfo:"=",anchor:"@"},controller:["$scope",function(t){switch(t.close=function(){i.ModalManager.getInstance().close()},t.print=function(){var e=window.open("","","height=500,width=600");e.document.write('<html><head></head><body onload="window.focus();window.print();window.close();">'),e.document.write(t.content),e.document.write("</body></html>"),e.document.close()},t.contentType){case i.PolicyPageType.PrivacyPolicy:t.heading="T:payment.privacy_policy";break;case i.PolicyPageType.UserAgreement:t.heading="T:payment.online_booking_rules"}t.bookingFormInfo.then(function(e){t.content=t.contentType==i.PolicyPageType.PrivacyPolicy?e.policy:e.terms}).finally(function(){t.isDataLoaded=!0})}],link:function(i,n){var o;i.isDataLoaded=!1,i.anchor&&(o=setInterval(function(){var e=n.find("#policy-container"),t=n.find("#"+i.anchor);t.length&&e.length&&(clearInterval(o),e.scrollTop(t.offset().top-e.offset().top+e.scrollTop()))},100),i.$on("$destroy",function(){o&&clearInterval(o)}))}}}])}(tl=tl||{}),tl.registerDirective("tlEmailPattern",[function(){return{require:"ngModel",link:function(e,t,i,n){n.$validators.email=function(e,t){return""==e||!!tl.EmailUtil.REG_EXP.test(t)}}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/secret-code-input/secret-code-input.html",'<div class="x-sci"><div class="x-sci__wrapper"><div class="x-sci__input-container"><input tl-pattern="noEmoji" id="gpSecretCode{{$index}}" class="x-sci__digit-input form-control {{getSecretCodeValidityClass()}}" type="text" name="{{codeStruct[$index].name}}" maxlength="1" required ng-keypress="onKeyPress($event, $index)" ng-keydown="onKeyDown($event, $index)" ng-model="codeStruct[$index].value" ng-focus="onFocus($event)" ng-repeat="digit in codeStruct track by $index" ng-disabled="tlDisabled" ng-init="focusFirstInput($index)"></input><div ng-if="isShowed" ng-init="focusFirstInput()"></div></div><div class="x-glim__error-inline" ng-if="isWrongCode">{{\'T:guest_log_in_error.wrong_reset_code\' | message}}</div></div></div>')}),tl.registerDirective("tlSecretCodeInput",["$timeout",function(n){return{restrict:"EA",templateUrl:"directives/secret-code-input/secret-code-input.html",replace:!0,scope:{code:"=",isShowed:"=",isWrongCode:"=?",codeLength:"<",tlDisabled:"=?"},controller:["$scope",function(i){i.codeStruct=[],null==i.tlDisabled&&(i.tlDisabled=!1);for(var e=0;e<i.codeLength;++e)i.codeStruct.push({name:"codeInputCell"+e,value:""});i.getSecretCodeValidityClass=function(){return i.isWrongCode?"ng-invalid _invalid":"ng-valid _valid"},i.onChange=function(){i.code=t()},i.onFocus=function(e){e.target.select()},i.focusFirstInput=function(){n(function(){var e=document.getElementById("gpSecretCode0");e&&e.focus()})},i.onKeyDown=function(e,t){8!=e.keyCode&&46!=e.keyCode||(i.codeStruct[t].value="",i.onChange(),0<t&&e.target.previousElementSibling.focus(),e.preventDefault())},i.onKeyPress=function(e,t){e.preventDefault(),isNaN(e.key)||" "===e.key||""===e.key||(i.codeStruct[t].value=e.key.toString(),i.onChange(),t<i.codeLength-1&&e.target.nextElementSibling.focus())};var t=function(){var t="";return _.forEach(i.codeStruct,function(e){e.value&&(t+=e.value)}),t}}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/header-navigation-panel/header-navigation-panel.html",'<div class="x-hnp" ng-class="{\'-without-progress\': !params.withProgress}" ng-show="showPanel"><div class="x-hnp__nav"><div class="x-hnp__link -back tl-btn-light tl-btn-light_transparent tl-btn-light_on_navigation" tl-id="hnp-b" ng-if="params.backLabel" ng-class="{\'tl-btn-light_disabled\': !params.backAction}" ng-click="params.backAction()"><svg class="tl-btn-light__icon"><use xlink:href="#arrow-left"></use></svg><div class="x-hnp__link-label" ng-bind="params.backLabel | message"></div></div><div class="x-hnp__content" ng-class="{\'-full-width\': !params.backLabel && !params.forwardLabel}" ng-if="params.stateLabel || params.stateCaption"><h1 class="x-hnp__title" ng-if="params.stateLabel" ng-bind="params.stateLabel | message"></h1><div class="x-hnp__caption" ng-if="params.stateCaption" ng-bind-html="params.stateCaption | message | tlUnsafe"></div></div><div class="x-hnp__link -forward tl-btn-light tl-btn-light_transparent tl-btn-light_on_navigation" tl-id="hnp-f" ng-if="params.forwardLabel" ng-class="{\'tl-btn-light_disabled\': !params.forwardAction}" ng-click="params.forwardAction()"><div class="x-hnp__link-label" ng-bind="params.forwardLabel | message"></div><svg class="tl-btn-light__icon"><use xlink:href="#arrow-right"></use></svg></div></div><div class="x-hnp__bar" ng-if="params.withProgress"><div class="x-hnp__bar-status" ng-style="{ \'width\': progress + \'%\' }"></div></div></div>')}),!function(v){v.directive||(v.directive={});v.registerDirective("tlHeaderNavigationPanel",["serviceFactory","layout",function(h,f){return{restrict:"EA",replace:!0,scope:{params:"="},templateUrl:"directives/header-navigation-panel/header-navigation-panel.html",controller:["$scope","$state",function(t,r){t.progress=0;function e(e){t.progress=(e=e,100/(g()-1)*(m(e)-1))}function i(){t.showPanel=t.params&&(!!t.params.stateLabel||!!t.params.backLabel||!!t.params.forwardLabel),c=n.isModeTurnedOn(v.BookingFormMode.CertificateBookingForm)?[[{name:v.AppState.CertificateList}],[{name:v.AppState.Payment_Certificate}],[{name:v.AppState.Complete}]]:n.isResortMode()?[[{name:v.AppState.SearchFilter}],[{name:v.AppState.RoomsGuestAccommodation,indexed:!0,repetitive:!0}],[{name:v.AppState.RatePlansGuestAccommodation}],[{name:v.AppState.Preview}],[{name:v.AppState.Payment}],[{name:v.AppState.Complete}]]:n.isSanatoriumMode()?[[{name:v.AppState.SearchFilter}],[{name:v.AppState.SharedRatePlans},{name:v.AppState.SharedRatePlans_FilteredList},{name:v.AppState.SharedRatePlans_List}],[{name:v.AppState.SharedRooms},{name:v.AppState.SharedRooms_List},{name:v.AppState.SharedRooms_FilteredList}],[{name:v.AppState.Preview}],[{name:v.AppState.Payment}],[{name:v.AppState.Complete}]]:[[{name:v.AppState.SearchFilter}],[{name:v.AppState.Rooms},{name:v.AppState.Rooms_List},{name:v.AppState.Rooms_Grid},{name:v.AppState.RoomsSearchCriteria},{name:v.AppState.RoomsSearchCriteria_All},{name:v.AppState.RoomsSearchCriteria_Filtered}],[{name:v.AppState.RoomInfo,condition:u}],[{name:v.AppState.Preview,indexed:!0,looped:!0,condition:d}],[{name:v.AppState.Preview,condition:p}],[{name:v.AppState.Payment}],[{name:v.AppState.Complete}]],e(r.current.name)}function a(){return _.filter(c,function(e){return _.every(e,function(e){return void 0===e.condition||e.condition()})})}function s(){var e,t,i=0;return h.bootstrapService.currentApp===o&&(e=l.getOrder(),t=o.getSearchCriteria(),i=!n.isResortMode()&&(null==e?void 0:e.guestStays.length)||t.placements.length),i}var n=v.BookingFormSettings.getInstance(),o=h.bookingService,l=h.orderService,c=[],u=function(){var e=n.isModeTurnedOn(v.BookingFormMode.RoomsGridView),t=n.accommodationMode==v.AccommodationMode.Manual||1<(null==(t=o.getSearchCriteria())?void 0:t.placements.length);return f.phone||e&&!t},d=function(){return n.isServicesNewViewMode()},p=function(){return!n.isServicesNewViewMode()},m=function(i){var e,n=null!=(e=function(e){e=e.params.placementRef;return _.isUndefined(e)?null:""===e?1:_.toNumber(e)+1}(r))?e:s(),o=0;return _.forEach(a(),function(e){if(_.some(e,{name:i}))return _.some(e,{looped:!0})?o=(o+=n)+(t=i,_.chain(a()).dropWhile(function(e){return!_.some(e,{name:t})}).drop().filter(function(e){return _.some(e,{looped:!0})}).value().length*Math.max(n-1,0)):_.some(e,{repetitive:!0})?o+=n:o++,!1;var t;_.some(e,{indexed:!0})?_.some(e,{repetitive:!0})?o+=s():o+=n:o++}),o},g=function(){var i=s();return _.reduce(a(),function(e,t){return e+(_.some(t,{indexed:!0})?i:1)},0)};t.$watch(function(){var e;return null==(e=l.getOrder())?void 0:e.guestStays.length},function(){e(r.current.name)}),t.$watch(function(){return t.params},i)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/copyright/copyright.html",'<div class="x-copyright" ng-if="isShowCopyright" tl-message="\'T:common.booking_engine\'" message-html="true"></div>')}),tl.registerDirective("tlCopyright",[function(){return{scope:!0,transclude:!0,templateUrl:"directives/copyright/copyright.html",controller:["$scope",function(e){tl.CopyrightManager.getInstance().initScope(e),e.isShowCopyright=!1,e.show=function(){e.isShowCopyright=!0},e.hide=function(){e.isShowCopyright=!1}}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/cart/cart-new.html",'<div class="x-cart-new-stub" rel="cart-stub" ng-show="isServicesNewViewMode"></div><div class="x-cart-new" rel="cart" ng-class="{\'_attached\': !isDetached}" ng-show="(isMotivationalTextShown || isCartPanelShown) && isServicesNewViewMode"><div class="x-cart-new__motivational-text" rel="cart-motivational-text" ng-bind="motivationalText" ng-hide="forceHideMotivationalText" ng-if="isMotivationalTextShown && isServicesNewViewMode"></div><div class="x-cart-new__content" ng-show="isCartPanelShown"><div class="x-cart-new__order" ng-class="{\'x-cart-new__order_active\': orderShown}" ng-click="toggleOrder()"><div class="x-cart-new__icon" rel="cart-icon"><svg class="x-cart-new__icon-cart"><use xlink:href="#cart"></use></svg></div></div><div class="tl-btn tl-btn_size_big x-cart-new__button" ng-class="{\'tl-btn_state_loading\': proceedBookingBtnLoading}" ng-click="proceedBooking()" ng-disabled="!proceedBookingBtnEnabled"><span class="x-cart-new__button-text" ng-bind="proceedBookingBtnString"></span> <span ng-if="proceedBookingBtnString && showPrice">&nbsp;</span> <span class="x-cart-new__button-price" ng-if="showPrice" ng-bind-html="orderPrice | tlUnsafe"></span> <svg class="tl-btn__icon"><use xlink:href="#arrow-right"></use></svg></div></div></div>'),e.put("directives/cart/cart.html",'<div class="x-cart-stub" rel="cart-stub" ng-show="!isServicesNewViewMode"></div><div class="x-cart" rel="cart" ng-class="{\'_attached\': !isDetached}" ng-show="(isMotivationalTextShown || isCartPanelShown) && !isServicesNewViewMode"><div class="x-cart__motivational-text" rel="cart-motivational-text" ng-bind="motivationalText" ng-hide="forceHideMotivationalText" ng-if="isMotivationalTextShown && !isServicesNewViewMode"></div><div class="x-cart__content" ng-show="isCartPanelShown"><div class="x-cart__order"><div class="x-cart__icon" ng-class="{\'x-cart__icon_active\': proceedBookingBtnEnabled}" rel="cart-icon"><svg class="x-cart__icon-cart"><use xlink:href="#cart"></use></svg></div><span class="x-cart__details" ng-bind-html="orderString | tlUnsafe"></span></div><div class="x-cart__booking"><div class="x-cart__hint" ng-bind="hintString" ng-show="!proceedBookingBtnEnabled"></div><div class="x-cart__prices"><div class="x-cart__price" ng-bind-html="orderPrice | tlUnsafe"></div><div class="x-cart__taxes" ng-bind="orderPriceDetails" ng-if="orderPriceDetails"></div></div><div class="tl-btn tl-btn_size_big tl-btn_secondary x-cart__button" ng-class="{\'tl-btn_state_loading\': proceedBookingBtnLoading}" ng-click="proceedBooking()" ng-disabled="!proceedBookingBtnEnabled"><span ng-bind="proceedBookingBtnString" ng-if="hintString"></span> <span class="x-cart__button-price" ng-bind-html="orderPrice | tlUnsafe" ng-if="hintString && !proceedBookingBtnString"></span><div ng-if="!hintString"><span class="x-cart__button-text" ng-bind="proceedBookingBtnString"></span> <span class="x-cart__button-price" ng-bind-html="orderPrice | tlUnsafe"></span></div><svg class="tl-btn__icon"><use xlink:href="#arrow-right"></use></svg></div></div></div></div>')}),function(l,e){return[function(){return{scope:!0,templateUrl:e,controller:["$scope","$timeout",function(n,o){var r,a;n.isDetached=!0,AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.UpdateOrder,function(e){n.$apply(function(){n.orderString=e.order,n.orderPrice=e.price,n.orderPriceDetails=e.priceDetails,n.showPrice=e.showPrice,n.orderShown=e.orderShown,n.proceedBookingBtnString=e.proceedBtnText,n.proceedBookingBtnEnabled=e.proceedBtnEnabled,n.proceedBookingBtnLoading=e.proceedBtnLoading,n.hintString=e.hintText})}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.Show,function(){n.$apply(function(){n.isCartPanelShown=!0})}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.Hide,function(){n.$apply(function(){n.isCartPanelShown=!1})}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.SetViewMode,function(e){n.$apply(function(){n.isServicesNewViewMode="new"===e.viewMode})}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.ShowMotivationalText,function(e){n.$apply(function(){n.motivationalText=e.text,n.forceHideMotivationalText=!1,n.isMotivationalTextShown=!0;function t(){return document.querySelector('[rel="cart-motivational-text"]')}var i=setInterval(function(){var e=t();e&&(clearInterval(i),e.style.opacity="1")},20);e.hideTimeout&&(o.cancel(a),clearTimeout(r),r=setTimeout(function(){var e=t();e&&(e.style.opacity="0"),a=o(function(){n.isMotivationalTextShown=!1},2e3)},e.hideTimeout))})}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.HideMotivationalText,function(){n.$apply(function(){n.forceHideMotivationalText=!0}),n.$apply(function(){n.isMotivationalTextShown=!1})}),n.proceedBooking=function(){AppIntegration.frameFireEvent(n.proceedBookingBtnEnabled?tl.directive.helper.uiCartEvent.ProceedBooking:tl.directive.helper.uiCartEvent.ClickBookingDisabled,{})};n.toggleOrder=function(){return n.orderShown?AppIntegration.frameFireEvent(tl.directive.helper.uiCartEvent.HideOrder,{}):AppIntegration.frameFireEvent(tl.directive.helper.uiCartEvent.ShowOrder,{})},AppIntegration.frameFireEvent(tl.directive.helper.uiCartEvent.Connect,{})}],link:function(e,t){var i,n,o,r,a,s=t[0].querySelector('[rel="cart-icon"]');e.animateCartIcon=function(){tl.HtmlUtil.toggleClass(s,"bounce-in",!0),setTimeout(function(){tl.HtmlUtil.toggleClass(s,"bounce-in",!1)},400)},e.$watch(function(){return e.orderPrice},function(){e.animateCartIcon()});clearInterval(i),r=t[0].querySelector('[rel="cart"]'),a=t[0].querySelector('[rel="cart-stub"]'),i=setInterval(function(){e.isServicesNewViewMode!=l?o=void 0:(n=Math.ceil(r.clientHeight),(null==o||2<Math.abs(o-n))&&(a.style.height=n+"px",o=n,AppIntegration.frameFireEvent(tl.directive.helper.uiCartEvent.Resize,{height:n})))},20)}}}]}),tlCartDetachedCtrl=(tl.registerDirective("tlCartDetached",tlCartDetachedDirective(!1,tl.directiveTemplateUrl("cart","cart"))),tl.registerDirective("tlCartNewDetached",tlCartDetachedDirective(!0,tl.directiveTemplateUrl("cart","cart-new"))),["$scope","$state","$timeout","locale",function(t,e,i,n){t.isCartPanelShown=!1,t.isMotivationalTextShown=!1,t.isDetached=!0;var o,r,a,s=tl.CartPanelManager.getInstance();s.isFrameCreated||(s.initScope(t),s.createFrame(e),r=!(o=[]),a=function(e,t){void 0===t&&(t={}),r?AppIntegration.frameFireEvent(e,t):o.push(new tl.directive.helper.uiCartDelayedEvent(e,t))},AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.Connect,function(){for(r=!0;o.length;){var e=o.shift();a(e.name,e.params)}}),t.showCartPanel=function(){a(tl.directive.helper.uiCartEvent.Show)},t.hideCartPanel=function(){a(tl.directive.helper.uiCartEvent.Hide)},t.showMotivationalText=function(e,t){a(tl.directive.helper.uiCartEvent.ShowMotivationalText,{text:e,hideTimeout:t})},t.hideMotivationalText=function(){a(tl.directive.helper.uiCartEvent.HideMotivationalText)},AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.ProceedBooking,function(){i(function(){t.proceedBooking()},0)}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.ClickBookingDisabled,function(){i(function(){t.clickBookingDisabled()},0)}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.ShowOrder,function(){return i(function(){return t.showOrder()},0)}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.HideOrder,function(){return i(function(){return t.hideOrder()},0)}),AppIntegration.frameSubscribeEvent(tl.directive.helper.uiCartEvent.Resize,function(e){t.resizeStub(e.height)}),t.$watchCollection(function(){var e;return t.order?(e=t.order.totalPrice(),[t.order.guestStays.length,t.order.totalGuests(),tl.util.OrderUtil.hasSelectedNonInclusiveOptions(t.order),t.searchCriteria.checkInDate,t.searchCriteria.checkOutDate,t.searchCriteria.guests(),e.priceAfterTax.amount,e.currency,t.proceedBookingBtnText,t.proceedBookingBtnLoading,t.showPrice,t.orderShown,n.id(),t.order.optionsPrice()]):t.searchCriteria?[null,null,null,null,null,t.searchCriteria.guests(),null,null,t.proceedBookingBtnText,t.proceedBookingBtnLoading,t.showPrice,t.orderShown,n.id(),null]:[null,null,null,null,null,null,null,null,t.proceedBookingBtnText,t.proceedBookingBtnLoading,t.showPrice,t.orderShown,n.id(),null]},function(){var e=tl.BookingFormSettings.getInstance();e.isModeTurnedOn(tl.BookingFormMode.SharedAccommodationRatePlan)&&!e.isModeTurnedOn(tl.BookingFormMode.SharedRoomView)?(t.proceedBookingBtnEnabled=t.searchCriteria&&0<t.searchCriteria.adults(),a(tl.directive.helper.uiCartEvent.UpdateOrder,{showPrice:t.showPrice,orderShown:t.orderShown,proceedBtnText:t.formatProceedBookingString(),proceedBtnEnabled:t.proceedBookingBtnEnabled,proceedBtnLoading:t.proceedBookingBtnLoading,hintText:t.formatHintString()})):t.formatOrderString()&&(e.isResortMode()?t.proceedBookingBtnEnabled=t.order&&t.order.guestStays.length==t.searchCriteria.placements.length:t.proceedBookingBtnEnabled=t.order&&0<t.order.guestStays.length,a(tl.directive.helper.uiCartEvent.UpdateOrder,{order:t.formatOrderString(),price:t.formatPriceString(),priceDetails:t.formatPriceDetailsString(),showPrice:t.showPrice,orderShown:t.orderShown,proceedBtnText:t.formatProceedBookingString(),proceedBtnEnabled:t.proceedBookingBtnEnabled,proceedBtnLoading:t.proceedBookingBtnLoading}))}),t.$watch(function(){return tl.BookingFormSettings.getInstance().isServicesNewViewMode()},function(e){a(tl.directive.helper.uiCartEvent.SetViewMode,{viewMode:e?"new":"old"})}))}]),tlCartCtrl=["$scope","locale","$timeout",function(o,t,r){var a,s;o.isCartPanelShown=!1,o.isMotivationalTextShown=!1,o.isDetached=!1,tl.CartPanelManager.getInstance().initScope(o),o.showCartPanel=function(){o.isCartPanelShown=!0},o.hideCartPanel=function(){o.isCartPanelShown=!1},o.showMotivationalText=function(e,t){o.motivationalText=e,o.forceHideMotivationalText=!1,o.isMotivationalTextShown=!0;function i(){return document.querySelector('[rel="cart-motivational-text"]')}var n=setInterval(function(){var e=i();e&&(clearInterval(n),e.style.opacity="1")},20);t&&(r.cancel(s),clearTimeout(a),a=setTimeout(function(){var e=i();e&&(e.style.opacity="0"),s=r(function(){o.isMotivationalTextShown=!1},2e3)},t))},o.hideMotivationalText=function(){o.forceHideMotivationalText=!0,o.isMotivationalTextShown=!1},o.$watchCollection(function(){var e;return o.order?(e=o.order.totalPrice(),[o.order.guestStays.length,o.order.totalGuests(),tl.util.OrderUtil.hasSelectedNonInclusiveOptions(o.order),o.searchCriteria.checkInDate,o.searchCriteria.checkOutDate,o.searchCriteria.guests(),e.priceAfterTax.amount,e.currency,o.proceedBookingBtnText,t.id(),o.order.optionsPrice()]):o.searchCriteria?[null,null,null,null,null,o.searchCriteria.guests(),null,null,o.proceedBookingBtnText,t.id(),null]:[null,null,null,null,null,null,null,null,o.proceedBookingBtnText,t.id(),null]},function(){var e=tl.BookingFormSettings.getInstance();o.orderString=o.formatOrderString(),o.orderPrice=o.formatPriceString(),o.orderPriceDetails=o.formatPriceDetailsString(),o.proceedBookingBtnString=o.formatProceedBookingString(),o.proceedBookingBtnEnabled=o.order&&0<o.order.guestStays.length,e.isModeTurnedOn(tl.BookingFormMode.SharedAccommodationRatePlan)&&(e.isResortMode()?o.proceedBookingBtnEnabled=o.order&&o.order.guestStays.length==o.searchCriteria.placements.length:o.proceedBookingBtnEnabled=o.searchCriteria&&0<o.searchCriteria.adults(),o.hintString=o.formatHintString())})}],tlCartDirective=function(e){return["locale","tl.messages","$q","$compile",function(f,v,y,b){return{scope:!0,templateUrl:AppIntegration.getProperties().attachCart?e:"",controller:AppIntegration.getProperties().attachCart?tlCartCtrl:tlCartDetachedCtrl,link:function(o,e){o.$watch(function(){return tl.BookingFormSettings.getInstance().isServicesNewViewMode()},function(e){return o.isServicesNewViewMode=e});var t,r,a,s,l,n=new tl.directive.helper.OrderHelper(v),c=tl.BookingFormSettings.getInstance(),i=tl.ModalManager.getInstance(),u=(o.setOrder=function(e){o.order=e},o.setSearchCriteria=function(e){o.searchCriteria=e,o.stayDates=new tl.RoomStayStayDate(o.searchCriteria.checkInDate,o.searchCriteria.checkOutDate,c.stayUnitKind)},o.proceedBooking=function(){o.proceedBookingBtnEnabled&&(o.hideOrder(),o.proceedBookingAction&&o.proceedBookingAction())},o.clickBookingDisabled=function(){o.proceedBookingBtnEnabled||o.clickBookingDisabledAction&&o.clickBookingDisabledAction()},o.formatOrderString=function(){var e,t,i=[];return c.isServicesBookingForm()&&!c.isServicesWithPeriod()?(o.order&&o.order.guestStays.length&&i.push(v.formatMessage("T:cart.service",{services:o.order.totalGuests()})),o.searchCriteria&&i.push(v.formatMessage("T:cart.date",{checkInDate:o.searchCriteria.checkInDate}))):(o.order&&(tl.util.OrderUtil.hasSelectedNonInclusiveOptions(o.order)&&i.push(v.getMessage("T:cart.services")),e=[],(t=n.getOrderString(o.order)).length&&e.push(t),o.order.guestStays.length&&e.push(v.formatMessage("T:cart.guests",{guests:o.order.totalGuests()})),e.length&&i.push(e.join(", "))),o.searchCriteria&&i.push(v.formatMessage("T:cart.dates",{checkInDate:o.searchCriteria.checkInDate,checkOutDate:o.searchCriteria.checkOutDate}))),i.join("<br/>")},o.formatPriceString=function(){var e=o.order?o.order.totalPrice():tl.Price.empty(f.currency()),e=c.isServicesNewViewMode()||!c.showNetPrices?e.priceAfterTax:e.priceBeforeTax;return v.formatMessage("T:cart.price",{price:e})},o.formatPriceDetailsString=function(){var e;return c.isTaxesEnabled&&o.order&&o.order.totalPrice().priceAfterTax.amount?(e=new tl.TaxUnit(tl.directive.helper.TaxHelper.resolveTaxAmountsKind(o.order.totalPrice().taxes)),v.formatMessage(o.order.totalPrice().taxes.length&&c.showNetPrices?"T:tax.not_included":"T:tax.included",{kind:e})):""},o.formatProceedBookingString=function(){if(o.proceedBookingBtnText)return v.getMessage(o.proceedBookingBtnText)},o.formatHintString=function(){if(o.hintText)return v.getMessage(o.hintText)},o.resizeStub=function(e){var t=document.getElementById("cart-stub-styles");t&&t.parentNode.removeChild(t),(t=document.createElement("style")).setAttribute("id","cart-stub-styles"),t.textContent=".tl-container { padding-bottom: "+e+"px !important; }",document.getElementsByTagName("head")[0].appendChild(t)},/PhantomJS/.test(window.navigator.userAgent)),d=function(){clearInterval(t)},p=(o.isDetached||(d(),s=e[0].querySelector('[rel="cart"]'),l=e[0].querySelector('[rel="cart-stub"]'),t=setInterval(function(){var e=0,t=AppIntegration.getPosition(),i=tl.LayoutManager._getWindowHeight(),n=Math.ceil(s.clientHeight);u?e=document.body.clientHeight-n:o.order||o.isMotivationalTextShown?(e=t.screenHeight+t.scrollTop-n,e=Math.min(Math.max(e,0),i-n),null!=a&&a!=e&&(s.style.opacity="0",clearTimeout(r),r=setTimeout(function(){s.style.opacity="1"},500)),a=e):e=i-n,tl.HtmlUtil.transform(s,"translate(-50%, "+e+"px)"),l.style.height=n+"px"},100)),o.$on("$destroy",function(){d()}),{callback:function(){o.order&&tl.util.IntegrationEvent.trackSelectRoom(o.order.guestStays)}}),m=(tl.OrderInformer.getInstance().subscribe(p,tl.OrderInformerMessageType.RemoveGuestStays),tl.OrderInformer.getInstance().subscribe(p,tl.OrderInformerMessageType.AddGuestStays),e[0].querySelector('[rel="cart-icon"]')),g="bounce-in",h=(o.$watch(function(){return o.order?o.order.totalPrice().priceAfterTax:null},function(e){tl.HtmlUtil.toggleClass(m,g,!0),setTimeout(function(){tl.HtmlUtil.toggleClass(m,g,!1)},400),tl.util.IntegrationEvent.trackChangeOrderPrice(e)},!0),o.$watchCollection(function(){return o.order&&o.order.guestStays.length?[o.order.stay().arrival().time(),o.order.stay().departure().time()]:o.searchCriteria?[o.searchCriteria.checkInDate,o.searchCriteria.checkOutDate]:[null,null]},function(e){e[0]&&e[1]&&tl.util.IntegrationEvent.trackChangeDates(e[0],e[1])}),o.$watch(function(){return o.order&&o.order.customer&&(o.order.paymentSystem||o.order.customer.termsAgree)?o.order.customer.email:""},function(e){tl.util.IntegrationEvent.trackType(tl.AppIntegrationEvent__TrackUserAction__FieldKind.Email,e)}),o.$watch(function(){return o.order&&o.order.customer&&o.order.customer.phone&&o.order.customer.phone.phone&&(o.order.paymentSystem||o.order.customer.termsAgree)?o.order.customer.phone.number():""},function(e){tl.util.IntegrationEvent.trackType(tl.AppIntegrationEvent__TrackUserAction__FieldKind.Phone,e)}),o.$watch(function(){return o.order&&(o.order.paymentSystem||o.order.customer&&o.order.customer.termsAgree)&&o.order.guestStays.length&&_.head(o.order.guestStays).guests.length?_.head(_.head(o.order.guestStays).guests).fullName():""},function(e){tl.util.IntegrationEvent.trackType(tl.AppIntegrationEvent__TrackUserAction__FieldKind.Name,e)}),o.showOrder=function(){var e,t;i.open(y.when(function(){return b('<tl-cart-inline\n                                    stay-dates="stayDates"\n                                    proceed-booking-btn-string="\'T:cart.proceed\'"\n                                    is-proceed-booking-btn-enabled="true"\n                                    is-proceed-booking-btn-hidden="true"\n                                    proceed-booking-action="proceedBooking()"\n                                    close-action="hideOrder()"\n                                    total-price="order.totalPrice()"\n                                >\n                                    <tl-cart-search-criteria search-criteria="::searchCriteria" is-search-criteria-editable="false">\n                                    </tl-cart-search-criteria>\n\n                                    <tl-cart-order order="order" collapsed="true"> </tl-cart-order>\n                                </tl-cart-inline>')(o)[0]}),{withoutPaddings:!0}),o.orderShown=i.opened(),e=AppIntegration.getPosition(),t=e.scrollTop,(e=document.body.clientHeight-e.screenHeight)<t?AppIntegration.scrollTo(e,!0):t<0&&AppIntegration.scrollTo(0),o.$applyAsync()},o.hideOrder=function(){i.close(),o.orderShown=i.opened(),o.$applyAsync()},o.toggleOrder=function(){return o.orderShown?o.hideOrder():o.showOrder()},new Date);_.forEach(["mousemove","keypress"],function(e){document.addEventListener(e,function(){h=new Date})}),setInterval(function(){(new Date).getTime()-h.getTime()<5e3&&tl.util.IntegrationEvent.trackInteract()},5e3)}}}]},tl,tl,tlTitleDirective=(tl.registerDirective("tlCart",tlCartDirective(tl.directiveTemplateUrl("cart","cart"))),tl.registerDirective("tlCartNew",tlCartDirective(tl.directiveTemplateUrl("cart","cart-new"))),tl.registerTemplate(function(e){"use strict";e.put("directives/cart-inline/cart-inline.html",'<aside class="x-cin-container"><div class="x-cin" rel="cart-inline"><div class="x-cin__header"><h1 class="x-cin__header-title" tl-message="\'T:cart_inline.my_booking\'"></h1><div class="x-cin__header-button" ng-if="closeAction" ng-click="closeAction()"><svg><use xlink:href="#cancel"></use></svg></div></div><div class="x-cin__section"><div class="x-cin__subheader x-cin__subheader_active"><span ng-bind="\'T:common.nights\' | message: {nights: stayDates.duration()}"></span></div><div class="x-cin-stay"><div class="x-cin-stay__item"><div class="x-cin-date"><span ng-bind-html="\'T:cart_inline.date\' | message: {date: stayDates.startDate} | tlUnsafe"></span> <span class="h4" ng-if="::!equalDates">&ndash;&nbsp;</span></div><div class="x-cin-date__weekday" ng-bind="\'T:cart_inline.weekday\' | message: {date: stayDates.startDate}"></div></div><div class="x-cin-stay__item" ng-if="::!equalDates"><div class="x-cin-date" ng-bind-html="\'T:cart_inline.date\' | message: {date: stayDates.endDate} | tlUnsafe"></div><div class="x-cin-date__weekday" ng-bind="\'T:cart_inline.weekday\' | message: {date: stayDates.endDate}"></div></div></div></div><div ng-transclude class="x-cin__content"></div><div class="x-cin__total" ng-if="(totalPrice | tlTax).amount" ng-bind-html="totalPrice | tlTax | tlCurrency"></div><div class="x-cin__taxes" ng-bind="getTaxAndFeeIncludedText()" ng-if="getTaxAndFeeIncludedText()"></div><div class="x-cin__action" ng-if="!isProceedBookingBtnHidden"><div class="tl-btn tl-btn_size_big x-cin__button" ng-class="{\'tl-btn_state_disabled\': !isProceedBookingBtnEnabled, \'tl-btn_state_loading\': isRoomStaysValidationInProgress, \'-blink\': isProceedBookingBtnEnabled}" ng-click="proceedBooking()" tl-tooltip tooltip-disabled="isProceedBookingBtnEnabled" tooltip-text="proceedBookingBtnDisabledTooltip" tooltip-event="hover" rel="cart-button"><span tl-message="proceedBookingBtnString"></span> <svg class="tl-btn__icon"><use xlink:href="#arrow-right"></use></svg></div></div></div></aside>')}),!function(p){p.directive||(p.directive={});p.registerDirective("tlCartInline",["tl.messages","$timeout",function(n,d){return{restrict:"EA",scope:{stayDates:"=",proceedBookingBtnString:"=",proceedBookingBtnDisabledTooltip:"=",isProceedBookingBtnEnabled:"=",isProceedBookingBtnHidden:"=?",proceedBookingAction:"&",clickBookingDisabledAction:"&?",isRoomStaysValidationInProgress:"=",closeAction:"&?",totalPrice:"=?"},transclude:!0,templateUrl:"directives/cart-inline/cart-inline.html",controller:["$scope",function(t){var i=p.BookingFormSettings.getInstance();t.proceedBooking=function(){t.isProceedBookingBtnEnabled?t.proceedBookingAction():t.clickBookingDisabledAction&&t.clickBookingDisabledAction()},t.equalDates=!moment(t.stayDates.endDate).isAfter(t.stayDates.startDate,"day"),t.getTaxAndFeeIncludedText=function(){var e;return i.isTaxesEnabled&&null!=(e=null==(e=t.totalPrice)?void 0:e.priceAfterTax)&&e.amount?n.formatMessage(t.totalPrice.taxes.length&&i.showNetPrices?"T:tax.not_included":"T:tax.included",{kind:new p.TaxUnit(p.directive.helper.TaxHelper.resolveTaxAmountsKind(t.totalPrice.taxes))}):""}}],link:function(e,t,i,n){function o(){var e=(t=AppIntegration.getPosition()).screenHeight,t=t.fixedHeaderHeight;s.style.maxHeight=e-t+"px"}var r=angular.element(window),a=t[0].querySelector('[rel="cart-icon"]'),s=t[0].querySelector('[rel="cart-inline"]'),l="x-cin__icon_animated",c=(n.animateCart=function(){p.HtmlUtil.toggleClass(a,l),p.HtmlUtil.toggleClass(a,"bounce-in"),setTimeout(function(){p.HtmlUtil.toggleClass(a,l),p.HtmlUtil.toggleClass(a,"bounce-in")},400)},r.on(p.EventType.Resize,o),d(o,0),document.documentElement.querySelector(".page")),u="-with-cart";p.HtmlUtil.toggleClass(c,u,!0),e.$on("$destroy",function(){p.HtmlUtil.toggleClass(c,u,!1),r.off(p.EventType.Resize,o)})}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/cart-search-criteria/cart-search-criteria.html",'<div class="x-cin__section"><div class="x-cin__subheader" ng-class="{\'x-cin__subheader_active\': searchCriteria.guests() > 0}" ng-show="searchCriteria.guests() > 0 && searchCriteria.guestRatePlans.length > 0"><div tl-title is-opened="opened" is-clickable="true" type="\'type_2\'" click-action="toggleList()" update-action="titleNotifier.notifier"><span ng-bind="\'T:cart_inline.guests\' | message: {guests: searchCriteria.guests()}"></span></div></div><div tl-accordion is-collapsed="!opened"><div class="x-cin__entries" ng-show="searchCriteria.guests() > 0 && searchCriteria.guestRatePlans.length > 0"><div class="x-cin-entry" ng-repeat="guestRatePlan in searchCriteria.guestRatePlans track by guestRatePlan.id" ng-if="guestRatePlan.guests()"><div class="x-cin-entry__body"><div tl-message="guestRatePlan.ratePlan.name"></div><div class="x-cin-entry__value" ng-bind-html="getPlacementDescription(guestRatePlan) | tlUnsafe"></div><div class="x-cin-entry__delete" ng-if="::isSearchCriteriaEditable" ng-click="removeGuestRatePlan(guestRatePlan)" tl-tooltip tooltip-text="\'T:cart_inline.remove\' | message" tooltip-event="hover"><svg class="x-cin-entry__icon"><use xlink:href="#trash"></use></svg> <svg class="x-cin-entry__icon"><use xlink:href="#trash-invert"></use></svg></div></div></div></div></div></div>')}),!function(o){var r;o.directive||(o.directive={});r=!0,o.registerDirective("tlCartSearchCriteria",["$q","tl.messages",function(e,n){return{restrict:"EA",scope:{searchCriteria:"=",isSearchCriteriaEditable:"=",removeGuestRatePlanAction:"&"},require:"^tlCartInline",templateUrl:"directives/cart-search-criteria/cart-search-criteria.html",controller:["$scope",function(t){t.titleNotifier=o.NotifierHelper.subscribe(t,e,!1,!1),t.opened=r,t.toggleList=function(){t.opened=!t.opened,t.titleNotifier.update(),r=t.opened};var i=new o.PlacementUtil(n);t.getPlacementDescription=function(e){return i.getGuestRatePlanPlacementDescription(e)},t.removeGuestRatePlan=function(e){t.removeGuestRatePlanAction({guestRatePlan:e})}}],link:function(i,e,t,n){i.animateCart=function(){n.animateCart()},i.$watch("searchCriteria",function(e,t){t.guestRatePlans.length&&t.guestRatePlans!=e.guestRatePlans&&i.animateCart()},!0)}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/title/title.html",'<div class="x-title"><span class="x-title__text"><span ng-transclude></span>&nbsp;<span ng-if="::showHint" class="x-title__hint"><span ng-show="!isOpened" tl-message="\'T:common.show\'" message-html="true"></span><span ng-show="isOpened" tl-message="\'T:common.hide\'" message-html="true"></span></span></span>&nbsp;<svg class="x-title__icon"><use xlink:href="#arrow-down-inline"></use></svg></div>')}),function(e){return["$parse",function(l){return{restrict:"EA",scope:!1,transclude:!0,replace:!0,templateUrl:e,link:function(e,t,i){function n(){e.isOpened=!!l(i.isOpened)(e),a=!!l(i.isClickable)(e),t.toggleClass("x-title_state_opened",e.isOpened),t.toggleClass("x-title_state_clickable",a)}var o=l(i.clickAction),r=l(i.updateAction)(e),a=!!l(i.isClickable)(e),s=(a&&t.addClass("x-title_state_clickable"),e.isOpened=!!l(i.isOpened)(e),e.isOpened&&t.addClass("x-title_state_opened"),l(i.type)(e));s&&-1!=_.indexOf(["type_1","type_2"],s)&&t.addClass("x-title_"+s);e.showHint=!!l(i.withHint)(e),t.on(tl.EventType.Click,function(){a&&(o(e),n(),e.$apply())}),r&&r(function(){n()})}}}]}),tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,HtmlUtil=(tl.registerDirective("tlTitle",tlTitleDirective(tl.directiveTemplateUrl("title"))),tl.registerTemplate(function(e){"use strict";e.put("directives/cart-order/cart-order-room.html",'<div tl-id="cin-${roomIndex}"><div class="x-cin__section"><div class="x-cin__subheader x-cin__subheader_active"><table class="x-cord__table"><tbody><tr><td><span ng-if="showRoomIndex" tl-message="\'T:cart_inline.room_index\'" message-params="{kind: getRoomTypeUnit(guestStay.roomStay.roomType.kind), index: roomIndex}" message-html="true"></span> <span ng-if="!showRoomIndex" tl-message="\'T:cart_inline.room\'" message-params="{kind: getRoomTypeUnit(guestStay.roomStay.roomType.kind)}" message-html="true"></span></td><td ng-bind-html="guestStay.getTotalPrice().priceAfterDiscount.priceBeforeTax | tlCurrency"></td></tr></tbody></table><div tl-title is-opened="title.opened" is-clickable="true" type="\'type_2\'" click-action="toggleList()" update-action="titleNotifier.notifier"><span tl-message="guestStay.roomStay.roomType.name"></span></div></div><div tl-accordion is-collapsed="!title.opened"><div class="x-cin__entries"><table class="x-cin__table x-cin__table_with_title"><tbody ng-repeat="guestPlacement in getGuestPlacements()" tl-id="cingp-${$index}"><tr><td colspan="2"><span class="x-cord__guest" tl-message="getPlacementDescription(guestPlacement)" message-html="true"></span></td></tr><tr><td tl-message="getRatePlan(guestPlacement).name"></td><td ng-bind-html="guestPlacement.price.priceBeforeDiscount.priceBeforeTax | tlCurrency"></td></tr><tr ng-repeat="mealPlan in guestStay.mealPlans track by mealPlan.id()" ng-if="mealPlan.option.getPlacementIndex() == guestPlacement.index" tl-id="cingpmp-${mealPlan.id()}"><td ng-bind="mealPlan.option.name()"></td><td ng-if="::!mealPlan.isInclusive()" ng-bind-html="mealPlan.getTotalPrice().priceAfterTax | tlCurrency"></td><td ng-if="::mealPlan.isInclusive()" tl-message="\'T:cart_inline.included\'"></td></tr><tr ng-repeat="roomOption in guestStay.roomOptions track by roomOption.id()" ng-if="roomOption.option.getPlacementIndex() == guestPlacement.index" tl-id="cingpro-${roomOption.id()}"><td ng-bind="roomOption.option.name()"></td><td ng-if="::!roomOption.isInclusive()" ng-bind-html="roomOption.getTotalPrice().priceAfterTax | tlCurrency"></td><td ng-if="::roomOption.isInclusive()" tl-message="\'T:cart_inline.included\'"></td></tr></tbody><tbody ng-if="guestStay.roomStay.price.discountAmountBeforeTax.amount"><tr><td class="x-cord__discount" tl-message="\'T:cart_inline.discount\'"></td><td class="x-cord__discount" ng-bind-html="guestStay.roomStay.price.discountAmountBeforeTax | tlCurrency"></td></tr></tbody><tbody ng-if="hasRoomServices()"><tr><td colspan="2" tl-message="\'T:cart_inline.room_services\'"></td></tr><tr ng-repeat="mealPlan in guestStay.mealPlans track by mealPlan.id()" ng-if="!mealPlan.option.hasPlacementIndex()" tl-id="cinmp-${mealPlan.id()}"><td ng-bind="mealPlan.option.name()"></td><td ng-if="::!mealPlan.isInclusive()" ng-bind-html="mealPlan.getTotalPrice().priceAfterTax | tlCurrency"></td><td ng-if="::mealPlan.isInclusive()" tl-message="\'T:cart_inline.included\'"></td></tr><tr ng-repeat="roomOption in guestStay.roomOptions track by roomOption.id()" ng-if="!roomOption.option.hasPlacementIndex()" tl-id="cinro-${roomOption.id()}"><td ng-bind="roomOption.option.name()"></td><td ng-if="::!roomOption.isInclusive()" ng-bind-html="roomOption.getTotalPrice().priceAfterTax | tlCurrency"></td><td ng-if="::roomOption.isInclusive()" tl-message="\'T:cart_inline.included\'"></td></tr><tr ng-if="guestStay.arrival().price().priceAfterTax.amount > 0"><td tl-message="\'T:order_info.early_arrival\'"></td><td ng-bind-html="guestStay.arrival().price().priceAfterTax | tlCurrency"></td></tr><tr ng-if="guestStay.departure().price().priceAfterTax.amount > 0"><td tl-message="\'T:order_info.late_departure\'"></td><td ng-bind-html="guestStay.departure().price().priceAfterTax | tlCurrency"></td></tr></tbody></table></div></div></div></div>'),e.put("directives/cart-order/cart-order.html",'<div><div tl-cart-order-room ng-repeat="guestStay in order.guestStays track by guestStay.id" guest-stay="guestStay" room-index="$index + 1" collapsed="collapsed" show-room-index="order.guestStays.length > 1"></div><div class="x-cin__section" tl-id="cinbo"><div class="x-cin__subheader x-cin__subheader_active" ng-show="hasBookingOptions()"><table class="x-cord__table"><tbody><tr><td><div tl-title is-opened="servicesList.opened" is-clickable="true" type="\'type_2\'" click-action="toggleList(\'servicesList\')" update-action="servicesList.titleNotifier.notifier"><span tl-message="\'T:cart_inline.services\'"></span></div></td><td ng-bind-html="order.bookingOptionsPrice().priceBeforeTax | tlCurrency"></td></tr></tbody></table></div><div tl-accordion is-collapsed="!servicesList.opened"><div class="x-cin__entries" ng-show="hasBookingOptions()"><table class="x-cin__table"><tbody ng-repeat="bookingOption in order.options track by bookingOption.id()" ng-if="bookingOption.getQuantity()" tl-id="cinbo-${bookingOption.id()}"><tr><td tl-message="bookingOption.option.getOption().name"></td><td ng-bind-html="bookingOption.getTotalPrice().priceAfterTax | tlCurrency"></td></tr></tbody></table></div></div></div><div class="x-cin__section" tl-id="cintr"><div class="x-cin__subheader x-cin__subheader_active" ng-show="hasTransfers()"><table class="x-cord__table"><tbody><tr><td><div tl-title is-opened="transfersList.opened" is-clickable="true" type="\'type_2\'" click-action="toggleList(\'transfersList\')" update-action="transfersList.titleNotifier.notifier"><span tl-message="\'T:cart_inline.transfers\'"></span></div></td><td ng-bind-html="order.transfersPrice().priceBeforeTax | tlCurrency"></td></tr></tbody></table></div><div tl-accordion is-collapsed="!transfersList.opened"><div class="x-cin__entries" ng-show="hasTransfers()"><table class="x-cin__table x-cin__table_with_title"><tbody ng-repeat="transferOption in order.transfers track by transferOption.id" ng-if="transferOption.isSelected()"><tr><td colspan="2" tl-message="transferOption.transferOffer.transfer.name"></td></tr><tr ng-repeat="vehicleOption in transferOption.vehicles track by vehicleOption.enumerableVehicleOptionId" ng-if="vehicleOption.quantity > 0" tl-id="cinvo-${vehicleOption.enumerableVehicleOptionId}"><td tl-message="vehicleOption.option.vehicle.name"></td><td ng-bind-html="vehicleOption.getTotalPrice().priceAfterTax | tlCurrency"></td></tr></tbody></table></div></div></div><div class="x-cin__section -last" tl-id="cintx"><div class="x-cin__subheader x-cin__subheader_active" ng-show="taxes.length"><table class="x-cord__table"><tbody><tr><td><div tl-title is-opened="taxesList.opened" is-clickable="true" type="\'type_2\'" click-action="toggleList(\'taxesList\')" update-action="taxesList.titleNotifier.notifier"><span tl-message="\'T:order_info.tax\'" message-params="{kind: getTaxesUnit(taxes)}"></span></div></td><td ng-bind-html="order.totalPrice().tax | tlCurrency"></td></tr></tbody></table></div><div tl-accordion is-collapsed="!taxesList.opened"><div class="x-cin__entries" ng-show="taxes.length"><table class="x-cin__table"><tbody ng-repeat="taxAmount in taxes"><tr><td><div class="x-cord__tax-info"><span tl-message="taxAmount.tax.name"></span><div tl-tax-popover class="x-cord__tax-popover" tax-amount="taxAmount" ng-if="taxAmount.tax.description"></div></div></td><td ng-bind-html="taxAmount | tlCurrency"></td></tr></tbody></table></div></div></div></div>')}),!function(r){var a;r.directive||(r.directive={});a={},r.registerDirective("tlCartOrderRoom",["$q","tl.messages",function(e,o){return{restrict:"EA",scope:{guestStay:"=",roomIndex:"=",showRoomIndex:"=",collapsed:"=?"},replace:!0,require:"^tlCartOrder",templateUrl:"directives/cart-order/cart-order-room.html",controller:["$scope",function(i){var n=i.guestStay.roomStay.id+","+i.roomIndex,t=(i.titleNotifier=r.NotifierHelper.subscribe(i,e,!1,!1),i.title={opened:null!=a[n]?a[n]:!i.collapsed},i.hasRoomServices=function(){return _.some(i.guestStay.mealPlans,function(e){return!e.option.hasPlacementIndex()})||_.some(i.guestStay.roomOptions,function(e){return!e.option.hasPlacementIndex()})||i.guestStay.arrival().price()&&0<i.guestStay.arrival().price().priceAfterTax.amount||i.guestStay.departure().price()&&0<i.guestStay.departure().price().priceAfterTax.amount},i.toggleList=function(){i.title.opened=!i.title.opened,i.titleNotifier.update(),a[n]=i.title.opened},new r.PlacementUtil(o));i.getPlacementDescription=function(e){return t.getOrderRoomPlacementDescription(e)},i.getRatePlan=function(e){return null!=(e=e.ratePlan)?e:i.guestStay.roomStay.ratePlan},i.getGuestPlacements=function(){return _.map(i.guestStay.guestPlacements,function(e){return e.guestPlacement})},i.getRoomTypeUnit=function(e){return new r.RoomTypeUnit(e)},i.$watch(function(){return i.guestStay.mealPlans.length+i.guestStay.roomOptions.length},function(e,t){t<e&&null==a[n]&&(i.title.opened=!0)})}]}}])}(tl=tl||{}),!function(o){var r;o.directive||(o.directive={});r={},o.registerDirective("tlCartOrder",["$q","tl.messages",function(n,e){return{restrict:"EA",scope:{order:"=",collapsed:"=?"},require:"^tlCartInline",templateUrl:"directives/cart-order/cart-order.html",controller:["$scope",function(t){_.forEach(["servicesList","taxesList","transfersList"],function(e){t[e]={titleNotifier:o.NotifierHelper.subscribe(t,n,!1,!1),opened:null!=r[e]?r[e]:!t.collapsed}}),t.toggleList=function(e){t[e].opened=!t[e].opened,t[e].titleNotifier.update(),r[e]=t[e].opened},t.taxes=t.order.totalPrice().taxes,t.getTaxesUnit=function(e){return new o.TaxUnit(o.directive.helper.TaxHelper.resolveTaxAmountsKind(e))},t.hasBookingOptions=function(){return _.some(t.order.options,function(e){return 0<e.getQuantity()})},t.hasTransfers=function(){return _.some(t.order.transfers,function(e){return e.isSelected()})};var i=new o.PlacementUtil(e);t.getPlacementDescription=function(e){return i.getPlacementKindDescription(e.kind)}}],link:function(e,t,i,n){e.animateCart=function(){n.animateCart()},e.$watch(function(){return e.order.totalPrice().priceAfterTax.amount},function(){e.animateCart(),e.taxes=e.order.totalPrice().taxes},!0)}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/tax-popover/tax-popover.html",'<div class="tl-svg-button tl-svg-button_bright" tl-popover content-generator-action="getTaxDescription()" event="click" element-position="center top" popover-position="center bottom"><svg class="tl-svg-button__icon"><use xlink:href="#info"></use></svg> <svg class="tl-svg-button__icon tl-svg-button__icon_inverted"><use xlink:href="#info-invert"></use></svg></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlTaxPopover",["$q","$compile",function(t,i){return{scope:{taxAmount:"="},templateUrl:"directives/tax-popover/tax-popover.html",controller:["$scope",function(e){e.getTaxDescription=function(){return t.when(function(){return i('<div class="x-tax-popover"><span class="x-popover__title" tl-message="::taxAmount.tax.name"></span><p ng-if="::taxAmount.tax.description" tl-message="::taxAmount.tax.description"></p></div>')(e)[0]})}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/page/preloader.html",'<div ng-if="!isPageLoaded" ng-switch="preloaderViewMode"><div class="placeholder clearfix" ng-switch-when="rooms-grid"><div class="placeholder__item" ng-repeat="i in [0, 1, 2, 3]"><div class="placeholder__wrapper"><div class="placeholder__media"></div><div class="placeholder__header"><div class="placeholder__header-top"></div><div class="placeholder__header-bottom"></div></div><div class="placeholder__panel"><div class="placeholder__price"></div><div class="placeholder__btn"></div></div></div></div></div><div class="page__loader" ng-switch-default><svg class="loader loader_on_iframe"><use xlink:href="#loader"></use></svg></div></div>')}),tl.registerDirective("tlPage",["$templateCache","$rootScope",function(e,t){var i=e.get("directives/page/preloader.html"),n=null;return t.$on("$locationChangeStart",function(){setTimeout(function(){var e=document.querySelector(".page");e&&(n=e.clientHeight)},0)}),{restrict:"AE",scope:!1,compile:function(e){var t=angular.element(i)[0];return e[0].appendChild(t),n&&(t.style.minHeight=n+"px",n=null),{pre:function(e,t,i){t[0].setAttribute("class",["page",i.name+"-page"].join(" "))}}}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/radio/radio.html",'<div class="x-radio {{::withoutBorder && \'x-radio_without_border\'}}" ng-click="select($event)"><input class="x-radio__input" type="radio" ng-model="radioModel" ng-value="radioValue" name="{{radioName}}" ng-required="radioRequired"></input> <span class="x-radio__content" ng-transclude></span></div>')}),tl.registerDirective("tlRadio",[function(){return{restrict:"EA",scope:{radioModel:"=?",radioValue:"=",radioName:"=",radioRequired:"=",withoutBorder:"=",onChange:"&"},replace:!0,transclude:!0,templateUrl:"directives/radio/radio.html",controller:["$scope",function(t){t.select=function(e){e.defaultPrevented||(t.radioModel=t.radioValue,t.onChange())}}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/textarea/textarea.html",'<label class="x-textarea"><span class="x-textarea__item x-textarea__item_hidden"><span class="x-textarea__placeholder form-control" ng-bind="textareaValue || (placeholder | message)"></span> </span><span class="x-textarea__item"><textarea tl-pattern="noEmoji" class="x-textarea__field" name="{{name}}" id="{{textareaId}}" tl-id="txa-${name}" ng-model="model" ng-change="changeAction()" ng-on-input="inputAction($event)" ng-attr-rows="1" ng-attr-placeholder="{{placeholder | message}}" ng-maxlength="maxlength" ng-required="required"></textarea></span></label>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlTextarea",[function(){return{scope:{model:"=",name:"=",id:"=?",placeholder:"=?",required:"=?",maxlength:"=?"},require:"^form",replace:!0,restrict:"EA",template:e.directiveTemplate({name:"textarea",single:!0}),link:function(n,e,t,o){n.textareaId=n.id||_.uniqueId("textarea"),n.placeholder=n.placeholder||"",n.textareaValue=n.model||"",n.required=!_.isUndefined(n.required)&&n.required,n.inputAction=function(e){n.textareaValue=e.target.value?e.target.value+"\n":""},n.changeAction=function(){i(),n.model=o[n.name].$modelValue};var i=function(){var e,t=o[n.name],i=!1;t.$valid&&(e=t.$modelValue.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F-\x9F]/g,function(){return i=!0,""}),i&&(n.textareaValue=e?e+"\n":"",t.$setViewValue(e),t.$render()))}}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/gallery-preview/gallery-preview.html",'<div class="x-gp"><div class="x-gp__overlay"><div class="x-gp__icon"><svg><use xlink:href="#zoom"></use></svg></div><div class="x-gp__text" tl-message="\'T:photo-gallery.show_gallery\'"></div></div><div tl-fit-image ng-repeat="image in ::images | limitTo: limit track by image.id" image="::image"></div></div>')}),tl.registerDirective("tlGalleryPreview",["$parse","$compile","$templateCache",function(o,r,a){return{restrict:"EA",replace:!0,scope:!1,template:'<div class="x-gallery-preview"></div>',link:function(e,t,i){var n=o(i.images)(e),i=o(i.limit)(e),n=(e.images=n,e.limit=i,a.get(tl.directiveTemplateUrl("gallery-preview")));t.append(r(n)(e))}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/photo-gallery/photo-gallery.html",'<div class="x-photo-gallery-container"><div tl-photo-gallery-endless ng-if="::showEndlessSlider" images="::images" placeholder-icon="::placeholderIcon" force-with-dots="::forceWithDots" show-slider="::showSlider" on-change-action="::onChangeAction({currentIndex: currentIndex})"></div><div tl-photo-gallery-preview ng-if="::showPreviewSlider" images="::images" name="::name" placeholder-icon="::placeholderIcon" show-slider="::showSlider" on-change-action="::onChangeAction({currentIndex: currentIndex})"></div></div>')}),!function(o){var e;o.directive||(o.directive={});o.registerDirective("tlPhotoGallery",(e=o.directiveTemplateUrl("photo-gallery","photo-gallery"),["layout",function(n){return{scope:{images:"=",name:"=?",placeholderIcon:"=?",forceWithDots:"=?",showSlider:"=?",onChangeAction:"&?"},replace:!0,templateUrl:e,link:function(e){var t,i=o.BookingFormSettings.getInstance();e.showSlider=null==(t=e.showSlider)||t,e.showEndlessSlider=n.phone||e.forceWithDots,e.showPreviewSlider=!e.showEndlessSlider,e.placeholderIcon=null!=(t=e.placeholderIcon)?t:i.isServicesBookingForm()?"service-placeholder-default":"room-placeholder"}}}]))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/photo-gallery-endless/photo-gallery-endless.html",'<div class="x-pge" ng-swipe-left="::nextSlide()" ng-swipe-right="::prevSlide()"><div class="x-pge__placeholder" ng-class="::{\'-pulse\': displayImages.length}"><svg class="x-pge__placeholder-icon"><use ng-attr-xlink:href="{{\'#\' + placeholderIcon}}" xlink:href=""></use></svg></div><div class="x-pge__slider"><div ng-repeat="(i, slide) in virtualImages track by slide.id" class="x-pge__slide" ng-class="::{\'-shadow\': displayImages.length > 1, \'-draggable\': isDraggable}" rel="x-pge-slide"><div tl-fit-image image="::slide"></div></div></div><div class="tag x-pge__cnt" ng-if="::showTag"><svg class="tag__icon"><use xlink:href="#gallery"></use></svg> <span tl-message="\'T:room-details.all_photos\'" message-params="::{count: images.length}"></span></div><div class="x-pge__dots-viewport" ng-if="::showDots" rel="x-pg-dots-viewport"><div class="x-pge__dots" rel="x-pg-dots"><div class="x-pge__dot" ng-repeat="dot in ::dots track by $index" ng-class="{\'-active\': isActiveDotIndex($index),\n          \'-more\': isEdgeDot($index),\n          \'-hidden\': isHiddenDot($index)\n        }" rel="x-pg-dot"></div></div></div></div>')}),!function(R){var D,e,t;R.directive||(R.directive={});(e=D=D||{}).Begin="begin",e.MiddleBegin="middle_begin",e.MiddleMiddle="middle_middle",e.MiddleEnd="middle_end",e.End="end",R.registerDirective("tlPhotoGalleryEndless",(t=R.directiveTemplateUrl("photo-gallery-endless","photo-gallery-endless"),["$timeout","layout",function(I){return{scope:{images:"=",placeholderIcon:"=?",forceWithDots:"=?",showSlider:"=?",onChangeAction:"&?"},replace:!0,templateUrl:t,link:function(r,a){r.showSlider=null==(e=r.showSlider)||e,r.displayImages=r.showSlider?r.images:_.take(r.images,1);var s,e=r.displayImages.length,t=e-1,n=11<=r.displayImages.length,l=0,o=Math.min(e,6),c=-1,u=D.Begin,i="",d=0,p=!1,m=0,g=(r.dots=[],r.virtualImages=[],r.prevSlide=function(){var e;0!==r.displayImages.length&&(m=f(l=m),y(),(p=v())&&(u=D.MiddleEnd,A(),i=D.MiddleEnd,u=D.MiddleMiddle,p=!1),k(l,m),g(m),null!=(e=r.onChangeAction)&&e.call(r,{currentIndex:m}))},r.nextSlide=function(){var e;0!==r.displayImages.length&&(m=h(l=m),y(),(p=v())&&(u=D.MiddleBegin,A(),i=D.MiddleBegin,u=D.MiddleMiddle,p=!1),k(l,m),g(m),null!=(e=r.onChangeAction)&&e.call(r,{currentIndex:m}))},r.showDots=1<r.displayImages.length,function(e){var t=[];0<r.displayImages.length&&(t=_.uniq([e,h(e),f(e)])),r.virtualImages=_.map(t,function(e){return r.displayImages[e]})}),h=function(e){return e<r.displayImages.length-1?e+1:0},f=function(e){return 0<e?e-1:r.displayImages.length-1},v=function(){return i===D.MiddleMiddle&&u===D.MiddleMiddle&&(m===c||m===o)},y=function(){if(i=u,0===m)u=D.Begin;else{if(u===D.Begin)return 6===m&&(u=D.MiddleBegin),void(m===r.displayImages.length-1&&(u=D.End));if(u===D.MiddleBegin&&7===m)u=D.MiddleMiddle;else{if(u===D.MiddleMiddle){if(1===m)return void(u=D.MiddleBegin);if(m===r.displayImages.length-2)return void(u=D.MiddleEnd)}u===D.MiddleEnd&&m===r.displayImages.length-8?u=D.MiddleMiddle:u===D.End&&m===r.displayImages.length-7?u=D.MiddleEnd:m===r.displayImages.length-1&&(u=D.End)}}},b="-animate",S=function(e,t){var i=l<m?"left":"right",e=(0===e&&t===r.displayImages.length-1&&(i="right"),e===r.displayImages.length-1&&0===t&&(i="left"),a[0].querySelectorAll('[rel="x-pge-slide"]')),t=2<r.displayImages.length?2:1,t="right"==i?t:"left"===i?1:0,n=e[0],o=e[t];R.HtmlUtil.toggleClass(n,b,!1),R.HtmlUtil.transform(n,"translateX(0%)"),R.HtmlUtil.toggleClass(o,b,!1),R.HtmlUtil.transform(o,"left"==i?"translateX(100%)":"translateX(-100%)"),s=I(function(){R.HtmlUtil.toggleClass(n,b,!0),R.HtmlUtil.transform(n,"left"==i?"translateX(-100%)":"translateX(100%)"),R.HtmlUtil.toggleClass(o,b,!0),R.HtmlUtil.transform(o,"translateX(0%)")},100)},k=function(e,t){I.cancel(s),e!=t&&(w(t),S(e,t))},P=(r.showTag=1<r.images.length&&!r.showSlider,r.isDraggable=r.showSlider&&1<r.displayImages.length,r.isEdgeDot=function(e){return 6===e},r.isHiddenDot=function(e){return 6<e},r.isActiveDotIndex=function(e){return d===e},function(e,t){var t=t[0],i=0;if(8<=r.displayImages.length){if(n)switch(u){case D.MiddleMiddle:i=1;break;case D.MiddleEnd:i=2;break;case D.End:i=3}else i=-1===c?0:c;t=getComputedStyle(t),t=i*(parseFloat(t.width)+parseFloat(t.marginRight)+parseFloat(t.marginLeft));R.HtmlUtil.toggleClass(e,b,!p),R.HtmlUtil.transform(e,"translateX(-"+t+"px)")}}),C=function(e){n?_.forEach(e,function(e,t){var i=u===D.Begin&&6===t||u===D.MiddleBegin&&0===t||u===D.MiddleBegin&&7===t||u===D.MiddleMiddle&&1===t||u===D.MiddleMiddle&&8===t||u===D.MiddleEnd&&2===t||u===D.MiddleEnd&&9===t||u===D.End&&3===t,t=u===D.Begin&&0<=t&&t<=6||u===D.MiddleBegin&&0<=t&&t<=7||u===D.MiddleMiddle&&1<=t&&t<=8||u===D.MiddleEnd&&2<=t&&t<=9||u===D.End&&3<=t&&t<=10;R.HtmlUtil.toggleClass(e,"-more",i),R.HtmlUtil.toggleClass(e,"-hidden",!t)}):_.forEach(e,function(e,t){var i=t===o||t===c,t=t<=o&&c<=t;R.HtmlUtil.toggleClass(e,"-hidden",!t),R.HtmlUtil.toggleClass(e,"-more",i)})},T=function(){n?p?(u===D.MiddleBegin&&d--,u===D.MiddleEnd&&d++):(d=(u===D.MiddleMiddle||u===D.MiddleEnd||u===D.End)&&11<=r.displayImages.length?m-c+1:m,u===D.MiddleEnd&&d++,u===D.End&&(d+=2)):d=m},x=function(e){var t=u===D.MiddleBegin||u===D.MiddleMiddle||u===D.MiddleEnd;R.HtmlUtil.toggleClass(e,"-extended",t)},A=function(){var e=a[0].querySelector('[rel="x-pg-dots"]'),t=a[0].querySelectorAll('[rel="x-pg-dot"]'),i=a[0].querySelector('[rel="x-pg-dots-viewport"]');_.forEach(t,function(e){R.HtmlUtil.toggleClass(e,b,!p)}),P(e,t),C(t),x(i),T()},w=function(e){(e=e)!==o&&0!==e||(0===e?o=6:o++,c=o-7),e!==c&&e!==t||(e===t?c=t-6:c--,o=c+7),I(function(){A()},100)};g(m),r.dots=_.times(Math.min(10,r.displayImages.length),_.constant(!0))}}}]))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/photo-gallery-preview/photo-gallery-preview.html",'<div class="x-pgp" ng-class="::{\'-with-lightbox\': previewImages.length}" ng-click="::showPhotoAction()"><div class="x-pgp__placeholder" ng-class="::{\'-pulse\': previewImages.length}"><svg class="x-pgp__placeholder-icon"><use ng-attr-xlink:href="{{\'#\' + placeholderIcon}}" xlink:href=""></use></svg></div><div class="x-pgp__slider"><div ng-repeat="(i, slide) in ::previewImages track by slide.id" class="x-pgp__slide" ng-class="::{\'-shadow\': previewImages.length > 1, \'-hidden\': !$first}" rel="x-pgp-slide"><div tl-fit-image ng-if="prerenderList[i]" image="::slide"></div><div class="x-pgp__overlay" ng-if="::previewImages.length > 1 && $last"><svg class="x-pgp__overlay-icon"><use ng-attr-xlink:href="{{\'#\' + placeholderIcon}}" xlink:href=""></use></svg> <span class="x-pgp__overlay-text" tl-message="\'T:photo-gallery.show_gallery\'"></span></div></div></div><div class="tag x-pgp__cnt" ng-if="::showTag"><svg class="tag__icon"><use xlink:href="#gallery"></use></svg> <span tl-message="\'T:room-details.all_photos\'" message-params="::{count: images.length}"></span></div><div class="x-pgp__lines-manager" ng-if="::previewImages.length > 1" ng-mouseleave="::setCurrentSlideIndex(0)"><div class="x-pgp__line" ng-repeat="(i, image) in ::previewImages track by image.id" ng-class="{\'-active\': i === currentIndex}" ng-mouseover="::setCurrentSlideIndex(i)"></div></div></div>')}),!function(a){var e;a.directive||(a.directive={});a.registerDirective("tlPhotoGalleryPreview",(e=a.directiveTemplateUrl("photo-gallery-preview","photo-gallery-preview"),["locale",function(r){return{scope:{images:"=",placeholderIcon:"=",name:"=?",showSlider:"=?",onChangeAction:"&?"},replace:!0,templateUrl:e,link:function(t,n){t.showSlider=null==(e=t.showSlider)||e;var e=t.showSlider?t.images:_.take(t.images,1),o=(t.currentIndex=0,t.previewImages=_.take(e,4),t.prerenderList=_.map(t.previewImages,function(){return!0}),t.setCurrentSlideIndex=function(e){i(t.currentIndex,e),t.currentIndex=e,null!=(e=t.onChangeAction)&&e.call(t,{currentIndex:t.currentIndex})},t.showPhotoAction=function(){var e;AppIntegration.showImages(_.map(t.images,function(e){return e.url}),{language:r.languageId(),title:null!=(e=t.name)?e:"",index:t.currentIndex,thumbs:_.map(t.images,function(e){return e.getThumbnailUrl(400)})})},"-hidden"),i=function(e,t){var i;e!=t&&(e=(i=n[0].querySelectorAll('[rel="x-pgp-slide"]'))[e],i=i[t],a.HtmlUtil.toggleClass(e,o,!0),a.HtmlUtil.toggleClass(i,o,!1))};t.showTag=1<t.images.length&&!t.showSlider}}}]))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/rate-plan/rate-plan.html",'<div class="x-rate-plan"><div tl-rate-plan-title rate-plan="roomStay.ratePlan" title-type="::titleType" click-action="toggleDescription()"></div><div class="x-rate-plan__info" ng-class="{\'x-rate-plan__info_offset\': increaseRatePlanName}" ng-show="showRatePlanInfo || isDescriptionOpened"><div tl-rate-plan-info inclusive-treatment="roomStay.ratePlan.treatment" inclusive-meal-plan="roomStayInclusiveMealPlan" hide-not-available-meal-plan="::hideNotAvailableMealPlan" force-show-treatment="forceShowTreatment" cancellation-info="roomStay.cancellationInfo" payment-systems="paymentSystems" options="::roomStay.getOptions()" meals="::roomStay.getMealPlans()" meal-duration="::roomStay.stayDates.duration()" extended-view="isDescriptionOpened" stay-dates="roomStay.stayDates"></div></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlRatePlan",["$q",function(e){return{scope:{roomStayRatePlan:"=",showRatePlanInfo:"=?",hideNotAvailableMealPlan:"=?",forceShowTreatment:"=?",increaseRatePlanName:"=?",clickAction:"&?"},templateUrl:"directives/rate-plan/rate-plan.html",replace:!0,controller:["$scope",function(e){e.roomStay=_.head(e.roomStayRatePlan.roomStays),e.titleType=e.increaseRatePlanName?"type_1":"type_2";var t=e.roomStay.inclusiveMealPlan();e.roomStayInclusiveMealPlan=t?t.meal:null,e.paymentSystems=_.map(e.roomStay.paymentOptions,function(e){return e.paymentSystem}),e.showRatePlanInfo=!_.isUndefined(e.showRatePlanInfo)&&e.showRatePlanInfo,e.isDescriptionOpened=!1;e.toggleDescription=function(){e.isDescriptionOpened=!e.isDescriptionOpened,_.isUndefined(e.clickAction)||e.clickAction()}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/rate-plan-title/rate-plan-title.html",'<div class="x-rpt"><div class="x-rpt__title"><div class="x-rpt__icon x-rpt__icon_{{::titleType}}" ng-if="ratePlan.icon"><div tl-fit-image image="::ratePlan.icon"></div></div><div tl-title class="x-rpt__name" is-opened="descriptionOpened" is-clickable="ratePlan.description || forceClickable" type="::titleType" with-hint="true" click-action="toggleDescription()" update-action="titleNotifier.notifier" data-autoscroll-save="x-rpt-{{::ratePlan.id}}"><span ng-bind="ratePlan.name"></span></div></div><div tl-accordion is-collapsed="!descriptionOpened" ng-if="::(ratePlan.description && !hideDescription)"><div class="x-rpt__description"><div class="pretty-text pretty-text_with_border" tl-message="ratePlan.description | tlSafeLinks" message-html="true"></div></div><div class="x-rpt__toggle"><div class="rounded-link" data-autoscroll-start="x-rpt-{{::ratePlan.id}}" tl-id="rpte-${ratePlan.id}" ng-click="toggleDescription()"><span tl-message="\'T:common.hide\'"></span> <svg class="rounded-link__icon"><use xlink:href="#arrow-up"></use></svg></div></div></div></div>')}),!function(i){i.directive||(i.directive={});i.registerDirective("tlRatePlanTitle",["$q","$location",function(t,e){return{restrict:"EA",scope:{ratePlan:"=",titleType:"=?",hideDescription:"=?",forceClickable:"=?",clickAction:"&?"},transclude:!0,replace:!0,templateUrl:"directives/rate-plan-title/rate-plan-title.html",controller:["$scope",function(e){_.isUndefined(e.titleType)&&(e.titleType="type_2"),e.clickActionHandler=function(){_.isUndefined(e.clickAction)||e.clickAction()},e.titleNotifier=i.NotifierHelper.subscribe(e,t,!1,!1),e.descriptionOpened=!1,e.toggleDescription=function(){e.descriptionOpened=!e.descriptionOpened,e.titleNotifier.update(),e.clickActionHandler()},e.$watch(function(){return e.ratePlan?e.ratePlan.name:""},function(){e.titleNotifier.update()})}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/rate-plan-info/rate-plan-info-cancellation.html",'<div><div class="x-popover__title" ng-if="::cancellationInfo.isFreeCancellation" tl-message="\'T:cancellation_rule.free_short\'"></div><div class="x-popover__title" ng-if="::!cancellationInfo.isFreeCancellation" tl-message="\'T:cancellation_rule.paid\'"></div><div class="pretty-text" ng-bind-html="cancellationInfo.cancellationText | tlUnsafe"></div><div class="x-rpi__mir-cancellation" ng-if="::hasMirCancellationInfo"><div class="x-rpi__mir-cancellation-title" tl-message="\'T:mir-promo.cancellation\'"></div><div class="pretty-text" ng-bind-html="cancellationInfo.mirCashbackDescription | tlUnsafe" ng-click="clickMirPromoCancellationInfo($event)"></div></div></div>'),e.put("directives/rate-plan-info/rate-plan-info.html",'<div class="x-rpi" ng-class="::{\'-inline\': inline}"><div class="x-rpi__item" ng-if="::(showTreatment && inclusiveTreatment)"><svg class="x-rpi__icon x-rpi__icon_active"><use xlink:href="#treatment"></use></svg><div class="x-rpi__feature x-rpi__has-bonus" tl-message="\'T:rooms.treatment_included\'" message-html="true"></div></div><div class="x-rpi__item" ng-if="::(showTreatment && !inclusiveTreatment && forceShowTreatment)"><svg class="x-rpi__icon"><use xlink:href="#no-treatment"></use></svg><div class="x-rpi__feature x-rpi__has-bonus" tl-message="\'T:rooms.treatment_not_included\'"></div></div><div class="x-rpi__item" ng-if="::inclusiveMealPlan"><svg class="x-rpi__icon x-rpi__icon_active"><use xlink:href="#food"></use></svg><div class="x-rpi__feature"><span ng-switch="::inclusiveMealPlan.mealPlanType" ng-class="::{ \'link -promo\': inclusiveMealPlan.description }" tl-popover content-generator-action="getInclusiveMealPlanNode()" event="{{::popoverEvent}}" element-position="center top" popover-disabled="::!inclusiveMealPlan.description" popover-position="center bottom"><span class="x-rpi__has-bonus" ng-switch-when="ultra_all_inclusive" tl-message="\'T:meal_plan.ultra_all_inclusive\'" message-html="true"></span> <span class="x-rpi__has-bonus" ng-switch-when="all_inclusive" tl-message="\'T:meal_plan.all_inclusive\'" message-html="true"></span> <span class="x-rpi__has-bonus" ng-switch-when="breakfast" tl-message="\'T:meal_plan.breakfast\'" message-html="true"></span> <span class="x-rpi__has-bonus" ng-switch-default tl-message="\'T:meal_plan.included\'" message-params="{meal: inclusiveMealPlan.name}" message-html="true"></span></span></div></div><div class="x-rpi__item" ng-if="::(!hideNotAvailableMealPlan && !inclusiveMealPlan)"><svg class="x-rpi__icon"><use xlink:href="#no-food"></use></svg><div class="x-rpi__feature"><p ng-class="::{ \'link -promo\': isMealDetailAvailable }" tl-popover content-generator-action="getMealDetailNode()" event="{{::popoverEvent}}" element-position="center top" popover-disabled="!isMealDetailAvailable" popover-position="center bottom"><span tl-message="\'T:meal_plan.not_included\'"></span></p><p class="x-rpi__hint" ng-if="::isMealDetailAvailable" tl-message="\'T:meal_plan.can_order_meal_hint\'" message-html="true"></p></div></div><div class="x-rpi__item" ng-if="::certificateBookingFormMode"><svg class="x-rpi__icon"><use xlink:href="#cancellation-rule"></use></svg><div class="x-rpi__feature"><span tl-message="\'T:cancellation_rule.certificate\'"></span></div></div><div class="x-rpi__item" ng-if="::!certificateBookingFormMode && cancellationInfo.showDescription && (cancellationInfo.cancellationText || cancellationInfo.isFreeCancellation) || hasMirCancellationInfo"><svg class="x-rpi__icon" ng-class="{\'x-rpi__icon_active\': cancellationInfo.isFreeCancellation}"><use xlink:href="#cancellation-rule"></use></svg><div class="x-rpi__feature" ng-class="{\'x-rpi__feature_active\': cancellationInfo.isFreeCancellation}"><span ng-class="::{\'link -promo\': cancellationInfo.cancellationText || hasMirCancellationInfo}" tl-popover content-generator-action="getRequireGuaranteedPaymentNode()" event="{{::popoverEvent}}" element-position="center top" popover-disabled="::!(cancellationInfo.cancellationText || hasMirCancellationInfo)" popover-position="center bottom"><span ng-if="::cancellationInfo.isFreeCancellation" class="x-rpi__has-bonus" tl-message="\'T:cancellation_rule.free\'" message-html="true"></span><span ng-if="::!cancellationInfo.isFreeCancellation" tl-message="\'T:cancellation_rule.paid\'" message-html="true"></span></span></div></div><div class="x-rpi__item" ng-if="paymentSystems && paymentSystems.length"><svg class="x-rpi__icon"><use xlink:href="#purse"></use></svg><div class="x-rpi__feature"><span><span tl-message="\'T:rooms.payment_types\'"></span>:&nbsp;</span><ul class="x-rpi__feature-list" ng-init="sortedPaymentSystems = getSortedPaymentSystems();"><li ng-repeat="paymentSystem in sortedPaymentSystems track by $index" class="x-rpi__feature-item" ng-class="{\'x-rpi__feature-item_in-list\': extendedView, \'x-rpi__has-bonus\': isPaymentOnArrival(paymentSystem)}"><span tl-message="getPaymentSystemText(paymentSystem)"></span></li></ul></div></div><div class="x-rpi__item x-rpi__item_services" ng-if="inclusiveOptions.length"><svg class="x-rpi__icon x-rpi__icon_active"><use xlink:href="#gift"></use></svg><div class="x-rpi__feature"><span class="x-rpi__has-bonus"><span tl-message="\'T:rooms.included\'"></span>&nbsp;</span><ul class="x-rpi__feature-list"><li ng-repeat="option in inclusiveOptions track by option.id()" class="x-rpi__feature-item" ng-class="{\'x-rpi__feature-item_in-list\': extendedView}"><span ng-class="::{ \'link -promo\': isOptionDescriptionAvailable(option) }" tl-popover content-generator-action="getOptionDescription(option)" event="{{::popoverEvent}}" element-position="center top" popover-disabled="!isOptionDescriptionAvailable(option)" popover-position="center bottom"><span ng-bind="option.name()"></span></span></li></ul></div></div></div>')}),!function(s){s.directive||(s.directive={});s.registerDirective("tlRatePlanInfo",["tl.messages","$q","$compile","$templateCache","$state",function(i,n,o,r,a){return{scope:{inclusiveTreatment:"=?",inclusiveMealPlan:"=?",hideNotAvailableMealPlan:"=?",forceShowTreatment:"=?",cancellationInfo:"=?",paymentSystems:"=?",extendedView:"=?",options:"=?",meals:"=?",mealDuration:"=?",inline:"=?",popoverEvent:"=?",stayDates:"=?"},templateUrl:"directives/rate-plan-info/rate-plan-info.html",controller:["$scope",function(t){t.popoverEvent=_.includes([s.directive.PopoverEventType.Click,s.directive.PopoverEventType.Hover],t.popoverEvent)?t.popoverEvent:s.directive.PopoverEventType.Click,t.inclusiveOptions=[],_.forEach(t.options,function(e){e.inclusive()&&t.inclusiveOptions.push(e)}),t.getSortedPaymentSystems=function(){return new s.RatePlanUtil(i,t.paymentSystems).getSortedByPriorityPaymentSystems()},t.isPaymentOnArrival=function(e){return e.paymentSystemCode==s.PaymentSystemCode.AtArrival},t.getPaymentSystemText=function(e){return new s.RatePlanUtil(i,t.paymentSystems).getPaymentSystemText(e)},t.hasMirCancellationInfo=t.cancellationInfo&&t.cancellationInfo.mirCashbackDescription&&s.MirCashbackUtil.showMirPromotional(t.stayDates,t.paymentSystems,[]),t.clickMirPromoCancellationInfo=function(e){if("a"==e.target.nodeName.toLowerCase()){var t="unknown";try{var i=e.target.parentElement.querySelectorAll("a");i[0]==e.target?t="rules":i[1]==e.target&&(t="updates")}catch(e){}s.TrackerService.trackExperiment(s.PromoOffer.MirCashback,{action:"go-to-rules",page:a.current&&a.current.name,target:t,source:"rate-plan"},!1)}},t.getRequireGuaranteedPaymentNode=function(){return n.when(function(){var e=r.get("directives/rate-plan-info/rate-plan-info-cancellation.html");return o(e)(t)[0]})},t.getInclusiveMealPlanNode=function(){return n.when(function(){return o('<div><div class="x-popover__title" ng-bind="inclusiveMealPlan.name"></div><div class="pretty-text" ng-bind="inclusiveMealPlan.description"></div></div>')(t)[0]})},t.showTreatment=s.BookingFormSettings.getInstance().motivators.showTreatment;function e(){return _.filter(t.meals,function(e){return!e.inclusive()})}t.isMealDetailAvailable=e().length&&!!t.mealDuration,t.getMealDetailNode=function(){return t.notInclusiveMealList=e(),n.when(function(){return o('<tl-rate-plan-meal meal-duration="mealDuration" meals="notInclusiveMealList"></tl-rate-plan-meal>')(t)[0]})},t.isOptionDescriptionAvailable=function(e){return""!==e.description()},t.getOptionDescription=function(e){return t.inclusiveOptionName=e.name(),t.inclusiveOptionDescription=e.description(),n.when(function(){return o('<div><div class="x-popover__title" tl-message="inclusiveOptionName"></div><div tl-message="inclusiveOptionDescription"></div></div>')(t)[0]})},t.certificateBookingFormMode=s.BookingFormSettings.getInstance().isModeTurnedOn(s.BookingFormMode.CertificateBookingForm)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/rate-plan-meal/desktop/rate-plan-meal__desktop.html",'<div class="x-rpm"><div class="x-popover__title" tl-message="\'T:meal_plan.not_included\'"></div><table><tr><td colspan="3" class="x-rpm__description"><span tl-message="\'T:meal_plan.can_order_meal_hint\'" message-html="true"></span></td></tr><tbody class="x-rpm__table"><tr class="x-rpm__table-head"><td class="x-rpm__table-head" tl-message="\'T:meal_plan.food\'"></td><td class="x-rpm__table-head" colspan="2" tl-message="\'T:meal_plan.price\'"></td></tr><tr ng-repeat="meal in ::meals track by meal.id()"><td tl-message="meal.name()"></td><td class="x-rpm__price" tl-currency="meal.getPrice() | tlTax"></td><td class="x-rpm__price-description" tl-message="getPriceDescription(meal)"></td></tr></tbody></table></div>'),e.put("directives/rate-plan-meal/phone/rate-plan-meal__phone.html",'<div class="x-rpm"><div class="x-popover__title" tl-message="\'T:meal_plan.not_included\'"></div><table><tr><td class="x-rpm__description"><span tl-message="\'T:meal_plan.can_order_meal_hint\'" message-html="true"></span></td></tr><tbody class="x-rpm__table"><tr class="x-rpm__table-head"><td class="x-rpm__table-head" tl-message="\'T:meal_plan.food\'"></td></tr><tr ng-repeat="meal in ::meals track by meal.id()"><td><p class="x-rpm__meal-name" tl-message="meal.name()"></p><span tl-currency="meal.getPrice() | tlTax"></span>&nbsp;<span tl-message="getPriceDescription(meal)"></span></td></tr></tbody></table></div>')}),!function(n){var e;n.directive||(n.directive={});n.registerDirective("tlRatePlanMeal",(e=n.directiveTemplate({name:"rate-plan-meal"}),["tl.messages",function(i){return{scope:{meals:"=",mealDuration:"=?"},replace:!0,template:e,controller:["$scope",function(t){t.getPriceDescription=function(e){switch(e.chargeType()){case n.ChargeType.PerPersonPerNight:return i.formatMessage("T:meal_plan.unit_per_person_per_night",{nights:t.mealDuration});case n.ChargeType.PerOccupancyPerNight:return i.formatMessage("T:meal_plan.unit_per_occupancy_per_night",{nights:t.mealDuration});case n.ChargeType.PerPerson:return i.formatMessage("T:meal_plan.unit_per_person",{});case n.ChargeType.PerNight:return i.formatMessage("T:meal_plan.unit_per_room_per_night",{nights:t.mealDuration});case n.ChargeType.PerStay:return i.formatMessage("T:meal_plan.unit_per_stay",{});case n.ChargeType.PerBooking:return i.formatMessage("T:meal_plan.unit_per_booking",{});case n.ChargeType.PerUse:return i.formatMessage("T:meal_plan.unit_per_use",{});default:return}}}]}}]))}(tl=tl||{}),tl.registerDirective("tlCurrency",["$q","$filter","$parse",function(r,e,a){var s=tl.CurrencyInformer.getInstance(),l=tl.LanguageInformer.getInstance(),c=e("tlCurrency");return{restrict:"EA",scope:!1,replace:!1,template:"",link:function(t,i,n){function o(){var e;n.tlCurrency?(e=a(n.tlCurrency)(t),e=c(e,n.currencyFormat,!1),i[0].innerHTML=e):i[0].innerHTML=""}var e={callback:function(){var e=r.defer();return setTimeout(function(){o(),e.resolve()},0),e.promise}};s.subscribe(e),l.subscribe(e),t.$on("$destroy",function(){s.unsubscribe(e),l.unsubscribe(e)}),o()}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/price/price.html",'<div class="x-price" ng-class="::{\n    \'x-price_small\': sizeSmall,\n    \'x-price_highlighted\': hasDiscount(),\n    \'x-price_detailed\': !!priceDetailsAction && !servicesBookingForm && showPriceDetails\n  }"><div class="x-price__discount-overlay" ng-if="discountMotivationAvailable" tl-popover force-redraw="true" show-close-button="false" content-generator-action="getDiscountInfo()" event="hover" element-position="center top" popover-position="center bottom" rel="wasteland"></div><div class="x-price__sale" ng-if="hasDiscount()"><div class="x-price__discount-icon" ng-if="discountIcon"><svg><use ng-attr-xlink:href="{{\'#\' + discountIcon}}" xlink:href=""></use></svg></div><span class="x-price__discount"><b ng-bind="getDiscountInPercentage()"></b><span>%</span></span> <span class="x-price__old" ng-bind-html="getPriceBeforeDiscount() | tlTax | tlCurrency"></span></div><div class="x-price__row"><div tl-placement-icon ng-if="guestPlacements && !!guestPlacements.length && showGuestPlacements" class="x-price__icons" tl-tooltip tooltip-event="hover" tooltip-text="::guestPlacementsTooltipText" tl-tooltip-disabled="::!guestPlacementsTooltipText" guest-placements="::guestPlacements" is-interactive="::isInteractiveGuestIcons"></div><span ng-if="isInfoPrice" class="x-price__starts-from с1" tl-message="\'T:common.from\'"></span><span class="x-price__current" ng-class="{\'-motivator\': isMotivator}" ng-bind-html="getPriceAfterDiscount() | tlTax | tlCurrency"></span> <span ng-if="perMonth" class="x-price__period" tl-message="\'T:payment.per_month\'"></span><div class="x-price__details" ng-if="::!!priceDetailsAction && !servicesBookingForm && showPriceDetails" tl-popover event="click" ng-click="$event.preventDefault();" force-redraw="true" element-position="center top" popover-position="{{priceDetailsPopoverPosition}}" popover-changed="priceDetailsPopoverChanged(opened)" content-generator-action="priceDetailsAction()"><div class="tl-svg-button tl-svg-button_bright" tl-tooltip tooltip-event="hover" tooltip-text="\'T:rooms.price_details\' | message" tooltip-opened="priceDetailsTooltipOpened" tooltip-disabled="priceDetailsTooltipDisabled"><svg class="tl-svg-button__icon"><use xlink:href="#info"></use></svg> <svg class="tl-svg-button__icon tl-svg-button__icon_inverted"><use xlink:href="#info-invert"></use></svg></div></div></div><div ng-if="::(isShowPriceDescription && priceDescription)" class="x-price__description" tl-message="::priceDescription" message-params="::priceDescriptionParams" message-html="true"></div><div tl-schedule-price class="x-price__schedule" price="price" has-discount="hasDiscount" payment-options="paymentOptions"></div></div>')}),!function(r){r.directive||(r.directive={});r.registerDirective("tlPrice",["$q","$compile",function(n,o){return{scope:{price:"=",isInfoPrice:"=?",sizeSmall:"=?",guestPlacements:"=?",showGuestPlacements:"=?",guestPlacementsTooltipText:"=?",priceDetailsPopoverPosition:"=?",priceDetailsAction:"&?",showPriceDetails:"=?",priceDescription:"=?",priceDescriptionParams:"=?",isShowPriceDescription:"=?",perMonth:"=?",paymentOptions:"=?",isMotivator:"=?"},replace:!0,templateUrl:"directives/price/price.html",controller:["$scope",function(t){var e,i=r.BookingFormSettings.getInstance();t.showPriceDetails=null==(e=t.showPriceDetails)||e,t.showGuestPlacements=null==(e=t.showGuestPlacements)||e,t.isShowPriceDescription=null==(e=t.isShowPriceDescription)||e,t.servicesBookingForm=i.isServicesBookingForm(),t.priceDetailsPopoverPosition=t.priceDetailsPopoverPosition||"right+25% bottom",t.getPriceBeforeDiscount=function(){return t.price.priceBeforeDiscount||t.price},t.getPriceAfterDiscount=function(){return t.price.priceAfterDiscount||t.price},t.hasDiscount=function(){return t.price.discountAmountAfterTax&&t.price.discountAmountAfterTax.amount},t.getDiscountInPercentage=function(){return r.directive.helper.PriceHelper.calculateDiscountInPercentage(t.price)},t.priceDetailsTooltipOpened=!1,t.priceDetailsTooltipDisabled=!1,t.priceDetailsPopoverChanged=function(e){e&&(t.priceDetailsTooltipOpened=!e),t.priceDetailsTooltipDisabled=e},t.price.discount&&t.price.discount.type&&r.directive.helper.DiscountHelper.resolveUiDiscountType(t.price.discount.type)&&(t.discountIcon=r.directive.helper.DiscountHelper.getIcon(t.price.discount.type),t.discountMotivationAvailable=!0),t.isShowPriceDescription=null==(e=t.isShowPriceDescription)||e,t.getDiscountInfo=function(){return n.when(function(){return o('<tl-discount-info class="x-price__discount-info" price="::price"/>')(t)[0]})}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/placement-icon/placement-icon.html",'<% if (isAdditional) { %> <div class="x-placement-icon__item"><svg class="x-placement-icon__icon"><use xlink:href="#placement-add"></use></svg></div> <% } %> <% if ($item.placements > 2 && showNumbers) { %> <div class="x-placement-icon__item"><div class="x-placement-icon__icon x-placement-icon__icon_quantity"><%= $item.placements %></div></div> <% } %> <% for (var i = $item.placements > 2 ? 1 : Math.min($item.placements, maxIcons); i > 0; i--) { %> <div class="x-placement-icon__item"><svg class="x-placement-icon__icon"><use xlink:href="#placement-<%= $item.icon %>"></use></svg></div> <% } %>')}),!function(d){d.directive||(d.directive={});d.registerDirective("tlPlacementIcon",["$parse","$templateCache",function(c,e){var u=_.template(e.get("directives/placement-icon/placement-icon.html"));return{restrict:"EA",scope:!1,template:'<div class="x-placement-icon"></div>',replace:!0,link:function(t,i,e){var n=null,o=[],r=(e.guestPlacements?(n=d.PlacementManager.guestPlacementsToPlacement(c(e.guestPlacements)(t)),o=d.PlacementUtil.getPlacementIcons(n)):e.uiGuestPlacements?(n=d.PlacementManager.uiGuestPlacementsToRoomStayPlacement(c(e.uiGuestPlacements)(t)),o=d.PlacementUtil.getPlacementIcons(n)):e.placementIcons&&(o=c(e.placementIcons)(t)),c(e.maxIcons)(t)||Number.MAX_VALUE),a=!e.maxIcons&&!1!==c(e.showNumber)(t),s=e.isInteractive||!1,l=!1;_.each(o,function(e){e.placements&&(t.maxIcons=r,t.showNumbers=a,t.$item=e,t.isAdditional=!1,"extra_adult"!=e.kind&&"extra_child"!=e.kind&&"child_band_without_bed"!=e.kind||l||(t.isAdditional=!0,l=!0),e=u(t),_.forEach(angular.element(e),function(e){i[0].appendChild(e)}),s&&i[0].classList.add("x-placement-icon_interactive"))})}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/schedule-price/schedule-price.html",'<div ng-if="schedulePrice" class="link -promo x-schedule-price" ng-bind-html="\'T:payment.monthly_price\' | message: {price: schedulePrice} | tlUnsafe" force-redraw="true" tl-popover content-generator-action="schedulePriceDetails()" event="click" element-position="center top" popover-position="center bottom"></div>'),e.put("directives/schedule-price/templates/schedule-price-info.html",'<div><div class="x-popover__title first-letter-upper" tl-message="\'T:payment_type.installment\'"></div><div ng-if="loanPaymentOption.paymentSystem.paymentSystemCode == paymentSystemCode.YandexKasssaInstallments" ng-bind-html="\'T:order_info_preview.can_pay_yandexkassa\' | message: {price: schedulePrice, term: schedulePrice.term} | tlUnsafe"></div><div ng-if="loanPaymentOption.paymentSystem.paymentSystemCode == paymentSystemCode.Moneywall" ng-bind-html="\'T:order_info_preview.can_pay_moneywall\' | message: {price: schedulePrice} | tlUnsafe"></div><div ng-if="showTaxInfo" ng-bind-html="\'T:order_info_preview.taxes_separately\' | message | tlUnsafe"></div><div ng-bind-html="\'T:order_info_preview.select_payment_installments\' | message | tlUnsafe"></div></div>')}),!function(s){s.directive||(s.directive={});s.registerDirective("tlSchedulePrice",["$q","$compile","$templateCache",function(o,r,a){return{scope:{price:"=",paymentOptions:"="},replace:!1,templateUrl:"directives/schedule-price/schedule-price.html",controller:["$scope",function(i){var t=s.BookingFormSettings.getInstance(),n=_.filter(i.paymentOptions||[],function(e){return e.hasLoanPaymentSchedule()}),e=_.map(n,function(e){return e.loanPaymentSchedule()});e.length&&(o.all(e).then(function(e){_.each(e,function(e,t){t=n[t];i.schedulePrice&&t.paymentSystem.paymentSystemCode!==s.PaymentSystemCode.Moneywall||(i.loanPaymentOption=t,i.schedulePrice=new s.SchedulePriceAmount(_.head(e).amount,_.head(e).currency,e.length))}),i.$applyAsync()}),i.schedulePriceDetails=function(){return o.when(function(){i.paymentSystemCode=s.PaymentSystemCode,i.showTaxInfo=!t.showNetPrices&&i.price.priceAfterDiscount.tax.amount;var e=a.get("directives/schedule-price/templates/schedule-price-info.html");return r(e)(i)[0]})})}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/discount-info/discount-info.html",'<div class="x-di"><div class="x-di__row"><div class="x-di__label" tl-message="\'T:discount.saving\'"></div><div class="x-di__value"><span class="x-di__price -saving" ng-bind-html="getDiscountPriceAmount() | tlCurrency"></span></div></div><div class="x-di__row"><div class="x-di__label" tl-message="\'T:discount.common_price\'"></div><div class="x-di__value"><span class="x-di__price -old" ng-bind-html="getPriceBeforeDiscount() | tlTax | tlCurrency"></span></div></div><div class="x-di__row" ng-if="discountLabel && discountIcon"><div class="x-di__label" tl-message="discountLabel"></div><div class="x-di__value"><div class="x-di__icon"><svg><use ng-attr-xlink:href="{{\'#\' + discountIcon}}" xlink:href=""></use></svg></div><span ng-bind-html="getPriceAfterDiscount() | tlTax | tlCurrency"></span></div></div><div class="x-di__row x-di__row-note" ng-if="isAppliedToPartialPeriod"><div tl-message="\'T:discount.valid_for_limited_period\'"></div></div></div>')}),!function(n){n.directive||(n.directive={});n.registerDirective("tlDiscountInfo",["tl.messages",function(e){return{scope:{price:"="},templateUrl:"directives/discount-info/discount-info.html",controller:["$scope",function(t){var i=n.BookingFormSettings.getInstance();t.price.discount&&t.price.discount.type&&(t.getDiscountPriceAmount=function(){var e=!i.showNetPrices&&t.price.priceAfterDiscount.tax.amount?t.price.discountAmountAfterTax:t.price.discountAmountBeforeTax;return new n.PriceAmount(Math.abs(e.amount),e.currency)},t.getPriceBeforeDiscount=function(){return t.price.priceBeforeDiscount||t.price},t.getPriceAfterDiscount=function(){return t.price.priceAfterDiscount||t.price},t.discountIcon=n.directive.helper.DiscountHelper.getIcon(t.price.discount.type),t.discountLabel=n.directive.helper.DiscountHelper.getLabel(t.price.discount.type,e),t.isAppliedToPartialPeriod=t.price.discount.applicabilityType===n.DiscountApplicabilityType.Partial)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/adaptive-text/adaptive-text.html",'<div class="x-adaptive-text -max-{{::lines}}-lines" ng-class="{\'-clickable\': isClickable}" ng-click="onClickAction()" tl-message="text" message-html="true"></div>')}),tl.registerDirective("tlAdaptiveText",[function(){return{restrict:"EA",scope:{text:"=",lines:"=?",isFullTextShown:"=?",isClickable:"=?",clickAction:"&"},replace:!0,templateUrl:"directives/adaptive-text/adaptive-text.html",controller:["$scope",function(e){e.lines&&"number"==typeof e.lines?(e.lines=Math.max(e.lines,2),e.lines=Math.min(e.lines,4)):e.lines=2,e.onClickAction=function(){(_.isUndefined(e.clickable)||e.clickable)&&_.isFunction(e.clickAction)&&e.clickAction()}}],link:function(e,t){function i(){e.$applyAsync(function(){e.isFullTextShown=n.scrollHeight<=n.clientHeight})}var n=t[0],o=angular.element(window),r=window.innerWidth,a=_.throttle(function(){r!==window.innerWidth&&(r=window.innerWidth,i())},50);e.$watch("text",function(){i()}),o.on(tl.EventType.Resize,a),e.$on("$destroy",function(){o.off(tl.EventType.Resize,a)})}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/motivator/motivator.html",'<div class="motivator {{::className}}"><svg class="motivator__icon" ng-if="::iconName"><use ng-attr-xlink:href="{{\'#\' + iconName}}" xlink:href=""></use></svg><div tl-adaptive-text class="motivator__text" text="text" is-full-text-shown="isFullTextShown" ng-attr-title="{{getTitle(isFullTextShown)}}"></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlMotivator",[function(){return{restrict:"EA",replace:!0,templateUrl:"directives/motivator/motivator.html",scope:{text:"=",iconName:"=?",classNames:"=?"},controller:["$scope",function(t){var e;t.classNames=null!=(e=t.classNames)?e:[],t.className=_.intersection(["-small","-light"],t.classNames).join(" "),t.getTitle=function(e){return e?"":t.text}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/room-preview/room-preview.html",'<figure class="x-rp" ng-class="{\'-selected\': isDetailsShown}" id="room-id-{{::roomType.id}}" rel="room-preview" ng-click="::onCardClick($event)"><div class="x-rp__container" ng-class="{\'-has-images\': roomType.images.length}"><div class="x-rp__gallery-container"><div tl-photo-gallery class="x-rp__gallery" rel="{{::roomType.images.length ? \'wasteland\' : \'\'}}" images="::roomType.images" name="::roomType.name" on-change="hideAttribute()"></div></div><div class="x-rp__wrapper"><header class="x-rp__header"><div class="x-rp__check" ng-if="::isSelected" tl-tooltip tooltip-position="\'center\'" tooltip-text="\'T:room-info.your_choice\' | message" tooltip-event="hover"><svg class="x-rp__check-icon"><use xlink:href="#check"></use></svg></div><h2 class="x-rp__title" tl-message="roomType.name"></h2><div tl-address class="x-rp__address" ng-if="::roomType.contactInfo" contact-info="roomType.contactInfo" is-show-link="false"></div></header><div tl-room-properties class="x-rp__properties" show-capacity="showRoomCapacity" size="roomType.size" quantity="roomType.roomsQuantity" capacity="roomType.occupancy.total" kind="roomType.kind"></div><div class="x-rp__panel"><div class="x-rp__price" ng-if="::price"><div tl-price is-show-price-description="!$scope.servicesBookingForm" size-small="layout.phone" price="price" is-info-price="::isInfoPrice" price-description="priceDescription" price-description-params="priceDescriptionParams"></div></div><div class="x-rp__price" ng-if="::(isDemoPriceMode && demoPrice)"><div tl-price size-small="layout.phone" price="::demoPrice.price" is-info-price="::isInfoPrice" price-description="periodPriceDescriptionMessage"></div></div><div class="x-rp__action x-rp__action_full" ng-if="::isDemoPriceMode"><div class="x-rp__book" rel="wasteland"><span class="tl-btn" tl-message="::checkPeriodPriceMessage()" ng-click="::bookRoomAction()"></span></div></div><div class="x-rp__action" ng-if="::!isDemoPriceMode"><div class="x-rp__book" rel="wasteland" ng-if="::(price || (isAutoApplyPromoCodeRatePlan && isRestrictedByPromotionCode))"><div class="tl-btn" ng-click="::bookRoomAction()" ng-if="::(price && isSuitableRoomCapacity)"><span tl-message="\'T:rooms.select\'"></span></div><span class="tl-btn tl-btn_motivator" ng-if="::(isAutoApplyPromoCodeRatePlan && isRestrictedByPromotionCode && isSuitableRoomCapacity)" ng-click="::autoApplyPromoCode()" tl-message="\'T:promo.auto_apply\'"></span></div><div tl-promo-code-button ng-if="::(stay && !isAutoApplyPromoCodeRatePlan && isRestrictedByPromotionCode && isSuitableRoomCapacity)" rel="wasteland"></div><div tl-rate-plan-restriction ng-if="::(ratePlanRestriction && isSuitableRoomCapacity)" rel="wasteland" with-label="true" room-type="roomType" rate-plan="ratePlan" search-criteria="searchCriteria" rate-plan-restriction="ratePlanRestriction" apply-search-criteria-action="applySearchCriteriaAction({updatedSearchCriteria: updatedSearchCriteria})"></div><div class="x-rp__sold-out badge badge_state_disabled" ng-if="::(!stay && isSuitableRoomCapacity)"><svg class="badge__icon"><use xlink:href="#forbidden"></use></svg> <span tl-message="\'T:rate-plan-list.out_of_stock\'"></span></div><div ng-if="::(!stay && availabilityCalendarAvailable && isSuitableRoomCapacity)" class="tl-btn-light"><span class="tl-btn-light__message" tl-message="\'T:room-details.open_calendar\'"></span></div><div class="x-rp__unavailable badge badge_state_disabled" ng-if="::!isSuitableRoomCapacity"><svg class="badge__icon"><use xlink:href="#forbidden"></use></svg> <span tl-message="\'T:rate-plan-list.unavailable\'"></span></div><div ng-if="::!stay && availabilityCalendarAvailable && isAccommodateGuests" class="tl-btn-light" tl-message="\'T:room-details.open_calendar\'"></div></div></div></div></div><div class="x-rp__attribute" rel="room-preview-attribute"><div tl-motivator class="x-rp__motivator" ng-if="::(isBestRoomType && !limitedInventoryCount)" icon-name="\'cup\'" text="\'T:room-info.best_room_type\'"></div><div tl-limited-inventory-count class="x-rp__motivator" ng-if="::limitedInventoryCount" rooms-unit="::limitedInventoryCount"></div><ul class="x-rp__features" rel="wasteland" ng-if="::mostImportantFeatures.length" tl-row-cropper><li class="x-rp__feature" ng-repeat="feature in mostImportantFeatures | limitTo: 5 track by $index" tl-tooltip tooltip-text="capitalize(feature.name)" tooltip-event="{{layout.desktop ? \'hover\' : \'click\'}}"><svg class="x-rp__feature-icon"><use xlink:href="{{::roomFeatureManager.getRoomFeatureIcon(feature.kind)}}"></use></svg></li></ul></div></figure>')}),!function(c){var u;u=c.directive||(c.directive={}),c.registerDirective("tlRoomPreview",["$q","overlay","layout","tl.messages","$timeout",function(o,r,a,s,l){return{restrict:"EA",replace:!0,scope:{roomType:"=",stay:"=?",price:"=?",guestsCount:"=?",limitedInventoryCount:"=?",availabilityCalendarAvailable:"=?",searchCriteria:"=",isDetailsShown:"=?",applySearchCriteriaAction:"&?",isInfoPrice:"=?",isDemoPriceMode:"=?",isSelected:"=?",minPricePeriodAction:"&?",bookRoomAction:"&?",showDetailsAction:"&?",wishListService:"="},template:c.directiveTemplate({name:"room-preview",template:"room-preview",single:!0}),link:function(e,t){l(function(){e.attributeElement=t[0].parentNode.querySelector('[rel="room-preview-attribute"]')})},controller:["$scope",function(i){function e(){var e=c.RoomFeatureManager.sortByPriority(i.roomType.features);i.mostImportantFeatures=c.RoomFeatureManager.getImportantFeatures(e),i.otherFeaturesCount=e.length-i.mostImportantFeatures.length}var n=c.BookingFormSettings.getInstance(),t=(i.stayDuration=i.searchCriteria.stayDuration(n.stayUnitKind),i.isSuitableRoomCapacity=c.RoomTypeUtil.isSuitableRoomCapacity(i.roomType,i.searchCriteria.placements),i.layout=a,i.messages=s,i.roomFeatureManager=c.RoomFeatureManager,i.servicesBookingForm=n.isServicesBookingForm(),i.isManualAccommodationMode=n.accommodationMode==c.AccommodationMode.Manual,i.isBestRoomType=_.some(n.motivators.bestRoomTypes,function(e){return e==i.roomType.id}),i.isRestrictedByPromotionCode=i.stay&&i.stay.hasRestriction(c.RoomStayRestrictionKind.PromotionalCode)||i.stay&&i.stay.isRestrictedByPromotionCode,i.ratePlanRestriction=i.stay&&i.stay.ratePlanRestriction,i.ratePlan=i.stay&&i.stay.ratePlan,i.stayDates=i.stay&&i.stay.stayDates,i.isAutoApplyPromoCodeRatePlan=i.stay&&n.isAutoApplyPromoCodeRatePlan(i.stay.ratePlan.id),i.showRoomCapacity=c.RoomTypeUtil.showRoomCapacity(i.roomType),i.autoApplyPromoCode=function(){var t={callback:function(e){r.off(),scInformer.unsubscribe(t,c.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.unsubscribe(t,c.SearchCriteriaInformerMessageType.InvalidPromoCode)}};r.on(),scInformer.subscribe(t,c.SearchCriteriaInformerMessageType.PromoCodeApplied),scInformer.subscribe(t,c.SearchCriteriaInformerMessageType.InvalidPromoCode),c.SearchCriteriaInformer.getInstance().notify(c.SearchCriteriaInformerMessageType.ApplyPromoCode,{promoCode:n.findAutoApplyPromoCode(i.stay.ratePlan.id)})},e(),i.featuresNotifier=c.NotifierHelper.subscribe(i,o,!0,!1),i.featuresNotifier.onLanguageChanged(function(){e()}),i.getRoomStayPlacement=function(){return i.stay?c.PlacementManager.guestPlacementsToPlacement(i.stay.guestPlacementOptions):null},i.hasDiscount=function(){return i.stay.price.discountAmountAfterTax&&i.stay.price.discountAmountAfterTax.amount},i.onCardClick=function(e){c.HtmlUtil.handleBlockableEvent({event:e,targetRel:"room-preview",blockerRel:"wasteland",handler:i.showDetailsAction||i.bookRoomAction})},i.bookRoom=function(){i.price&&_.isFunction(i.bookRoomAction)&&i.bookRoomAction()},i.isDemoPriceMode&&!_.isUndefined(i.minPricePeriodAction)&&(i.demoPrice=i.minPricePeriodAction({roomType:i.roomType})),i.checkPeriodPriceMessage=function(){var e=i.demoPrice&&i.demoPrice.price?"T:rooms.check_price":"T:rooms.booking_room";return i.messages.formatMessage(e,{})},null);i.hideAttribute=function(){!a.desktop&&i.attributeElement&&(l.cancel(t),c.HtmlUtil.toggleClass(i.attributeElement,"-hide",!0),t=l(function(){c.HtmlUtil.toggleClass(i.attributeElement,"-hide",!1)},3e3))},i.price&&!i.servicesBookingForm&&(i.isManualAccommodationMode?(i.priceDescription="T:rooms.number_nights_manual",i.priceDescriptionParams={nights:i.stayDuration}):(i.priceDescription="T:rooms.number_nights",i.priceDescriptionParams={nights:i.stayDuration,guests:i.guestsCount||i.getRoomStayPlacement().total()})),i.capitalize=function(e){return c.StringUtil.capitalize(e)},i.periodPriceDescriptionMessage=u.helper.AvailabilityCalendarHelper.getPeriodPriceDescriptionMessage(i.demoPrice,s)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/address/address.html",'<address class="property"><svg class="property__icon"><use xlink:href="#location"></use></svg> <a class="property__label -link" ng-if="::mapUrl && isShowLink" href="{{::mapUrl}}" target="_blank"><div class="property__label-text"><span class="property__label-link" tl-message="\'T:common.address\'" message-params="{address: contactInfo.address()}"></span></div><svg class="property__label-icon"><use xlink:href="#link"></use></svg> </a><span class="property__label" ng-if="::!mapUrl || !isShowLink" tl-message="\'T:common.address\'" message-params="{address: contactInfo.address()}"></span></address>')}),tl.registerDirective("tlAddress",[function(){return{restrict:"EA",scope:{contactInfo:"=",isShowLink:"=?"},templateUrl:"directives/address/address.html",replace:!1,controller:["$scope",function(e){var t;e.isShowLink=null==(t=e.isShowLink)||t,e.mapUrl=e.contactInfo.getMapUrl()}]}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/room-properties/room-properties.html",'<div class="properties"> <% if ((showCapacity || size || quantity) && kind !== roomTypeUnitKind.Service) { %> <% if (showCapacity) { %> <div class="property <%= withoutIcon ? \' -without-icon\' : \'\' %>"><svg class="property__icon"><use xlink:href="#capacity"></use></svg><div class="property__label" tl-message="capacity == 1 ? \'T:room-preview.occupancy\' : \'T:room-preview.up_to_occupancy\'" message-params="{value: capacity}" message-html="true"></div></div> <% } %> <% if (size) { %> <div class="property <%= withoutIcon ? \' -without-icon\' : \'\' %>"><svg class="property__icon"><use xlink:href="#area"></use></svg><div class="property__label" tl-message="\'T:common.area\'" message-params="{area: size}" message-html="true"></div></div> <% } %> <% if (quantity) { %> <div class="property <%= withoutIcon ? \' -without-icon\' : \'\' %>"><svg class="property__icon"><use xlink:href="#rooms"></use></svg><div class="property__label" tl-message="\'T:common.rooms_quantity\'" message-params="{rooms: quantity}" message-html="true"></div></div> <% } %> <% } %> </div>')}),!function(r){r.directive||(r.directive={});r.registerDirective("tlRoomProperties",["$templateCache","$compile",function(n,o){return{scope:{capacity:"=?",size:"=?",quantity:"=?",kind:"=?",showCapacity:"=?",withoutIcon:"=?"},link:function(e,t){var i;e.showCapacity=null==(i=e.showCapacity)||i,e.withoutIcon=null!=(i=e.withoutIcon)&&i,e.roomTypeUnitKind=r.RoomTypeUnitKind,t.append(o(_.template(n.get(r.directiveTemplateUrl("room-properties")))(e))(e))}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/rate-plan-restriction/rate-plan-restriction.html",'<div class="x-rpr" ng-if="::ratePlanRestriction"><div tl-rate-plan-restriction-message ng-if="::withLabel" class="x-rpr__message" rate-plan-restriction="::ratePlanRestriction"></div><div class="tl-btn-light" tl-popover content-generator-action="getChangeDatesNode()" event="click" force-redraw="true" popover-opened="disabledChangeDates.shown" element-position="center top" popover-position="right+25% bottom" popover-overflow="false"><div><span tl-message="\'T:rate-plan-list.change_dates\'"></span></div></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlRatePlanRestriction",["$q","$compile",function(t,i){return{restrict:"AE",templateUrl:"directives/rate-plan-restriction/rate-plan-restriction.html",scope:{ratePlanRestriction:"=",ratePlan:"=",roomType:"=?",searchCriteria:"=?",applySearchCriteriaAction:"&",withLabel:"=?"},controller:["$scope",function(e){e.withLabel=!!_.isUndefined(e.withLabel)||e.withLabel,e.disabledChangeDates={shown:null},e.getChangeDatesNode=function(){return t.when(function(){return e.closeChangeDates=function(){e.disabledChangeDates.shown=!1},i('<tl-change-dates search-criteria="searchCriteria" rate-plan="ratePlan" room-type="roomType" rate-plan-restriction="ratePlanRestriction" close-action="closeChangeDates()" apply-search-criteria-action="applySearchCriteriaAction({updatedSearchCriteria: updatedSearchCriteria})"  />')(e)[0]})}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/rate-plan-restriction-message/rate-plan-restriction-message.html",'<div class="x-rprm"><div ng-if="::ratePlanRestriction.hasMinLos() && !ratePlanRestriction.hasMaxLos()" tl-message="\'T:rate-plan-list.min_los\'" message-params="{nights: ratePlanRestriction.minLos}" message-html="true"></div><div ng-if="::ratePlanRestriction.hasMaxLos() && ratePlanRestriction.minLos.value == ratePlanRestriction.maxLos.value" tl-message="\'T:rate-plan-list.los\'" message-params="{nights: ratePlanRestriction.maxLos}" message-html="true"></div><div ng-if="::ratePlanRestriction.hasMaxLos() && ratePlanRestriction.minLos.value != ratePlanRestriction.maxLos.value" tl-message="\'T:rate-plan-list.los_range\'" message-params="{from: ratePlanRestriction.minLos, to: ratePlanRestriction.maxLos}" message-html="true"></div></div>')}),!function(i){i.directive||(i.directive={});i.registerDirective("tlRatePlanRestrictionMessage",[function(){return{restrict:"AE",replace:!0,templateUrl:"directives/rate-plan-restriction-message/rate-plan-restriction-message.html",scope:{ratePlanRestriction:"="},controller:["$scope",function(e){var t=i.BookingFormSettings.getInstance();e.servicesBookingForm=t.isServicesBookingForm()}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/change-dates/change-dates.html",'<div class="x-change-dates"><div class="x-popover__title" tl-message="\'T:rooms.stay_dates\'" message-params="{ nights: headingNights }"></div><div class="x-change-dates__content"><div class="x-change-dates__dates"><svg class="x-change-dates__dates-icon"><use xlink:href="#check-in-date"></use></svg> <span><span ng-bind="\'T:common.date_format\' | message: { date: updatedSearchCriteria.checkInDate }"></span>&nbsp;&ndash;</span> <svg class="x-change-dates__dates-icon"><use xlink:href="#check-out-date"></use></svg> <b class="x-change-dates__date" ng-bind="\'T:common.date_format\' | message: { date: updatedSearchCriteria.checkOutDate }"></b></div><div tl-select class="x-change-dates__select" select-model="nightsSelect.selected" select-items="nightsSelect.items" select-match-template="nightsSelectMatchTemplate" select-choice-template="nightsSelectChoiceTemplate" select-scroll="center" select-change="changeNights()"></div></div><div class="x-change-dates__controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="::close()"></span> <span class="button-group__item"><span class="tl-btn tl-btn_on_popup" ng-click="applySearchCriteria()" tl-message="\'T:modal.apply\'"></span></span></div></div></div>'),e.put("directives/change-dates/nights-select-choice.html","<span class=\"x-change-dates__nights\"> <%= $message('T:common.nights', {nights: $item}) %> </span>"),e.put("directives/change-dates/nights-select-match.html","<span class=\"x-change-dates__nights h6\"> <%= $message('T:common.nights', {nights: $selected}) %> </span>")}),!function(c){c.directive||(c.directive={});c.registerDirective("tlChangeDates",[function(){return{restrict:"AE",templateUrl:"directives/change-dates/change-dates.html",scope:{searchCriteria:"=?",ratePlan:"=?",roomType:"=?",ratePlanRestriction:"=?",applySearchCriteriaAction:"&",closeAction:"&"},controller:["$scope",function(e){for(var t=c.BookingFormSettings.getInstance().stayUnitKind,i=(e.updatedSearchCriteria=e.searchCriteria.clone(),e.headingNights=new c.StayDuration(t,42),e.updatedSearchCriteria.nights()),n=e.ratePlanRestriction&&e.ratePlanRestriction.minLos.value||1,o=e.ratePlanRestriction&&e.ratePlanRestriction.maxLos.value||Number.MAX_VALUE,r=[],a=Math.min(30+n,o),s=Math.min(n,a);s<=a;s++)r.push(new c.StayDuration(t,s));e.nightsSelectMatchTemplate=c.directiveTemplateUrl("change-dates","nights-select-match"),e.nightsSelectChoiceTemplate=c.directiveTemplateUrl("change-dates","nights-select-choice"),e.nightsSelect={selected:_.find(r,function(e){return e.value==i})||r[0],items:r};function l(){e.updatedSearchCriteria.checkOutDate=e.updatedSearchCriteria.checkInDate.addDays(e.nightsSelect.selected.value+(t==c.StayUnitKind.Night?0:-1))}e.changeNights=function(){e.$applyAsync(function(){l()})},e.applySearchCriteria=function(){e.updatedSearchCriteria.ratePlansIds=e.ratePlan?[e.ratePlan.id]:[],e.updatedSearchCriteria.roomTypeIds=e.roomType?[e.roomType.id]:[],e.applySearchCriteriaAction({updatedSearchCriteria:e.updatedSearchCriteria})},e.close=function(){e.closeAction()},l()}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/limited-inventory-count/limited-inventory-count.html",'<div tl-motivator ng-if="::roomsUnit" text="getMotivatorText(roomsUnit.kind)"></div>')}),!function(o){o.directive||(o.directive={});o.registerDirective("tlLimitedInventoryCount",["tl.messages",function(n){return{restrict:"EA",scope:{roomsUnit:"="},templateUrl:"directives/limited-inventory-count/limited-inventory-count.html",replace:!1,controller:["$scope",function(t){(e={})[o.RoomTypeUnitKind.Room]="T:rooms.limited_room",e[o.RoomTypeUnitKind.PlaceInRoom]="T:rooms.limited_room:place_in_room",e[o.RoomTypeUnitKind.Cottage]="T:rooms.limited_room",e[o.RoomTypeUnitKind.Apartment]="T:rooms.limited_room:apartment",e[o.RoomTypeUnitKind.Service]="T:rooms.limited_room:service",e[o.RoomTypeUnitKind.GuestRoom]="T:rooms.limited_room:guest_room",e[o.RoomTypeUnitKind.Camp]="T:rooms.limited_room:camp",e[o.RoomTypeUnitKind.Studio]="T:rooms.limited_room:studio",e[o.RoomTypeUnitKind.Flat]="T:rooms.limited_room:flat",e[o.RoomTypeUnitKind.House]="T:rooms.limited_room:house",e[o.RoomTypeUnitKind.Villa]="T:rooms.limited_room:villa";var e,i=e;t.getMotivatorText=function(e){return n.formatMessage(i[e],{amount:t.roomsUnit.value,rooms:t.roomsUnit})}}]}}])}(tl=tl||{}),tl.HtmlUtil),tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl,tl;tl.registerDirective("tlRowCropper",["$timeout",function(i){return{scope:{maxRows:"=?",showLastElement:"=?",croppedCount:"=?"},replace:!0,link:function(r,a,e){setTimeout(function(){r.maxRows=_.isUndefined(r.maxRows)?1:r.maxRows;function e(){r.croppedCount=0;var e=o(a),i=e.length-1;_.forEachRight(e,function(e,t){t===i&&r.showLastElement||_.filter(o(a),function(e){return 0==n(e).left}).length>r.maxRows&&(r.croppedCount++,HtmlUtil.toggleClass(e,"ng-hide",!0))})}var n=function(e){var t=e.parentElement.getBoundingClientRect(),e=e.getBoundingClientRect();return{top:e.top-t.top,right:e.right-t.right,bottom:e.bottom-t.bottom,left:e.left-t.left}},o=function(e){return _.map(e.children(),function(e){return e})},t=_.throttle(function(){i(function(){_.forEach(o(a).reverse(),function(e){HtmlUtil.toggleClass(e,"ng-hide",!1)}),e()},100)},100);t(),angular.element(window).on(tl.EventType.Resize,t),r.$on("$destroy",function(){angular.element(window).off(tl.EventType.Resize,t)})})}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/room-info/lite/room-info-lite.html",'<div class="x-ril"><div class="plate -first -no-wrap x-ril__for-phone" ng-class="{\'-with-hidden-details\': hasLiteHiddenDetails()}" id="room-id-small-{{::roomType.id}}"><figure class="plate__media -size-xxs -stretch x-ril__media" ng-if="::roomType.images.length"><div tl-photo-gallery images="::roomType.images" show-slider="false"></div></figure><div class="plate__content"><div class="plate__header x-ril__header"><div class="x-ril__room-name"><div class="plate__title x-ril__title" tl-message="roomType.name" ng-click="toggleLiteRoomDescription()"></div></div></div></div></div><div class="plate -first -no-wrap" ng-class="{\'-with-hidden-details\': hasLiteHiddenDetails(), \'-last\': isLast && !opened}" id="room-id-{{::roomType.id}}"><figure class="plate__media -size-xs -stretch x-ril__for-desktop x-ril__media" ng-if="::roomType.images.length"><div tl-photo-gallery images="::roomType.images" show-slider="false"></div></figure><div class="plate__content"><div class="plate__header x-ril__header x-ril__for-desktop"><div class="x-ril__room-name"><div class="plate__title x-ril__title" tl-message="roomType.name" ng-click="toggleLiteRoomDescription()"></div></div><div class="x-ril__show-more" ng-if="::hasLiteHiddenDetails()"><div class="rounded-link" data-autoscroll-save="x-ri-{{::roomType.id}}" tl-id="ripe-${roomType.id}" ng-click="toggleLiteRoomDescription()"><span ng-bind="opened ? \'T:common.hide\' : \'T:common.show\' | message"></span> <svg class="rounded-link__icon"><use ng-if="!opened" xlink:href="#arrow-down"></use><use ng-if="opened" xlink:href="#arrow-up"></use></svg></div></div><div class="rounded-link -only-icon x-ril__rounded-link x-ril__for-desktop" ng-if="::hasLiteHiddenDetails()" data-autoscroll-save="x-ri-{{::roomType.id}}" tl-id="ripe-${roomType.id}" ng-click="toggleLiteRoomDescription()"><svg class="rounded-link__icon"><use ng-if="!opened" xlink:href="#arrow-down"></use><use ng-if="opened" xlink:href="#arrow-up"></use></svg></div></div><div class="x-ril__properties-container"><div tl-room-properties capacity="roomType.occupancy.total" size="roomType.size" quantity="roomType.roomsQuantity" kind="roomType.kind" show-capacity="showRoomCapacity"></div><div class="rounded-link -only-icon x-ril__rounded-link x-ril__for-phone" ng-if="::hasLiteHiddenDetails() && !mostImportantFeatures.length" data-autoscroll-save="x-ri-{{::roomType.id}}" tl-id="ripe-${roomType.id}" ng-click="toggleLiteRoomDescription()"><svg class="rounded-link__icon"><use ng-if="!opened" xlink:href="#arrow-down"></use><use ng-if="opened" xlink:href="#arrow-up"></use></svg></div></div><div class="x-ril__footer" ng-if="::mostImportantFeatures.length"><ul class="x-ril__features" tl-row-cropper show-last-element="true" cropped-count="croppedCount"><li class="x-ril__feature" ng-repeat="feature in mostImportantFeatures | limitTo: featuresLimit track by $index"><svg class="x-ril__feature-icon"><use xlink:href="{{::roomFeatureManager.getRoomFeatureIcon(feature.kind)}}"></use></svg><div class="x-ril__feature-hint" tl-tooltip tooltip-text="getFeatureName(feature)" tooltip-event="hover"></div><span class="x-ril__feature-label" tl-message="getFeatureName(feature)"></span></li><li class="x-ril__feature -additional" ng-if="::mostImportantFeatures.length < roomType.features.length" ng-click="toggleLiteRoomDescription()" data-autoscroll-save="x-ri-{{::roomType.id}}"><svg class="x-ril__feature-icon"><use xlink:href="#add"></use></svg> <span class="x-ril__feature-label" ng-bind="\'T:common.more.count\' | message: { count: roomType.features.length - mostImportantFeatures.length + croppedCount }"></span></li></ul><div class="rounded-link -only-icon x-ril__rounded-link x-ril__for-phone" ng-if="::hasLiteHiddenDetails()" data-autoscroll-save="x-ri-{{::roomType.id}}" tl-id="ripe-${roomType.id}" ng-click="toggleLiteRoomDescription()"><svg class="rounded-link__icon"><use ng-if="!opened" xlink:href="#arrow-down"></use><use ng-if="opened" xlink:href="#arrow-up"></use></svg></div></div></div></div><div class="plate" ng-class="{\'-with-separator\': opened}" ng-if="opened && (roomType.description || roomType.features.length)"><div class="plate__content"><div tl-preferences class="x-ril__room-preferences" ng-if="::roomPreferences.length" room-preferences="::roomPreferences" preference-change-action="changeRoomPreferencesAction({preferenceCategory: preferenceCategory, preferenceCode: preferenceCode})"></div><div class="whitespace-preline" ng-if="::roomType.description" tl-message="roomType.description"></div><div tl-room-features class="x-ril__amenities-list" ng-if="::roomType.features.length" features="roomType.features"></div><div class="plate__show-more"><div class="rounded-link" data-autoscroll-start="x-ri-{{::roomType.id}}" tl-id="rie-${roomType.id}" ng-click="toggleLiteRoomDescription()"><span tl-message="\'T:common.hide\'"></span> <svg class="rounded-link__icon"><use xlink:href="#arrow-up"></use></svg></div></div></div></div></div>'),e.put("directives/room-info/mini/room-info-mini.html",'<div class="plate -no-wrap -first x-rim-plate" ng-class="{\'-last\': isLast}"><figure class="plate__media x-rim-plate__media" ng-if="::roomType.images.length"><div tl-fit-image image="::roomType.images[0]"></div></figure><div class="plate__content -narrow"><div class="plate__title x-rim-plate__title" tl-message="roomType.name"></div><div tl-room-properties class="x-rim-plate__properties" size="roomType.size" capacity="roomType.occupancy.total" quantity="roomType.roomsQuantity" show-capacity="showRoomCapacity" kind="roomType.kind" without-icon="true"></div></div></div>'),e.put("directives/room-info/room-info.html",'<div class="x-ri"><div class="plate -first" id="room-id-{{::roomType.id}}" ng-class="{\'-state-active\': isBestRoomType, \'-with-hidden-details\': hasHiddenDetails()}"><div class="plate__media" ng-class="{\'-has-images\': roomType.images.length}"><div tl-photo-gallery images="::roomType.images" name="roomType.name"></div><div class="plate__media-promo"><div tl-motivator ng-if="isBestRoomType && !limitedInventoryCount" icon-name="\'cup\'" text="\'T:room-info.best_room_type\'"></div><div tl-limited-inventory-count ng-if="::limitedInventoryCount" rooms-unit="::limitedInventoryCount"></div></div></div><div class="plate__content"><div class="plate__header"><h2 class="plate__title" tl-message="roomType.name" data-autoscroll-save="x-ri-{{::roomType.id}}" ng-click="toggleRoomDescription()"></h2></div><div tl-room-properties class="x-ri__properties" capacity="roomType.occupancy.total" size="roomType.size" quantity="roomType.roomsQuantity" kind="roomType.kind" show-capacity="showRoomCapacity"></div><ul class="x-ri__features" ng-if="::mostImportantFeatures.length"><li class="x-ri__feature" ng-repeat="feature in mostImportantFeatures | limitTo: 5 track by $index"><svg class="x-ri__feature-icon"><use xlink:href="{{::roomFeatureManager.getRoomFeatureIcon(feature.kind)}}"></use></svg> <span class="x-ri__feature-label" tl-message="getFeatureName(feature)"></span></li><li class="x-ri__feature -additional" ng-if="::mostImportantFeatures.length < roomType.features.length" ng-click="toggleRoomDescription()" data-autoscroll-save="x-ri-{{::roomType.id}}"><svg class="x-ri__feature-icon"><use xlink:href="#add"></use></svg> <span class="x-ri__feature-label" tl-message="\'T:common.more.count\'" message-params="{count: roomType.features.length - mostImportantFeatures.length}"></span></li></ul><div tl-address class="x-ri__address" ng-if="::roomType.contactInfo" contact-info="roomType.contactInfo"></div><div class="x-ri__preview -screen-size-large" ng-if="!opened"><div tl-adaptive-text ng-if="::roomType.description" text="roomType.description" lines="::adaptiveShortTextParams.lines" is-full-text-shown="adaptiveShortTextParams.isFullTextShown" click-action="toggleRoomDescription()" is-clickable="isTextClickable(adaptiveShortTextParams)" data-autoscroll-save="x-ri-{{::roomType.id}}"></div><div class="plate__show-more" ng-if="isTextClickable(adaptiveShortTextParams)"><div class="rounded-link" data-autoscroll-save="x-ri-{{::roomType.id}}" tl-id="ripe-${roomType.id}" ng-click="toggleRoomDescription()"><span ng-bind="opened ? \'T:common.hide\' : \'T:common.show\' | message"></span> <svg class="rounded-link__icon"><use ng-if="!opened" xlink:href="#arrow-down"></use><use ng-if="opened" xlink:href="#arrow-up"></use></svg></div></div></div></div></div><div class="plate -with-separator x-ri__preview -screen-size-small" ng-class="{\'-state-active\': isBestRoomType}" ng-if="!opened && (roomType.description || roomType.features.length)"><div class="plate__content"><div tl-adaptive-text ng-if="::roomType.description" text="roomType.description" lines="::adaptiveTextParams.lines" is-full-text-shown="adaptiveTextParams.isFullTextShown" click-action="toggleRoomDescription()" is-clickable="isTextClickable(adaptiveTextParams)"></div><div class="plate__show-more" ng-if="isTextClickable(adaptiveTextParams)"><div class="rounded-link" data-autoscroll-save="x-ri-{{::roomType.id}}" tl-id="ride-${roomType.id}" ng-click="toggleRoomDescription()"><span ng-bind="opened ? \'T:common.hide\' : \'T:common.show\' | message"></span> <svg class="rounded-link__icon"><use ng-if="!opened" xlink:href="#arrow-down"></use><use ng-if="opened" xlink:href="#arrow-up"></use></svg></div></div></div></div><div class="plate -with-separator" ng-class="{\'-state-active\': isBestRoomType}" ng-if="opened && (roomType.description || roomType.features.length)"><div class="plate__content"><div class="whitespace-preline" ng-if="::roomType.description" tl-message="roomType.description"></div><div tl-room-features class="x-ri__amenities-list" ng-if="::roomType.features.length" features="roomType.features"></div><div class="plate__show-more"><div class="rounded-link" data-autoscroll-start="x-ri-{{::roomType.id}}" tl-id="rie-${roomType.id}" ng-click="toggleRoomDescription()"><span tl-message="\'T:common.hide\'"></span> <svg class="rounded-link__icon"><use xlink:href="#arrow-up"></use></svg></div></div></div></div></div>')}),!function(r){function e(t){return["$q","layout","locale",function(n,o,e){return{scope:{roomType:"=",roomPreferences:"=?",limitedInventoryCount:"=?",isBestRoomType:"=?",isLast:"=?",changeRoomPreferencesAction:"&?"},templateUrl:t,replace:!0,controller:["$scope",function(t){function e(){var e=r.RoomFeatureManager.sortByPriority(t.roomType.features);t.mostImportantFeatures=r.RoomFeatureManager.getImportantFeatures(e)}var i;t.layout=o,t.roomFeatureManager=r.RoomFeatureManager,t.isLast=null==(i=t.isLast)||i,t.featuresLimit=5,t.croppedCount=0,t.opened=!1,t.adaptiveShortTextParams={lines:2,isFullTextShown:!0},t.adaptiveTextParams={lines:3,isFullTextShown:!0},t.showRoomCapacity=r.RoomTypeUtil.showRoomCapacity(t.roomType),t.isTextClickable=function(e){return!!t.roomType.description&&!e.isFullTextShown||!!t.roomType.features.length||t.opened},t.hasHiddenDetails=function(){return!(!t.roomType.features.length&&(!t.roomType.description||t.adaptiveShortTextParams.isFullTextShown&&t.adaptiveTextParams.isFullTextShown))},t.toggleRoomDescription=function(){(t.hasHiddenDetails()||t.opened)&&(t.opened=!t.opened)},t.hasLiteHiddenDetails=function(){return!!t.roomType.features.length||!!t.roomType.description},t.toggleLiteRoomDescription=function(){(t.hasLiteHiddenDetails()||t.opened)&&(t.opened=!t.opened)},t.getFeatureName=function(e){return r.StringUtil.capitalize(e.name)};e(),r.NotifierHelper.subscribe(t,n,!0,!1).onLanguageChanged(function(){e()})}]}}]}r.directive||(r.directive={}),r.registerDirective("tlRoomInfo",e(r.directiveTemplateUrl("room-info"))),r.registerDirective("tlRoomInfoLite",e(r.directiveTemplateUrl("room-info","lite/room-info-lite"))),r.registerDirective("tlRoomInfoMini",e(r.directiveTemplateUrl("room-info","mini/room-info-mini")))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/preferences/preferences-select-choice.html","<div class=\"x-preferences__option<%= !$item.category ? ' -with-icon' : '' %><%= $inline ? ' -inline' : '' %>\"> <% if ($item.category) { %> <div class=\"x-preferences__text\"><%= $message('T:guest-info.preference_cancel') %></div> <% } else { %> <svg class=\"x-preferences__icon\"><use xlink:href=\"<%= getFeatureIconHref($item.roomPreference.code) %>\"></use></svg><div class=\"x-preferences__text\"><%= $item.roomPreference.name %></div> <% } %> </div>"),e.put("directives/preferences/preferences-select-label.html","<%= $selected.category ? $selected.roomPreference.roomPreference.categoryName : $selected.roomPreference.categoryName %>"),e.put("directives/preferences/preferences-select-match.html",'<div class="x-preferences__select"><div class="x-preferences__label"> <%= $selected.category ? $selected.roomPreference.roomPreference.categoryName :\n    $selected.roomPreference.categoryName %> </div> <% if ($selected.category) { %> <div class="x-preferences__value"> <%= $message(\'T:guest-info.preference_cancel\') %> </div> <% } else { %> <div class="x-preferences__option<%= !$selected.category ? \' -with-icon\' : \'\' %>"><svg class="x-preferences__icon"><use xlink:href="<%= getFeatureIconHref($selected.roomPreference.code) %>"></use></svg><div class="x-preferences__value"> <%= $selected.roomPreference.name %> </div></div> <% } %> </div>'),e.put("directives/preferences/preferences.html",'<div class="x-preferences"><div class="x-preferences__items" rel="preferences-container" ng-class="{\'-inline\': inlineMode}"><div class="x-preferences__item-wrap" ng-if="inlineMode" ng-repeat="select in ::roomPreferencesSelects track by $index" tl-id="pr-${select.type}"><div class="x-preferences__item" rel="preferences-item"><div tl-select-inline select-model="select.selected" select-items="select.options" select-match-template="preferencesSelectLabelTemplate" select-choice-template="preferencesSelectChoiceTemplate" select-change="preferenceChange($selected)" select-update="selectNotifier.notifier"></div></div></div><div ng-if="!inlineMode" class="x-preferences__item-wrap" ng-repeat="select in ::roomPreferencesSelects track by $index" tl-id="pr-${select.type}"><div class="x-preferences__item" rel="preferences-item"><div tl-select select-class="\'-united\'" select-model="select.selected" select-items="select.options" select-match-template="preferencesSelectMatchTemplate" select-choice-template="preferencesSelectChoiceTemplate" select-change="preferenceChange($selected)" select-update="selectNotifier.notifier"></div></div></div></div><div class="x-preferences__note" tl-message="\'T:guest-info.preferences_note\'"></div></div>')}),!function(o){o.directive||(o.directive={});o.registerDirective("tlPreferences",["$q","$state","layout","serviceFactory",function(t){return{scope:{roomPreferences:"=?",preferenceChangeAction:"&?"},replace:!0,templateUrl:"directives/preferences/preferences.html",controller:["$scope","$element",function(i,n){i.inlineMode=!0;function e(){var e,t;i.inlineMode&&(e=_.head(n).querySelector('[rel="preferences-container"]'),t=_.reduce(_.head(n).querySelectorAll('[rel="preferences-item"]'),function(e,t){return e+t.clientWidth},0),i.inlineMode=e.clientWidth>t,i.$apply())}setTimeout(e),angular.element(window).on(o.EventType.Resize,e),i.$on("$destroy",function(){angular.element(window).unbind(o.EventType.Resize,e)});i.roomPreferencesSelects=_.map(_.groupBy(i.roomPreferences,function(e){return e.roomPreference.categoryCode}),function(e,t){var i={category:!0,roomPreference:_.head(e)},n=(e.unshift(i),_.find(e,function(e){return e.selected}));return{type:t,selected:_.isUndefined(n)?i:n,options:e}}),i.getFeatureIconHref=function(e){return o.RoomFeatureManager.getRoomFeatureIcon(e)},i.preferenceChange=function(e){e.category?i.preferenceChangeAction({preferenceCategory:e.roomPreference.roomPreference.categoryCode,preferenceCode:null}):i.preferenceChangeAction({preferenceCategory:e.roomPreference.categoryCode,preferenceCode:e.roomPreference.code}),i.$apply()},i.selectNotifier=o.NotifierHelper.subscribe(i,t,!0,!1),i.preferencesSelectMatchTemplate=o.directiveTemplateUrl("preferences","preferences-select-match"),i.preferencesSelectChoiceTemplate=o.directiveTemplateUrl("preferences","preferences-select-choice"),i.preferencesSelectLabelTemplate=o.directiveTemplateUrl("preferences","preferences-select-label")}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/room-features/room-features-template.html",'<ul class="x-rf__category"> <% if ($item.category) { %> <li class="x-rf__title"><%= $item.category.name %>:</li> <% } %> <% _.each($item.features, function(feature) { %> <li class="x-rf__feature"><svg class="x-rf__feature-icon<%= colorScheme == \'iframe\' ? \' x-rf__feature-icon_on_iframe\' : \'\' %>"><use xlink:href="<%= roomFeatureManager.getRoomFeatureIcon(feature.kind) %>"></use></svg> <%= feature.name %> </li> <% }) %> </ul>'),e.put("directives/room-features/room-features.html",'<div class="x-rf" ng-class="{\'x-rf_undercut\': hidden, \'x-rf_simple\': visualStyle == \'simple\'}"><div class="x-rf__content"><div tl-repeat repeat-items="::sortedFeatures" repeat-template="::featuresTemplate" repeat-update="::featuresNotifier.notifier"></div></div><div ng-if="::undercut" class="x-rf__toggle" ng-class="{\'x-rf__toggle_hidden\': hidden}" ng-click="toggle()"><a ng-show="hidden" class="-normal" tl-message="\'T:common.show\'"></a> <a ng-show="!hidden" class="-normal" tl-message="\'T:common.hide\'"></a></div></div>')}),!function(n){n.directive||(n.directive={});n.registerDirective("tlRoomFeatures",["$q",function(i){return{restrict:"EA",replace:!0,scope:{features:"=",colorScheme:"=?",visualStyle:"=?",undercut:"=?"},templateUrl:"directives/room-features/room-features.html",controller:["$scope",function(e){e.colorScheme=e.colorScheme||"",e.roomFeatureManager=n.RoomFeatureManager;function t(){e.sortedFeatures=e.roomFeatureManager.groupByCategory(e.features)}t(),e.featuresTemplate=n.directiveTemplateUrl("room-features","room-features-template"),e.featuresNotifier=n.NotifierHelper.subscribe(e,i,!0,!1),e.featuresNotifier.onLanguageChanged(function(){t()}),e.hidden=e.undercut,e.toggle=function(){e.hidden=!e.hidden}}]}}])}(tl=tl||{}),!function(e){var r;function t(e,t,i,n){this.scope=e,this.$parse=t,this.$templateCache=i,this.messageFilter=n,this.itemVar="$item",e.$message=n}e.directive||(e.directive={}),t.prototype.getItems=function(){return this.$parse(this.itemsString)(this.scope)||[]},t.prototype.update=function(){var t=this,i="";_.each(this.getItems(),function(e){t.scope[t.itemVar]=e,i+=t.template(t.scope)}),this.parent.innerHTML=i},t.prototype.compile=function(e){var t=this,i=this.$parse(e.getAttribute("repeat-template"))(this.scope);this.template=_.template(this.$templateCache.get(i)),this.itemsString=e.getAttribute("repeat-items"),this.onUpdateAction=this.$parse(e.getAttribute("repeat-update"))(this.scope),this.parent=e.parentNode,e.parentNode.removeChild(e),this.update(),this.onUpdateAction&&this.onUpdateAction(function(){t.update()})},r=t,e.registerDirective("tlRepeat",["$parse","$filter","$templateCache",function(i,e,n){var o=e("message");return{restrict:"EA",scope:!1,replace:!1,link:function(e,t){new r(e,i,n,o).compile(t[0])}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/price-details/price-details.html",'<div class="x-pd"><div class="x-popover__title"><span tl-message="\'T:price_details.price_details\'"></span> <span tl-currency="getCurrency().priceAfterTax" currency-format="%s"></span></div><div class="x-pd__stay-dates" ng-if="::isOneDayStay" tl-message="\'T:common.date_format_long\'" message-params="{date: checkInDate}"></div><div class="x-pd__stay-dates" ng-if="::!isOneDayStay" tl-message="\'T:price_details.title_period\'" message-params="{startDate: checkInDate, endDate: checkOutDate, nights: numNights}" message-html="true"></div><div class="x-pd__body" ng-if="::!isSimplifiedView"><div class="x-pd__slider"><div class="x-pd__slide" ng-repeat="guestPlacements in ::guestPlacementsGroups track by $index"><div class="x-pd__room h6" ng-if="::guestPlacementsGroups.length > 1"><b tl-message="\'T:price_details.room_index\'" message-params="{kind: roomTypeUnit, index: $index + 1}"></b></div><table class="x-pd__details" ng-class="::{\'x-pd__details_repetitive\': guestPlacementsGroups.length > 1}"><thead><tr><td ng-repeat="weekTitle in ::weekTitles track by $index" class="c1 bold" tl-message="weekTitle"></td></tr></thead><tbody ng-repeat="guestPlacement in ::guestPlacements track by $index" ng-init="weeks = getPricesByWeeks(guestPlacement)"><tr ng-if="::!servicesBookingForm"><td class="x-pd__placement" colspan="{{::weekTitles.length}}"><b ng-if="::isSharedAccommodation && guestPlacements.length > 1" tl-message="\'T:price_details.guest_index\'" message-params="{index: $index + 1}"></b> <b ng-if="::!isSharedAccommodation && guestPlacements.length > 1" tl-message="\'T:price_details.accommodation\'" message-params="{index: $index + 1}"></b> <span tl-message="description(guestPlacement)" message-html="true"></span></td></tr><tr ng-repeat="week in ::weeks track by $index"><td ng-repeat="day in ::week track by $index"><div class="x-pd__date c2" ng-class="{\'x-pd__date_inactive\': !day.price}" ng-if="::day.date" ng-bind="\'T:common.date_format_short\' | message: { date: day.date }"></div><div class="c1" ng-if="::day.price" tl-currency="day.price.priceAfterTax" currency-format="%d"></div></td></tr></tbody></table></div></div></div><div ng-if="::isSimplifiedView" class="x-pd__guest-list" ng-repeat="guestPlacements in ::guestPlacementsGroups track by $index"><div ng-if="::guestPlacementsGroups.length > 1"><b tl-message="\'T:price_details.room_index\'" message-params="{kind: roomTypeUnit, index: $index + 1}"></b></div><div class="x-pd__guest" ng-repeat="guestPlacement in ::guestPlacements track by $index"><span tl-message="description(guestPlacement)" message-html="true"></span>&nbsp;— <span ng-if="::guestPlacement.rates[0].price.priceAfterTax.amount == 0" tl-message="\'T:common.free\'"></span><span ng-if="::guestPlacement.rates[0].price.priceAfterTax.amount != 0" tl-currency="guestPlacement.rates[0].price.priceAfterTax"></span> <span ng-if="::guestPlacement.rates[0].price.priceAfterTax.amount != 0" tl-message="\'T:price_details.per_night\'" message-params="{nights: stayUnitKind}"></span></div></div><div class="x-pd__footer"><table class="x-pd__total"><thead><tr><td><div class="x-pd__cost" tl-message="\'T:price-details.cost\'" message-params="{kind: roomTypeUnit}" message-html="true"></div></td><td><div class="x-pd__old" ng-if="::totalPrice.discountAmountAfterTax.amount"><span tl-currency="totalPrice.priceBeforeDiscount.priceBeforeTax" currency-format="%d2"></span></div><div class="bold" tl-currency="totalPrice.priceAfterDiscount.priceBeforeTax" currency-format="%d2"></div></td></tr></thead><tbody class="x-pd__taxes"><tr ng-if="::totalPrice.priceAfterDiscount.tax.amount && !showNetPrices && totalPrice.priceAfterDiscount.taxes.length > 1"><td><b tl-message="\'T:tax.common\'" message-params="{kind: getTaxesUnit(totalPrice.priceAfterDiscount)}"></b></td><td><div class="x-pd__old" ng-if="::totalPrice.priceBeforeDiscount.tax.amount != totalPrice.priceAfterDiscount.tax.amount"><span tl-currency="totalPrice.priceBeforeDiscount.tax" currency-format="%d2"></span></div><div class="bold" tl-currency="totalPrice.priceAfterDiscount.tax" currency-format="%d2"></div></td></tr><tr ng-if="::totalPrice.priceAfterDiscount.tax.amount && !showNetPrices" ng-class="::{\'x-pd__taxes-list\': totalPrice.priceAfterDiscount.taxes.length > 1}" ng-repeat="taxAmount in ::totalPrice.priceAfterDiscount.taxes track by $index"><td tl-message="taxAmount.tax.name || \'&mdash;\'"></td><td><div class="x-pd__old" ng-if="::totalPrice.priceAfterDiscount.taxes.length == 1 && totalPrice.priceBeforeDiscount.tax.amount != totalPrice.priceAfterDiscount.tax.amount"><span tl-currency="totalPrice.priceBeforeDiscount.tax" currency-format="%d2"></span></div><div tl-currency="taxAmount" currency-format="%d2"></div></td></tr></tbody><tbody class="x-pd__taxes-note"><tr ng-if="::(showTaxesDescription && (showNetPrices || !totalPrice.priceAfterDiscount.tax.amount))"><td colspan="2" tl-message="getTaxAndFeeIncludedText()"></td></tr></tbody><tbody ng-if="::(totalPrice.priceAfterDiscount.tax.amount && !showNetPrices)"><tr class="x-pd__price"><td><b class="h6" tl-message="\'T:price-details.total\'"></b></td><td><div class="x-pd__old" ng-if="::totalPrice.discountAmountAfterTax.amount"><span tl-currency="totalPrice.priceBeforeDiscount.priceAfterTax" currency-format="%d2"></span></div><b class="h4" tl-currency="totalPrice.priceAfterDiscount.priceAfterTax" currency-format="%d2"></b></td></tr></tbody></table></div></div>')}),!function(r){r.directive||(r.directive={});r.registerDirective("tlPriceDetails",["tl.messages","locale",function(n,o){return{restrict:"AE",templateUrl:"directives/price-details/price-details.html",replace:!0,scope:{guestPlacementsGroups:"=",numNights:"=",roomTypeUnit:"=",totalPrice:"=",showAgeGroup:"=?"},controller:["$scope",function(i){var t=new r.PlacementUtil(n),e=r.BookingFormSettings.getInstance(),e=(i.servicesBookingForm=e.isServicesBookingForm(),i.weekTitles=_.map(r.DateUtil.getWeekDays(),function(e){return n.getMessage("T:price_details.week_day."+e)}),i.description=function(e){return e.kind==r.GuestPlacementKind.RoomType?n.formatMessage("T:price-details.placement_type",{kind:i.roomTypeUnit}):t.getPlacementDescription(r.PlacementManager.guestPlacementsToPlacement([e]),e.kind,e.ratePlan,i.showAgeGroup||!1)},i.getCurrency=function(){return r.Price.empty(o.currency())},i.showNetPrices=e.showNetPrices,i.showTaxesDescription=e.isTaxesEnabled,i.getTaxesUnit=function(e){return new r.TaxUnit(r.directive.helper.TaxHelper.resolveTaxAmountsKind(e.taxes))},i.getTaxAndFeeIncludedText=function(){var e=i.totalPrice.priceAfterDiscount;return n.formatMessage(e.taxes.length&&i.showNetPrices?"T:tax.not_included":"T:tax.included",{kind:i.getTaxesUnit(e)})},i.getPricesByWeeks=function(e){if(0==(e=e.rates).length)return[];var t=_.minBy(e,function(e){return e.date}).date,i=_.maxBy(e,function(e){return e.date}).date,e=r.DateUtil.makeFullWeeks(e,t,i,function(e){return new r.PlacementRate(t.addDays(-(e+1)),null)},function(e){return new r.PlacementRate(i.addDays(e+1),null)});return r.DateUtil.sliceDaysArrayByWeeks(e)},i.isSharedAccommodation=r.BookingFormSettings.getInstance().isModeTurnedOn(r.BookingFormMode.SharedAccommodationRatePlan),i.isSimplifiedView=!0,_.forEach(_.flatten(i.guestPlacementsGroups),function(e){var t=_.head(e.rates).price;return i.isSimplifiedView=!_.some(e.rates,function(e){return!r.PriceCalculator.equal(t,e.price)}),i.isSimplifiedView}),_.head(_.head(i.guestPlacementsGroups)).rates);i.checkInDate=_.head(e).date,i.checkOutDate=i.checkInDate.addDays(i.numNights.kind==r.StayUnitKind.Day?i.numNights.value-1:i.numNights.value),i.isOneDayStay=i.checkInDate.isEqualDate(i.checkOutDate),i.stayUnitKind=new r.StayDuration(i.numNights.kind,1)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/taxes-modal/taxes-modal.html",'<div class="x-taxes-modal"><div class="x-modal__close" tl-id="pop-close" ng-click="close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" rel="heading"><h1 class="x-modal__title" tl-message="heading"></h1></div><div class="x-modal__content" rel="content"><div class="pretty-text whitespace-preline"><h2 ng-repeat-start="tax in ::taxes track by $index" tl-message="::tax.name"></h2><p ng-if="::tax.description" tl-message="::tax.description" ng-repeat-end></p></div></div><div class="x-modal__controls" rel="controls"><div class="button-group button-group_rtl"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="::close()"></span></div></div></div>')}),!function(t){t.directive||(t.directive={});t.registerDirective("tlTaxesModal",[function(){return{restrict:"EA",templateUrl:"directives/taxes-modal/taxes-modal.html",scope:{taxes:"=",kind:"="},controller:["$scope",function(e){switch(e.close=function(){t.ModalManager.getInstance().close()},e.kind){case t.TaxUnitKind.Tax:e.heading="T:taxes_modal.taxes_info";break;case t.TaxUnitKind.Fee:e.heading="T:taxes_modal.fees_info";break;default:e.heading="T:taxes_modal.taxes_fees_info"}e.taxes=_.map(e.taxes,function(e){return e.tax||e})}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/guest-rate-description/guest-rate-description.html",'<div class="x-grd"><div class="x-grd__count" ng-if="::isIndexed" tl-message="\'T:room_stay_group.guest_index\'" message-params="{index: guestIndex}"></div><div class="x-grd__guest"><div ng-if="::!guestInfo" class="x-grd__placement" tl-message="getPlacementDescription(guestPlacement)" message-html="true"></div><div ng-if="::guestInfo" class="x-grd__placement"><span class="bold" tl-message="guestInfo | tlPersonalName"></span>&#32; <span class="c1" tl-message="getPlacementBedDescription(guestPlacement)" message-html="true"></span></div><div class="x-grd__promo tl-motivator tl-motivator_type_group tl-motivator_type_flag-sharp tl-motivator_type_small" ng-if="::ratePlan.promo"><svg class="tl-motivator__icon tl-motivator__icon_extra-small"><use xlink:href="#unlock"></use></svg><div class="tl-motivator__text" tl-message="\'T:promo.opened_rate_plan\'" message-html="true"></div></div><div class="x-grd__rate-plan" ng-if="::ratePlan"><div tl-fit-image class="x-grd__rate-icon" ng-if="::ratePlan.icon" image="::ratePlan.icon"></div><div class="x-grd__rate-name" tl-message="ratePlan.name"></div></div></div></div>')}),!function(n){n.directive||(n.directive={});n.registerDirective("tlGuestRateDescription",["tl.messages",function(i){return{scope:{guestIndex:"=?",ratePlan:"=?",guestPlacement:"=",guestInfo:"=?"},replace:!0,templateUrl:n.directiveTemplateUrl("guest-rate-description"),controller:["$scope",function(e){e.isIndexed=!_.isUndefined(e.guestIndex);var t=new n.PlacementUtil(i);e.getPlacementDescription=function(e){return t.getPlacementKindDescription(e.kind)},e.getPlacementBedDescription=function(e){return t.getPlacementBedDescription(e.kind)}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/stay-price-caption/stay-price-caption.html",'<div class="x-spc"><div ng-if="::!taxesDescriptionOnly && (!servicesBookingForm || servicesWithPeriod)"><span tl-message="\'T:rooms.price\'"></span> <span tl-message="\'T:rooms.price_for\'" message-params="{nights: stayDuration}" message-html="true"></span></div><div ng-if="::!taxesDescriptionOnly && (servicesBookingForm && !servicesWithPeriod)" tl-message="\'T:rooms.price_date\'" message-params="{date: stayDate}"></div><div class="c1" tl-message="getTaxAndFeeIncludedText()" ng-if="::(showTaxesDescription && !hasTaxesWithDescription)"></div><div ng-if="::(showTaxesDescription && hasTaxesWithDescription)"><a class="x-spc__modal-toggle nobr -normal" tl-message="getTaxAndFeeIncludedText()" ng-click="::openTaxesModal()"></a></div></div>')}),!function(l){var c;c=l.directive||(l.directive={}),l.registerDirective("tlStayPriceCaption",["tl.messages","$q","$compile","serviceFactory",function(o,r,a,s){return{restrict:"EA",scope:{stayDuration:"=?",stayDate:"=?",price:"=",taxesDescriptionOnly:"=?"},templateUrl:"directives/stay-price-caption/stay-price-caption.html",replace:!0,controller:["$scope",function(t){var e=l.BookingFormSettings.getInstance(),i=(t.servicesBookingForm=e.isServicesBookingForm(),t.servicesWithPeriod=t.servicesBookingForm&&e.isServicesWithPeriod(),t.showTaxesDescription=e.isTaxesEnabled&&(!!t.price||t.taxesDescriptionOnly),t.taxes=s.serviceStorage.taxes,t.kind=c.helper.TaxHelper.resolveTaxesKind(t.taxes),t.hasTaxesWithDescription=_.some(t.taxes,function(e){return!!e.description}),t.price?(t.price.priceAfterDiscount||t.price).taxes:[]),n=!!_.filter(i,function(e){return e&&e.tax}).length;t.getTaxAndFeeIncludedText=function(){return t.showTaxesDescription?o.formatMessage(n&&e.showNetPrices?"T:tax.not_included":"T:tax.included",{kind:new l.TaxUnit(t.kind)}):null},t.openTaxesModal=function(){var e=r.when(function(){return a('<tl-taxes-modal taxes="::taxes" kind="::kind" />')(t)[0]});l.ModalManager.getInstance().open(e)}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/compare-bookings/desktop/compare-bookings__desktop.html",'<div class="x-cb"><table class="tl-table"><tbody ng-repeat="mergedRoomStay in ::mergedRoomStays track by $index" ng-init="optionCodes = getComparedOptionsCodes(getRoomStayOptions(mergedRoomStay.item1), getRoomStayOptions(mergedRoomStay.item2));\n               comparedGuestPlacements = !isHotelMode && getComparedGuestPlacements(mergedRoomStay.item1.guestPlacements, mergedRoomStay.item2.guestPlacements)"><tr class="tl-table__head"><td colspan="4"><div class="x-cb__old-room" ng-if="::(mergedRoomStay.item1.roomType.name != mergedRoomStay.item2.roomType.name)"><span class="tl-table__old" tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item1.roomType.kind)}"></span> <span class="tl-table__old" tl-message="mergedRoomStay.item1.roomType.name"></span><div class="x-cb__address" ng-if="::mergedRoomStay.item1.roomType.contactInfo"><span class="weight-normal tl-table__old" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item1.roomType.contactInfo.address()}"></span></div></div><span tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item2.roomType.kind)}"></span> <span tl-message="mergedRoomStay.item2.roomType.name"></span><div ng-if="::mergedRoomStay.item2.roomType.contactInfo" class="weight-normal x-cb__address" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item2.roomType.contactInfo.address()}"></div></td></tr><tr class="tl-table__row" ng-if="::isHotelMode"><td tl-message="\'T:compare_bookings.placement\'"></td><td><div ng-if="::isPlacementChanged(mergedRoomStay.item1, mergedRoomStay.item2)"><span class="tl-table__old" tl-message="getPlacementDescription(mergedRoomStay.item1)" message-html="true"></span></div><span tl-message="getPlacementDescription(mergedRoomStay.item2)" message-html="true"></span></td><td class="tl-table__narrow"><span class="tl-table__old" tl-currency="mergedRoomStay.item1.stayPrice.priceAfterDiscount.priceBeforeTax"></span><div ng-if="::isRatePlanChanged(mergedRoomStay.item1, mergedRoomStay.item2)"><span class="tl-table__old"><span tl-message="\'T:common.rate\'"></span>&#32; <span tl-message="mergedRoomStay.item1.ratePlan.name"></span></span></div></td><td class="tl-table__narrow"><span class="tl-table__price" ng-class="::{\'bold\': isPriceChanged(mergedRoomStay.item1.stayPrice.priceAfterDiscount, mergedRoomStay.item2.stayPrice.priceAfterDiscount)}" tl-currency="mergedRoomStay.item2.stayPrice.priceAfterDiscount.priceBeforeTax"></span><div class="c1" ng-if="::isRatePlanChanged(mergedRoomStay.item1, mergedRoomStay.item2)"><span tl-message="\'T:common.rate\'"></span>&#32; <span tl-message="mergedRoomStay.item2.ratePlan.name"></span></div></td></tr><tr class="tl-table__row" ng-if="::!isHotelMode" ng-repeat="comparedGuestPlacement in ::comparedGuestPlacements track by $index"><td ng-class="::{\'x-cb__valign-row-bottom\': !comparedGuestPlacement.item1 || !comparedGuestPlacement.item2}"><span class="x-cb__badge x-cb__badge_add" ng-if="::(!comparedGuestPlacement.item1 && comparedGuestPlacement.item2)" tl-message="\'T:compare_bookings.would_be_added\'"></span> <span class="x-cb__badge x-cb__badge_remove" ng-if="::(comparedGuestPlacement.item1 && !comparedGuestPlacement.item2)" tl-message="\'T:compare_bookings.would_be_removed\'"></span><div><div ng-class="::{\'tl-table__old\': !comparedGuestPlacement.item2}"><div tl-message="\'T:compare_bookings.shared_rate\'"></div><div tl-message="getGuestPlacementDescription(comparedGuestPlacement.item1 || comparedGuestPlacement.item2)" message-html="true"></div></div></div></td><td><span ng-if="::(isRatePlanChanged(comparedGuestPlacement.item1, comparedGuestPlacement.item2) && comparedGuestPlacement.item1)" class="tl-table__old" tl-message="comparedGuestPlacement.item1.ratePlan.name"></span><div ng-if="::comparedGuestPlacement.item2" tl-message="comparedGuestPlacement.item2.ratePlan.name"></div></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::comparedGuestPlacement.item1" tl-currency="comparedGuestPlacement.item1.price.priceAfterDiscount.priceAfterTax"></span> <span ng-if="::!comparedGuestPlacement.item1">&mdash;</span></td><td class="tl-table__narrow" ng-class="::{\'bold\': isPriceChanged(comparedGuestPlacement.item1.price.priceAfterDiscount, comparedGuestPlacement.item2.price.priceAfterDiscount)}"><span ng-if="::comparedGuestPlacement.item2" tl-currency="comparedGuestPlacement.item2.price.priceAfterDiscount.priceAfterTax"></span> <span ng-if="::!comparedGuestPlacement.item2">&mdash;</span></td></tr><tr class="tl-table__row" ng-if="::(mergedRoomStay.item1.arrivalExtraStay.priceAfterTax.amount || mergedRoomStay.item2.arrivalExtraStay.priceAfterTax.amount)"><td tl-message="\'T:compare_bookings.early_arrival\'"></td><td tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.startDate}"></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::mergedRoomStay.item1.arrivalExtraStay" tl-currency="mergedRoomStay.item1.arrivalExtraStay.priceAfterTax"></span> <span class="tl-table__old" ng-if="::!mergedRoomStay.item1.arrivalExtraStay" tl-message="\'T:compare_bookings.free\'"></span></td><td class="tl-table__narrow" ng-class="::{\'bold\': isPriceChanged(mergedRoomStay.item1.arrivalExtraStay, mergedRoomStay.item2.arrivalExtraStay)}"><span ng-if="::mergedRoomStay.item2.arrivalExtraStay" tl-currency="mergedRoomStay.item2.arrivalExtraStay.priceAfterTax"></span> <span ng-if="::!mergedRoomStay.item2.arrivalExtraStay" tl-message="\'T:compare_bookings.free\'"></span></td></tr><tr class="tl-table__row" ng-if="::(mergedRoomStay.item1.departureExtraStay.priceAfterTax.amount || mergedRoomStay.item2.departureExtraStay.priceAfterTax.amount)"><td tl-message="\'T:compare_bookings.late_departure\'"></td><td><div tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.endDate}"></div></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::mergedRoomStay.item1.departureExtraStay" tl-currency="mergedRoomStay.item1.departureExtraStay.priceAfterTax"></span> <span class="tl-table__old" ng-if="::!mergedRoomStay.item1.departureExtraStay" tl-message="\'T:compare_bookings.free\'"></span></td><td class="tl-table__narrow" ng-class="::{\'bold\': isPriceChanged(mergedRoomStay.item1.departureExtraStay, mergedRoomStay.item2.departureExtraStay)}"><span ng-if="::mergedRoomStay.item2.departureExtraStay" tl-currency="mergedRoomStay.item2.departureExtraStay.priceAfterTax"></span> <span ng-if="::!mergedRoomStay.item2.departureExtraStay" tl-message="\'T:compare_bookings.free\'"></span></td></tr><tr class="tl-table__row" ng-repeat="optionCode in ::optionCodes track by $index"><td ng-class="::{\'x-cb__valign-row-bottom\': !optionCode.item1 || !optionCode.item2}"><span class="x-cb__badge x-cb__badge_add" ng-if="::!optionCode.item1 && optionCode.item2" tl-message="\'T:compare_bookings.would_be_added\'"></span> <span class="x-cb__badge x-cb__badge_remove" ng-if="::optionCode.item1 && !optionCode.item2" tl-message="\'T:compare_bookings.would_be_removed\'"></span><div><span ng-class="::{\'tl-table__old\': !optionCode.item2}" tl-message="getOptionName(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)) || getOptionName(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))"></span></div></td><td><span ng-if="::isOptionChanged(\n              optionCode.item1,\n              optionCode.item2,\n              getRoomStayOptions(mergedRoomStay.item1),\n              getRoomStayOptions(mergedRoomStay.item2)\n            ) && optionCode.item1" class="tl-table__old" tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))}"></span><div ng-if="::optionCode.item2" tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))}"></div></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::optionCode.item1 && !isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-currency="getOptionPrice(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)).priceAfterTax"></span> <span class="tl-table__old" ng-if="::optionCode.item1 && isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> <span ng-if="::!optionCode.item1">&mdash;</span></td><td class="tl-table__narrow" ng-class="::{\'bold\': isOptionChanged(\n            optionCode.item1,\n            optionCode.item2,\n            getRoomStayOptions(mergedRoomStay.item1),\n            getRoomStayOptions(mergedRoomStay.item2)\n          ) && optionCode.item2}"><span ng-if="::optionCode.item2 && !isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-currency="getOptionPrice(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2)).priceAfterTax"></span> <span ng-if="::optionCode.item2 && isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> <span ng-if="::!optionCode.item2">&mdash;</span></td></tr></tbody><tbody ng-if="::(booking.total.priceAfterDiscount.tax.amount || comparedBooking.total.priceAfterDiscount.tax.amount)" ng-init="comparedTaxes = getComparedTaxes(booking.total.priceAfterDiscount.taxes, comparedBooking.total.priceAfterDiscount.taxes)"><tr class="tl-table__head"><td colspan="4"><div tl-message="\'T:compare_bookings.taxes_per_stay\'" message-params="{kind: getTaxesUnit(comparedBooking.total.priceAfterDiscount)}"></div><a class="c1 -normal" tl-message="\'T:common.show\'" ng-if="::hasTaxesWithDescription(comparedTaxes)" ng-click="::openTaxesModal(comparedTaxes, getTaxesKind(comparedBooking.total.priceAfterDiscount))"></a></td></tr><tr class="tl-table__row" ng-repeat="comparedBookingTax in ::comparedTaxes track by $index"><td></td><td><div class="x-cb__tax-info"><span tl-message="comparedBookingTax.item1.tax.name || comparedBookingTax.item2.tax.name"></span><div tl-tax-popover class="x-cb__tax-popover" tax-amount="comparedBookingTax.item1 || comparedBookingTax.item2" ng-if="::(comparedBookingTax.item1.tax.description || comparedBookingTax.item2.tax.description)"></div></div></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::comparedBookingTax.item1" tl-currency="comparedBookingTax.item1"></span> <span class="c1" ng-if="::!comparedBookingTax.item1">&mdash;</span></td><td class="tl-table__narrow"><span ng-if="::comparedBookingTax.item2" ng-class="::{\'bold\': isTaxChanged(comparedBookingTax.item1, comparedBookingTax.item2)}" tl-currency="comparedBookingTax.item2"></span> <span ng-if="::!comparedBookingTax.item2">&mdash;</span></td></tr></tbody><tbody ng-if="::comparedBooking.transfers.length"><tr class="tl-table__head"><td colspan="4" tl-message="\'T:compare_bookings.transfers\'"></td></tr><tr class="tl-table__row" ng-repeat="bookingTransfer in ::comparedBooking.transfers track by $index"><td tl-message="bookingTransfer.transfer.name"></td><td tl-message="\'T:order_info.vehicle\'" message-params="{count: bookingTransfer.getQuantity()}"></td><td class="tl-table__narrow"><span class="tl-table__old" tl-currency="bookingTransfer.getTotalPrice().priceAfterTax"></span></td><td class="tl-table__narrow"><span tl-currency="bookingTransfer.getTotalPrice().priceAfterTax"></span></td></tr></tbody><tbody ng-if="::booking.options.length || comparedBooking.options.length" ng-init="bookingOptionsCodes = getComparedOptionsCodes(booking.options, comparedBooking.options)"><tr class="tl-table__head"><td colspan="4" tl-message="\'T:compare_bookings.booking_options\'"></td></tr><tr class="tl-table__row" ng-repeat="bookingOptionsCode in ::bookingOptionsCodes track by $index"><td ng-class="::{\'x-cb__valign-row-bottom\': !bookingOptionsCode.item1 || !bookingOptionsCode.item2}"><span class="x-cb__badge x-cb__badge_add" ng-if="::!bookingOptionsCode.item1 && bookingOptionsCode.item2" tl-message="\'T:compare_bookings.would_be_added\'"></span> <span class="x-cb__badge x-cb__badge_remove" ng-if="::bookingOptionsCode.item1 && !bookingOptionsCode.item2" tl-message="\'T:compare_bookings.would_be_removed\'"></span><div><span ng-class="::{\'tl-table__old\': !bookingOptionsCode.item2}" tl-message="getOptionName(bookingOptionsCode.item1, booking.options) || getOptionName(bookingOptionsCode.item2, comparedBooking.options)"></span></div></td><td></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::bookingOptionsCode.item1" tl-currency="getOptionPrice(bookingOptionsCode.item1, booking.options).priceAfterTax"></span> <span ng-if="::!bookingOptionsCode.item1">&mdash;</span></td><td class="tl-table__narrow" ng-class="::{\'bold\': isOptionChanged(\n            bookingOptionsCode.item1,\n            bookingOptionsCode.item2,\n            booking.options,\n            comparedBooking.options\n          )}"><span ng-if="::bookingOptionsCode.item2" tl-currency="getOptionPrice(bookingOptionsCode.item2, comparedBooking.options).priceAfterTax"></span> <span ng-if="::!bookingOptionsCode.item2">&mdash;</span></td></tr></tbody><tbody><tr class="tl-table__row tl-table__row_active" ng-if="::!isHotelMode && hasDiscount(booking.total, comparedBooking.total)"><td colspan="2"><b class="tl-table__payment" tl-message="\'T:compare_bookings.discount\'"></b></td><td class="tl-table__narrow"><span class="tl-table__old" tl-currency="booking.total.discountAmountBeforeTax"></span></td><td class="tl-table__narrow bold"><span class="tl-table__price tl-table__price_highlighted" tl-currency="comparedBooking.total.discountAmountBeforeTax"></span></td></tr><tr class="tl-table__row tl-table__row_active"><td colspan="2"><b class="tl-table__payment" tl-message="\'T:compare_bookings.total\'"></b></td><td class="tl-table__narrow"><span class="tl-table__old h6" tl-currency="booking.total.priceAfterDiscount.priceAfterTax"></span></td><td class="tl-table__narrow"><span class="tl-table__total" tl-currency="comparedBooking.total.priceAfterDiscount.priceAfterTax"></span></td></tr></tbody></table></div>'),e.put("directives/compare-bookings/desktop/compare-bookings-room-deleted__desktop.html",'<div class="x-cbrd"><table class="tl-table"><tbody ng-repeat="mergedRoomStay in ::mergedRoomStays track by $index" ng-init="optionCodes = getComparedOptionsCodes(getRoomStayOptions(mergedRoomStay.item1), getRoomStayOptions(mergedRoomStay.item2));"><tr class="tl-table__head"><td colspan="3"><div ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span class="x-cb__badge x-cb__badge_remove" tl-message="\'T:compare_bookings.would_be_removed\'"></span></div><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item1.roomType.kind)}"></span> <span tl-message="mergedRoomStay.item1.roomType.name"></span></span><div class="weight-normal x-cbrd__address" ng-if="::((mergedRoomStay.item1 && !mergedRoomStay.item2) && mergedRoomStay.item1.roomType.contactInfo)"><span class="tl-table__old" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item1.roomType.contactInfo.address()}"></span></div><span ng-if="::mergedRoomStay.item2"><span tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item2.roomType.kind)}"></span> <span tl-message="mergedRoomStay.item2.roomType.name"></span></span><div class="weight-normal x-cbrd__address" ng-if="::(mergedRoomStay.item2 && mergedRoomStay.item2.roomType.contactInfo)" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item2.roomType.contactInfo.address()}"></div></td></tr><tr class="tl-table__row"><td><span tl-message="\'T:compare_bookings.placement\'" ng-class="::{\'tl-table__old\': !mergedRoomStay.item2}"></span></td><td><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-message="getPlacementDescription(mergedRoomStay.item1)" message-html="true"></span><span ng-if="::mergedRoomStay.item2" tl-message="getPlacementDescription(mergedRoomStay.item2)" message-html="true"></span></td><td class="tl-table__narrow"><span class="tl-table__price tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-currency="mergedRoomStay.item1.stayPrice.priceAfterDiscount.priceBeforeTax"></span><span class="tl-table__price" ng-if="::mergedRoomStay.item2" tl-currency="mergedRoomStay.item2.stayPrice.priceAfterDiscount.priceBeforeTax"></span></td></tr><tr class="tl-table__row" ng-if="::(mergedRoomStay.item1.arrivalExtraStay.priceAfterTax.amount || mergedRoomStay.item2.arrivalExtraStay.priceAfterTax.amount)"><td><span tl-message="\'T:compare_bookings.early_arrival\'" ng-class="::{\'tl-table__old\': !mergedRoomStay.item2}"></span></td><td><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item1.stayDates.startDate}"></span><span ng-if="::mergedRoomStay.item2" tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.startDate}"></span></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-currency="mergedRoomStay.item1.arrivalExtraStay.priceAfterTax"></span><span ng-if="::mergedRoomStay.item2" tl-currency="mergedRoomStay.item2.arrivalExtraStay.priceAfterTax"></span></td></tr><tr class="tl-table__row" ng-if="::(mergedRoomStay.item1.departureExtraStay.priceAfterTax.amount || mergedRoomStay.item2.departureExtraStay.priceAfterTax.amount)"><td><span tl-message="\'T:compare_bookings.late_departure\'" ng-class="::{\'tl-table__old\': !mergedRoomStay.item2}"></span></td><td><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item1.stayDates.endDate}"></span><span ng-if="::mergedRoomStay.item2" tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.endDate}"></span></td><td class="tl-table__narrow"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-currency="mergedRoomStay.item1.departureExtraStay.priceAfterTax"></span><span ng-if="::mergedRoomStay.item2" tl-currency="mergedRoomStay.item2.departureExtraStay.priceAfterTax"></span></td></tr><tr class="tl-table__row" ng-repeat="optionCode in ::optionCodes track by $index"><td><span ng-class="::{\'tl-table__old\': !optionCode.item2}" tl-message="getOptionName(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)) || getOptionName(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))"></span></td><td><span ng-if="::optionCode.item1 && !optionCode.item2" class="tl-table__old" tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))}"></span><span ng-if="::optionCode.item2" tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))}"></span></td><td class="tl-table__narrow"><span ng-if="::optionCode.item1 && !optionCode.item2"><span class="tl-table__old" ng-if="::!isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-currency="getOptionPrice(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)).priceAfterTax"></span> <span class="tl-table__old" ng-if="::isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> </span><span ng-if="::optionCode.item2"><span ng-if="::!isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-currency="getOptionPrice(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2)).priceAfterTax"></span> <span ng-if="::isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span></span></td></tr></tbody><tbody ng-if="::(booking.total.priceAfterDiscount.tax.amount || comparedBooking.total.priceAfterDiscount.tax.amount)" ng-init="comparedTaxes = getComparedTaxes(booking.total.priceAfterDiscount.taxes, comparedBooking.total.priceAfterDiscount.taxes)"><tr class="tl-table__head"><td colspan="3" ng-init="taxesUnit = getTaxesUnit(booking.total.priceAfterDiscount) || getTaxesUnit(comparedBooking.total.priceAfterDiscount)"><div tl-message="\'T:compare_bookings.taxes_per_stay\'" message-params="{kind: taxesUnit}"></div><a class="c1 -normal" tl-message="\'T:common.show\'" ng-if="::hasTaxesWithDescription(comparedTaxes)" ng-click="::openTaxesModal(comparedTaxes, taxesUnit.kind)"></a></td></tr><tr class="tl-table__row" ng-repeat="comparedBookingTax in ::comparedTaxes track by $index"><td><div class="x-cbrd__tax-info"><span tl-message="comparedBookingTax.item1.tax.name || comparedBookingTax.item2.tax.name"></span><div tl-tax-popover class="x-cbrd__tax-popover" tax-amount="comparedBookingTax.item1 || comparedBookingTax.item2" ng-if="::comparedBookingTax.item1.tax.description || comparedBookingTax.item2.tax.description"></div></div></td><td></td><td class="tl-table__narrow"><div><span class="tl-table__old" ng-if="::comparedBookingTax.item1" tl-currency="comparedBookingTax.item1"></span> <span ng-if="::!comparedBookingTax.item1">&mdash;</span></div><span ng-if="::comparedBookingTax.item2" tl-currency="comparedBookingTax.item2"></span> <span class="tl-table__price" ng-if="::!comparedBookingTax.item2">&mdash;</span></td></tr></tbody><tbody ng-if="::booking.transfers.length"><tr class="tl-table__head"><td colspan="3" tl-message="\'T:compare_bookings.transfers\'"></td></tr><tr class="tl-table__row" ng-repeat="bookingTransfer in ::booking.transfers track by $index"><td tl-message="bookingTransfer.transfer.name"></td><td tl-message="\'T:order_info.vehicle\'" message-params="{count: bookingTransfer.getQuantity()}"></td><td class="tl-table__narrow"><span tl-currency="bookingTransfer.getTotalPrice().priceAfterTax"></span></td></tr></tbody><tbody ng-if="::booking.options.length"><tr class="tl-table__head"><td colspan="3" tl-message="\'T:compare_bookings.booking_options\'"></td></tr><tr class="tl-table__row" ng-repeat="bookingOption in ::booking.options track by $index"><td tl-message="bookingOption.name()"></td><td tl-message="\'T:compare_bookings.count\'" message-params="{count: bookingOption.quantity()}"></td><td class="tl-table__narrow" tl-currency="bookingOption.getPrice().priceAfterTax"></td></tr></tbody><tbody><tr class="tl-table__row tl-table__row_active" ng-if="::!isHotelMode && hasDiscount(booking.total, comparedBooking.total)"><td><b class="tl-table__payment" tl-message="\'T:compare_bookings.discount\'"></b></td><td class="tl-table__narrow"><span class="tl-table__old" tl-currency="booking.total.discountAmountBeforeTax"></span></td><td class="tl-table__narrow bold"><span class="tl-table__price tl-table__price_highlighted" tl-currency="comparedBooking.total.discountAmountBeforeTax"></span></td></tr><tr class="tl-table__row tl-table__row_active"><td><b class="tl-table__payment" tl-message="\'T:compare_bookings.total\'"></b></td><td class="tl-table__narrow"><span class="tl-table__old h6" tl-currency="booking.total.priceAfterDiscount.priceAfterTax"></span></td><td class="tl-table__narrow"><span class="tl-table__total" tl-currency="comparedBooking.total.priceAfterDiscount.priceAfterTax"></span></td></tr></tbody></table></div>'),e.put("directives/compare-bookings/phone/compare-bookings__phone.html",'<div class="x-cb"><div class="tl-table" ng-repeat="mergedRoomStay in ::mergedRoomStays track by $index" ng-init="optionCodes = getComparedOptionsCodes(getRoomStayOptions(mergedRoomStay.item1), getRoomStayOptions(mergedRoomStay.item2));\n             comparedGuestPlacements = !isHotelMode && getComparedGuestPlacements(mergedRoomStay.item1.guestPlacements, mergedRoomStay.item2.guestPlacements)"><div class="tl-table__title"><div class="x-cb__old-room" ng-if="::(mergedRoomStay.item1.roomType.name != mergedRoomStay.item2.roomType.name)"><span class="tl-table__old" tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item1.roomType.kind)}"></span> <span class="tl-table__old" tl-message="mergedRoomStay.item1.roomType.name"></span><div class="x-cb__address" ng-if="::mergedRoomStay.item1.roomType.contactInfo"><span class="weight-normal tl-table__old" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item1.roomType.contactInfo.address()}"></span></div></div><span tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item2.roomType.kind)}"></span> <span tl-message="mergedRoomStay.item2.roomType.name"></span><div ng-if="::mergedRoomStay.item2.roomType.contactInfo" class="weight-normal x-cb__address" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item2.roomType.contactInfo.address()}"></div></div><div class="tl-table__data" ng-if="::isHotelMode"><div class="tl-table__key"><div tl-message="\'T:compare_bookings.placement\'"></div><div class="tl-table__key-row" ng-if="::isPlacementChanged(mergedRoomStay.item1, mergedRoomStay.item2)"><span class="tl-table__old" tl-message="getPlacementDescription(mergedRoomStay.item1)" message-html="true"></span></div><div class="tl-table__key-row" tl-message="getPlacementDescription(mergedRoomStay.item2)" message-html="true"></div></div><div class="tl-table__value"><div><span class="tl-table__old" tl-currency="mergedRoomStay.item1.stayPrice.priceAfterDiscount.priceBeforeTax"></span><div ng-if="::isRatePlanChanged(mergedRoomStay.item1, mergedRoomStay.item2)"><span class="tl-table__old"><span tl-message="\'T:common.rate\'"></span>&#32; <span tl-message="mergedRoomStay.item1.ratePlan.name"></span></span></div></div><div><div class="tl-table__price" ng-class="::{\'bold\': isPriceChanged(mergedRoomStay.item1.stayPrice.priceAfterDiscount, mergedRoomStay.item2.stayPrice.priceAfterDiscount)}" tl-currency="mergedRoomStay.item2.stayPrice.priceAfterDiscount.priceBeforeTax"></div><div class="c1" ng-if="::isRatePlanChanged(mergedRoomStay.item1, mergedRoomStay.item2)"><span tl-message="\'T:common.rate\'"></span>&#32; <span tl-message="mergedRoomStay.item2.ratePlan.name"></span></div></div></div></div><div class="tl-table__data" ng-if="::!isHotelMode" ng-repeat="comparedGuestPlacement in ::comparedGuestPlacements track by $index"><div class="tl-table__banner-wrapper"><div class="tl-table__banner" ng-if="::(!comparedGuestPlacement.item1 || !comparedGuestPlacement.item2)"><span class="x-cb__badge x-cb__badge_add" ng-if="::(!comparedGuestPlacement.item1 && comparedGuestPlacement.item2)" tl-message="\'T:compare_bookings.would_be_added\'"></span> <span class="x-cb__badge x-cb__badge_remove" ng-if="::(comparedGuestPlacement.item1 && !comparedGuestPlacement.item2)" tl-message="\'T:compare_bookings.would_be_removed\'"></span></div><div class="tl-table__banner-data"><div class="tl-table__key"><div ng-class="::{\'tl-table__old\': !comparedGuestPlacement.item2}"><div tl-message="\'T:compare_bookings.shared_rate\'"></div><div tl-message="getGuestPlacementDescription(comparedGuestPlacement.item1 || comparedGuestPlacement.item2)" message-html="true"></div></div><div class="tl-table__key-row tl-table__old" ng-if="::(isRatePlanChanged(comparedGuestPlacement.item1, comparedGuestPlacement.item2) && comparedGuestPlacement.item1)" tl-message="comparedGuestPlacement.item1.ratePlan.name"></div><div class="tl-table__key-row" ng-if="::comparedGuestPlacement.item2" tl-message="comparedGuestPlacement.item2.ratePlan.name"></div></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::comparedGuestPlacement.item1" tl-currency="comparedGuestPlacement.item1.price.priceAfterDiscount.priceAfterTax"></span> <span ng-if="::!comparedGuestPlacement.item1">&mdash;</span><div class="tl-table__current" ng-class="::{\'bold\': isPriceChanged(comparedGuestPlacement.item1.price.priceAfterDiscount, comparedGuestPlacement.item2.price.priceAfterDiscount)}"><span ng-if="::comparedGuestPlacement.item2" tl-currency="comparedGuestPlacement.item2.price.priceAfterDiscount.priceAfterTax"></span> <span ng-if="::!comparedGuestPlacement.item2">&mdash;</span></div></div></div></div></div><div class="tl-table__data" ng-if="::(mergedRoomStay.item1.arrivalExtraStay.priceAfterTax.amount || mergedRoomStay.item2.arrivalExtraStay.priceAfterTax.amount)"><div class="tl-table__key"><div tl-message="\'T:compare_bookings.early_arrival\'"></div><div class="tl-table__key-row" tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.startDate}"></div></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::mergedRoomStay.item1.arrivalExtraStay" tl-currency="mergedRoomStay.item1.arrivalExtraStay.priceAfterTax"></span> <span class="tl-table__old" ng-if="::!mergedRoomStay.item1.arrivalExtraStay" tl-message="\'T:compare_bookings.free\'"></span><div class="tl-table__current" ng-class="::{\'bold\': isPriceChanged(mergedRoomStay.item1.arrivalExtraStay, mergedRoomStay.item2.arrivalExtraStay)}"><span ng-if="::mergedRoomStay.item2.arrivalExtraStay" tl-currency="mergedRoomStay.item2.arrivalExtraStay.priceAfterTax"></span> <span ng-if="::!mergedRoomStay.item2.arrivalExtraStay" tl-message="\'T:compare_bookings.free\'"></span></div></div></div><div class="tl-table__data" ng-if="::(mergedRoomStay.item1.departureExtraStay.priceAfterTax.amount || mergedRoomStay.item2.departureExtraStay.priceAfterTax.amount)"><div class="tl-table__key"><div tl-message="\'T:compare_bookings.late_departure\'"></div><div class="tl-table__key-row" tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.endDate}"></div></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::mergedRoomStay.item1.departureExtraStay" tl-currency="mergedRoomStay.item1.departureExtraStay.priceAfterTax"></span> <span class="tl-table__old" ng-if="::!mergedRoomStay.item1.departureExtraStay" tl-message="\'T:compare_bookings.free\'"></span><div class="tl-table__current" ng-class="::{\'bold\': isPriceChanged(mergedRoomStay.item1.departureExtraStay, mergedRoomStay.item2.departureExtraStay)}"><span ng-if="::mergedRoomStay.item2.departureExtraStay" tl-currency="mergedRoomStay.item2.departureExtraStay.priceAfterTax"></span> <span ng-if="::!mergedRoomStay.item2.departureExtraStay" tl-message="\'T:compare_bookings.free\'"></span></div></div></div><div class="tl-table__data" ng-repeat="optionCode in ::optionCodes track by $index"><div class="tl-table__banner-wrapper"><div class="tl-table__banner" ng-if="::!optionCode.item1 || !optionCode.item2"><span class="x-cb__badge x-cb__badge_add" ng-if="::!optionCode.item1 && optionCode.item2" tl-message="\'T:compare_bookings.would_be_added\'"></span> <span class="x-cb__badge x-cb__badge_remove" ng-if="::optionCode.item1 && !optionCode.item2" tl-message="\'T:compare_bookings.would_be_removed\'"></span></div><div class="tl-table__banner-data"><div class="tl-table__key"><div ng-class="::{\'tl-table__old\': !optionCode.item2}" tl-message="getOptionName(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)) || getOptionName(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))"></div><div class="tl-table__key-row" ng-if="::isOptionChanged(\n                optionCode.item1,\n                optionCode.item2,\n                getRoomStayOptions(mergedRoomStay.item1),\n                getRoomStayOptions(mergedRoomStay.item2)\n              ) && optionCode.item1"><span class="tl-table__old" tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))}"></span></div><div class="tl-table__key-row" ng-if="::optionCode.item2"><span tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))}"></span></div></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::optionCode.item1 && !isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-currency="getOptionPrice(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)).priceAfterTax"></span> <span class="tl-table__old" ng-if="::optionCode.item1 && isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> <span ng-if="::!optionCode.item1">&mdash;</span><div class="tl-table__current" ng-class="::{\'bold\': isOptionChanged(\n                optionCode.item1,\n                optionCode.item2,\n                getRoomStayOptions(mergedRoomStay.item1),\n                getRoomStayOptions(mergedRoomStay.item2)\n              )"><span ng-if="::optionCode.item2 && !isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-currency="getOptionPrice(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2)).priceAfterTax"></span> <span ng-if="::optionCode.item2 && isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> <span ng-if="::!optionCode.item2">&mdash;</span></div></div></div></div></div></div><div class="tl-table" ng-if="::(booking.total.priceAfterDiscount.tax.amount || comparedBooking.total.priceAfterDiscount.tax.amount)" ng-init="comparedTaxes = getComparedTaxes(booking.total.priceAfterDiscount.taxes, comparedBooking.total.priceAfterDiscount.taxes)"><div class="tl-table__title"><div tl-message="\'T:compare_bookings.taxes_per_stay\'" message-params="{kind: getTaxesUnit(comparedBooking.total.priceAfterDiscount)}"></div><a class="c1 -normal" tl-message="\'T:common.show\'" ng-if="::hasTaxesWithDescription(comparedTaxes)" ng-click="::openTaxesModal(comparedTaxes, getTaxesKind(comparedBooking.total.priceAfterDiscount))"></a></div><div class="tl-table__data" ng-repeat="comparedBookingTax in ::comparedTaxes track by $index"><div class="tl-table__key x-cb__tax-info"><span tl-message="comparedBookingTax.item1.tax.name || comparedBookingTax.item2.tax.name"></span><div tl-tax-popover class="x-cb__tax-popover" tax-amount="comparedBookingTax.item1 || comparedBookingTax.item2" ng-if="::(comparedBookingTax.item1.tax.description || comparedBookingTax.item2.tax.description)"></div></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::comparedBookingTax.item1" tl-currency="comparedBookingTax.item1"></span> <span class="c1" ng-if="::!comparedBookingTax.item1">&mdash;</span><div class="tl-table__current"><span ng-if="::comparedBookingTax.item2" ng-class="::{\'bold\': isTaxChanged(comparedBookingTax.item1, comparedBookingTax.item2)}" tl-currency="comparedBookingTax.item2"></span> <span ng-if="::!comparedBookingTax.item2">&mdash;</span></div></div></div></div><div class="tl-table" ng-if="::comparedBooking.transfers.length"><div class="tl-table__title" tl-message="\'T:compare_bookings.transfers\'"></div><div class="tl-table__data" ng-repeat="bookingTransfer in ::comparedBooking.transfers track by $index"><div class="tl-table__key"><div tl-message="bookingTransfer.transfer.name"></div><div class="tl-table__key-row" tl-message="\'T:order_info.vehicle\'" message-params="{count: bookingTransfer.getQuantity()}"></div></div><div class="tl-table__value"><span class="tl-table__old" tl-currency="bookingTransfer.getTotalPrice().priceAfterTax"></span><div class="tl-table__current" tl-currency="bookingTransfer.getTotalPrice().priceAfterTax"></div></div></div></div><div class="tl-table" ng-if="::(booking.options.length || comparedBooking.options.length)" ng-init="bookingOptionsCodes = getComparedOptionsCodes(booking.options, comparedBooking.options)"><div class="tl-table__title" tl-message="\'T:compare_bookings.booking_options\'"></div><div class="tl-table__data" ng-repeat="bookingOptionsCode in ::bookingOptionsCodes track by $index"><div class="tl-table__banner-wrapper"><div class="tl-table__banner" ng-if="::!bookingOptionsCode.item1 || !bookingOptionsCode.item2"><span class="x-cb__badge x-cb__badge_add" ng-if="::!bookingOptionsCode.item1 && bookingOptionsCode.item2" tl-message="\'T:compare_bookings.would_be_added\'"></span> <span class="x-cb__badge x-cb__badge_remove" ng-if="::bookingOptionsCode.item1 && !bookingOptionsCode.item2" tl-message="\'T:compare_bookings.would_be_removed\'"></span></div><div class="tl-table__banner-data"><div class="tl-table__key"><div ng-class="::{\'tl-table__old\': !bookingOptionsCode.item2}" tl-message="getOptionName(bookingOptionsCode.item1, booking.options) || getOptionName(bookingOptionsCode.item2, comparedBooking.options)"></div></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::bookingOptionsCode.item1 && !isOptionInclusive(bookingOptionsCode.item1, booking.options)" tl-currency="getOptionPrice(bookingOptionsCode.item1, booking.options).priceAfterTax"></span> <span class="tl-table__old" ng-if="::bookingOptionsCode.item1 && isOptionInclusive(bookingOptionsCode.item1, booking.options)" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> <span ng-if="::!bookingOptionsCode.item1">&mdash;</span><div class="tl-table__current" ng-class="::{\'bold\': isOptionChanged(\n                bookingOptionsCode.item1,\n                bookingOptionsCode.item2,\n                booking.options,\n                comparedBooking.options\n              )"><span ng-if="::bookingOptionsCode.item2 && !isOptionInclusive(bookingOptionsCode.item2, comparedBooking.options)" tl-currency="getOptionPrice(bookingOptionsCode.item2, comparedBooking.options).priceAfterTax"></span> <span ng-if="::bookingOptionsCode.item2 && isOptionInclusive(bookingOptionsCode.item2, comparedBooking.options)" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> <span ng-if="::!bookingOptionsCode.item2">&mdash;</span></div></div></div></div></div></div><div class="tl-table"><div class="tl-table__data tl-table__data_highlighted" ng-if="::!isHotelMode && hasDiscount(booking.total, comparedBooking.total)"><div class="tl-table__key"><b tl-message="\'T:compare_bookings.discount\'"></b></div><div class="tl-table__value"><div class="tl-table__old" tl-currency="booking.total.discountAmountBeforeTax"></div><div class="tl-table__current tl-table__price_highlighted bold" tl-currency="comparedBooking.total.discountAmountBeforeTax"></div></div></div><div class="tl-table__data tl-table__data_highlighted"><div class="tl-table__key"><b tl-message="\'T:compare_bookings.total\'"></b></div><div class="tl-table__value"><div class="tl-table__old" tl-currency="booking.total.priceAfterDiscount.priceAfterTax"></div><div class="tl-table__current tl-table__total h5" tl-currency="comparedBooking.total.priceAfterDiscount.priceAfterTax"></div></div></div></div></div>'),e.put("directives/compare-bookings/phone/compare-bookings-room-deleted__phone.html",'<div class="x-cbrd"><div class="tl-table" ng-repeat="mergedRoomStay in ::mergedRoomStays track by $index" ng-class="::{\'x-cbrd__removed\': mergedRoomStay.item1 && !mergedRoomStay.item2}" ng-init="optionCodes = getComparedOptionsCodes(getRoomStayOptions(mergedRoomStay.item1), getRoomStayOptions(mergedRoomStay.item2));"><div class="tl-table__title"><div ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span class="x-cb__badge x-cb__badge_remove" tl-message="\'T:compare_bookings.would_be_removed\'"></span></div><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item1.roomType.kind)}"></span> <span tl-message="mergedRoomStay.item1.roomType.name"></span></span><div class="weight-normal x-cbrd__address" ng-if="::((mergedRoomStay.item1 && !mergedRoomStay.item2) && mergedRoomStay.item1.roomType.contactInfo)"><span class="tl-table__old" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item1.roomType.contactInfo.address()}"></span></div><span ng-if="::mergedRoomStay.item2"><span tl-message="\'T:compare_bookings.room\'" message-params="{index: $index + 1, kind: getRoomTypeUnit(mergedRoomStay.item2.roomType.kind)}"></span> <span tl-message="mergedRoomStay.item2.roomType.name"></span></span><div class="weight-normal x-cbrd__address" ng-if="::(mergedRoomStay.item2 && mergedRoomStay.item2.roomType.contactInfo)" tl-message="\'T:common.address\'" message-params="{address: mergedRoomStay.item2.roomType.contactInfo.address()}"></div></div><div class="tl-table__data"><div class="tl-table__key"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span tl-message="\'T:compare_bookings.placement\'"></span> <span tl-message="getPlacementDescription(mergedRoomStay.item1)" message-html="true"></span> </span><span ng-if="::mergedRoomStay.item2"><span tl-message="\'T:compare_bookings.placement\'"></span> <span tl-message="getPlacementDescription(mergedRoomStay.item2)" message-html="true"></span></span></div><div class="tl-table__value"><span class="tl-table__price tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-currency="mergedRoomStay.item1.stayPrice.priceAfterDiscount.priceBeforeTax"></span><span class="tl-table__price" ng-if="::mergedRoomStay.item2" tl-currency="mergedRoomStay.item2.stayPrice.priceAfterDiscount.priceBeforeTax"></span></div></div><div class="tl-table__data" ng-if="::(mergedRoomStay.item1.arrivalExtraStay.priceAfterTax.amount || mergedRoomStay.item2.arrivalExtraStay.priceAfterTax.amount)"><div class="tl-table__key"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span tl-message="\'T:compare_bookings.early_arrival\'"></span> <span tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item1.stayDates.startDate}"></span> </span><span ng-if="::mergedRoomStay.item2"><span tl-message="\'T:compare_bookings.early_arrival\'"></span> <span tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.startDate}"></span></span></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-currency="mergedRoomStay.item1.arrivalExtraStay.priceAfterTax"></span><span ng-if="::mergedRoomStay.item2" tl-currency="mergedRoomStay.item2.arrivalExtraStay.priceAfterTax"></span></div></div><div class="tl-table__data" ng-if="::(mergedRoomStay.item1.departureExtraStay.priceAfterTax.amount || mergedRoomStay.item2.departureExtraStay.priceAfterTax.amount)"><div class="tl-table__key"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)"><span tl-message="\'T:compare_bookings.late_departure\'"></span> <span tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item1.stayDates.endDate}"></span> </span><span ng-if="::mergedRoomStay.item2"><span tl-message="\'T:compare_bookings.late_departure\'"></span> <span tl-message="\'T:compare_bookings.at\'" message-params="{date: mergedRoomStay.item2.stayDates.endDate}"></span></span></div><div class="tl-table__value"><span class="tl-table__old" ng-if="::(mergedRoomStay.item1 && !mergedRoomStay.item2)" tl-currency="mergedRoomStay.item1.departureExtraStay.priceAfterTax"></span><span ng-if="::mergedRoomStay.item2" tl-currency="mergedRoomStay.item2.departureExtraStay.priceAfterTax"></span></div></div><div class="tl-table__data" ng-repeat="optionCode in ::optionCodes track by $index"><div class="tl-table__key"><span ng-if="::optionCode.item1 && !optionCode.item2" class="tl-table__old"><span tl-message="getOptionName(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))"></span> <span tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))}"></span> </span><span ng-if="::optionCode.item2"><span tl-message="getOptionName(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))"></span> <span tl-message="\'T:compare_bookings.count\'" message-params="{count: getOptionQuantity(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))}"></span></span></div><div class="tl-table__value"><span ng-if="::optionCode.item1 && !optionCode.item2"><span class="tl-table__old" ng-if="::!isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-currency="getOptionPrice(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1)).priceAfterTax"></span> <span class="tl-table__old" ng-if="::isOptionInclusive(optionCode.item1, getRoomStayOptions(mergedRoomStay.item1))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span> </span><span ng-if="optionCode.item2"><span ng-if="::!isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-currency="getOptionPrice(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2)).priceAfterTax"></span> <span ng-if="::isOptionInclusive(optionCode.item2, getRoomStayOptions(mergedRoomStay.item2))" tl-message="\'T:compare_bookings.inclusive\'" message-html="true"></span></span></div></div></div><div class="tl-table" ng-if="::(booking.total.priceAfterDiscount.tax.amount || comparedBooking.total.priceAfterDiscount.tax.amount)" ng-init="comparedTaxes = getComparedTaxes(booking.total.priceAfterDiscount.taxes, comparedBooking.total.priceAfterDiscount.taxes)"><div class="tl-table__title" ng-init="taxesUnit = getTaxesUnit(booking.total.priceAfterDiscount) || getTaxesUnit(comparedBooking.total.priceAfterDiscount)"><div tl-message="\'T:compare_bookings.taxes_per_stay\'" message-params="{kind: taxesUnit}"></div><a class="c1 -normal" tl-message="\'T:common.show\'" ng-if="::hasTaxesWithDescription(comparedTaxes)" ng-click="::openTaxesModal(comparedTaxes, taxesUnit.kind)"></a></div><div class="tl-table__data" ng-repeat="comparedBookingTax in ::comparedTaxes track by $index"><div class="tl-table__key x-cbrd__tax-info"><span tl-message="comparedBookingTax.item1.tax.name || comparedBookingTax.item2.tax.name"></span><div tl-tax-popover class="x-cbrd__tax-popover" tax-amount="comparedBookingTax.item1 || comparedBookingTax.item2" ng-if="::comparedBookingTax.item1.tax.description || comparedBookingTax.item2.tax.description"></div></div><div class="tl-table__value"><div><span class="tl-table__old" ng-if="::comparedBookingTax.item1" tl-currency="comparedBookingTax.item1"></span> <span ng-if="::!comparedBookingTax.item1">&mdash;</span></div><span ng-if="::comparedBookingTax.item2" tl-currency="comparedBookingTax.item2"></span> <span class="tl-table__price" ng-if="::!comparedBookingTax.item2">&mdash;</span></div></div></div><div class="tl-table" ng-if="::booking.transfers.length"><div class="tl-table__title" tl-message="\'T:compare_bookings.transfers\'"></div><div class="tl-table__data" ng-repeat="bookingTransfer in ::booking.transfers track by $index"><div class="tl-table__key"><span tl-message="bookingTransfer.transfer.name"></span> <span tl-message="\'T:order_info.vehicle\'" message-params="{count: bookingTransfer.getQuantity()}"></span></div><div class="tl-table__value"><span tl-currency="bookingTransfer.getTotalPrice().priceAfterTax"></span></div></div></div><div class="tl-table" ng-if="::booking.options.length"><div class="tl-table__title" tl-message="\'T:compare_bookings.booking_options\'"></div><div class="tl-table__data" ng-repeat="bookingOption in ::booking.options track by $index"><div class="tl-table__key"><span tl-message="bookingOption.name()"></span> <span tl-message="\'T:compare_bookings.count\'" message-params="{count: bookingOption.quantity()}"></span></div><div class="tl-table__value"><span tl-currency="bookingOption.getPrice().priceAfterTax"></span></div></div></div><div class="tl-table"><div class="tl-table__data tl-table__data_highlighted" ng-if="::!isHotelMode && hasDiscount(booking.total, comparedBooking.total)"><div class="tl-table__key"><b tl-message="\'T:compare_bookings.discount\'"></b></div><div class="tl-table__value"><div class="tl-table__old" tl-currency="booking.total.discountAmountBeforeTax"></div><div class="tl-table__current tl-table__price_highlighted bold" tl-currency="comparedBooking.total.discountAmountBeforeTax"></div></div></div><div class="tl-table__data tl-table__data_highlighted"><div class="tl-table__key"><b tl-message="\'T:compare_bookings.total\'"></b></div><div class="tl-table__value"><div class="tl-table__old" tl-currency="booking.total.priceAfterDiscount.priceAfterTax"></div><div class="tl-table__current tl-table__total h5" tl-currency="comparedBooking.total.priceAfterDiscount.priceAfterTax"></div></div></div></div></div>')}),!function(s){function e(t){return["tl.messages","$q","$compile",function(e,r,a){return{scope:{booking:"=",comparedBooking:"="},replace:!0,template:t,controller:["$scope",function(o){var i=new s.PlacementUtil(e),n=s.CollectionCalculator;o.isHotelMode=!s.BookingFormSettings.getInstance().isSharedMode(),o.mergedRoomStays=n.union(o.booking.roomStays,o.comparedBooking.roomStays,function(e,t){return e.getHashCode()==t.getHashCode()}),o.showAgeGroup=o.booking.bookingDate<=new Date(Date.UTC(2019,1,1,7,0,0))&&!s.BookingFormSettings.getInstance().isModeTurnedOn(s.BookingFormMode.SharedAccommodationRatePlan),o.getTaxesKind=function(e){return s.directive.helper.TaxHelper.resolveTaxAmountsKind(e.taxes)},o.getTaxesUnit=function(e){return new s.TaxUnit(o.getTaxesKind(e))},o.getPlacementDescription=function(e){e=s.PlacementManager.guestPlacementsToPlacement(e.guestPlacements);return i.getPlacementOrderDescription(e,o.showAgeGroup)},o.getGuestPlacementDescription=function(e){var t=_.head(e.childrenPlacements);return i.getPlacementKindDescription(e.kind,t?t.age:void 0)},o.getRoomStayOptions=function(e){var t;return _.concat(null!=(t=null==e?void 0:e.roomOptions)?t:[],null!=(t=null==e?void 0:e.mealPlans)?t:[])},o.getOptionName=function(t,e){return null==(e=_.find(e,function(e){return e.code()==t}))?void 0:e.getOption().name},o.getOptionQuantity=function(t,e){return _.chain(e).filter(function(e){return e.code()==t}).reduce(function(e,t){return e+t.quantity()},0).value()},o.getOptionPrice=function(t,e){var i=s.PriceCalculator.clone(_.head(e).getPrice());return s.PriceCalculator.clean(i),_.chain(e).filter(function(e){return e.code()==t}).reduce(function(e,t){return s.PriceCalculator.sumTo(e,t.getPrice()),e},i).value()},o.getComparedOptionsCodes=function(e,t){e=_.uniq(_.map(e,function(e){return e.code()})),t=_.uniq(_.map(t,function(e){return e.code()}));return n.intersect(e,t,function(e,t){return e==t})},o.isOptionInclusive=function(t,e){return null==(e=_.find(e,function(e){return e.code()===t}))?void 0:e.inclusive()},o.isOptionChanged=function(e,t,i,n){return!e||!t||(o.isOptionInclusive(e,i)!=o.isOptionInclusive(t,n)||!s.PriceCalculator.equal(o.getOptionPrice(e,i),o.getOptionPrice(t,n)))},o.getComparedTaxes=function(e,t){return n.intersect(e,t,function(e,t){return e.code==t.code})},o.getComparedGuestPlacements=function(e,t){return n.intersect(e,t,function(e,t){var i=_.head(e.childrenPlacements),n=_.head(t.childrenPlacements);return e.kind==t.kind&&e.capacity==t.capacity&&(i&&i.age)==(n&&n.age)})},o.isPlacementChanged=function(e,t){if(!e||!t)return!0;e=s.PlacementManager.guestPlacementsToPlacement(e.guestPlacements),t=s.PlacementManager.guestPlacementsToPlacement(t.guestPlacements);return!e.equals(t)},o.isRatePlanChanged=function(e,t){return!e||!t||e.ratePlan.id!=t.ratePlan.id},o.isPriceChanged=function(e,t){return!e||!t||!s.PriceCalculator.equal(e,t)},o.isTaxChanged=function(e,t){return!e||!t||(e.amount!=t.amount||e.currency!=t.currency)},o.hasDiscount=function(e,t){return e&&0!=e.discountAmountBeforeTax.amount||t&&0!=t.discountAmountBeforeTax.amount},o.hasTaxesWithDescription=function(e){return _.some(e,function(e){return!!e.item1&&!!e.item1.tax.description||!!e.item2&&!!e.item2.tax.description})},o.openTaxesModal=function(e,t){o.modalTaxes=_.map(e,function(e){return e.item1||e.item2}),o.modalTaxesKind=t;e=r.when(function(){return a('<tl-taxes-modal taxes="::modalTaxes" kind="::modalTaxesKind" />')(o)[0]});s.ModalManager.getInstance().open(e)},o.getRoomTypeUnit=function(e){return new s.RoomTypeUnit(e)}}]}}]}s.directive||(s.directive={}),s.registerDirective("tlCompareBookings",e(s.directiveTemplate({name:"compare-bookings"}))),s.registerDirective("tlCompareBookingsRoomDeleted",e(s.directiveTemplate({name:"compare-bookings",template:"compare-bookings-room-deleted"})))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/compare-cancellation-info/compare-cancellation-info.html",'<div class="x-cci" ng-if="::show()"><div ng-if="::isCommonCancellationText()"><div ng-if="::isCommonCancellationTextChanged()" class="x-cci__title title-h4" tl-message="\'T:compare_cancellation_info.will_change\'"></div><div ng-if="::!isCommonCancellationTextChanged()" class="x-cci__title title-h4" tl-message="\'T:compare_cancellation_info.will_not_change\'"></div><div ng-if="::getItem2().cancellationInfo.cancellationText" tl-message="getItem2().cancellationInfo.cancellationText" message-html="true"></div><div ng-if="::!getItem2().cancellationInfo.cancellationText" tl-message="\'T:cancellation_rule.free\'" message-html="true"></div><div class="x-cci__prev" ng-if="::isCommonCancellationTextChanged()" rel="prev-cancellation-info"><span class="x-cci__toggle link -normal" tl-message="\'T:compare_cancellation_info.show_prev\'"></span> <span class="x-cci__rules" tl-message="\'T:compare_cancellation_info.prev\'"></span><div ng-if="::getItem1().cancellationInfo.cancellationText" class="x-cci__cancellation-text" tl-message="getItem1().cancellationInfo.cancellationText" message-html="true"></div><div ng-if="::!getItem1().cancellationInfo.cancellationText" class="x-cci__cancellation-text" tl-message="\'T:cancellation_rule.free\'" message-html="true"></div></div></div><div ng-if="::!isCommonCancellationText()"><div ng-if="::cancellationInfoChanged.length" class="x-cci__title title-h4" tl-message="\'T:compare_cancellation_info.will_change\'"></div><div ng-repeat="mergedRoomStay in ::cancellationInfoChanged track by $index"><div class="x-cci__room" tl-message="mergedRoomStay.item2.roomType.name"></div><div ng-if="::mergedRoomStay.item2.cancellationInfo.cancellationText" tl-message="mergedRoomStay.item2.cancellationInfo.cancellationText" message-html="true"></div><div ng-if="::!mergedRoomStay.item2.cancellationInfo.cancellationText" tl-message="\'T:cancellation_rule.free\'" message-html="true"></div><div class="x-cci__prev" rel="prev-cancellation-info"><span class="x-cci__toggle link -normal" tl-message="\'T:compare_cancellation_info.show_prev\'"></span> <span class="x-cci__rules" tl-message="\'T:compare_cancellation_info.prev\'"></span><div ng-if="::mergedRoomStay.item1.cancellationInfo.cancellationText" class="x-cci__cancellation-text" tl-message="mergedRoomStay.item1.cancellationInfo.cancellationText" message-html="true"></div><div ng-if="::!mergedRoomStay.item1.cancellationInfo.cancellationText" class="x-cci__cancellation-text" tl-message="\'T:cancellation_rule.free\'" message-html="true"></div></div></div><div ng-if="::cancellationInfoNotChanged.length" class="x-cci__title title-h4" tl-message="\'T:compare_cancellation_info.will_not_change\'"></div><div ng-repeat="mergedRoomStay in ::cancellationInfoNotChanged track by $index"><div class="x-cci__room" tl-message="mergedRoomStay.item2.roomType.name"></div><div ng-if="::mergedRoomStay.item2.cancellationInfo.cancellationText" tl-message="mergedRoomStay.item2.cancellationInfo.cancellationText" message-html="true"></div><div ng-if="::!mergedRoomStay.item2.cancellationInfo.cancellationText" tl-message="\'T:cancellation_rule.free\'" message-html="true"></div></div></div></div>')}),!function(n){n.directive||(n.directive={});n.registerDirective("tlCompareCancellationInfo",["$timeout",function(i){return{scope:{booking:"=",comparedBooking:"="},templateUrl:"directives/compare-cancellation-info/compare-cancellation-info.html",controller:["$scope",function(t){t.show=function(){return t.comparedBooking.paymentSystem.type!=n.PaymentSystemType.Cash},t.mergedRoomStays=n.CollectionCalculator.union(t.booking.roomStays,t.comparedBooking.roomStays,function(e,t){return e.getHashCode()==t.getHashCode()});function e(e){var t=_.head(e.roomStays);return _.every(e.roomStays,function(e){return e.cancellationInfo.cancellationText==t.cancellationInfo.cancellationText})}t.isCommonCancellationText=function(){return e(t.booking)&&e(t.comparedBooking)},t.getItem1=function(){var e=_.find(t.mergedRoomStays,function(e){return!!e.item1});return e&&e.item1},t.getItem2=function(){var e=_.find(t.mergedRoomStays,function(e){return!!e.item2});return e&&e.item2},t.isCommonCancellationTextChanged=function(){return t.getItem1().cancellationInfo.cancellationText!=t.getItem2().cancellationInfo.cancellationText},t.cancellationInfoChanged=[],t.cancellationInfoNotChanged=[],_.forEach(t.mergedRoomStays,function(e){e.item2&&(!e.item1||e.item1&&e.item2&&e.item1.cancellationInfo.cancellationText==e.item2.cancellationInfo.cancellationText?t.cancellationInfoNotChanged:t.cancellationInfoChanged).push(e)})}],link:function(e,t){i(function(){var e=t[0].querySelectorAll('[rel="prev-cancellation-info"]');_.forEach(e,function(e){e.addEventListener(n.EventType.Click,function(){n.HtmlUtil.toggleClass(e,"x-cci__prev_opened",!0)})})},0)}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/mir-promo-motivator/mir-promo-motivator.html",'<div class="x-mrm" ng-if="::show"><div class="x-mrm__image"><div class="x-mrm__logo"></div></div><span tl-message="\'T:mir-promo-motivator.motivator\'"></span></div>')}),!function(t){t.directive||(t.directive={});t.registerDirective("tlMirPromoMotivator",[function(){return{restrict:"EA",templateUrl:"directives/mir-promo-motivator/mir-promo-motivator.html",scope:{stayDates:"=",paymentOptions:"=?",paymentSystems:"=?",forceShow:"=?"},controller:["$scope",function(e){e.show=e.forceShow||t.MirCashbackUtil.showMirPromotional(e.stayDates,e.paymentSystems,e.paymentOptions)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/filter/desktop/filter__desktop.html",'<div class="x-filter"><div class="x-filter__filter" ng-repeat="filter in filters track by $index" tl-id="fltr-${$index}"><div class="x-filter__label" ng-if="::!hideFilterNames" ng-class="::{\'uppercase\': filterNameStyle === \'uppercase\'}" ng-bind="transformFilterName(filter.name) | message"></div><div class="x-filter__description" ng-if="::(filter.description && !hideFilterNames)" ng-bind="filter.description | message"></div><div tl-select ng-if="::(!filter.isMultiSelect && filter.isValuable())" select-items="filter.options" select-model="filter.selected" select-match-template="selectMatchTemplate" select-choice-template="selectChoiceTemplate" select-update="selectNotifier.notifier" select-change="onSelectChange()"></div><div ng-if="::(filter.isMultiSelect && filter.isValuable())" class="x-filter__checkbox-group" ng-class="{\'x-filter__checkbox-group_inline\': isInlineLayoutStyle}"><div tl-checkbox ng-if="::(filter.options.length > 2 && filter.showSelectAll)" class="x-filter__checkbox" without-border="!isInlineLayoutStyle" on-popup="onPopup" selected="filter.allSelected" on-change="(filter.markAll() || filterAll()) && autoApplyFilterAction && apply()"><span tl-message="\'T:room-stay-filter.mark_all\'"></span></div><div tl-checkbox ng-repeat="option in filter.options track by option.code" class="x-filter__checkbox" tl-id="fcbo-${$index}" without-border="!isInlineLayoutStyle" on-popup="onPopup" selected="option.selected" on-change="(filter.onOptionChange() || filterAll()) && autoApplyFilterAction && apply()"><span ng-bind="option.name | message"></span></div></div><div class="x-filter__badge" ng-if="::(!filter.isValuable() && option.code != \'reset\')" ng-repeat="option in filter.options" tl-id="fico-${$index}"><svg class="x-filter__icon x-filter__badge-icon" ng-if="::option.categoryIconName"><use xlink:href="{{getIconHref(option.categoryIconName)}}"></use></svg><div class="x-filter__badge-text" ng-bind="option.name | message"></div></div></div><button class="tl-btn x-filter__button x-filter__button_apply" ng-class="{\'tl-btn_state_disabled\': !found.length}" ng-click="::apply()" ng-if="::!autoApplyFilterAction"><span ng-if="found.length" ng-bind="\'T:room-stay-filter.apply_cnt\' | message : {count: found.length}"></span> <span ng-if="!found.length" tl-message="\'T:room-stay-filter.not_found\'"></span></button> <button class="tl-btn-light tl-btn-light_on_iframe x-filter__button" ng-click="::reset()" tl-message="\'T:room-stay-filter.reset_filter\'" ng-if="::!autoApplyFilterAction"></button></div>'),e.put("directives/filter/filter-choice.html",'<%= $message($item.name) %> <% if ($item.description) { %> <div class="x-filter__select-hint"><%= $message($item.description) %></div> <% } %>'),e.put("directives/filter/filter-match.html",'<% if ($selected) { %> <% if ($selected.categoryIconName) { %> <div class="x-filter__match"><svg class="x-filter__icon"><use xlink:href="#<%= $selected.categoryIconName %>"></use></svg><div class="x-filter__match-text"><%= $message($selected.name) %></div></div> <% } else { %> <%= $message($selected.name) %> <% } %> <% } else { %> <%= $message(\'T:room-stay-filter.select\') %> <% }\n%>'),e.put("directives/filter/phone/filter__phone.html",'<div class="x-filter"><div class="x-filter__header" ng-class="{\'x-filter__header_active\': found.length}" ng-if="!headless"><b ng-if="found.length" ng-bind="\'T:room-stay-filter.found\' | message : {count: found.length}"></b> <b ng-if="!found.length" tl-message="\'T:room-stay-filter.not_found_sad\'" message-html="true"></b> <span ng-click="apply() || scrollToButton()" class="x-filter__control" ng-if="found.length && !autoApplyFilterAction" tl-message="\'T:room-stay-filter.apply\'"></span> <span ng-click="reset()" class="x-filter__control" ng-if="!found.length && !autoApplyFilterAction" tl-message="\'T:room-stay-filter.reset\'"></span></div><div ng-class="{\'x-filter__body\': !isCompact}"><div ng-if="::getFiltersTitle()" class="x-filter__title x-filter__name" ng-class="{\'uppercase\': filterNameStyle === \'uppercase\'}" tl-message="::getFiltersTitle()"></div><div ng-class="::{\'x-filter__filter\': !filter.isMultiSelect, \'x-filter__filter_multi-select\': filter.isMultiSelect}" ng-repeat="filter in filters track by $index" tl-id="fltr-${$index}"><div ng-class="{\'x-filter__title\': !isInlineLayoutStyle, \'x-filter__title_inline\': isInlineLayoutStyle}" ng-if="::(filter.isMultiSelect && !hideFilterNames)"><div class="x-filter__name" ng-class="{\'x-filter__name_uppercase\': filterNameStyle === \'uppercase\'}" ng-bind="transformFilterName(filter.name) | message"></div><div class="x-filter__description" ng-if="::filter.description" ng-bind="filter.description | message"></div></div><div ng-if="::!filter.isMultiSelect" class="x-filter__tags" ng-class="{\'x-filter__tags_with-icon\': filter.options[0].categoryIconName}"><svg class="x-filter__category-icon" ng-if="::filter.options[0].categoryIconName"><use xlink:href="{{getIconHref(filter.options[0].categoryIconName)}}"></use></svg><div tl-tag class="x-filter__tag" ng-repeat="option in filter.options track by option.code" tl-id="fstg-${$index}" ng-if="::option.code != \'reset\'" selected="option.selected" disabled="!filter.isValuable()" on-change="toggleSingleChoice(filter, option) || filterAll()"><span ng-bind="option.name | message"></span></div></div><div ng-if="::filter.isMultiSelect" ng-class="{\'x-filter__tags\': !isInlineLayoutStyle, \'x-filter__control_checkbox-group_inline\': isInlineLayoutStyle}"><div ng-if="::filter.isValuable()"><div tl-tag class="x-filter__tag" ng-if="::(filter.options.length > 2 && filter.showSelectAll)" selected="filter.allSelected" on-change="(filter.markAll() || filterAll()) && autoApplyFilterAction && apply()"><span tl-message="\'T:room-stay-filter.mark_all\'" message-params="{count: filter.matchAll.length}"></span></div></div><div tl-tag ng-if="::!multiSelectCheckbox" class="x-filter__tag" ng-repeat="option in filter.options track by option.code" tl-id="fmtg-${$index}" selected="option.selected" disabled="!filter.isValuable()" on-change="(filter.onOptionChange() || filterAll()) && autoApplyFilterAction && apply()"><span ng-bind="option.name | message"></span></div><div ng-if="::multiSelectCheckbox" ng-repeat="option in filter.options track by option.code" tl-id="fcbo-${$index}" class="x-filter__control_checkbox_inline"><div tl-checkbox class="x-filter__control_checkbox" without-border="false" on-popup="onPopup" selected="option.selected" on-change="(filter.onOptionChange() || filterAll()) && autoApplyFilterAction && apply()"><span ng-bind="option.name | message"></span></div></div></div></div><div ng-if="::(bookingOptionsAvailable || transfersAvailable)" class="x-filter__extras" tl-message="getExtrasHint()" message-html="true"></div><button class="tl-btn x-filter__button x-filter__button_apply" rel="apply-btn" ng-class="{\'tl-btn_state_disabled\': !found.length}" ng-click="apply() || scrollToButton()" ng-if="::!autoApplyFilterAction"><span ng-if="found.length" ng-bind="\'T:room-stay-filter.apply_cnt_rates\' | message : {count: found.length}"></span> <span ng-if="!found.length" tl-message="\'T:room-stay-filter.not_found\'"></span></button> <button class="tl-btn-light x-filter__button" ng-click="::reset()" ng-if="::!autoApplyFilterAction" tl-message="\'T:room-stay-filter.reset_filter\'"></button></div></div>')}),!function(o){o.directive||(o.directive={});o.registerDirective("tlFilter",["$q","tl.messages",function(t,n){return{restrict:"EA",scope:{filters:"=",storage:"=",applyFilterAction:"&",autoApplyFilterAction:"=?",filterNameStyle:"=?",layoutStyle:"=?",multiSelectCheckbox:"=",headless:"=",isCompact:"=",onPopup:"="},template:o.directiveTemplate({name:"filter"}),replace:!0,controller:["$scope",function(i){i.layoutStyle=_.isUndefined(i.layoutStyle)?"block":i.layoutStyle,i.isInlineLayoutStyle="inline"===i.layoutStyle,i.filterNameStyle=_.isUndefined(i.filterNameStyle)?"capitalize":i.filterNameStyle,i.hideFilterNames="hidden"===i.filterNameStyle;var e=_.chain(i.filters).map(function(e){return e.options}).flatten().map(function(e){return e.relatedIds}).flatten().uniq().value();i.opened=!1,i.selectChoiceTemplate=o.directiveTemplateUrl("filter","filter-choice"),i.selectMatchTemplate=o.directiveTemplateUrl("filter","filter-match"),i.selectNotifier=o.NotifierHelper.subscribe(i,t,!0,!1),i.selectNotifier.onLanguageChanged(function(){i.storage.restore(i.filters),i.selectNotifier.update()}),i.storage.restore(i.filters),i.filterAll=function(){return i.found=_.reduce(i.filters,function(e,t){return e=_.intersection(e,t.filter())},e),i.found},i.onSelectChange=function(){i.$applyAsync(function(){i.filterAll(),i.autoApply&&i.apply()})},i.toggleSingleChoice=function(e,t){i.$applyAsync(function(){t.selected?e.selected=t:e.selected=_.head(e.options),_.forEach(e.options,function(e){e.code!=t.code&&(e.selected=!1)}),i.filterAll(),i.autoApply&&i.apply()})},i.apply=function(e){void 0===e&&(e=o.directive.helper.UiFilterAction.Search),i.storage.store(i.filters),i.applyFilterAction({found:i.filterAll(),action:e})},i.apply(o.directive.helper.UiFilterAction.Init),i.reset=function(){_.forEach(i.filters,function(e){e.reset(),_.forEach(e.options,function(e){e.selected=!1})}),i.storage.store(i.filters),i.selectNotifier.update(),i.applyFilterAction({found:i.filterAll(),action:o.directive.helper.UiFilterAction.Reset})},i.getFiltersTitle=function(){var t=[];return _.forEach(i.filters,function(e){e.isMultiSelect||!e.isValuable()&&2!=e.options.length||t.push(n.getMessage(e.name))}),t.join(" / ")},i.getIconHref=function(e){return"#"+e},i.scrollToButton=function(){var e=document.querySelector('[rel="apply-btn"]');e&&o.util.IntegrationUtil.scrollTo(e.getBoundingClientRect().top,!1)},i.transformFilterName=function(e){return"capitalize"===i.filterNameStyle?o.StringUtil.capitalize(e):e}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/wish-list/wish-list-button.html",'<span class="x-wlb tl-btn" ng-show="wishListAvailable" tl-message="\'T:wish-list.request_button\'" ng-click="getWishListModalContent()"></span>'),e.put("directives/wish-list/wish-list-modal.html",'<div class="x-wlm"><div class="x-modal__close" ng-click="::close()"><svg class="x-modal__close-icon"><use xlink:href="#cancel"></use></svg></div><div class="x-modal__header" rel="heading" ng-if="state.initial"><h1 class="x-modal__title" tl-message="\'T:wish-list.form_title\'"></h1></div><div class="x-modal__content" ng-class="{\'x-wlm__content_pending\': pending, \'x-wlm__content\': state.initial}" rel="content"><div class="x-wlm__status" ng-if="state.succeed"><h4 class="x-wlm__title" tl-message="\'T:wish-list.succeed_title\'"></h4><p class="h6" tl-message="\'T:wish-list.succeed_message\'"></p></div><div class="x-wlm__status" ng-if="state.failed"><h4 class="x-wlm__title" tl-message="\'T:wish-list.failure_title\'"></h4><p class="h6" tl-message="\'T:wish-list.failure_message\'"></p></div><figure class="x-wlm__deal" ng-if="::roomType"><div class="x-wlm__media" ng-if="::roomType.images.length"><div tl-fit-image class="x-wlm__image" image="::roomType.images[0]"></div></div><figcaption class="x-wlm__caption"><h4 class="x-wlm__name" tl-message="::roomType.name"></h4><div class="x-wlm__dates"><svg class="x-wlm__calendar"><use xlink:href="#calendar"></use></svg> <span tl-message="\'T:common.date_format_long\'" message-params="{ date: checkInDate }"></span> <span ng-if="::checkOutDate">— <span tl-message="\'T:common.date_format_long\'" message-params="{ date: checkOutDate }"></span></span></div></figcaption></figure><div class="x-wlm__dates" ng-if="::!roomType"><svg class="x-wlm__calendar"><use xlink:href="#calendar"></use></svg> <span tl-message="\'T:common.date_format_long\'" message-params="{ date: checkInDate }"></span> <span ng-if="::checkOutDate">— <span tl-message="\'T:common.date_format_long\'" message-params="{ date: checkOutDate }"></span></span></div><div class="tl-data-table tl-data-table_secondary tl-data-table_on_popup" ng-if="!state.initial"><div class="tl-data-table__scrollable"><table><tr ng-if="wishListTicket.name"><td tl-message="\'T:common.name\'"></td><td tl-message="wishListTicket.name"></td></tr><tr ng-if="wishListTicket.phone && wishListTicket.phone.number()"><td tl-message="\'T:common.telephone\'"></td><td tl-message="wishListTicket.phone.number()"></td></tr><tr ng-if="wishListTicket.email"><td tl-message="\'T:common.email\'"></td><td tl-message="wishListTicket.email"></td></tr><tr ng-if="wishListTicket.comment"><td tl-message="\'T:wish-list.field_comment\'"></td><td tl-message="wishListTicket.comment"></td></tr></table></div></div><p ng-if="state.initial && !roomType" tl-message="\'T:wish-list.form_message\'"></p><p ng-if="state.initial && roomType" tl-message="\'T:wish-list.form_message_single\'" message-params="{roomName: roomType.name}"></p><form class="x-wlm__form" ng-show="state.initial" name="form.wishListForm" autocomplete="on"><table class="form -fixed-label"><tr class="form__row" ng-if="::wishListSettings.showName"><td class="form__cell"><label class="form__label" for="wl-name" tl-message="\'T:common.name\'"></label></td><td class="form__cell"><input tl-pattern="name" class="form-control x-wlm__field" id="wl-name" type="text" name="name" autocomplete="name" maxlength="255" ng-required="::wishListSettings.isNameRequired" ng-model="wishListTicket.name"></input><div tl-error-tooltip input-name="\'name\'" hide="hideValidation()" required-error-message="{{\'T:validation.firstname_req\' | message}}"></div></td></tr><tr class="form__row" ng-if="::wishListSettings.showPhone"><td class="form__cell"><label class="form__label" for="wl-tel" tl-message="\'T:common.telephone\'"></label></td><td class="form__cell"><div tl-phone-control class="x-wlm__field" input-id="\'wl-tel\'" input-name="\'phone\'" required="::wishListSettings.isPhoneRequired" parent-form="form.wishListForm" ng-model="wishListTicket.phone"></div><div tl-error-tooltip input-name="\'phone\'" hide="hideValidation()" required-error-message="{{\'T:validation.phone_req\' | message}}" error-message="{{\'T:validation.phone_length\' | message}}"></div></td></tr><tr class="form__row" ng-if="::wishListSettings.showEmail"><td class="form__cell"><label class="form__label nobr" for="wl-email" tl-message="\'T:common.email\'"></label></td><td class="form__cell"><input tl-pattern="noEmoji" class="form-control x-wlm__field" id="wl-email" type="email" name="email" maxlength="200" autocomplete="email" tl-email-pattern ng-required="::wishListSettings.isEmailRequired || !wishListSettings.isPhoneRequired" ng-model="wishListTicket.email"></input><div tl-error-tooltip input-name="\'email\'" hide="hideValidation()" required-error-message="{{\'T:validation.email_req\' | message}}" error-message="{{\'T:validation.email_nonformed\' | message}}"></div></td></tr><tr class="form__row" ng-if="::wishListSettings.showComment"><td class="form__cell"><label class="form__label" for="wl-comment" tl-message="\'T:wish-list.field_comment\'"></label></td><td class="form__cell"><div tl-textarea id="\'wl-comment\'" name="\'comment\'" maxlength="1000" model="wishListTicket.comment"></div><div tl-error-tooltip input-name="\'comment\'" hide="hideValidation()" error-message="{{\'T:validation.comment_length\' | message}}"></div></td></tr></table></form></div><div class="x-wlm__loader" ng-show="pending"><div class="loader loader_on_popup"><svg><use xlink:href="#loader"></use></svg></div></div><div class="x-modal__controls" ng-class="{\'x-wlm__controls\': state.initial}" rel="controls"><div class="x-wlm__agreement" ng-if="state.initial"><div ng-if="!requireAgreeWithBookingTerms"><span tl-message="\'T:wish-list.you_agree_with\'"></span> <a ng-click="::openPolicy()" tl-message="\'T:payment.you_agree_terms\'"></a></div><div tl-checkbox ng-if="requireAgreeWithBookingTerms" checkbox-id="::checkboxId" required="true" selected="wishListTicket.userAgreed" without-border="true"><span tl-message="\'T:payment.im_agree_with\'" message-html="true"></span> <a ng-click="::openPolicy()" tl-message="\'T:payment.you_agree_terms\'"></a></div></div><div class="button-group button-group_rtl button-group_nowrap"><span class="button-group__item tl-btn-light tl-btn-light_on_popup" tl-message="\'T:modal.close\'" ng-click="::close()"></span><span class="button-group__item tl-btn tl-btn_on_popup" ng-if="!state.succeed" ng-class="{\'tl-btn_state_disabled\': pending || (requireAgreeWithBookingTerms && !wishListTicket.userAgreed)}" ng-bind="state.initial ? \'T:wish-list.form_submit\' : \'T:wish-list.form_retry\' | message" ng-click="::submit()"></span></div></div></div>')}),!function(a){var s,l;function e(){}function t(){this._state=s.Initial}function i(r,t,i){return["$q","$compile","locale",function(e,n,o){return{restrict:"EA",templateUrl:t,replace:i,scope:{checkInDate:"=",checkOutDate:"=",roomType:"=?",ratePlan:"=?",wishListService:"="},controller:["$scope",function(t){var i;_.isUndefined(t.wishListService)||(t.wishListService.getSettings(o.language()).then(function(e){t.wishListSettings=e,t.wishListTicket=t.wishListService.getTicket(),_.isUndefined(t.wishListSettings.enabled)||(t.wishListAvailable=t.wishListService.isAvailable(t.checkInDate,t.checkOutDate),t.wishListSettings.enabled?i("shown"):i("disabled"))}),t.state=new l,t.pending=!1,t.form={wishListForm:null},t.hideValidation=function(){return!t.form.wishListForm.$submitted},t.requireAgreeWithBookingTerms=a.BookingFormSettings.getInstance().requireAgreeWithBookingTerms,t.checkboxId=_.uniqueId("wl-cbx"),t.openPolicy=function(){a.ModalManager.getInstance().open(e.when(function(){return t.policyContentType=a.PolicyPageType.PrivacyPolicy.toString(),t.bookingFormInfo=t.wishListService.getLegalDocuments(o.language()),n('<tl-policy content-type="{{policyContentType}}" booking-form-info="bookingFormInfo" />')(t)[0]}),{stacked:!0})},t.submit=function(){t.pending||t.requireAgreeWithBookingTerms&&!t.wishListTicket.userAgreed||(i("submitted"),t.form.wishListForm.$setSubmitted(),t.form.wishListForm.$valid&&(t.pending=!0,t.roomType&&(t.wishListTicket.roomTypeId=t.roomType.id),t.ratePlan&&(t.wishListTicket.ratePlanId=t.ratePlan.id),t.wishListTicket.checkInDate=t.checkInDate,t.wishListTicket.nights=t.checkOutDate.diffInDays(t.checkInDate),t.wishListService.sendTicket(o.language()).then(function(){t.state.setState(s.Succeed),i("succeed")}).catch(function(){t.state.setState(s.Failed),i("failed")}).finally(function(){t.pending=!1})))},t.close=function(){a.ModalManager.getInstance().close()},t.getWishListModalContent=function(){a.ModalManager.getInstance().open(e.when(function(){return n('<tl-wish-list-modal check-in-date="::checkInDate" check-out-date="::checkOutDate" room-type="::roomType" wish-list-service="wishListService">')(t)[0]}))},i=function(e){a.TrackerService.trackExperiment(a.Experiment.WishList,{providerId:a.BookingFormSettings.getInstance().providerId,eventInitiator:r,status:e,roomTypeId:t.roomType?"rt-"+t.roomType.id:"no-rooms",checkInDate:t.checkInDate.format("YYYY-MM-DD"),checkOutDate:t.checkOutDate.format("YYYY-MM-DD")},!0)})}]}}]}a.directive||(a.directive={}),e.Initial="initial",e.Succeed="succeed",e.Failed="failed",s=e,t.prototype.setState=function(e){this._state=e},Object.defineProperty(t.prototype,"initial",{get:function(){return this._state==s.Initial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"succeed",{get:function(){return this._state==s.Succeed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"failed",{get:function(){return this._state==s.Failed},enumerable:!0,configurable:!0}),l=t,a.registerDirective("tlWishListButton",i("wish-list-button","directives/wish-list/wish-list-button.html",!0)),a.registerDirective("tlWishListModal",i("wish-list-modal","directives/wish-list/wish-list-modal.html",!1))}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/closest-available-dates/closest-available-dates.html",'<div class="x-cad"><div ng-repeat="dates in ::closestAvailableDates" tl-id="cad-${$index}" class="tl-panel tl-panel_selectable x-cad__date" ng-click="selectDatesAction({$event: $event, dates: dates})"><div class="tl-panel__item" ng-if="::!dates.startDate.isEqualDate(dates.endDate)" tl-message="\'T:rooms.closest_available_date_range\'" message-params="{checkin: dates.startDate, checkout: dates.endDate, days: dates.duration()}" message-html="true"></div><div class="tl-panel__item" ng-if="::dates.startDate.isEqualDate(dates.endDate)" tl-message="\'T:rooms.closest_available_date\'" message-params="{checkin: dates.startDate, days: dates.duration()}" message-html="true"></div></div><div class="tl-panel tl-panel_selectable x-cad__date" ng-if="::!hideSearchButton" ng-click="searchAction()"><div class="tl-panel__item"><a class="-normal" tl-message="\'T:rooms.other_date\'"></a></div></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlClosestAvailableDates",[function(){return{restrict:"AE",templateUrl:"directives/closest-available-dates/closest-available-dates.html",scope:{closestAvailableDates:"=",hideSearchButton:"=?",selectDatesAction:"&",searchAction:"&?"},controller:["$scope",function(e){}]}}])}(tl=tl||{}),!function(a){a.directive||(a.directive={});a.registerDirective("tlSticky",[function(){return{scope:{disabled:"=?"},restrict:"A",link:function(e,t){var i,n,o,r;!_.isUndefined(e.disabled)&&e.disabled||(n=t[0],o=0,r=n.parentNode,a.HtmlUtil.toggleClass(n,"x-sticky"),i=setInterval(function(){var e=AppIntegration.getPosition(),e=e.scrollTop+e.fixedHeaderHeight,t=r.getBoundingClientRect().top+window.pageYOffset,e=t<e?Math.round(Math.min(e-t,r.offsetHeight-n.offsetHeight)):0;e!=o&&(o=e,a.HtmlUtil.transform(n,"translate(0, "+e+"px)"))},200),e.$on("$destroy",function(){a.HtmlUtil.toggleClass(n,"x-sticky"),clearInterval(i)}))}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/slider/slider.html",'<div class="x-slider"><div class="x-slider__viewport"><div class="x-slider__content"><div class="x-slider__list" ng-style="{\'width\': availabilitySettings.sliderWidth + \'px\', \'height\': sliderHeight + \'px\'}" ng-class="{\'-availability-mode\': availabilityMode}"><div class="x-slider__list-item" ng-repeat="item in getItemsAction()" data-key="{{item.date.format(\'YYYY-MM-DD\')}}" ng-style="{\'left\': item.leftPosition + \'px\'}"><div ng-transclude></div></div><div class="x-slider__list-item" ng-repeat="item in items track by $index" tl-id="sli-${$index}"><div ng-transclude></div></div></div></div></div></div>')}),tl.registerDirective("tlSlider",["$q",function(g){var h=angular.element(window);return{restrict:"EA",transclude:!0,scope:{items:"=",selectedItem:"=",subscriptionCode:"=?",getItemsAction:"&?",availabilitySettings:"=?",isNavigation:"=?"},templateUrl:"directives/slider/slider.html",link:function(i,e){i.availabilityMode=!_.isUndefined(i.availabilitySettings);function t(){i.$applyAsync(function(){var e=s.querySelector(".x-slider__list-item");i.sliderHeight=tl.HtmlUtil.getAbsoluteHeight(e)})}function n(e){void 0===e&&(e=""),i.isNavigation&&d.notify(tl.directive.helper.AvailabilityCalendarInformerMessageType.UpdateSliderState,e,{count:r.getViewportCapacity(),date:r.date}),r.isNextButtonDisabled||d.notify(tl.directive.helper.AvailabilityCalendarInformerMessageType.ActivateSliderNextButton,e),r.isNextButtonDisabled&&d.notify(tl.directive.helper.AvailabilityCalendarInformerMessageType.DeactivateSliderNextButton,e),r.isPrevButtonDisabled||d.notify(tl.directive.helper.AvailabilityCalendarInformerMessageType.ActivateSliderPrevButton,e),r.isPrevButtonDisabled&&d.notify(tl.directive.helper.AvailabilityCalendarInformerMessageType.DeactivateSliderPrevButton,e)}function o(){p&&(r.update(),n(i.subscriptionCode),i.availabilityMode&&t())}var r,a=e[0].querySelector(".x-slider__viewport"),s=e[0].querySelector(".x-slider__list"),l=(i.availabilityMode?(r=new tl.directive.helper.AvailabilitySlider(a,s,i.getItemsAction,i.availabilitySettings,g),t()):r=new tl.directive.helper.Slider(a,s,i.items),{callback:function(){r.slideAt(-1),n(i.subscriptionCode)}}),c={callback:function(){r.slideAt(1),n(i.subscriptionCode)}},u={callback:function(){r.slideTo(i.availabilitySettings.startDate).then(function(){return n(i.subscriptionCode)})}},d=tl.directive.helper.AvailabilityCalendarInformer.getInstance(),p=(d.subscribe(l,tl.directive.helper.AvailabilityCalendarInformerMessageType.SlideLeft,i.subscriptionCode),d.subscribe(c,tl.directive.helper.AvailabilityCalendarInformerMessageType.SlideRight,i.subscriptionCode),i.availabilityMode&&d.subscribe(u,tl.directive.helper.AvailabilityCalendarInformerMessageType.SlideTo,i.subscriptionCode),!1),m=(h.on(tl.EventType.Resize,o),i.$on(tl.BroadcastEvent.WindowSizeChanged,o),i.$on("$destroy",function(){d.unsubscribe(l,tl.directive.helper.AvailabilityCalendarInformerMessageType.SlideLeft,i.subscriptionCode),d.unsubscribe(c,tl.directive.helper.AvailabilityCalendarInformerMessageType.SlideRight,i.subscriptionCode),i.availabilityMode&&d.unsubscribe(u,tl.directive.helper.AvailabilityCalendarInformerMessageType.SlideTo,i.subscriptionCode),h.off(tl.EventType.Resize,o)}),i.availabilityMode||i.$watch(function(){return i.selectedItem},function(){r.slideTo(i.selectedItem),n(i.subscriptionCode)}),setInterval(function(){var e,t=(null==(e=i.getItemsAction)?void 0:e.call(i))||i.items;(i.selectedItem||null!=t&&t.length)&&(clearInterval(m),i.$applyAsync(function(){i.selectedItem?r.slideTo(i.selectedItem):i.availabilityMode?r.slideTo(i.availabilitySettings.startDate).then(function(){return n(i.subscriptionCode)}):(r.slideTo(_.head(t)),n(i.subscriptionCode)),p=!0}))},100))}}}]),tl.registerTemplate(function(e){"use strict";e.put("directives/availability-calendar-date/availability-calendar-date.html",'<div class="x-acd" ng-class="item.customCssClass"><div class="c1 x-acd__weekday" ng-bind="\'T:common.weekday_format\' | message: { date: item.date }"></div><div class="c2 x-acd__date" ng-bind="\'T:common.date_format_short\' | message: { date: item.date }"></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlAvailabilityCalendarDate",[function(){return{restrict:"EA",scope:!1,replace:!0,templateUrl:"directives/availability-calendar-date/availability-calendar-date.html",controller:["$scope",function(e){e.item=e.$parent.item}],link:function(){}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/availability-calendar-price/availability-calendar-price.html",'<div class="x-acp" ng-class="[{\'x-acp_valid\': item.isAvailable === true}, item.customCssClass]"><div ng-if="item.isLoaded && (!item.isAvailable || !item.price.priceAfterTax.amount)"><div class="loader x-acp__icon x-acp__icon_loader" ng-show="item.isAvailable === null"><svg><use xlink:href="#loader"></use></svg></div><div ng-show="item.isAvailable !== null"><svg class="x-acp__icon x-acp__icon_valid" ng-if="item.isAvailable"><use xlink:href="#valid-thin"></use></svg> <svg class="x-acp__icon" ng-if="!item.isAvailable"><use xlink:href="#not-available"></use></svg></div></div><div class="x-acp__price" ng-if="item.isLoaded && item.isAvailable === true && item.price.priceAfterTax.amount"><div tl-currency="item.price | tlTax" currency-format="%.0ds"></div></div></div>')}),!function(e){e.directive||(e.directive={});e.registerDirective("tlAvailabilityCalendarPrice",[function(){return{restrict:"EA",scope:!1,replace:!0,templateUrl:"directives/availability-calendar-price/availability-calendar-price.html",link:function(e){e.item=e.$parent.item}}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/mir-cashback-unavailable/mir-cashback-unavailable.html",'<div class="x-mcu" ng-if="show"><div class="x-mcu__image"></div><div class="x-mcu__message" tl-message="\'T:mir-promo.sorry\'" message-html="true"></div></div>')}),!function(r){r.directive||(r.directive={});r.registerDirective("tlMirCashbackUnavailable",["$state",function(o){return{restrict:"EA",templateUrl:"directives/mir-cashback-unavailable/mir-cashback-unavailable.html",scope:{source:"="},controller:["$scope",function(e){var t=r.BookingFormSettings.getInstance(),i=t.hasPromoOffer(r.PromoOffer.MirCashback),n=t.forceDisablePromoMir;e.show=(i||n)&&!t.promoMirSettings&&r.MirCashbackUtil.isShowPeriodValid()&&!t.hasFeature(r.Feature.HideBannerMir),e.show&&r.TrackerService.trackExperiment(r.PromoOffer.MirCashback,{action:e.source,page:o.current&&o.current.name},!1)}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/room-info-details/room-info-details.html",'<div class="x-rid"><div ng-if="::(showSize && roomType.size)" tl-message="\'T:rooms.square_extended\'" message-params="{area: roomType.size}" message-html="true"></div><div ng-if="::(showOccupancy && showRoomCapacity)" tl-message="getOccupancyText()" message-html="true"></div></div>')}),!function(a){a.directive||(a.directive={});a.registerDirective("tlRoomInfoDetails",["tl.messages",function(r){return{scope:{roomType:"=",showSize:"=?",showRules:"=?",showOccupancy:"=?"},templateUrl:"directives/room-info-details/room-info-details.html",replace:!0,controller:["$scope",function(n){n.showSize=!!_.isUndefined(n.showSize)||n.showSize,n.showOccupancy=!!_.isUndefined(n.showOccupancy)||n.showOccupancy,n.showRoomCapacity=a.RoomTypeUtil.showRoomCapacity(n.roomType),n.getOccupancyText=function(){var e,t=n.roomType.occupancy.total,t=[r.formatMessage(1===t?"T:rooms.occupancy_exact":"T:rooms.occupancy",{value:t})],i=(!n.showRules||(i=new a.PlacementUtil(r).getPlacementNote())&&t.push(i),o());return i&&!a.BookingFormSettings.getInstance().isModeTurnedOn(a.BookingFormMode.GuestRoomBookingForm)&&(e=1==n.roomType.occupancy.withoutBeds?"T:rooms.occupancy_without_bed_one":"T:rooms.occupancy_without_bed_some",t.push(r.formatMessage(e,{ageGroups:i}))),t.join(r.getMessage("T:rooms.occupancy_separator"))};var o=function(){var e,t,i=[];return _.forEach((e=n.roomType.occupancy.withoutBedsAgeGroups,e=_.sortBy(e,"minAge"),t=[],_.forEach(e,function(e){!t.length||_.last(t).maxAge<e.minAge?t.push(new a.AgeGroup(e.minAge,e.maxAge)):_.last(t).maxAge=e.maxAge}),t),function(e){var t=[];0!=e.minAge&&t.push(r.formatMessage("T:rooms.occupancy_starts",{age:e.minAge})),t.push(r.formatMessage("T:rooms.occupancy_ends",{age:e.maxAge})),i.push(t.join(" "))}),i.join(", ")}}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/best-price-guarantee/best-price-guarantee.html",'<div class="x-bpg" ng-if="show" ng-class="{\'-price-wrap\': inlinePriceViewMode, \'-vertical\': verticalViewMode, \'-narrow\': narrowViewMode, \'-loading\': loadingAdvantages}"><div class="x-bpg__container"><div class="x-bpg__title" ng-if="!verticalViewMode"><span class="x-bpg__title-label" tl-message="\'T:best-price-guarantee.title\'" message-html="true"></span> <svg class="x-bpg__title-curve"><use xlink:href="#curve"></use></svg></div><div class="x-bpg__list" ng-class="{\'-full\': !minPriceRoomStay && !loadingPrice}"><div class="x-bpg__title" ng-if="verticalViewMode"><span class="x-bpg__title-label" tl-message="\'T:best-price-guarantee.title\'" message-html="true"></span> <svg class="x-bpg__title-curve"><use xlink:href="#curve"></use></svg></div><div class="x-bpg__item" ng-repeat="item in items"><div class="x-bpg__item-icon" ng-if="!item.action"><svg><use xlink:href="#check"></use></svg></div><div class="x-bpg__item-icon -link" ng-if="item.action" ng-click="item.action()"><div class="x-bpg__item-pulse"></div><svg><use xlink:href="#gift"></use></svg></div><div class="x-bpg__item-content"><span class="x-bpg__item-label" ng-if="!item.action" message-html="true" tl-message="item.text"></span> <span class="x-bpg__item-label -link" ng-if="item.action" ng-click="item.action()" tl-message="item.text"></span></div></div></div><div class="x-bpg__compare" ng-if="priceExpected"><div class="x-bpg__price" ng-class="{\'-loading\': priceExpected && !price}"><div class="x-bpg__price-label" tl-message="\'T:best-price-guarantee.online\'"></div><div class="x-bpg__price-value"><span ng-bind-html="price.priceAfterDiscount | tlTax | tlCurrency"></span></div></div></div></div></div>')}),!function(d){d.directive||(d.directive={});d.registerDirective("tlBestPriceGuarantee",["serviceFactory","tl.messages","$q","$compile","$rootScope",function(s,e,l,c,u){return{restrict:"EA",replace:!1,scope:{price:"="},template:d.directiveTemplate({name:"best-price-guarantee",single:!0}),controller:["$scope",function(t){var e,i,n,o=d.BookingFormSettings.getInstance(),r=s.bookingService.getSearchCriteria(),a=!o.hasFeature(d.Feature.HideBannerMir)&&(o.isMirCashbackAvailable()&&d.MirCashbackUtil.isShowingMotivator(r.checkInDate)||o.hasPromoOffer(d.PromoOffer.MirCashback)||o.forceDisablePromoMir);o.bestPriceGuaranteeBannerEnabled&&!a&&(t.show=!0,t.priceExpected=o.bestPriceGuaranteePriceEnabled&&!1!==t.price&&1==r.placements.length,t.items=[],t.guestProfileService=s.guestProfileService,t.showLoginDialog=function(){d.ModalManager.getInstance().open(l.when(function(){var e=u.$new(!0);return c("<tl-guest-log-in-modal></tl-guest-log-in-modal>")(e)[0]}),{fitContent:!0,fullScreen:!1,withoutSidePaddings:!0})},_.times(3,function(){return t.items.push(new d.BestPriceGuaranteeAdvantage(""))}),t.bestPriceGuaranteeService=s.bestPriceGuaranteeService,t.loadAdvantages=function(){t.loadingAdvantages=!0,t.bestPriceGuaranteeService.getAdvantages().then(function(e){e.length<3?t.show=!1:(t.items=e.slice(0,3),t.loadingAdvantages=!1,t.show=!0,t.$applyAsync())})},t.loadAdvantages(),(e=d.LanguageInformer.getInstance()).subscribe(i={callback:function(){return t.loadAdvantages(),l.when()}}),(n=function(){var e=window.innerWidth||document.documentElement.clientWidth;t.inlinePriceViewMode=t.priceExpected&&e<840,t.verticalViewMode=e<720,t.narrowViewMode=e<340,t.$applyAsync()})(),angular.element(window).bind(d.EventType.Resize,n),t.$on("$destroy",function(){angular.element(window).unbind(d.EventType.Resize,n),e.unsubscribe(i)}))}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/mir-promo-welcome/mir-promo-welcome.html",'<div class="x-mpw" ng-class="{\'-registered\': isRegistered()}" ng-if="::show" ng-click="showDetails($event)" rel="mir-promo-welcome"><div class="x-mpw__header"><div class="x-mpw__promo"><div class="x-mpw__title" tl-message="\'T:mir-promo-welcome.title\'" message-params="mirMessageParams" message-html="true"></div><div class="x-mpw__logo"><div class="x-mpw__image"></div></div></div><div class="x-mpw__details"><span rel="about" tl-message="\'T:mir-promo-welcome.about\'" message-params="mirMessageParams" message-html="true"></span></div></div><div class="x-mpw__content"><div class="x-mpw__term"><div class="x-mpw__icon"><svg><use xlink:href="#m-calendar"></use></svg></div><div class="x-mpw__text" tl-message="\'T:mir-promo-welcome.nights\'" message-params="mirMessageParams" message-html="true"></div></div><div class="x-mpw__term"><div class="x-mpw__icon"><svg><use xlink:href="#m-wallet"></use></svg></div><div class="x-mpw__text" tl-message="\'T:mir-promo-welcome.max_cb\'" message-params="mirMessageParams" message-html="true"></div></div><div class="x-mpw__term" ng-if="!isRegistered()"><div class="x-mpw__icon"><svg><use xlink:href="#mir-check-circle"></use></svg></div><div class="x-mpw__text" tl-message="\'T:mir-promo-welcome.register_req\'" message-params="mirMessageParams" message-html="true"></div></div><div class="x-mpw__term" ng-if="isRegistered()"><div class="x-mpw__icon"><svg><use xlink:href="#mir-check-circle"></use></svg></div><div class="x-mpw__text" tl-message="\'T:mir-promo-welcome.complete\'" message-params="mirMessageParams" message-html="true"></div></div><div class="x-mpw__term -button" ng-if="!isRegistered()"><div class="x-mpw__button" ng-if="!isRegistered()" ng-click="register()" rel="wasteland"><div class="x-mpw__button-text" tl-message="\'T:mir-promo-welcome.register\'" message-params="mirMessageParams" message-html="true"></div><svg class="x-mpw__button-icon"><use xlink:href="#mir-external-link"></use></svg></div></div></div></div>')}),!function(u){u.directive||(u.directive={});u.registerDirective("tlMirPromoWelcome",["$q","$compile","$state","$templateCache","serviceFactory",function(r,a,s,l,c){return{restrict:"EA",templateUrl:"directives/mir-promo-welcome/mir-promo-welcome.html",scope:!0,controller:["$scope",function(n){var t,e,i,o=u.BookingFormSettings.getInstance();o.isMirCashbackAvailable()&&!o.hasFeature(u.Feature.HideBannerMir)&&(o=c.bookingService.getSearchCriteria(),u.MirCashbackUtil.isShowingMotivator(o.checkInDate)&&(n.show=!0,n.mirMessageParams=u.MirCashbackUtil.getMessageParams(),t=function(e){u.ModalManager.getInstance().open(r.when(function(){var e=l.get("directives/mir-cashback/mir-cashback-modal.html");return a(e)(n)[0]}));var t="banner";try{var i=e.target.getAttribute("rel");i&&(t=i)}catch(e){}u.TrackerService.trackExperiment(u.PromoOffer.MirCashback,{action:"go-to-action-info",page:s.current&&s.current.name,target:t,source:u.MirCashbackUtil.isRegistered()?"cashback-banner-with-registration":"cashback-banner-without-registration"},!1)},n.showDetails=function(e){u.HtmlUtil.handleBlockableEvent({event:e,targetRel:"mir-promo-welcome",blockerRel:"wasteland",handler:t})},n.close=function(){u.ModalManager.getInstance().close()},n.isRegistered=function(){return u.MirCashbackUtil.isRegistered()},n.register=function(){u.MirCashbackUtil.canOpenNewPage()?s.go(u.AppState.MirRegister):u.ModalManager.getInstance().open(r.when(function(){return a("<tl-mir-promo-register-modal></tl-mir-promo-register-modal>")(n)[0]}),{stacked:!0,fitContent:!0}),u.TrackerService.trackExperiment(u.PromoOffer.MirCashback,{action:"go-to-mir-registration",page:s.current&&s.current.name,source:"cashback-banner-without-registration",target:"register",newPage:u.MirCashbackUtil.canOpenNewPage()},!1)},e=u.MirCashbackUtil.isRegistered(),(i=function(){u.TrackerService.trackExperiment(u.PromoOffer.MirCashback,{action:u.MirCashbackUtil.isRegistered()?"cashback-banner-with-registration-shown":"cashback-banner-without-registration-shown",page:s.current&&s.current.name},!1)})(),n.$watch(function(){return u.MirCashbackUtil.isRegistered()},function(){!e&&u.MirCashbackUtil.isRegistered()&&i()})))}]}}])}(tl=tl||{}),tl.registerTemplate(function(e){"use strict";e.put("directives/room-type-availability-calendar/room-type-availability-calendar.html",'<div class="x-rtac"><div class="x-rtac__description" ng-bind="\'T:availability-calendar.guests_hint\' | message: {guests: findRoomAvailabilitiesGuests(), price: currencyPrice}"></div><div tl-slider get-items-action="getDateAvailabilitiesAction()" subscription-code="subscriptionCode" availability-settings="settings" is-navigation="true"><div tl-availability-calendar-date item="item"></div><div tl-availability-calendar-price item="item" ng-click="onAvailabilityChoiceClick($event, item)"></div></div><div class="x-rtac__navigation"><div class="x-rtac__nav" ng-class="{\'x-rtac__nav_disabled\': !slideButtonState.prev}" ng-click="slide(slideDirection.left, subscriptionCode)"><div class="tl-btn-light tl-btn-light_transparent"><svg class="tl-btn-light__icon"><use xlink:href="#arrow-left"></use></svg> <span tl-message="\'T:availability-calendar.before\'"></span></div></div><div class="x-rtac__nav" ng-class="{\'x-rtac__nav_disabled\': !slideButtonState.next}" ng-click="slide(slideDirection.right, subscriptionCode)"><div class="tl-btn-light tl-btn-light_transparent"><span tl-message="\'T:availability-calendar.after\'"></span> <svg class="tl-btn-light__icon"><use xlink:href="#arrow-right"></use></svg></div></div></div></div>')}),!function(u){var d;d=u.directive||(u.directive={}),u.registerDirective("tlRoomTypeAvailabilityCalendar",["$timeout",function(c){return{restrict:"EA",scope:{settings:"=",roomType:"=",checkRoomTypeAvailabilityAction:"&",availabilityChoiceAction:"&",subscriptionCode:"=?"},replace:!0,templateUrl:"directives/room-type-availability-calendar/room-type-availability-calendar.html",controller:["$scope",function(n){function e(e,t,i){return n.checkRoomTypeAvailabilityAction({date:e,roomType:t,currency:i})}function i(){n.roomAvailabilities=d.helper.AvailabilityCalendarHelper.getDatePriceSliderElements(n.settings,n.roomType,e,n.roomAvailabilities)}i(),n.onAvailabilityChoiceClick=function(e,t){return n.availabilityChoiceAction({event:e,item:t})},n.getDateAvailabilitiesAction=function(){return n.roomAvailabilities},n.findRoomAvailabilitiesGuests=function(){var e=_.find(n.roomAvailabilities,function(e){return null!=e.guests});return e?e.guests:1};var o=u.directive.helper.AvailabilityCalendarInformer.getInstance(),t=(n.slideDirection={left:u.directive.helper.AvailabilityCalendarInformerMessageType.SlideLeft,right:u.directive.helper.AvailabilityCalendarInformerMessageType.SlideRight},n.slideButtonState={prev:!1,next:!1},{callback:function(){n.slideButtonState.next=!0,n.$applyAsync()}}),r={callback:function(){n.slideButtonState.next=!1,n.$applyAsync()}},a={callback:function(){n.slideButtonState.prev=!0,n.$applyAsync()}},s={callback:function(){n.slideButtonState.prev=!1,n.$applyAsync()}},l={callback:function(e){e.count&&(n.settings.rendererDatesCount=e.count+1),e.date&&(n.settings.startDate=u.directive.helper.AvailabilityCalendarHelper.getStartDate(n.settings,e.date.resetTime()))}};o.subscribe(t,u.directive.helper.AvailabilityCalendarInformerMessageType.ActivateSliderNextButton,n.subscriptionCode),o.subscribe(r,u.directive.helper.AvailabilityCalendarInformerMessageType.DeactivateSliderNextButton,n.subscriptionCode),o.subscribe(a,u.directive.helper.AvailabilityCalendarInformerMessageType.ActivateSliderPrevButton,n.subscriptionCode),o.subscribe(s,u.directive.helper.AvailabilityCalendarInformerMessageType.DeactivateSliderPrevButton,n.subscriptionCode),o.subscribe(l,u.directive.helper.AvailabilityCalendarInformerMessageType.UpdateSliderState,n.subscriptionCode),n.$on("$destroy",function(){o.unsubscribe(t,u.directive.helper.AvailabilityCalendarInformerMessageType.ActivateSliderNextButton,n.subscriptionCode),o.unsubscribe(r,u.directive.helper.AvailabilityCalendarInformerMessageType.DeactivateSliderNextButton,n.subscriptionCode),o.unsubscribe(a,u.directive.helper.AvailabilityCalendarInformerMessageType.ActivateSliderPrevButton,n.subscriptionCode),o.unsubscribe(s,u.directive.helper.AvailabilityCalendarInformerMessageType.DeactivateSliderPrevButton,n.subscriptionCode),o.unsubscribe(l,u.directive.helper.AvailabilityCalendarInformerMessageType.UpdateSliderState,n.subscriptionCode)}),n.slide=function(e,t){n.settings.startDate=u.directive.helper.AvailabilityCalendarHelper.getStartDateByDirection(n.settings,e),i(),c(function(){return o.notify(e,t)})}}]}}])}(tl=tl||{});